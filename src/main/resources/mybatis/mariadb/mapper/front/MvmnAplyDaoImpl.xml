<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SQL File Name : MvmnAplyDaoImpl.xml
    Description : 푸름이 이동환경교실 교육신청
-->
<mapper namespace="com.kbrainc.plum.front.mvmnAply.model.MvmnAplyDao">
    
    <!-- 푸름이 이동환경교실 교육신청 목록 조회 -->
    <select id="selectMvmnAplyList" parameterType="front.MvmnAplyVo" resultType="front.MvmnAplyVo">
        /* MvmnAplyDao.selectMvmnAplyList */
        <include refid="PaginationMapper.header"/>
            SELECT 
                A.PRGRMID
                , A.SAREAID
                , B.SAREA_NM
                , A.EDU_SE_CD
                , E.CD_NM EDU_SE_NM
                , F.CD_NM AS CLSF_NM
                , A.OPER_FOM_CD
                , H.CD_NM OPER_FOM_NM
                , A.PRGRM_NM
                , A.EDU_HR_MNT
                , G.FILEID
                , G.FILE_IDNTFC_KEY
                ,(SELECT GROUP_CONCAT(TB.CD_NM SEPARATOR', ') FROM TB_EDU_MVMN_PRGRM_TRGT_MAPNG TA, TB_CMM_CD TB WHERE TA.PRGRMID = A.PRGRMID and TA.TRGT_CD = TB.CD) AS TRGT_NM
                , A.MDFCN_DT
                , A.MDFRID
                , A.REG_DT
                , A.RGTRID
                FROM TB_EDU_MVMN_PRGRM A
                LEFT OUTER JOIN TB_EDU_SAREA B ON A.SAREAID = B.SAREAID 
                LEFT OUTER JOIN TB_EDU_MVMN_PRGRM_CLSF_MAPNG C ON A.PRGRMID = C.PRGRMID
                LEFT OUTER JOIN TB_EDU_MVMN_PRGRM_TRGT_MAPNG D  ON A.PRGRMID = D.PRGRMID
                LEFT OUTER JOIN TB_CMM_CD E ON E.CD = A.EDU_SE_CD
                LEFT OUTER JOIN TB_CMM_CD F ON F.CD = C.CLSF_CD
                LEFT OUTER JOIN TB_CMM_CD H ON H.CD = A.OPER_FOM_CD
                LEFT OUTER JOIN TB_CMM_FILE G ON A.EDU_PHOTO_FILEID = G.FILEID
                WHERE
                A.USE_YN = 'Y'
                <!-- 푸름이 이동환경교실 교육신청 프로그램명 -->
                <if test="searchPrgrmNm != null and searchPrgrmNm != ''">
                AND A.PRGRM_NM LIKE CONCAT('%',#{searchPrgrmNm},'%')
                </if>
                <!-- 푸름이 이동환경교실 교육신청 교육구분 -->
                <if test="searchEduSeCd != null and searchEduSeCd != '' and searchEduSeCd != '전체'">
                AND A.EDU_SE_CD = #{searchEduSeCd}
                </if>
                <!-- 푸름이 이동환경교실 교육신청 운영권역 -->
                <if test="searchSareaId != null and searchSareaId != '' and searchSareaId != '전체'">
                AND A.SAREAID = #{searchSareaId}
                </if>
                <!-- 푸름이 이동환경교실 교육신청 교육대상 -->
                <if test="searchTrgtCd != null and searchTrgtCd != '' and searchTrgtCd != '전체'">
                AND D.TRGT_CD = #{searchTrgtCd}
                </if>
                <!-- 푸름이 이동환경교실 교육신청 교육형식 -->
                <if test="searchOperFomCd != null and searchOperFomCd != '' and searchOperFomCd != '전체'">
                AND A.OPER_FOM_CD = #{searchOperFomCd}
                </if>
                <!-- 푸름이 이동환경교실 교육신청 교육주제 -->
                <if test="searchClsfCd1 != null and searchClsfCd1 != '' and searchClsfCd1 != '전체'">
                AND F.UPPR_CD = #{searchClsfCd1}
                </if>            
                <if test="searchClsfCd2 != null and searchClsfCd2 != '' and searchClsfCd2 != '전체'">
                AND C.CLSF_CD = #{searchClsfCd2}
                </if>
        GROUP BY A.PRGRMID, C.CLSF_CD
        <include refid="PaginationMapper.footer"/>
    </select>
    
    <!-- 푸름이 이동환경교실 교육신청 게시글 상세조회 -->
    <select id="selectMvmnAplyInfo" parameterType="front.MvmnAplyVo" resultType="front.MvmnAplyVo"> 
        /* MvmnAplyDao.selectMvmnAplyInfo */
            SELECT
                  A.PRGRMID
                , A.SAREAID
                , B.SAREA_NM
                , A.EDU_SE_CD
                , E.CD_NM EDU_SE_NM
                , F.CD_NM AS CLSF_NM
                , A.OPER_FOM_CD
                , J.CD_NM OPER_FOM_NM
                ,(SELECT GROUP_CONCAT(TB.CD_NM SEPARATOR', ') FROM TB_EDU_MVMN_PRGRM_TRGT_MAPNG TA, TB_CMM_CD TB WHERE TA.PRGRMID = A.PRGRMID and TA.TRGT_CD = TB.CD) AS TRGT_NM
                , A.PRGRM_NM
                , A.EDU_HR_MNT
                , A.EDU_NOPE
                , A.EDU_INTRCN_FILEID
                , H.FILEGRPID EDU_INTRCN_FILEGRPID
                , H.FILE_IDNTFC_KEY EDU_INTRCN_FILE_IDNTFC_KEY
                , H.ORGINL_FILE_NM EDU_INTRCN_ORGINL_FILE_NM
                , G.FILEID
                , G.FILE_IDNTFC_KEY
                , I.CD_NM AS RCPT_MTHD_NM
                , A.RCPT_MTHD_CD
                , A.EDU_EXPLN
                , A.MTTRAT              
                , E.CD_NM CTPRVN_NM                
                , A.MDFCN_DT
                , A.MDFRID
                , A.REG_DT
                , A.RGTRID
            FROM TB_EDU_MVMN_PRGRM A
                LEFT OUTER JOIN TB_EDU_SAREA B ON A.SAREAID = B.SAREAID 
                LEFT OUTER JOIN TB_EDU_MVMN_PRGRM_CLSF_MAPNG C ON A.PRGRMID = C.PRGRMID
                LEFT OUTER JOIN TB_CMM_CD E ON E.CD = A.EDU_SE_CD
                LEFT OUTER JOIN TB_CMM_CD F ON F.CD = C.CLSF_CD
                LEFT OUTER JOIN TB_CMM_FILE G ON A.EDU_PHOTO_FILEID = G.FILEID
                LEFT OUTER JOIN TB_CMM_FILE H ON A.EDU_INTRCN_FILEID = H.FILEID
                LEFT OUTER JOIN TB_CMM_CD I ON I.CD = A.RCPT_MTHD_CD
                LEFT OUTER JOIN TB_CMM_CD J ON J.CD = A.OPER_FOM_CD
            WHERE A.USE_YN = 'Y'
              AND A.PRGRMID = #{prgrmid}
            GROUP BY A.PRGRMID;
    </select>
    
    <!-- 푸름이 이동환경교실 교육신청 교육사진 파일 목록 조회 -->
    <select id="selectEduPhotoFileList" parameterType="front.MvmnAplyVo" resultType="front.MvmnAplyVo">
        /* MvmnAplyDao.selectInstMvmnAplyList */
            SELECT
                COALESCE(B.FILEID, 0) FILEID
              , B.FILE_IDNTFC_KEY
            FROM
                TB_EDU_MVMN_PRGRM A
                LEFT OUTER JOIN tb_cmm_file B ON A.EDU_PHOTO_FILEID = B.FILEID                
            WHERE
                1=1
                AND A.PRGRMID = #{prgrmid}
    </select>
    
    <!-- 푸름이 이동환경교실 교육신청 회차 목록 조회 -->
    <select id="selectMvmnAplyTmeList" parameterType="front.MvmnAplyVo" resultType="front.MvmnAplyVo">
        /* MvmnAplyDao.selectMvmnAplyTmeList */
        SELECT  X.PRGRMID
              , X.TMEID
              , X.TME_NM
              , (CASE WHEN X.EDU_NOPE > X.APLY_CNT THEN 
                    CASE WHEN X.TMEID IN (
                        SELECT TMEID FROM TB_EDU_MVMN_PRGRM_TME_SCHDL 
                         WHERE DE <![CDATA[>=]]>  DATE_FORMAT(NOW(), '%Y.%m.%d')) THEN '신청가능' 
                    ELSE '마감' END 
                 ELSE '마감' END) AS STTS_DESC
              , X.DE_DESC
              , X.WEEK_DESC
              , X.WAIT_CNT
              , X.REG_DT
          FROM (
                SELECT  A.PRGRMID
                      , A.TMEID
                      , A.TME_NM
                      , B.EDU_NOPE
                      , A.REG_DT
                      , (SELECT COUNT(TA.APLYID) 
                           FROM TB_EDU_MVMN_PRGRM_APLY TA
                              , TB_EDU_MVMN_PRGRM_TME_SCHDL TB 
                              , TB_EDU_MVMN_PRGRM_APLY_SCHDL TC                              
                          WHERE TA.APLYID = TC.APLYID  
                            AND TB.TME_SCHDLID = TC.TME_SCHDLID
                            AND TB.TMEID = A.TMEID) APLY_CNT
                      ,(SELECT COUNT(TA.APLYID) 
                          FROM TB_EDU_MVMN_PRGRM_APLY TA
                             , TB_EDU_MVMN_PRGRM_TME_SCHDL TB 
                             , TB_EDU_MVMN_PRGRM_APLY_SCHDL TC
                          WHERE TA.APLYID = TC.APLYID  
                            AND TB.TME_SCHDLID = TC.TME_SCHDLID 
                            AND TA.STTS_CD = '180101'
                            AND TB.TMEID = A.TMEID) WAIT_CNT    
                      , (SELECT GROUP_CONCAT(REPLACE(TA.DE, '.', '-') SEPARATOR', ')
                           FROM TB_EDU_MVMN_PRGRM_TME_SCHDL TA                                                             
                          WHERE TA.TMEID = A.TMEID) DE_DESC  
                      , (SELECT GROUP_CONCAT(DISTINCT CASE DAYOFWEEK(TA.DE) 
                                    WHEN '1' THEN '일요일'
                                    WHEN '2' THEN '월요일'
                                    WHEN '3' THEN '화요일'
                                    WHEN '4' THEN '수요일'
                                    WHEN '5' THEN '목요일'
                                    WHEN '6' THEN '금요일'
                                    WHEN '7' THEN '토요일' END
                                SEPARATOR', ')
                           FROM TB_EDU_MVMN_PRGRM_TME_SCHDL TA                               
                          WHERE TA.TMEID = A.TMEID) WEEK_DESC                             
                  FROM TB_EDU_MVMN_PRGRM_TME A    
                  LEFT OUTER JOIN TB_EDU_MVMN_PRGRM B ON B.PRGRMID = A.PRGRMID
                  WHERE A.TMEID IN (SELECT TMEID FROM TB_EDU_MVMN_PRGRM_TME_SCHDL)
           ) X
         WHERE 1=1
           AND X.PRGRMID = #{prgrmid}    
         ORDER BY X.REG_DT ASC             
    </select>    

    <!-- 푸름이 이동환경교실 동일 운영권역 교육 프로그램 목록 조회 -->
    <select id="selectMvmnAplyEduSareaList" parameterType="front.MvmnAplyVo" resultType="front.MvmnAplyVo">
        /* MvmnAplyDao.selectMvmnAplyEduSareaList */
            SELECT 
                A.PRGRMID
                , A.SAREAID
                , B.SAREA_NM
                , A.PRGRM_NM
                , F.CD_NM AS CLSF_NM
                , A.EDU_HR_MNT
                , E.CD_NM OPER_FOM_NM
                ,(SELECT GROUP_CONCAT(TB.CD_NM SEPARATOR', ') FROM TB_EDU_MVMN_PRGRM_TRGT_MAPNG TA, TB_CMM_CD TB WHERE TA.PRGRMID = A.PRGRMID and TA.TRGT_CD = TB.CD) AS TRGT_NM
                , A.MDFCN_DT
                , A.MDFRID
                , A.REG_DT
                , A.RGTRID
                FROM TB_EDU_MVMN_PRGRM A
                LEFT OUTER JOIN TB_EDU_SAREA B ON A.SAREAID = B.SAREAID 
                LEFT OUTER JOIN TB_EDU_MVMN_PRGRM_CLSF_MAPNG C ON A.PRGRMID = C.PRGRMID
                LEFT OUTER JOIN TB_CMM_CD E ON E.CD = A.OPER_FOM_CD
                LEFT OUTER JOIN TB_CMM_CD F ON F.CD = C.CLSF_CD
            WHERE A.USE_YN = 'Y'
            AND A.SAREAID = #{sareaid}   
            AND A.PRGRMID <![CDATA[<>]]> #{prgrmid}             
    </select>  
    
    <!-- 푸름이 이동환경교실 교육신청 목록 조회 -->
    <select id="selectMvmnAplyDeList" parameterType="front.MvmnAplyVo" resultType="front.MvmnAplyVo">
        /* MvmnAplyDao.selectMvmnAplyList */
        SELECT  X.PRGRMID
              , X.TMEID
              , X.TME_NM
              , (CASE WHEN X.EDU_NOPE > X.APLY_CNT THEN '신청가능' ELSE '마감' END) AS STTS_DESC
              , REPLACE(X.DE,'.','-') DE
              , X.TME_SCHDLID
          FROM (
                SELECT  A.PRGRMID
                      , A.TMEID
                      , A.TME_NM
                      , B.EDU_NOPE
                      , C.DE
                      , C.TME_SCHDLID
                      , (SELECT COUNT(TA.APLYID)
                           FROM TB_EDU_MVMN_PRGRM_APLY TA
                              , TB_EDU_MVMN_PRGRM_TME_SCHDL TB 
                              , TB_EDU_MVMN_PRGRM_APLY_SCHDL TC 
                          WHERE TA.APLYID = TC.APLYID  
                            AND TB.TME_SCHDLID = TC.TME_SCHDLID  
                            AND TB.TMEID = A.TMEID) APLY_CNT
                  FROM TB_EDU_MVMN_PRGRM_TME A    
                  LEFT OUTER JOIN TB_EDU_MVMN_PRGRM B ON B.PRGRMID = A.PRGRMID 
                  LEFT OUTER JOIN TB_EDU_MVMN_PRGRM_TME_SCHDL C ON C.TMEID = A.TMEID
                  WHERE C.DE IS NOT NULL
           ) X
         WHERE 1=1
           AND X.PRGRMID = #{prgrmid}       
           AND NOW() <![CDATA[<=]]> DATE_FORMAT(X.DE,'%Y.%m.%d') 
    </select>
    
    <!-- 푸름이 이동환경교실 교육신청 등록정보 상세조회 -->
    <select id="selectMvmnAplyRegInfo" parameterType="front.MvmnAplyVo" resultType="front.MvmnAplyVo"> 
        /* MvmnAplyDao.selectMvmnAplyInfo */
            WITH T1 AS (
                SELECT TMEID, REPLACE(DE, '.', '-') DE 
                  FROM TB_EDU_MVMN_PRGRM_TME_SCHDL 
                 WHERE TME_SCHDLID = #{tmeSchdlid}
                 UNION ALL 
                SELECT TMEID, DATE_ADD(REPLACE(DE, '.', '-'), INTERVAL 1 WEEK) DE 
                  FROM TB_EDU_MVMN_PRGRM_TME_SCHDL 
                 WHERE TME_SCHDLID = #{tmeSchdlid}
                 UNION ALL 
                SELECT TMEID, DATE_ADD(REPLACE(DE, '.', '-'), INTERVAL 2 WEEK) DE 
                  FROM TB_EDU_MVMN_PRGRM_TME_SCHDL
                 WHERE TME_SCHDLID = #{tmeSchdlid}
                 UNION ALL 
                SELECT TMEID, DATE_ADD(REPLACE(DE, '.', '-'), INTERVAL 3 WEEK) DE 
                  FROM TB_EDU_MVMN_PRGRM_TME_SCHDL
                 WHERE TME_SCHDLID = #{tmeSchdlid}
                 UNION ALL 
                SELECT TMEID, DATE_ADD(REPLACE(DE, '.', '-'), INTERVAL 4 WEEK) DE 
                  FROM TB_EDU_MVMN_PRGRM_TME_SCHDL
                 WHERE TME_SCHDLID = #{tmeSchdlid}
            )        
            SELECT
                A.PRGRMID
                , A.SAREAID
                , B.SAREA_NM
                , A.PRGRM_NM
                , A.EDU_HR_MNT
                , A.EDU_NOPE
                , J.SIGNGU_CD
                , CONCAT(E.CTPRVN_NM,' <![CDATA[>]]> ', G.SIGNGU_NM) SIGNGU_DESC
                , CONCAT(C.TME_NM, C.BGNG_TM, ' ~ ', C.END_TM) TME_NM
                -- , CASE WHEN A.OPER_FOM_CD = '197101' THEN REPLACE(D.DE, '.', '-') ELSE (SELECT GROUP_CONCAT(T1.DE SEPARATOR', ') FROM T1 WHERE MONTH(T1.DE) = MONTH(D.DE)) END DE
                , GROUP_CONCAT(REPLACE(D.DE, '.', '-') SEPARATOR', ') DE
                ,(SELECT GROUP_CONCAT(TB.CD_NM SEPARATOR', ') FROM TB_EDU_MVMN_PRGRM_TRGT_MAPNG TA, TB_CMM_CD TB WHERE TA.PRGRMID = A.PRGRMID and TA.TRGT_CD = TB.CD) AS TRGT_NM
                ,(SELECT GROUP_CONCAT(TC.TRGT_CD SEPARATOR', ') FROM TB_EDU_MVMN_PRGRM_TRGT_MAPNG TC WHERE TC.PRGRMID = A.PRGRMID ) AS TRGT_CD
                , F.INSTID
                , H.INST_NM
                , H.TELNO
                , F.USERID APLY_USERID                
                , F.NM APLY_USER_NM
                , F.MOBLPHON
                , F.EML
                , H.FXNO
                , H.ADDR
                , H.ADDR_DTL
                , A.MDFCN_DT
                , A.MDFRID
                , A.REG_DT
                , A.RGTRID
            FROM TB_EDU_MVMN_PRGRM A
                LEFT OUTER JOIN TB_EDU_SAREA B ON A.SAREAID = B.SAREAID
                LEFT OUTER JOIN TB_EDU_SAREA_CTPRVN_MAPNG I ON I.SAREAID = B.SAREAID
                LEFT OUTER JOIN TB_EDU_SAREA_SIGNGU J ON J.CTPRVN_CD = I.CTPRVN_CD AND J.SAREAID = B.SAREAID
                LEFT OUTER JOIN TB_EDU_MVMN_PRGRM_TME C ON C.PRGRMID = A.PRGRMID
                LEFT OUTER JOIN TB_EDU_MVMN_PRGRM_TME_SCHDL D ON D.TMEID = C.TMEID 
                LEFT OUTER JOIN TB_CMM_ADDR_CTPRVN E ON E.CTPRVN_CD = I.CTPRVN_CD
                LEFT OUTER JOIN TB_CMM_ADDR_SIGNGU G ON G.SIGNGU_CD = J.SIGNGU_CD
                LEFT OUTER JOIN TB_CMM_USER F ON F.USERID = #{user.userid}
                LEFT OUTER JOIN TB_CMM_INST H ON H.INSTID = F.INSTID   
            WHERE A.USE_YN = 'Y'
              AND A.PRGRMID = #{prgrmid}
              <choose>
                  <when test="operFomCd == '197101'">
                    AND D.TME_SCHDLID = #{tmeSchdlid}
                  </when>
                  <otherwise>
                    AND D.TMEID = #{tmeid}
                  </otherwise>
              </choose>
              AND I.CTPRVN_CD = SUBSTRING_INDEX(SUBSTRING_INDEX(#{sareaSignguCd}, '^', -2), '^', 1)
              AND J.SIGNGU_CD = SUBSTRING_INDEX(#{sareaSignguCd}, '^', -1)
            GROUP BY A.PRGRMID
    </select>    
    <!-- 푸름이 이동환경교실 교육신청 등록 --> 
    <insert id="insertMvmnAply" parameterType="front.MvmnAplyVo" useGeneratedKeys="true" keyProperty="aplyid">
        /* MvmnAplyDao.insertMvmnAply */
        INSERT INTO TB_EDU_MVMN_PRGRM_APLY (
            INSTID
            , USERID
            , ADDR
            , ADDR_DTL
            , SIGNGU_CD
            , TELNO
            , FXNO
            , EML
            , EDU_NOPE
            , HOPE_EDU_BGNG_TM
            , HOPE_EDU_END_TM
            , RMRK
            , MEMO
            , STTS_CD
            , MDFCN_DT
            , MDFRID
            , REG_DT
            , RGTRID
        )
        SELECT 
             NULLIF(#{instid},'')
            ,#{aplyUserid}
            ,#{addr}
            ,#{addrDtl}
            ,#{signguCd}
            ,#{telno}
            ,#{fxno}
            ,#{eml}
            ,#{eduNope}
            ,#{hopeEduBgngTm}
            ,#{hopeEduEndTm}
            ,#{rmrk}
            ,#{memo}
            ,CASE WHEN C.RCPT_MTHD_CD = '156101' THEN '180102' ELSE CASE WHEN COUNT(D.STTS_CD) <![CDATA[<=]]> C.EDU_NOPE THEN '180102' ELSE '180101' END END    
            ,NOW()
            ,#{user.userid}
            ,NOW()
            ,#{user.userid}
          FROM TB_EDU_MVMN_PRGRM_TME_SCHDL A
          LEFT OUTER JOIN TB_EDU_MVMN_PRGRM_TME B ON B.TMEID = A.TMEID
          LEFT OUTER JOIN TB_EDU_MVMN_PRGRM C ON C.PRGRMID = B.PRGRMID                
          LEFT OUTER JOIN (
            SELECT T1.STTS_CD, T2.TME_SCHDLID 
            FROM TB_EDU_MVMN_PRGRM_APLY T1
               , TB_EDU_MVMN_PRGRM_APLY_SCHDL T2 
            WHERE T1.APLYID = T2.APLYID) D ON D.TME_SCHDLID = #{tmeSchdlid}                 
         WHERE A.TME_SCHDLID = #{tmeSchdlid}    
    </insert>    
    <!-- 푸름이 이동환경교실 교육신청 대상등록 -->
    <insert id="insertTrgtCd" parameterType="front.MvmnAplyVo" >
         /* MvmnAplyDao.insertTrgtCd */
         INSERT INTO TB_EDU_MVMN_PRGRM_APLY_EDU_TRGT(
              APLYID
              ,EDU_TRGT_CD
              ,MDFCN_DT
              ,MDFRID
              ,REG_DT
              ,RGTRID
         )VALUES
          <foreach item="item" collection="trgtCds"  separator=",">
           (
             #{aplyid}
             ,#{item}
             ,NOW()
             ,#{user.userid}
             ,NOW()
             ,#{user.userid}             
            )
          </foreach>
    </insert>
    <!-- 푸름이 이동환경교실 운영권역 목록 조회 -->
    <select id="selectEduSareaList" parameterType="front.MvmnAplyVo" resultType="front.MvmnAplyVo">
        /* MvmnAplyDao.selectEduSareaList */
        SELECT
              A.SAREAID
            , A.SAREA_NM
        FROM 
            TB_EDU_SAREA A
        WHERE A.USE_YN = 'Y'
    </select>    

    <!-- 푸름이 이동환경교실 신청 지역선택 시군구 목록 조회 -->
    <select id="selectMvmnAplySignguList" parameterType="front.MvmnAplyVo" resultType="front.MvmnAplyVo">
        /* MvmnAplyDao.selectMvmnAplySignguList */
        SELECT
              A.SAREAID
            , A.SAREA_NM
            , CONCAT(A.SAREAID,'^',B.CTPRVN_CD,'^',C.SIGNGU_CD) AS SAREA_SIGNGU_CD
            , CONCAT(A.SAREA_NM,' <![CDATA[>]]>',D.CTPRVN_NM,' ',E.SIGNGU_NM) AS SAREA_SIGNGU_DESC
        FROM 
            TB_EDU_SAREA A
            LEFT OUTER JOIN TB_EDU_SAREA_CTPRVN_MAPNG B ON B.SAREAID = A.SAREAID
            LEFT OUTER JOIN TB_EDU_SAREA_SIGNGU C ON C.CTPRVN_CD = B.CTPRVN_CD AND C.SAREAID = A.SAREAID
            LEFT OUTER JOIN TB_CMM_ADDR_CTPRVN D ON D.CTPRVN_CD = B.CTPRVN_CD
            LEFT OUTER JOIN TB_CMM_ADDR_SIGNGU E ON E.SIGNGU_CD = C.SIGNGU_CD
        WHERE A.USE_YN = 'Y'
          AND A.SAREAID = #{sareaid}
          AND C.SAREAID IS NOT NULL
          AND B.SAREAID IS NOT NULL
    </select>    
    
    <insert id="insertMvmnAplySchdl" parameterType="front.MvmnAplyVo">
        /* MvmnAplyDao.insertMvmnAplySchdl */
         INSERT INTO TB_EDU_MVMN_PRGRM_APLY_SCHDL(
              APLYID
              ,TME_SCHDLID
              ,REG_DT
              ,RGTRID
         )VALUES(
             #{aplyid}
             ,#{tmeSchdlid}
             ,NOW()
             ,#{user.userid}
         )
    </insert>          
</mapper>