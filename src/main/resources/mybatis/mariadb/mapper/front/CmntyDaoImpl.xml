<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
	SQL File Name : CmntyDaoImpl.xml
	Description : 환경동아리
-->
<mapper namespace="com.kbrainc.plum.front.cmnty.model.CmntyDao">
    <!-- 환경동아리 목록 조회 -->
    <select id="selectCmntyList" resultType="front.CmntyVo" parameterType="front.CmntyVo">
        /* CmntyDao.selectCmntyList */
        <include refid="PaginationMapper.header"/>
        SELECT
            A.CMNTYID
            , A.CMNTY_NM
            , A.CMNTY_LOGO_FILEID
            , B.FILE_IDNTFC_KEY
            , A.CMNTY_INTRCN
            , (SELECT COUNT(0) FROM TB_CMT_CMNTY_MBR WHERE CMNTYID = A.CMNTYID) MBR_CNT
            , A.ESTERID
            , A.RLS_YN
            , (SELECT MBR_STTS_CD FROM TB_CMT_CMNTY_MBR WHERE CMNTYID = A.CMNTYID AND USERID = #{user.userid}) MBR_STTS_CD
            , A.MDFCN_DT
            , A.MDFRID
            , A.REG_DT
            , A.RGTRID
        FROM TB_CMT_CMNTY A
        JOIN TB_CMM_FILE B ON B.FILEID = A.CMNTY_LOGO_FILEID
        WHERE
            1=1
            AND A.OPER_YN = 'Y'
        <if test="searchKeyword != null and searchKeyword != ''">
            AND A.CMNTY_NM LIKE CONCAT('%',#{searchKeyword},'%')
            AND A.SRCH_EXPSR_YN = 'Y'
        </if>
        <if test="esterid != null and esterid != ''">
            AND A.ESTERID = #{esterid}
        </if>
        <include refid="PaginationMapper.footer"/>
    </select>
</mapper>