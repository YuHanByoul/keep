<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kbrainc.plum.front.pltfomImprvmPropsl.model.PltfomImprvmPropslDao">

    <!-- 플랫폼 개선 제안 생성 -->
    <insert id="insertPltfomImprvmPropsl">
        INSERT INTO TB_CMM_PLTFOM_IMPRVM_PRPSL(
               USERID
               , INSTID
               , TTL
               , CN
               , CLSF_CD
               , PRCS_STTS_CD
               , FILEGRPID
               , RLS_YN
               , DEL_YN
               , MDFCN_DT
               , MDFRID
               , REG_DT
               , RGTRID
        ) VALUES(
                #{user.userid}
                , #{user.instid}
                , #{ttl}
                , #{cn}
                , #{clsfCd}
                , '188101'
                , #{filegrpid}
                , #{rlsYn}
                , 'N'
                , NOW()
                , #{user.userid}
                , NOW()
                , #{user.userid}
        )
    </insert>

    <!-- 플랫폼 개선 제안 수정 -->
    <update id="updatePltfomImprvmPropsl">
        UPDATE TB_CMM_PLTFOM_IMPRVM_PRPSL SET
            TTL = #{ttl}
            , CN = #{cn}
            , CLSF_CD =#{clsfCd}
            , FILEGRPID = #{filegrpid}
            , RLS_YN = #{rlsYn}
            , MDFCN_DT = NOW()
            , MDFRID = #{user.userid}
        WHERE PRPSLID =  #{prpslid}
    </update>

    <!-- 플랫폼 개선 제안 삭제 -->
    <update id="deletePltfomImprvmPropsl">
        UPDATE TB_CMM_PLTFOM_IMPRVM_PRPSL SET
            DEL_YN = 'Y'
            , MDFCN_DT = NOW()
            , MDFRID = #{user.userid}
            WHERE PRPSLID = #{prpslid}
    </update>

    <!-- 플랫폼 개선 제안 취소 -->
    <update id="cancelPltfomImprvmPropsl">
        UPDATE TB_CMM_PLTFOM_IMPRVM_PRPSL SET
            PRCS_STTS_CD = '188102'
            , MDFCN_DT = NOW()
            , MDFRID = #{user.userid}
        WHERE PRPSLID = #{prpslid}
    </update>

    <!-- 플랫폼 개선 제안 목록 조회 -->
    <select id="selectPltfomImprvmPropslList" resultType="com.kbrainc.plum.front.pltfomImprvmPropsl.model.PltfomImprvmPropslVo">
        <include refid="PaginationMapper.header"/>
        SELECT
            A.PRPSLID
            , A.USERID
            , A.TTL
            , A.CN
            , B.NM
            , A.FILEGRPID
            , A.CLSF_CD
            , A.PRCS_STTS_CD
            , A.RLS_YN
            , A.REG_DT
        FROM TB_CMM_PLTFOM_IMPRVM_PRPSL A
        INNER JOIN TB_CMM_USER B
            ON A.USERID = B.USERID
        WHERE
        A.DEL_YN = 'N' AND A.PRCS_STTS_CD != '188102'
        <if test="searchKeyword != null and searchKeyword!= ''">
            AND A.TTL LIKE CONCAT('%', #{searchKeyword}, '%')
        </if>
        <if test="clsfCd != null and clsfCd !=''">
            AND A.CLSF_CD = #{clsfCd}
        </if>
        <include refid="PaginationMapper.footer"/>
    </select>

    <!-- 플랫폼 개선 제안 상세 조회 -->
    <select id="selectPropsl" resultType="com.kbrainc.plum.front.pltfomImprvmPropsl.model.PltfomImprvmPropslVo">
        SELECT
            A.PRPSLID
            , A.USERID
            , A.TTL
            , A.CN
            , B.NM
            , A.FILEGRPID
            , A.CLSF_CD
            , A.PRCS_STTS_CD
            , A.RLS_YN
            , A.REG_DT
        FROM TB_CMM_PLTFOM_IMPRVM_PRPSL A
        INNER JOIN TB_CMM_USER B
            ON A.USERID = B.USERID
        WHERE PRPSLID = #{prpslid}
    </select>

    <!-- 플랫폼 개선 제안 답변 조회 -->
    <select id="selectPropslAns" resultType="com.kbrainc.plum.front.pltfomImprvmPropsl.model.PltfomImprvmPropslAnsVo">
        SELECT
            A.ANSID
             , A.PRPSLID
             , A.TTL
             , A.CN
             , A.ANS_DT
             , A.FILEGRPID
             , C.NM
        FROM TB_CMM_PLTFOM_IMPRVM_PRPSL_ANS A
        INNER JOIN TB_CMM_PLTFOM_IMPRVM_PRPSL B
            ON A.PRPSLID = B.PRPSLID
        INNER JOIN TB_CMM_USER C
            ON A.USERID = C.USERID
        WHERE A.PRPSLID = #{prpslid}
    </select>

    <!-- 마이페이지 > 플랫폼 개선 제안 목록 조회 -->
    <select id="selectMyPltfomImprvmPropslList" resultType="com.kbrainc.plum.front.pltfomImprvmPropsl.model.PltfomImprvmPropslVo">
        <include refid="PaginationMapper.header"/>
        SELECT
            A.PRPSLID
            , A.USERID
            , A.TTL
            , A.CN
            , B.NM
            , A.FILEGRPID
            , A.CLSF_CD
            , A.PRCS_STTS_CD
            , A.RLS_YN
            , A.REG_DT
        FROM TB_CMM_PLTFOM_IMPRVM_PRPSL A
        INNER JOIN TB_CMM_USER B
            ON A.USERID = B.USERID
        WHERE
            A.DEL_YN = 'N' AND A.USERID = #{user.userid}
        <if test="searchKeyword != null and searchKeyword!= ''">
            AND A.TTL LIKE CONCAT('%', #{searchKeyword}, '%')
        </if>
        <include refid="PaginationMapper.footer"/>
    </select>
</mapper>