<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
	SQL File Name : MemberDaoImpl.xml
	Description : 회원정보
-->
<mapper namespace="com.kbrainc.plum.front.member.model.MemberDao">

    <!-- 회원 등록 -->
    <insert id="insertMember" parameterType="front.MemberVo"  useGeneratedKeys="true"  keyProperty ="userid">
        /* MemberDao.insertMember */
        INSERT INTO TB_CMM_USER (
			ACNT
			,PSWD
			,NM
			,MOBNO
			,EMAIL
			,TOS_AGRE_YN
			,STTS_CD
			,USER_SE_CD
			,MDFCN_DT
			,MDFRID
			,REG_DT
			,RGTRID
        ) VALUES (
        	 #{acnt         }
			,#{pswd          }
			,#{nm           }
			,#{mobNo       }
			,#{email        }
			,#{tosAgreYn  }
			,#{sttsCd      }
			,#{userSeCd   }
			,NOW()
			,#{user.userid  }
			,NOW()
			,#{user.userid  }
        )
    </insert>
    
    <!-- 회원 정보 수정 -->
    <update id="updateMember" parameterType="front.MemberVo">
      /* MemberDao.updateMember */
      UPDATE TB_CMM_USER 
       SET
       	ACNT          = #{acnt         }  
		,PSWD          = #{pswd          } 
		,NM           = #{nm           } 
		,MOBNO        = #{mobNo       } 
		,EMAIL        = #{email        } 
		,USER_SE_CD   = #{userSeCd} 
		,MDFCN_DT      = NOW()
		,MDFRID   = #{userid } 
	  WHERE  USERID = #{userid  }
    </update>
    
    <!-- 회원 정보(강사) 등록 -->
    <insert id="insertMemberTeacher" parameterType="front.TeacherVo" >
        /* MemberDao.insertMemberTeacher */
        INSERT INTO TB_CMM_USER_TEACHER (
          USERID
		  ,SCHL_NM
		  ,SCHL_CD
		  ,CHRG_CRS_NM
		  ,CHRG_CRS_CD
		  ,CLS_TCHR_YN
		  ,MDFCN_DT
		  ,MDFRID
		  ,REG_DT
		  ,RGTRID
        ) VALUES (
         #{userid}        
         ,#{schlNm    }  
         ,#{schlCd    }  
         ,#{chrgCrsNm}  
		 ,#{chrgCrsCd}  
		 ,#{clsTchrYn}  
		 ,NOW()  
		 ,#{userid }  
		 ,NOW()  
		 ,#{userid  }    
        )
    </insert>
    
    <!-- 회원 정보(강사) 수정 -->
    <update id="updateMemberTeacher" parameterType="front.TeacherVo" >
      /* MemberDao.updateMemberTeacher */
      UPDATE TB_CMM_USER_TEACHER 
        SET
		   SCHL_NM      =  #{schlNm     }
		  ,SCHL_CD      =  #{schlCd     }
		  ,CHRG_CRS_NM  =  #{chrgCrsNm }
		  ,CHRG_CRS_CD  =  #{chrgCrsCd }
		  ,CLS_TCHR_YN  =  #{clsTchrYn }
		  ,MDFCN_DT      =  NOW()
		  ,MDFRID   =  #{userid  }
	  WHERE USERID = #{userid  }
    </update>
    
    <select id="chekcDuplicationUser" parameterType="front.MemberVo" resultType="int">
    /* MemberDao.chekcDuplicationUser */
     SELECT 
	   COUNT(*)
	 FROM 
	   TB_CMM_USER
	 WHERE 1=1
	   AND ACNT = #{acnt}
    </select>
    
    <select id="selectTeacherMemberInfo" parameterType="front.MemberVo" resultType="map">
    /* MemberDao.selectTeacherMemberInfo */
     SELECT 
        A.USERID as userid
        ,A.ACNT as acnt
        ,A.PSWD as pswd
        ,A.NM as nm
        ,A.EMAIL as email
        ,A.MOBNO as mobno
        ,A.STTS_CD as stts_cd
        ,A.TOS_AGRE_YN   as tos_agre_yn    
        ,A.USER_SE_CD    as user_se_cd     
        ,B.SCHL_NM       as schl_nm        
        ,B.SCHL_CD       as schl_cd        
        ,B.CHRG_CRS_NM   as chrg_crs_nm    
        ,B.CHRG_CRS_CD   as chrg_crs_cd    
        ,B.CLS_TCHR_YN   as cls_tchr_yn    
	 FROM 
	   TB_CMM_USER A
	   LEFT OUTER JOIN TB_CMM_USER_TEACHER B 
	   ON(A.USERID = B.USERID) 
	 WHERE 1=1
	   AND A.USERID = #{userid}
    </select>
    
    
    <!-- 회원 역할 권한 등록 -->
    <insert id="insertRoleId" parameterType="front.MemberVo" >
        /* MemberDao.insertMember */
        INSERT INTO TB_CMM_ROLE_USER (
		   ROLEID
           ,USERID
           ,ROLE_STRT_DD
           ,ROLE_END_DD
           ,MDFCN_DT
           ,MDFRID
           ,REG_DT
           ,RGTRID
        ) VALUES (
           #{roleid  }
           ,#{userid }
           ,DATE_FORMAT(NOW(),'%Y-%m-%d')
           ,DATE_FORMAT(DATE_ADD(NOW(),INTERVAL 5 YEAR),'%Y-%m-%d')
           ,NOW()
           ,#{userid }
           ,NOW()
           ,#{userid}
        )
    </insert>
    
    
    
    
    
</mapper>