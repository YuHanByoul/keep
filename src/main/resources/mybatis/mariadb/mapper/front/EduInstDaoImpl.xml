<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SQL File Name : EduInstDaoImpl.xml
    Description : 사회환경교육기관 지정
-->
<mapper namespace="com.kbrainc.plum.front.eduInst.model.EduInstDao">

    <!-- 신청정보 조회 -->
    <select id="selectAplyInfoForm" parameterType="front.EduInstVo" resultType="front.EduInstVo">
        /* EduInstDao.selectAplyInfoForm*/
        SELECT
            A.USERID    AS APLCNTID
          , A.NM        AS APLCNT_NM
          , A.TELNO     AS APLY_TELNO
          , A.EML       AS APLCNT_EML
          , A.MOBLPHON  AS APLCNT_MOBLPHON
          , A.INSTID
          , B.RGN_CD
          , SUBSTR(B.RGN_CD,1,2)    AS CTPRVN_CD
          , B.INST_NM
          , B.INST_TYPE_CD
          , TYPE_CD.CD_NM
          , B.RPRSV_NM
          , B.TELNO      AS INST_CNTCT
          , B.BRNO
          , B.ADDR
          , B.ADDR_DTL
          , A.REG_DT
        FROM TB_CMM_USER A
        LEFT OUTER JOIN TB_CMM_INST B ON A.INSTID =B.INSTID
        LEFT OUTER JOIN TB_CMM_ADDR_CTPRVN ADDR ON B.RGN_CD = ADDR.CTPRVN_CD
        LEFT OUTER JOIN TB_CMM_CD TYPE_CD ON B.INST_TYPE_CD = TYPE_CD.CD
        WHERE A.USERID = #{aplcntid}
    </select>

    <!-- 환경교육기관 상세 조회 -->
    <select id="selectEnvEduInst" parameterType="front.EduInstVo" resultType="front.EduInstVo">
        /* EduInstDao.selectAplyInfoForm*/
         SELECT
            A.APLYID             /*신청아이디*/
          , A.RCPTNO             /*접수번호*/
          , A.INSTID             /*기관아이디*/
          , A.APLCNTID           /*신청자아이디*/
          , A.APLCNT_NM          /*신청자_이름*/
          , A.APLCNT_EML         /*신청자_이메일*/
          , A.APLCNT_MOBLPHON    /*신청자_휴대폰*/
          , A.INST_NM            /*기관_이름*/
          , A.INST_EML           /*기관_이메일*/
          , A.INST_CNTCT         /*기관_연락처*/
          , A.CTPRVN_CD          /*시도_코드*/
          , A.RPRSV_BRDT         /*대표자_생년월일*/
          , A.ATCH_FILEGRPID     /*첨부_파일그룹아이디*/
          , A.DSGNNO             /*지정번호*/
          , A.DSGN_DE            /*지정_일자*/
          , A.AUTZRID            /*승인자아이디*/
          , A.ISSU_DE            /*발급_일자*/
          , A.ISGN_DE            /*재발급_일자*/
          , A.STTS_CD            /*상태_코드*/
          , A.MDFCN_DT           /*수정_일시*/
          , A.MDFRID             /*수정자아이디*/
          , A.REG_DT             /*등록_일시*/
          , A.RGTRID             /*등록자아이디*/
          , B.RGN_CD
          , SUBSTR(B.RGN_CD,1,2)    AS CTPRVN_CD
          , B.INST_TYPE_CD
          , B.TELNO      AS INST_CNTCT
          , B.ADDR
          , B.ADDR_DTL
          , B.BRNO
          , TYPE_CD.CD_NM
        FROM TB_SEE_ENV_EDU_INST A
        LEFT OUTER JOIN TB_CMM_INST B ON A.INSTID =B.INSTID
        LEFT OUTER JOIN TB_CMM_ADDR_CTPRVN ADDR ON B.RGN_CD = ADDR.CTPRVN_CD
        LEFT OUTER JOIN TB_CMM_CD TYPE_CD ON B.INST_TYPE_CD = TYPE_CD.CD
        WHERE A.APLYID = #{aplyid}
    </select>

    <!-- 환경교육기관 등록 -->
    <insert id="insertEnvEduInst" parameterType="front.EduInstVo" useGeneratedKeys="true" keyProperty="aplyid">
    /* EduInstDao.insertEnvEduInst*/
    INSERT INTO TB_SEE_ENV_EDU_INST
        (
            RCPTNO
          , INSTID
          , APLCNTID
          , APLCNT_NM
          , APLCNT_EML
          , APLCNT_MOBLPHON
          , INST_NM
          , INST_EML
          , INST_CNTCT
          , CTPRVN_CD
          , RPRSV_BRDT
          , ATCH_FILEGRPID
          , DSGNNO
          , DSGN_DE
          , AUTZRID
          , ISSU_DE
          , ISGN_DE
          , STTS_CD
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
        ) VALUES(
            #{rcptno        }
          , #{instid        }
          , #{aplcntid      }
          , #{aplcntNm      }
          , #{aplcntEml     }
          , #{aplcntMoblphon}
          , #{instNm        }
          , #{instEml       }
          , #{instCntct     }
          , #{ctprvnCd      }
          , #{rprsvBrdt     }
          , #{atchFilegrpid }
          , #{dsgnno        }
          , #{dsgnDe        }
          , #{autzrid       }
          , #{issuDe        }
          , #{isgnDe        }
          , #{sttsCd        }
          , NOW()
          , #{user.userid}
          , NOW()
          , #{user.userid}
    )
    </insert>

    <!-- 환경교육기관 수정 -->
    <update id="updateEnvEduInst" parameterType="front.EduInstVo" keyProperty="aplyid">
        /* EduInstDao.updateEnvEduInst*/
        UPDATE
            TB_SEE_ENV_EDU_INST
        SET
            RCPTNO             = #{rcptno        }
          , INSTID             = #{instid        }
          , APLCNTID           = #{aplcntid      }
          , APLCNT_NM          = #{aplcntNm      }
          , APLCNT_EML         = #{aplcntEml     }
          , APLCNT_MOBLPHON    = #{aplcntMoblphon}
          , INST_NM            = #{instNm        }
          , INST_EML           = #{instEml       }
          , INST_CNTCT         = #{instCntct     }
          , CTPRVN_CD          = #{ctprvnCd      }
          , RPRSV_BRDT         = #{rprsvBrdt     }
          , ATCH_FILEGRPID     = #{atchFilegrpid }
          , DSGNNO             = #{dsgnno        }
          , DSGN_DE            = #{dsgnDe        }
          , AUTZRID            = #{autzrid       }
          , ISSU_DE            = #{issuDe        }
          , ISGN_DE            = #{isgnDe        }
          , STTS_CD            = #{sttsCd        }
          , MDFCN_DT           = NOW()
          , MDFRID             = #{user.userid   }
        WHERE
            APLYID = #{aplyid}
    </update>

    <!-- 운영계획 개요 조회 -->
    <select id="selectOperPlan" parameterType="front.EduInstVo" resultType="front.EduInstVo">
        /* EduInstDao.selectOperPlan*/
            SELECT
                APLYID            /*신청아이디*/
              , MAIN_BSNS         /*주요_사업*/
              , OPER_MTHD         /*운영_방법*/
              , OPER_PLAN         /*운영_계획*/
              , MNG_PLAN          /*관리_계획*/
              , BGT_PLAN          /*예산_계획*/
              , EXPC_EFFECT       /*기대_효과*/
              , ETC_DTA           /*기타_자료*/
              , ATCH_FILEGRPID    /*첨부_파일그룹아이디*/
              , MDFCN_DT          /*수정_일시*/
              , MDFRID            /*수정자아이디*/
              , REG_DT            /*등록_일시*/
              , RGTRID            /*등록자아이디*/
            FROM TB_SEE_OPER_PLAN
            WHERE APLYID =#{aplyid}
    </select>

     <!-- 운영계획 등록 -->
    <insert id="insertOperPlan" parameterType="front.EduInstVo" useGeneratedKeys="true" keyProperty="aplyid">
        /* EduInstDao.insertOperPlan*/
        INSERT INTO TB_SEE_OPER_PLAN
        (
            APLYID
          , MAIN_BSNS
          , OPER_MTHD
          , OPER_PLAN
          , MNG_PLAN
          , BGT_PLAN
          , EXPC_EFFECT
          , ETC_DTA
          , ATCH_FILEGRPID
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
        ) VALUES
        (
            #{aplyid       }
          , #{mainBsns     }
          , #{operMthd     }
          , #{operPlan     }
          , #{mngPlan      }
          , #{bgtPlan      }
          , #{expcEffect   }
          , #{etcDta       }
          , #{atchFilegrpid}
          , NOW()
          , #{user.userid}
          , NOW()
          , #{user.userid}
        (
    </insert>

    <!-- 운영계획 수정 -->
    <update id="updateOperPlan" parameterType="front.EduInstVo" useGeneratedKeys="true" keyProperty="aplyid">
        /* EduInstDao.updateOperPlan*/
        UPDATE TB_SEE_OPER_PLAN SET
              MAIN_BSNS      = #{mainBsns}       /*주요사업*/
            , OPER_MTHD      = #{operMthd}       /*운영방법*/
            , OPER_PLAN      = #{operPlan}       /*운영계획*/
            , MNG_PLAN       = #{mngPlan}        /*관리계획*/
            , BGT_PLAN       = #{bgtPlan}        /*예산계획*/
            , EXPC_EFFECT    = #{expcEffect}     /*기대효과*/
            , ETC_DTA        = #{etcDta}         /*기타자료*/
            , ATCH_FILEGRPID = #{atchFilegrpid}  /*첨부파일그룹아이디*/
            , MDFCN_DT       = NOW()             /*수정일시*/
            , MDFRID         = #{user.userid}    /*수정자아이디*/
        WHERE APLYID = #{aplyid}    /*신청아이디*/
    </update>

</mapper>
