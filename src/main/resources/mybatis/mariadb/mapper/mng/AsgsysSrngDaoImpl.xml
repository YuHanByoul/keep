<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SQL File Name : AsgsysSrngDaoImpl.xml
    Description : 지정제심사 관리
-->
<mapper namespace="com.kbrainc.plum.mng.asgsysSrng.model.AsgsysSrngDao">

    <!-- 지정신청 목록 조회. -->
    <select id="selectDsgnAplyList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectDsgnAplyList */
        <include refid="PaginationMapper.header"/>
        SELECT
            A.PRGRM_NM
          , A.PRGRMID
          , A.INST_NM
          , A.STTS_CD
          , A.APLY_DT
          , A.REG_DT
          , B.SRNG_STTS_CD
          , C.SRGN_STTS_CD
          , C.VST_DE
          , C.VST_HR
          , C.VST_MNT
          , CONCAT(C.VST_DE , " " , C.VST_HR , ":" , C.VST_MNT) AS VST_DT
        FROM
            TB_ASS_PRGRM A
        LEFT OUTER JOIN
        (   SELECT
                PRGRMID
              , SRNG_STTS_CD
            FROM
                TB_ASS_PRGRM_JDGS LIMIT 0,1 ) B ON A.PRGRMID  = B.PRGRMID
        LEFT OUTER JOIN
        (   SELECT
                PRGRMID
              , SRGN_STTS_CD
              , VST_DE
              , VST_HR
              , VST_MNT
            FROM
                TB_ASS_SPRTGRP_SRNG LIMIT 0,1 ) C ON A.PRGRMID  = C.PRGRMID
        LEFT OUTER JOIN
        TB_CMM_INST D ON A.INSTID  = D.INSTID
        WHERE 1=1
        <!-- 키워드.프로그램명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchPrgrmNm'">
            AND A.PRGRM_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 키워드.기관명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchInstNm'">
            AND A.INST_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 진행상태  -->
        <if test="searchSttsCd != null and searchSttsCd != ''">
            AND A.STTS_CD = #{searchSttsCd}
        </if>
        <!-- 신청일 검색시작일  -->
        <if test="searchAplyStartDt != null and searchAplyStartDt != ''">
            AND A.APLY_DT >= #{searchAplyStartDt}
        </if>
        <!-- 신청일 검색종료일  -->
        <if test="searchAplyEndDt  != null and searchAplyEndDt != ''">
            AND A.APLY_DT <![CDATA[<]]> CAST(CONCAT(#{searchAplyEndDt},' 23:59:59') AS DATETIME)
        </if>
        <!-- 심사위원 심사상태-->
        <if test="searchSrngSttsCd != null and searchSrngSttsCd != ''">
            AND B.SRNG_STTS_CD = #{searchSrngSttsCd}
        </if>
        <!-- 지원단 심사상태-->
        <if test="searchSrgnSttsCd != null and searchSrgnSttsCd != ''">
            AND C.SRGN_STTS_CD = #{searchSrgnSttsCd }
        </if>
        <!-- 현장점검지정일 시작일-->
        <if test="searchChckDsgnStartDt != null and searchChckDsgnStartDt != ''">
            AND C.VST_DE >= #{searchChckDsgnStartDt}
        </if>
        <!-- 현장점검지정일 종료일-->
        <if test="searchChckDsgnEndDt != null and searchChckDsgnEndDt != ''">
            AND C.VST_DE <![CDATA[<]]> CAST(CONCAT(#{searchChckDsgnEndDt},' 23:59:59') AS DATETIME)
        </if>
        <include refid="PaginationMapper.footer"/>
    </select>

    <!-- 지정신청 목록 엑셀 다운로드 -->
    <select id="aplyExcelDownList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.aplyExcelDownList */
        SELECT
            A.PRGRM_NM
          , A.PRGRMID
          , A.INST_NM
          , A.STTS_CD
          , A.APLY_DT
          , A.REG_DT
          , B.SRNG_STTS_CD
          , C.SRGN_STTS_CD
          , C.VST_DE
          , C.VST_HR
          , C.VST_MNT
        FROM
            TB_ASS_PRGRM A
        LEFT OUTER JOIN
        (   SELECT
                PRGRMID
              , SRNG_STTS_CD
            FROM
                TB_ASS_PRGRM_JDGS LIMIT 0,1 ) B ON A.PRGRMID  = B.PRGRMID
        LEFT OUTER JOIN
        (   SELECT
                PRGRMID
              , SRGN_STTS_CD
              , VST_DE
              , VST_HR
              , VST_MNT
            FROM
                TB_ASS_SPRTGRP_SRNG LIMIT 0,1 ) C ON A.PRGRMID  = C.PRGRMID
        LEFT OUTER JOIN
        TB_CMM_INST D ON A.INSTID  = D.INSTID
        WHERE 1=1
        <!-- 키워드.프로그램명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchPrgrmNm'">
            AND A.PRGRM_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 키워드.기관명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchInstNm'">
            AND A.INST_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 키워드.사업자번호 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchBrno'">
            AND D.BRNO LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 진행상태  -->
        <if test="searchSttsCd != null and searchSttsCd != ''">
            AND A.STTS_CD = #{searchSttsCd}
        </if>
        <!-- 신청일 검색시작일  -->
        <if test="searchAplyStartDt != null and searchAplyStartDt != ''">
            AND A.APLY_DT >= #{searchAplyStartDt}
        </if>
        <!-- 신청일 검색종료일  -->
        <if test="searchAplyEndDt  != null and searchAplyEndDt != ''">
            AND A.APLY_DT <![CDATA[<]]> CAST(CONCAT(#{searchAplyEndDt},' 23:59:59') AS DATETIME)
        </if>
        <!-- 심사위원 심사상태-->
        <if test="searchSrngSttsCd != null and searchSrngSttsCd != ''">
            AND B.SRNG_STTS_CD = #{searchSrngSttsCd}
        </if>
        <!-- 지원단 심사상태-->
        <if test="searchSrgnSttsCd != null and searchSrgnSttsCd != ''">
            AND C.SRGN_STTS_CD = #{searchSrgnSttsCd }
        </if>
        <!-- 현장점검지정일 시작일-->
        <if test="searchChckDsgnStartDt != null and searchChckDsgnStartDt != ''">
            AND C.VST_DE >= #{searchChckDsgnStartDt}
        </if>
        <!-- 현장점검지정일 종료일-->
        <if test="searchChckDsgnEndDt != null and searchChckDsgnEndDt != ''">
            AND C.VST_DE <![CDATA[<]]> CAST(CONCAT(#{searchChckDsgnEndDt},' 23:59:59') AS DATETIME)
        </if>
    </select>

    <!-- 지정프로그램상세 조회. -->
    <select id="selectDsgnAplyDtlInfo" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        SELECT
            A.PRGRMID
          , A.INSTID              /* 기관아이디 */
          , A.APLCNTID            /* 신청자아이디 */
          , A.APLCNT_NM           /* 신청자_이름 */
          , A.APLCNT_EML          /* 신청자_이메일 */
          , A.APLCNT_MOBLPHON     /* 신청자_휴대폰 */
          , A.INST_NM             /* 기관_이름 */
          , A.INST_EML            /* 기관_이메일 */
          , A.INST_CNTCT          /* 기관_연락처 */
          , A.INST_HMPG           /* 기관_홈페이지 */
          , A.INST_TYPE_CD        /* 기관_유형_코드 */
          , A.INST_RGN_CD         /* 기관_지역_코드 */
          , A.INST_ZIP            /* 기관_우편번호 */
          , A.INST_ADDR           /* 기관_주소 */
          , A.INST_DTLADDR        /* 기관_상세주소 */
          , A.PRGRM_NM            /* 프로그램_이름 */
          , A.FILEGRPID           /* 파일그룹아이디 */
          , A.STTS_CD             /* 상태_코드 */
          , A.DSGN_CYCL           /* 지정_차수 */
          , A.DSGN_NO             /* 지정_번호 */
          , A.DSGN_DE             /* 지정_일자 */
          , A.DSGN_BGNG_DE        /* 지정_시작_일자 */
          , A.DSGN_END_DE         /* 지정_종료_일자 */
          , A.AUTZRID             /* 승인자아이디 */
          , A.CHKLSTID            /* 체크리스트아이디 */
          , A.CNSLTNG_PRGRS_YN    /* 컨설팅__진행_여부 */
          , A.CNSLTNGID           /* 컨설텅아이디 */
          , A.APLY_DT             /* 신청_일시 */
          , A.MDFCN_DT            /* 수정_일시 */
          , A.MDFRID              /* 수정자아이디 */
          , A.REG_DT              /* 등록_일시 */
          , A.RGTRID              /* 등록자아이디 */
          , CONCAT(A.DSGN_CYCL, "/", A.DSGN_NO)    AS CYCL_NO
          , CONCAT(A.DSGN_BGNG_DE, " ~ ", A.DSGN_END_DE )   AS DSGN_PRD
          , (SELECT ACNT FROM TB_CMM_USER WHERE USERID = A.APLCNTID) AS ACNT
          , B.SPLMNT_DMNDID
          , C.USERID_GRP
          , C.USER_ACNT_GRP
          , C.USER_NM_GRP
          , C.USER_EML_GRP
          , C.USER_MOBLPHON_GRP
          , D.SPRTGRPID
          , D.SPRTGRP_ACNT
          , D.SPRTGRP_NM
          , D.SPRTGRP_EML
          , D.SPRTGRP_MOBLPHON
        FROM
            TB_ASS_PRGRM A
        LEFT OUTER JOIN
        (
            SELECT
                MAX(SPLMNT_DMNDID)    AS SPLMNT_DMNDID
              , PRGRMID
            FROM TB_ASS_PRGRM_SPLMNT_DMND
            WHERE PRGRMID = #{prgrmid}
        ) B ON A.PRGRMID = B.PRGRMID
        LEFT OUTER JOIN    /* 심사위원 */
        (
            SELECT
                AA.PRGRMID
              , GROUP_CONCAT(AA.JDGSID)   AS USERID_GRP
              , GROUP_CONCAT(BB.ACNT)     AS USER_ACNT_GRP
              , GROUP_CONCAT(BB.NM)       AS USER_NM_GRP
              , GROUP_CONCAT(BB.EML)      AS USER_EML_GRP
              , GROUP_CONCAT(BB.MOBLPHON) AS USER_MOBLPHON_GRP
            FROM
                TB_ASS_PRGRM_JDGS AA
            INNER JOIN
                TB_CMM_USER BB ON AA.JDGSID = BB.USERID
            WHERE AA.PRGRMID = #{prgrmid}
            GROUP BY
                AA.PRGRMID
        ) C ON A.PRGRMID = C.PRGRMID
        LEFT OUTER JOIN    /* 지원단 */
        (
            SELECT
                AA.PRGRMID
              , AA.SPRTGRPID
              , BB.ACNT     AS SPRTGRP_ACNT
              , BB.NM       AS SPRTGRP_NM
              , BB.EML      AS SPRTGRP_EML
              , BB.MOBLPHON AS SPRTGRP_MOBLPHON
            FROM
                TB_ASS_SPRTGRP_SRNG AA
            INNER JOIN
                TB_CMM_USER BB ON AA.SPRTGRPID = BB.USERID
        ) D ON A.PRGRMID = D.PRGRMID
        WHERE 1=1
        AND A.PRGRMID = #{prgrmid}
    </select>

    <!-- 프로그램 우수성 조회. -->
    <select id="selectPrgrmDstnctn" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        SELECT
            A.PRGRMID                /* 프로그램아이디           */
          , B.PRGRMID    AS DSTNCTN_KEY    /* 우수성_프로그램아이디           */
          , A.PRGRM_NM               /* 프로그램이름             */
          , A.CNSLTNG_PRGRS_YN       /* 컨설팅 진행여부          */
          , C.CNSLTNG_KND_CD         /* 컨설팅 종류코드          */
          , B.STY_YN                 /* 숙박_여부                */
          , B.STY_NIGHT              /* 숙박_밤                  */
          , B.STY_DAYTM              /* 숙박_낮                  */
          , B.OPER_FRM_CD            /* 운영_형태_코드           */
          , B.JAN                    /* 1월                      */
          , B.FEB                    /* 2월                      */
          , B.MAR                    /* 3월                      */
          , B.APR                    /* 4월                      */
          , B.MAY                    /* 5월                      */
          , B.JUNE                   /* 6월                      */
          , B.JULY                   /* 7월                      */
          , B.AUG                    /* 8월                      */
          , B.SEPT                   /* 9월                      */
          , B.OCT                    /* 10월                     */
          , B.NOV                    /* 11월                     */
          , B.DCM                    /* 12월                     */
          , B.WHOL_MM                /* 전체_월                  */
          , B.INFNT                  /* 유아                     */
          , B.SCHBOY                 /* 초등학생                 */
          , B.MSKLSD                 /* 중학생                   */
          , B.HGSCHST                /* 고등학생                 */
          , B.ADULT                  /* 성인                     */
          , B.WHOL_AGE               /* 전체_연령                */
          , B.EDU_PLC                /* 교육_장소                */
          , B.EDU_NOPE               /* 교육_인원수              */
          , B.EDU_CNT                /* 교육_횟수                */
          , B.EDU_HR                 /* 교육_시간                */
          , B.EDU_MNT                /* 교육_분                  */
          , B.PCHRG_YN               /* 유료_여부                */
          , B.ETRFEE                 /* 참가비                   */
          , B.EDU_PRPS               /* 교육_목적                */
          , B.APPRO                  /* 적절성                   */
          , B.DSTNCTN                /* 우수성                   */
          , B.EDU_CN                 /* 교육_내용                */
          , B.WETHER_STTN            /* 기상_상황                */
          , B.ACTN_MTHD              /* 조치_방법                */
          , B.EDU_PHOTO_FILEGRPID    /* 교육_사진_파일그룹아이디 */
          , B.MDFCN_DT               /* 수정_일시                */
          , B.MDFRID                 /* 수정자아이디             */
          , B.REG_DT                 /* 등록_일시                */
          , B.RGTRID                 /* 등록자아이디             */
          , (SELECT GROUP_CONCAT(EDU_SBJCT_CD SEPARATOR',') FROM TB_ASS_PRGRM_EDU_SBJCT WHERE PRGRMID = #{prgrmid}) AS EDU_SBJCT_CD
        FROM
            TB_ASS_PRGRM A
        /*프로그램 우수성*/
        LEFT OUTER JOIN
            TB_ASS_PRGRM_DSTNCTN B ON A.PRGRMID = B.PRGRMID
        LEFT OUTER JOIN    /*컨설팅*/
            TB_ASS_CNSLTNG C ON A.CNSLTNGID = C.CNSLTNGID
        WHERE A.PRGRMID = #{prgrmid}
    </select>

    <!-- 프로그램 운영일정 목록 조회 -->
    <select id="selectPrgrmSchdlList" parameterType="PrgrmSchdlVo" resultType="PrgrmSchdlVo">
        SELECT
            PRGRMID
          , SCHDLID
          , RND
          , BGNG_HR
          , BGNG_MNT
          , END_HR
          , END_MNT
          , PRGRM_NM
          , CRS
          , REG_DT
          , RGTRID
          , MDFRID
        FROM
            TB_ASS_PRGRM_SCHDL    /*ASS_프로그램_일정*/
        WHERE PRGRMID = #{prgrmid}
    </select>

    <!-- 프로그램 운영일정 수정 -->
    <update id="updatePrgrmSchdl" parameterType="PrgrmSchdlVo" >
    UPDATE
        TB_ASS_PRGRM_SCHDL
    SET
        PRGRMID    = #{prgrmid }
      , RND        = #{rnd     }
      , BGNG_HR    = #{bgngHr  }
      , BGNG_MNT   = #{bgngMnt }
      , END_HR     = #{endHr   }
      , END_MNT    = #{endMnt  }
      , PRGRM_NM   = #{prgrmNm }
      , CRS        = #{crs     }
      , MDFCN_DT   = NOW()
      , MDFRID     = #{user.userid}
    WHERE SCHDLID  = #{schdlid}

    </update>
    <!-- 프로그램 운영일정 등록 -->
    <insert id="insertPrgrmSchdl" parameterType="PrgrmSchdlVo" >
        INSERT INTO
            TB_ASS_PRGRM_SCHDL (
                PRGRMID
              , RND
              , BGNG_HR
              , BGNG_MNT
              , END_HR
              , END_MNT
              , PRGRM_NM
              , CRS
              , MDFCN_DT
              , MDFRID
              , REG_DT
              , RGTRID
        ) VALUES(
                #{prgrmid }
              , #{rnd     }
              , #{bgngHr  }
              , #{bgngMnt }
              , #{endHr   }
              , #{endMnt  }
              , #{prgrmNm }
              , #{crs     }
              , NOW()
              , #{user.userid}
              , NOW()
              , #{user.userid}
        )

    </insert>

    <!-- 프로그램 운영일정 삭제 -->
    <delete id="deletePrgrmSchdl" parameterType="PrgrmSchdlVo" >
        DELETE FROM
            TB_ASS_PRGRM_SCHDL
        WHERE PRGRMID = #{prgrmid}

    </delete>

    <!-- 비상조치계획 목록조회 -->
    <select id="selectEmrgcyActnPlanList" parameterType="AsgsysSrngVo" resultType="EmrgcyActnPlanVo">
        SELECT
            PLANID
          , PRGRMID
          , PRGRM_NM
          , SBSTN_PRGRM_NM
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
        FROM
            TB_ASS_EMRGCY_ACTN_PLAN
        WHERE PRGRMID = #{prgrmid}
    </select>

    <!-- 비상조치계획 등록 -->
    <insert id="insertEmrgcyActnPlan" parameterType="EmrgcyActnPlanVo" >
        INSERT INTO
            TB_ASS_EMRGCY_ACTN_PLAN(
                PRGRMID
              , PRGRM_NM
              , SBSTN_PRGRM_NM
              , MDFCN_DT
              , MDFRID
              , REG_DT
              , RGTRID
        ) VALUES (
                #{prgrmid}
              , #{prgrmNm}
              , #{sbstnPrgrmNm}
              , NOW()
              , #{user.userid}
              , NOW()
              , #{user.userid}
        )
    </insert>

    <!-- 비상조치계획 수정 -->
    <update id="updateEmrgcyActnPlan" parameterType="EmrgcyActnPlanVo" >
        UPDATE
            TB_ASS_EMRGCY_ACTN_PLAN
        SET
            PRGRM_NM       =  #{prgrmNm}
          , SBSTN_PRGRM_NM =  #{sbstnPrgrmNm}
          , MDFCN_DT       =  NOW()
          , MDFRID         =  #{user.userid}
    </update>

    <!-- 비상조치계획 삭제 -->
    <delete id="deleteEmrgcyActnPlan" parameterType="EmrgcyActnPlanVo" >
        DELETE FROM
            TB_ASS_EMRGCY_ACTN_PLAN
        WHERE PRGRMID = #{prgrmid}
    </delete>

    <!-- 프로그램우수성 등록 -->
    <insert id="insertPrgrmDstnctn" parameterType="AsgsysSrngVo" >
    /* AsgsysSrngDao.insertPrgrmDstnctn */
    INSERT
        INTO TB_ASS_PRGRM_DSTNCTN (
            PRGRMID
          , STY_YN
          , STY_NIGHT
          , STY_DAYTM
          , OPER_FRM_CD
          , JAN
          , FEB
          , MAR
          , APR
          , MAY
          , JUNE
          , JULY
          , AUG
          , SEPT
          , OCT
          , NOV
          , DCM
          , WHOL_MM
          , INFNT
          , SCHBOY
          , MSKLSD
          , HGSCHST
          , ADULT
          , WHOL_AGE
          , EDU_PLC
          , EDU_NOPE
          , EDU_CNT
          , EDU_HR
          , EDU_MNT
          , PCHRG_YN
          , ETRFEE
          , EDU_PRPS
          , APPRO
          , DSTNCTN
          , EDU_CN
          , WETHER_STTN
          , ACTN_MTHD
          , EDU_PHOTO_FILEGRPID
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
          ) VALUES (
            #{prgrmid          }
          , #{styYn            }
          , #{styNight         }
          , #{styDaytm         }
          , #{operFrmCd        }
          , #{jan              }
          , #{feb              }
          , #{mar              }
          , #{apr              }
          , #{may              }
          , #{june             }
          , #{july             }
          , #{aug              }
          , #{sept             }
          , #{oct              }
          , #{nov              }
          , #{dcm              }
          , #{wholMm           }
          , #{infnt            }
          , #{schboy           }
          , #{msklsd           }
          , #{hgschst          }
          , #{adult            }
          , #{wholAge          }
          , #{eduPlc           }
          , #{eduNope          }
          , #{eduCnt           }
          , #{eduHr            }
          , #{eduMnt           }
          , #{pchrgYn          }
          , #{etrfee           }
          , #{eduPrps          }
          , #{appro            }
          , #{dstnctn          }
          , #{eduCn            }
          , #{wetherSttn       }
          , #{actnMthd         }
          , #{eduPhotoFilegrpid}
          , NOW()
          , #{user.userid}
          , NOW()
          , #{user.userid}
          )
    </insert>

    <!-- 프로그램우수성 수정 -->
    <update id="updatePrgrmDstnctn" parameterType="AsgsysSrngVo" >
    /* AsgsysSrngDao.updatePrgrmDstnctn */
        UPDATE
            TB_ASS_PRGRM_DSTNCTN
        SET
            STY_YN                  = #{styYn            }
          , STY_NIGHT               = #{styNight         }
          , STY_DAYTM               = #{styDaytm         }
          , OPER_FRM_CD             = #{operFrmCd        }
          , JAN                     = #{jan              }
          , FEB                     = #{feb              }
          , MAR                     = #{mar              }
          , APR                     = #{apr              }
          , MAY                     = #{may              }
          , JUNE                    = #{june             }
          , JULY                    = #{july             }
          , AUG                     = #{aug              }
          , SEPT                    = #{sept             }
          , OCT                     = #{oct              }
          , NOV                     = #{nov              }
          , DCM                     = #{dcm              }
          , WHOL_MM                 = #{wholMm           }
          , INFNT                   = #{infnt            }
          , SCHBOY                  = #{schboy           }
          , MSKLSD                  = #{msklsd           }
          , HGSCHST                 = #{hgschst          }
          , ADULT                   = #{adult            }
          , WHOL_AGE                = #{wholAge          }
          , EDU_PLC                 = #{eduPlc           }
          , EDU_NOPE                = #{eduNope          }
          , EDU_CNT                 = #{eduCnt           }
          , EDU_HR                  = #{eduHr            }
          , EDU_MNT                 = #{eduMnt           }
          , PCHRG_YN                = #{pchrgYn          }
          , ETRFEE                  = #{etrfee           }
          , EDU_PRPS                = #{eduPrps          }
          , APPRO                   = #{appro            }
          , DSTNCTN                 = #{dstnctn          }
          , EDU_CN                  = #{eduCn            }
          , WETHER_STTN             = #{wetherSttn       }
          , ACTN_MTHD               = #{actnMthd         }
          , EDU_PHOTO_FILEGRPID     = #{eduPhotoFilegrpid}
          , MDFCN_DT                = NOW()
          , MDFRID                  = #{user.userid      }
        WHERE
            PRGRMID = #{prgrmid}
    </update>

    <!-- 프로그램 운영관리 조회 -->
    <select id="selectPrgrmOperMng" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectPrgrmOperMng */
        SELECT
            A.PRGRMID
          , B.PRGRMID   AS OPER_MNG_PRGRMID
          , B.ETRFEE_INCM
          , B.ETC_INCM
          , B.SLFPY
          , IFNULL(B.ETRFEE_INCM,0) + IFNULL(B.ETC_INCM,0) + IFNULL(B.SLFPY,0) AS BTG_SUM
          , B.OPER_BFR_PRMTN_SESS
          , B.OPER_BFR_PRMTN_MTHD
          , B.OPER_MDL_PRMTN_SESS
          , B.OPER_MDL_PRMTN_MTHD
          , B.OPER_AFTR_PRMTN_SESS
          , B.OPER_AFTR_PRMTN_MTHD
          , B.TEL_RCPT_YN
          , B.APLFRM_RCPT_YN
          , B.ONLN_APLY_YN
          , B.ETC_YN
          , B.ETC_CN
          , B.MDFCN_DT
          , B.MDFRID
          , B.REG_DT
          , B.RGTRID
        FROM
            TB_ASS_PRGRM A
        LEFT OUTER JOIN
            TB_ASS_PRGRM_OPER_MNG B ON A.PRGRMID = B.PRGRMID
        WHERE A.PRGRMID = #{prgrmid}
    </select>

    <!-- 프로그램운영관리 수정 -->
    <update id="updatePrgrmOperMng" parameterType="AsgsysSrngVo" >
    /* AsgsysSrngDao.updatePrgrmOperMng */
        UPDATE
            TB_ASS_PRGRM_OPER_MNG
        SET
            ETRFEE_INCM            = #{etrfeeIncm }
          , ETC_INCM               = #{etcIncm }
          , SLFPY                  = #{slfpy }
          , OPER_BFR_PRMTN_SESS    = #{operBfrPrmtnSess }
          , OPER_BFR_PRMTN_MTHD    = #{operBfrPrmtnMthd }
          , OPER_MDL_PRMTN_SESS    = #{operMdlPrmtnSess }
          , OPER_MDL_PRMTN_MTHD    = #{operMdlPrmtnMthd }
          , OPER_AFTR_PRMTN_SESS   = #{operAftrPrmtnSess }
          , OPER_AFTR_PRMTN_MTHD   = #{operAftrPrmtnMthd }
          , TEL_RCPT_YN            = #{telRcptYn }
          , APLFRM_RCPT_YN         = #{aplfrmRcptYn }
          , ONLN_APLY_YN           = #{onlnAplyYn }
          , ETC_YN                 = #{etcYn }
          , ETC_CN                 = #{etcCn }
          , MDFCN_DT               = NOW()
          , MDFRID                 = #{user.userid}
        WHERE PRGRMID = #{prgrmid}
    </update>


    <insert id="insertPrgrmOperMng" parameterType="AsgsysSrngVo" >
        INSERT INTO
            TB_ASS_PRGRM_OPER_MNG(
                PRGRMID
              , ETRFEE_INCM
              , ETC_INCM
              , SLFPY
              , OPER_BFR_PRMTN_SESS
              , OPER_BFR_PRMTN_MTHD
              , OPER_MDL_PRMTN_SESS
              , OPER_MDL_PRMTN_MTHD
              , OPER_AFTR_PRMTN_SESS
              , OPER_AFTR_PRMTN_MTHD
              , TEL_RCPT_YN
              , APLFRM_RCPT_YN
              , ONLN_APLY_YN
              , ETC_YN
              , ETC_CN
              , MDFCN_DT
              , MDFRID
              , REG_DT
              , RGTRID
        ) VALUES (
                #{prgrmid}
              , #{etrfeeIncm}
              , #{etcIncm}
              , #{slfpy}
              , #{operBfrPrmtnSess}
              , #{operBfrPrmtnMthd}
              , #{operMdlPrmtnSess}
              , #{operMdlPrmtnMthd}
              , #{operAftrPrmtnSess}
              , #{operAftrPrmtnMthd}
              , #{telRcptYn}
              , #{aplfrmRcptYn}
              , #{onlnAplyYn}
              , #{etcYn}
              , #{etcCn}
              , NOW()
              , #{user.userid}
              , NOW()
              , #{user.userid}
        )
    </insert>

    <!-- 교구 및 시설목록조회 -->
    <select id="selectTchaidFcltList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selecttchaidFcltList */
        SELECT
            TCHAIDFCLTID
          , PRGRMID
          , DTL_PRGRM_NM
          , EDU_PLC
          , TCHAID
          , QNTY
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
        FROM
            TB_ASS_TCHAID_FCLT
        WHERE PRGRMID = #{prgrmid}
    </select>

    <!-- 프로그램 평가 조회 -->
    <select id="selectPrgrmEvl" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectPrgrmEvl*/
        SELECT
            A.PRGRMID
          , B.EVL_PRPS
          , B.BFR_LDR_EVL_ARTCL
          , B.BFR_LDR_EVL_TL
          , B.AFTR_LDR_EVL_ARTCL
          , B.AFTR_LDR_EVL_TL
          , B.BFR_PRTPNT_EVL_ARTCL
          , B.BFR_PRTPNT_EVL_TL
          , B.AFTR_PRTPNT_EVL_ARTCL
          , B.AFTR_PRTPNT_EVL_TL
          , B.BFR_GDR_EVL_ARTCL
          , B.AFTR_GDR_EVL_TL
          , B.DATABASE_WRT_YN
          , B.CLSJRNL_WRT_YN
          , B.ETC_YN
          , B.ETC_CN
          , B.MDFCN_DT
          , B.MDFRID
          , B.REG_DT
          , B.RGTRID
        FROM
            TB_ASS_PRGRM A
        LEFT OUTER JOIN
            TB_ASS_PRGRM_EVL B ON A.PRGRMID = B.PRGRMID
        WHERE A.PRGRMID = #{prgrmid}
    </select>

    <!-- 지정제 프로그램 등록 -->
    <insert id="insertPrgrm" parameterType="AsgsysSrngVo" >
    /* AsgsysSrngDao.insertPrgrm */
    INSERT INTO
        TB_ASS_PRGRM (
            PRGRMID,
          , INSTID
          , APLCNTID
          , APLCNT_NM
          , APLCNT_EML
          , APLCNT_MOBLPHON
          , INST_NM
          , INST_EML
          , INST_CNTCT
          , INST_HMPG
          , INST_TYPE_CD
          , INST_RGN_CD
          , INST_ZIP
          , INST_ADDR
          , INST_DTLADDR
          , PRGRM_NM
          , FILEGRPID
          , STTS_CD
          , DSGN_CYCL
          , DSGN_NO
          , DSGN_DE
          , DSGN_BGNG_DE
          , DSGN_END_DE
          , AUTZRID
          , CHKLSTID
          , CNSLTNG_PRGRS_YN
          , CNSLTNGID
          , APLY_DT
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
    ) VALUES(
            #{prgrmid       }
          , #{instid        }
          , #{aplcntid      }
          , #{aplcntNm      }
          , #{aplcntEml     }
          , #{aplcntMoblphon}
          , #{instNm        }
          , #{instEml       }
          , #{instCntct     }
          , #{instHmpg      }
          , #{instTypeCd    }
          , #{instRgnCd     }
          , #{instZip       }
          , #{instAddr      }
          , #{instDtladdr   }
          , #{prgrmNm       }
          , #{filegrpid     }
          , #{sttsCd        }
          , #{dsgnCycl      }
          , #{dsgnNo        }
          , #{dsgnDe        }
          , #{dsgnBgngDe    }
          , #{dsgnEndDe     }
          , #{autzrid       }
          , #{chklstid      }
          , #{cnsltngPrgrsYn}
          , #{cnsltngid     }
          , #{aplyDt        }
          , NOW()
          , #{user.userid}
          , NOW()
          , #{user.userid}
    )
    </insert>

    <!-- 지정제 프로그램 수정 -->
    <update id="updatePrgrm" parameterType="AsgsysSrngVo" >
    /* AsgsysSrngDao.updatePrgrm */
    UPDATE TB_ASS_PRGRM SET
        INSTID              = #{instid        }    /* 기관아이디 */
      , APLCNTID            = #{aplcntid      }    /* 신청자아이디 */
      , APLCNT_NM           = #{aplcntNm      }    /* 신청자_이름 */
      , APLCNT_EML          = #{aplcntEml     }    /* 신청자_이메일 */
      , APLCNT_MOBLPHON     = #{aplcntMoblphon}    /* 신청자_휴대폰 */
      , INST_NM             = #{instNm        }    /* 기관_이름 */
      , INST_EML            = #{instEml       }    /* 기관_이메일 */
      , INST_CNTCT          = #{instCntct     }    /* 기관_연락처 */
      , INST_HMPG           = #{instHmpg      }    /* 기관_홈페이지 */
      , INST_TYPE_CD        = #{instTypeCd    }    /* 기관_유형_코드 */
      , INST_RGN_CD         = #{instRgnCd     }    /* 기관_지역_코드 */
      , INST_ZIP            = #{instZip       }    /* 기관_우편번호 */
      , INST_ADDR           = #{instAddr      }    /* 기관_주소 */
      , INST_DTLADDR        = #{instDtladdr   }    /* 기관_상세주소 */
      , PRGRM_NM            = #{prgrmNm       }    /* 프로그램_이름 */
      , FILEGRPID           = #{filegrpid     }    /* 파일그룹아이디 */
      , STTS_CD             = #{sttsCd        }    /* 상태_코드 */
      , DSGN_CYCL           = #{dsgnCycl      }    /* 지정_차수 */
      , DSGN_NO             = #{dsgnNo        }    /* 지정_번호 */
      , DSGN_DE             = #{dsgnDe        }    /* 지정_일자 */
      , DSGN_BGNG_DE        = #{dsgnBgngDe    }    /* 지정_시작_일자 */
      , DSGN_END_DE         = #{dsgnEndDe     }    /* 지정_종료_일자 */
      , AUTZRID             = #{autzrid       }    /* 승인자아이디 */
      , CHKLSTID            = #{chklstid      }    /* 체크리스트아이디 */
      , CNSLTNG_PRGRS_YN    = #{cnsltngPrgrsYn}    /* 컨설팅__진행_여부 */
      , CNSLTNGID           = #{cnsltngid     }    /* 컨설텅아이디 */
      , APLY_DT             = #{aplyDt        }    /* 신청_일시 */
      , MDFCN_DT            = NOW()                /* 수정_일시 */
      , MDFRID              = #{mdfrid        }    /* 수정자아이디 */
      , REG_DT              = NOW()                /* 등록_일시 */
      , RGTRID              = #{rgtrid        }    /* 등록자아이디 */
    WHERE PRGRMID = #{prgrmid}
    </update>

    <!-- 지정신청 진행상태 조회 -->
    <select id="selectPrgrmSttsCd" parameterType="AsgsysSrngVo" resultType="String">
    SELECT
        STTS_CD
    FROM
        TB_ASS_PRGRM
    WHERE
        PRGRMID = #{prgrmid}
    </select>


    <!-- 지정신청 진행상태 수정 -->
    <update id="updatePrgrSttsCd" parameterType="AsgsysSrngVo" >
    UPDATE TB_ASS_PRGRM SET
        STTS_CD = #{sttsCd}    /* 상태_코드 */
    WHERE PRGRMID = #{prgrmid}
    </update>

    <!-- 보완요청 목록조회 -->
    <select id="selectSplmntDmndList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectSplmntDmndList*/
        <include refid="PaginationMapper.header"/>
        SELECT
            SPLMNT_DMNDID    /* 보완_요청아이디 */
          , PRGRMID          /* 프로그램아이디 */
          , STTS_CD          /* 상태_코드 */
          , OPNN_CN          /* 의견_내용 */
          , CMPTN_PRCS_DE    /* 완료_처리_일자 */
          , MDFCN_DT         /* 수정_일시 */
          , MDFRID           /* 수정자아이디 */
          , REG_DT           /* 등록_일시 */
          , RGTRID           /* 등록자아이디 */
        FROM
            TB_ASS_PRGRM_SPLMNT_DMND
        WHERE 1=1
        AND PRGRMID = #{prgrmid}
        <include refid="PaginationMapper.footer"/>
    </select>

    <!-- 보완요청 조회 -->
    <select id="selectSplmntDmnd" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectSplmntDmnd */

        SELECT
            SPLMNT_DMNDID    /* 보완_요청아이디 */
          , PRGRMID          /* 프로그램아이디 */
          , STTS_CD          /* 상태_코드 */
          , OPNN_CN          /* 의견_내용 */
          , CMPTN_PRCS_DE    /* 완료_처리_일자 */
          , MDFCN_DT         /* 수정_일시 */
          , MDFRID           /* 수정자아이디 */
          , REG_DT           /* 등록_일시 */
          , RGTRID           /* 등록자아이디 */
        FROM
            TB_ASS_PRGRM_SPLMNT_DMND
        WHERE 1=1
        AND SPLMNT_DMNDID = #{splmntDmndid}

    </select>

    <!-- 보완요청 등록 -->
    <insert id="insertSplmntDmnd" parameterType="AsgsysSrngVo" >
        /* AsgsysSrngDao.insertSplmntDmnd*/
        INSERT INTO
        TB_ASS_PRGRM_SPLMNT_DMND (
            PRGRMID
          , STTS_CD
          , OPNN_CN
          , CMPTN_PRCS_DE
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
        ) VALUES (
            #{prgrmid    }
          , #{sttsCd     }
          , #{opnnCn     }
          , #{cmptnPrcsDe}
          , NOW()
          , #{user.userid}
          , NOW()
          , #{user.userid}
        )
    </insert>

    <!-- 보완요청 수정 -->
    <update id="updateSplmntDmnd" parameterType="AsgsysSrngVo" >
        /* AsgsysSrngDao.updateSplmntDmnd*/
        UPDATE
            TB_ASS_PRGRM_SPLMNT_DMND
        SET
            STTS_CD       = #{sttsCd}
          , OPNN_CN       = #{opnnCn}
          , CMPTN_PRCS_DE = #{cmptnPrcsDe}
          , MDFCN_DT      = NOW()
          , MDFRID        = #{user.userid}
        WHERE
            SPLMNT_DMNDID = #{splmntDmndid}

    </update>

    <!-- 보완요청 삭제 -->
    <delete id="deleteSplmntDmnd" parameterType="AsgsysSrngVo" >
        /* AsgsysSrngDao.deleteSplmntDmnd*/
        DELETE FROM
            TB_ASS_PRGRM_SPLMNT_DMND
        WHERE
            SPLMNT_DMNDID = #{splmntDmndid}
    </delete>

    <!-- 신청정보탭 안전관리 상세 조회 -->
    <select id="selectSftyMng" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        SELECT
            A.PRGRMID
          , B.FILEGRPID
          , B.LDR_EDU_SESS
          , B.LDR_EDU_PIC
          , B.LDR_EDU_CN
          , B.PRTCPNT_EDU_SESS
          , B.PRTCPNT_EDU_PIC
          , B.PRTCPNT_EDU_CN
          , B.BFR_CERT_YN
          , B.BFR_CERT_FILEGRPID
          , B.MDFCN_DT
          , B.MDFRID
          , B.REG_DT
          , B.RGTRID
        FROM
            TB_ASS_PRGRM A
        LEFT OUTER JOIN
            TB_ASS_SFTY_MNG B ON A.PRGRMID = B.PRGRMID
        WHERE 1=1
        AND A.PRGRMID = #{prgrmid}

    </select>

    <!-- 안전관리 수정 -->
    <update id="updateSftyMng" parameterType="AsgsysSrngVo" >
    /* AsgsysSrngDao.updatePrgrm */
    UPDATE
        TB_ASS_SFTY_MNG
    SET
        LDR_EDU_SESS          = #{ldrEduSess}
      , LDR_EDU_PIC           = #{ldrEduPic}
      , LDR_EDU_CN            = #{ldrEduCn}
      , PRTCPNT_EDU_SESS      = #{prtcpntEduSess}
      , PRTCPNT_EDU_PIC       = #{prtcpntEduPic}
      , PRTCPNT_EDU_CN        = #{prtcpntEduCn}
      , BFR_CERT_YN           = #{bfrCertYn}
      , BFR_CERT_FILEGRPID    = #{bfrCertFilegrpid}
      , MDFCN_DT              = NOW()
      , MDFRID                = #{user.userid}
    WHERE PRGRMID = #{prgrmid}
    </update>

    <!-- 심사위원심사 목록조회-->
    <select id="selectJdgsSrngList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectJdgsSrngList*/
        <include refid="PaginationMapper.header"/>
            SELECT
                 A.PRGRMID
               , A.JDGSID
               , '' AS JDGS_NM
               , B.PRGRM_NM
               , B.INST_NM
               , A.SRNG_STTS_CD
               , A.REG_DT          /* 배정일*/
               , C.STY_YN          /* 숙박여부*/
               , D.SBMSN_DT        /* 심사일 */
               , A.MDFCN_DT
               , A.MDFRID
               , A.RGTRID
            FROM
                TB_ASS_PRGRM_JDGS A
            INNER JOIN
                TB_ASS_PRGRM B ON A.PRGRMID = B.PRGRMID
            LEFT OUTER JOIN
                TB_ASS_PRGRM_DSTNCTN C ON A.PRGRMID = C.PRGRMID
            LEFT OUTER JOIN
                /*TB_ASS_SRNG_RSLT D ON A.PRGRMID = D.PRGRMID */
                TB_ASS_SRNG_SBMSN D ON A.PRGRMID = D.PRGRMID
            WHERE 1=1
        <!-- 키워드.전체 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == ''">
            AND (B.PRGRM_NM LIKE CONCAT('%',#{searchKeyword},'%') OR B.INST_NM LIKE CONCAT('%',#{searchKeyword},'%'))
        </if>
        <!-- 키워드.프로그램명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchPrgrmNm'">
            AND B.PRGRM_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 키워드.기관명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchInstNm'">
            AND B.INST_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 심사진행상태  -->
        <if test="searchSrngSttsCd != null and searchSrngSttsCd != ''">
            AND A.SRNG_STTS_CD = #{searchSrngSttsCd}
        </if>
        <!-- 배정일 검색시작일  -->
        <if test="searchRegStartDt != null and searchRegStartDt != ''">
            AND A.REG_DT >= #{searchRegStartDt}
        </if>
        <!-- 배정일 검색종료일  -->
        <if test="searchRegEndDt != null and searchRegEndDt != ''">
            AND A.REG_DT  <![CDATA[<]]> CAST(CONCAT(#{searchRegEndDt},' 23:59:59') AS DATETIME)
        </if>
        <!-- 숙박여부-->
        <if test="searchStyYn!= null and searchStyYn != ''">
            AND C.STY_YN = #{searchStyYn}
        </if>
        <include refid="PaginationMapper.footer"/>
    </select>

    <select id="jdgsSrngListExcelDown" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.jdgsSrngListExcelDown */
            SELECT
            A.PRGRM_NM
          , A.PRGRMID
          , A.INST_NM
          , A.STTS_CD
          , A.APLY_DT
          , A.REG_DT
          , B.SRNG_STTS_CD
          , C.SRGN_STTS_CD
          , C.VST_DE
          , C.VST_HR
          , C.VST_MNT
          , CONCAT(C.VST_DE , " " , C.VST_HR , ":" , C.VST_MNT) AS VST_DT
        FROM
            TB_ASS_PRGRM A
        LEFT OUTER JOIN
        (   SELECT
                PRGRMID
              , SRNG_STTS_CD
            FROM
                TB_ASS_PRGRM_JDGS LIMIT 0,1 ) B ON A.PRGRMID  = B.PRGRMID
        LEFT OUTER JOIN
        (   SELECT
                PRGRMID
              , SRGN_STTS_CD
              , VST_DE
              , VST_HR
              , VST_MNT
            FROM
                TB_ASS_SPRTGRP_SRNG LIMIT 0,1 ) C ON A.PRGRMID  = C.PRGRMID
        LEFT OUTER JOIN
        TB_CMM_INST D ON A.INSTID  = D.INSTID
        WHERE 1=1
        <!-- 키워드.전체 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == ''">
            AND (B.PRGRM_NM LIKE CONCAT('%',#{searchKeyword},'%') OR B.INST_NM LIKE CONCAT('%',#{searchKeyword},'%'))
        </if>
        <!-- 키워드.프로그램명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchPrgrmNm'">
            AND B.PRGRM_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 키워드.기관명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchInstNm'">
            AND B.INST_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 심사진행상태  -->
        <if test="searchSrngSttsCd != null and searchSrngSttsCd != ''">
            AND A.SRNG_STTS_CD = #{searchSrngSttsCd}
        </if>
        <!-- 배정일 검색시작일  -->
        <if test="searchRegStartDt != null and searchRegStartDt != ''">
            AND A.REG_DT >= #{searchRegStartDt}
        </if>
        <!-- 배정일 검색종료일  -->
        <if test="searchRegEndDt != null and searchRegEndDt != ''">
            AND A.REG_DT  <![CDATA[<]]> CAST(CONCAT(#{searchRegEndDt},' 23:59:59') AS DATETIME)
        </if>
        <!-- 숙박여부-->
        <if test="searchStyYn!= null and searchStyYn != ''">
            AND C.STY_YN = #{searchStyYn}
        </if>
    </select>

    <!-- 심사위원 심사 상세 조회 -->
    <select id="selectJdgsSrngDetail" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectJdgsSrngDetail */
            SELECT
                 A.PRGRMID
               , A.JDGSID
               , G.FORMID       /*양식ID*/
               , F.SBMSNID
               , B.PRGRM_NM
               , B.INST_NM
               , C.STY_YN    /*숙박여부*/
               , C.STY_NIGHT
               , C.STY_DAYTM
               , C.OPER_FRM_CD
               , NULLIF(E.PRGRMID,'N') AS SFTY_MNG_YN
    --         , '첨부파일'
    --         , '증빙서류'
               , A.SRNG_STTS_CD
               , A.REG_DT    /*배정일*/
               , F.SRNG_OPNN    /*심사의견*/
               , G.FORMID       /*양식ID*/
            FROM
                TB_ASS_PRGRM_JDGS A
            INNER JOIN
                TB_ASS_PRGRM B ON A.PRGRMID = B.PRGRMID
            LEFT OUTER JOIN
                TB_ASS_PRGRM_DSTNCTN C ON A.PRGRMID = C.PRGRMID
            LEFT OUTER JOIN
                TB_ASS_SFTY_MNG E ON A.PRGRMID = E.PRGRMID
            LEFT OUTER JOIN
                TB_ASS_SRNG_SBMSN F ON A.PRGRMID = F.PRGRMID
            LEFT OUTER JOIN
                TB_ASS_SRNG_FORM G ON G.FORMID = F.FORMID
            WHERE 1=1
            AND A.JDGSID = #{jdgsid}
    </select>

    <!-- 심사양식목록 조회 -->
    <select id="selectDsgnSrgnFormList" parameterType="DsgnSrngFormVO" resultType="DsgnSrngFormVO">
            SELECT
                  C.DSGNCRTR_CD
                , B.IDNTY_MTTR
                , C.ORDR             AS DSGNCRTR_ORDR
                , A.QITEMID          AS QITEMID
                , A.CHKLST_SE_CD     AS CHKLST_SE_CD
                , B.ALTM
                , D.SCR
                , SUM(B.ALTM) OVER() AS ALLALTM
                , SUM(D.SCR) OVER()  AS ALLSCR
                , TASS.PRGRMID
                , TASS.FORMID
                , TASS.SBMSNID
                , A.ORDR
                , ROW_NUMBER() OVER(PARTITION BY C.DSGNCRTR_CD ORDER BY A.ORDR ASC) AS RNK
                , COUNT(1) OVER (PARTITION  BY C.DSGNCRTR_CD ASC) AS ROWSPAN
            FROM TB_ASS_SRNG_SBMSN TASS
            LEFT OUTER JOIN  TB_ASS_SRNG_FORM_QITEM_MAPNG A
                ON TASS.FORMID = A.FORMID
            LEFT OUTER JOIN TB_ASS_SRNG_QITEM B
                ON B.QITEMID = A.QITEMID
            LEFT OUTER JOIN TB_ASS_SRNG_FORM_DSGNCRTR_ORDR C
                ON C.FORMID = A.FORMID AND B.DSGNCRTR_CD = C.DSGNCRTR_CD
            LEFT OUTER JOIN TB_ASS_SRNG_ANS D ON A.QITEMID = D.QITEMID
            WHERE
                TASS.PRGRMID = #{prgrmid}
            ORDER BY
                A.ORDR ,C.DSGNCRTR_CD , C.ORDR

    </select>

    <!-- 심사위원심사 등록 -->
    <insert id="insertJdgsSrngDetail" parameterType="AsgsysSrngVo" >
    /* AsgsysSrngDao.insertJdgsSrngDetail */
        INSERT INTO TB_ASS_SRNG_SBMSN (
            PRGRMID
          , FORMID
          , USERID
          , SBMSN_DT
          , SBMSN_STTS_CD
          , USER_IP
          , SCR
          , SRNG_OPNN
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
        )
        VALUES (
            #{prgrmid    }
          , #{formid     }
          , #{user.userid}
          , #{sbmsnDt    }
          , #{sbmsnSttsCd}
          , #{userIp     }
          , #{scr        }
          , #{srngOpnn   }
          , NOW()
          , #{user.userid}
          , NOW()
          , #{user.userid}
        )
    </insert>

    <!-- 심사위원심사 상세 수정-->
    <update id="updateJdgsSrngDetail" parameterType="AsgsysSrngVo" >
    /* AsgsysSrngDao.updateJdgsSrngDetail*/
        UPDATE
            TB_ASS_SRNG_SBMSN
        SET
            USERID        = #{userid     }
            SBMSN_DT      = NOW()
            SBMSN_STTS_CD = #{sbmsnSttsCd}
            USER_IP       = #{userIp     }
            SCR           = #{scr        }
            SRNG_OPNN     = #{srngOpnn   }
            MDFCN_DT      = NOW()
            MDFRID        = #{user.userid}
            REG_DT        = NOW()
            RGTRID        = #{user.userid}
        WHERE
            SBMSNID       = #{sbmsnid    }
    </update>

    <!-- 지원단심사 목록 조회 -->
    <select id="selectSprtgrpSrngList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectSprtgrpSrngList*/
        <include refid="PaginationMapper.header"/>
            SELECT
                A.PRGRMID
              , A.SPRTGRPID
              , B.PRGRM_NM        /* 프로그램명 */
              , B.INST_NM         /* 기관명 */
              , A.SRGN_STTS_CD    /* (지원단)심사 진행상태 */
              , A.REG_DT          /* 배정일 */
              , A.VST_DE          /* (현장점검) 방문일 */
              , A.VST_HR          /* (현장점검) 방문시 */
              , A.VST_MNT         /* (현장점검) 방문분 */
              , CONCAT(A.VST_DE , " " , A.VST_HR , ":" , A.VST_MNT) AS VST_DT
              , C.STY_YN          /* 숙박여부 */
              , A.SPLMNT_DMND_OPNN
              , A.SRNG_OPNN
              , A.MDFCN_DT
              , A.MDFRID
              , A.RGTRID
        FROM
            TB_ASS_SPRTGRP_SRNG A
        INNER JOIN
            TB_ASS_PRGRM B ON A.PRGRMID = B.PRGRMID
        LEFT OUTER JOIN
            TB_ASS_PRGRM_DSTNCTN C ON A.PRGRMID = C.PRGRMID
        WHERE 1=1
        <!-- 키워드.프로그램명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchPrgrmNm'">
            AND B.PRGRM_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 키워드.기관명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchInstNm'">
            AND B.INST_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- (지원단)진행상태  -->
        <if test="searchSttsCd != null and searchSttsCd != ''">
            AND A.SRGN_STTS_CD = #{searchSrgnSttsCd}
        </if>
        <!-- 배정일 검색시작일  -->
        <if test="searchRegStartDt != null and searchRegStartDt != ''">
            AND A.REG_DT >= #{searchRegStartDt}
        </if>
        <!-- 배정일 검색종료일  -->
        <if test="searchRegEndDt != null and searchRegEndDt != ''">
            AND A.REG_DT  <![CDATA[<]]> CAST(CONCAT(#{searchRegEndDt},' 23:59:59') AS DATETIME)
        </if>
        <!-- 현장점검지정일 시작일-->
        <if test="searchChckDsgnStartDt != null and searchChckDsgnStartDt != ''">
            AND A.VST_DE >= #{searchChckDsgnStartDt}
        </if>
        <!-- 현장점검지정일 종료일-->
        <if test="searchChckDsgnEndDt != null and searchChckDsgnEndDt != ''">
            AND A.VST_DE <![CDATA[<]]> CAST(CONCAT(#{searchChckDsgnEndDt},' 23:59:59') AS DATETIME)
        </if>
        <!-- 숙박여부-->
        <if test="searchStyYn!= null and searchStyYn != ''">
            AND C.STY_YN = #{searchStyYn}
        </if>
        <include refid="PaginationMapper.footer"/>
    </select>

    <!-- 지원단심사 상세 조회 -->
    <select id="selectSprtgrpSrng" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectSprtgrpSrng*/
        SELECT
                A.PRGRMID
              , A.SPRTGRPID
              , B.PRGRM_NM        /* 프로그램명 */
              , B.INST_NM         /* 기관명 */
              , A.SRGN_STTS_CD    /* (지원단)심사 진행상태 */
              , A.REG_DT          /* 배정일 */
              , C.STY_YN          /* 숙박여부 */
              , A.SPLMNT_DMND_OPNN
              , A.SRNG_OPNN
              , A.MDFCN_DT
              , A.MDFRID
              , A.RGTRID
              , C.STY_NIGHT
              , C.STY_DAYTM
              , C.OPER_FRM_CD
              , IFNULL(E.PRGRMID,'N') AS SFTY_MNG_YN
    --        , '첨부파일'
    --        , '증빙서류'
              , CONCAT(A.VST_DE , " " , A.VST_HR , ":" , A.VST_MNT) AS VST_DT
              , B.CHKLSTID
              , F.CHKLST_RSLT_CN
              , F.SBMSNID
              , F.SCR
        FROM
            TB_ASS_SPRTGRP_SRNG A
        LEFT OUTER JOIN
            TB_ASS_PRGRM B ON A.PRGRMID = B.PRGRMID
        LEFT OUTER JOIN
            TB_ASS_PRGRM_DSTNCTN C ON A.PRGRMID = C.PRGRMID
        LEFT OUTER JOIN
            TB_ASS_SFTY_MNG E ON A.PRGRMID = E.PRGRMID
        LEFT OUTER JOIN
            TB_ASS_CHKLST_SBMSN F ON A.PRGRMID = F.PRGRMID
        WHERE 1=1
        AND  A.SPRTGRPID= #{sprtgrpid}
    </select>

    <!-- 지원단심사 체크리스트 조회
    <select id="selectCheckList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectCheckList*/
        SELECT
            A.CHKLSTID
          , A.CHKLST_NM
          , B.QITEMID
          , B.ORDR
          , C.SE_CD
          , ( SELECT CD FROM TB_CMM_CD WHERE CD = CONCAT(LEFT(C.SE_CD, 4),'00') ) AS CHK_LV1_CD
          , ( SELECT CD FROM TB_CMM_CD WHERE CD = C.SE_CD) AS CHK_LV2_CD
          , ( SELECT CD_NM  FROM TB_CMM_CD WHERE CD = CONCAT(LEFT(C.SE_CD, 4),'00') ) AS CHK_LV1_NM
          , ( SELECT CD_NM  FROM TB_CMM_CD WHERE CD = C.SE_CD) AS CHK_LV2_NM
          , C.CN
          , C.IDNTY_MTTR
          , C.ALTM
          , C.USE_YN
        FROM
            TB_ASS_CHKLST A
        LEFT OUTER JOIN
            TB_ASS_CHKLST_QITEM_MAPNG B ON A.CHKLSTID = B.CHKLSTID
        LEFT OUTER JOIN
            TB_ASS_CHKLST_QITEM C ON B.QITEMID = C.QITEMID
        WHERE A.CHKLSTID = #{chklstid}
        AND C.USE_YN = 'Y'
        GROUP BY B.ORDR

    </select>
-->

    <!-- 지원단심사 체크리스트 조회 -->
    <select id="selectCheckList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectCheckList*/
        WITH RECURSIVE CODE_CTE(LV1KEY, LV2KEY, TITLE, TREE_ORD, QITEMID) AS (
            SELECT
                IFNULL(UPPR_CD , '')  AS LV1KEY
              , CD                    AS LV2KEY
              , CONCAT(CD_NM)         AS TITLE
              , CASE WHEN UPPR_CD  = 0  THEN 1 ELSE 2 END AS TREE_ORD
              , 0 AS  QITEMID
            FROM
                TB_CMM_CD
            WHERE 1=1
                AND CDGRPID != 'G0001'
                AND CDGRPID  = '140'
            UNION ALL
            SELECT
                IFNULL(UPPR_CD , '') AS LV1KEY
              , CD AS LV2KEY
              , CD_NM AS TITLE
              , 3 AS TREE_ORD
              , D.QITEMID AS QITEMID
            FROM
                (
                  SELECT
                    (SELECT UPPR_CD FROM TB_CMM_CD WHERE C.SE_CD = CD) AS UPPR_CD
                  , C.SE_CD     AS CD
                  , C.CN        AS CD_NM
                  , B.ORDR      AS ORD
                  , C.QITEMID
                FROM
                    TB_ASS_CHKLST_QITEM_MAPNG B
                LEFT OUTER JOIN
                    TB_ASS_CHKLST_QITEM C ON B.QITEMID = C.QITEMID
                WHERE 1=1
                AND B.CHKLSTID = #{chklstid}
                AND C.USE_YN = 'Y'
                ) D,
                CODE_CTE C
            WHERE
                UPPR_CD = C.LV2KEY
        )
        SELECT
             A.LV1KEY
           , A.LV2KEY
           , A.TITLE    AS CN
           , A.TREE_ORD
           , A.QITEMID
           , B.ALTM
           , B.ORDR
           , B.SCR
        FROM
            CODE_CTE A
        LEFT OUTER JOIN
            (
                SELECT
                    B.QITEMID
                  , C.SE_CD
                  , C.CN
                  , C.IDNTY_MTTR
                  , C.ALTM
                  , C.USE_YN
                  , C.MDFCN_DT
                  , C.MDFRID
                  , C.REG_DT
                  , C.RGTRID
                  , B.CHKLSTID
                  , B.ORDR
                  , D.SCR
                FROM
                    TB_ASS_CHKLST_QITEM_MAPNG B
                LEFT OUTER JOIN
                    TB_ASS_CHKLST_QITEM C ON B.QITEMID = C.QITEMID
                LEFT OUTER JOIN
                    TB_ASS_CHKLST_ANS D ON C.QITEMID = D.QITEMID
                WHERE
                    B.CHKLSTID = #{chklstid}
            ) B ON A.QITEMID = B.QITEMID
        ORDER BY LV2KEY, TREE_ORD, B.ORDR
    </select>


    <!-- 지원단심사 등록 -->

    <!-- 지원단심사 수정 -->
    <update id="updateSprtgrpSrng" parameterType="AsgsysSrngVo" >
        /* AsgsysSrngDao.updateSprtgrpSrng */
        UPDATE
            TB_ASS_SPRTGRP_SRNG
        SET
            SRNG_OPNN = #{srngOpnn}
          , MDFCN_DT  = NOW()
          , MDFRID    = #{user.userid}
        WHERE SPRTGRPID= #{sprtgrpid}

    </update>

    <!-- 체크리스트 제출 수정 -->
    <update id="updateChklstSbmsn" parameterType="AsgsysSrngVo" >

        UPDATE
            TB_ASS_CHKLST_SBMSN
        SET
            SCR             = #{scr}
          , CHKLST_RSLT_CN  = #{chklstRsltCn}
          /*, USER_IP         = ''*/
          , SBMSN_STTS_CD   = #{sbmsnSttsCd}
          , SBMSN_DT        = NOW()
          , USERID          = #{user.userid}
          , MDFCN_DT        = NOW()
          , MDFRID          = #{user.userid}
        WHERE SBMSNID       = #{sbmsnid}

    </update>


    <select id="selectKeyCntChklstAns" parameterType="ChklstAnsVo" resultType="int">
        SELECT
            COUNT(QITEMID) AS KEY_CNT
        FROM
            TB_ASS_CHKLST_ANS
        WHERE 1=1
        AND SBMSNID = #{sbmsnid}
        AND QITEMID = #{qitemid}

    </select>
    <update id="updateChklstAns" parameterType="ChklstAnsVo" >
        UPDATE
            TB_ASS_CHKLST_ANS
        SET
            SE_CD         = #{seCd      }
          , CN            = #{cn        }
          , IDNTY_MTTR    = #{idntyMttr }
          , SCR           = #{scr       }
          , ORDR          = #{ordr      }
          , MDFCN_DT      = NOW()
          , MDFRID        = #{user.userid}
        WHERE
            SBMSNID       = #{sbmsnid   }
        AND QITEMID       = #{qitemid   }
    </update>

    <insert id="insertChklstAns" parameterType="ChklstAnsVo" >
    INSERT INTO
        TB_ASS_CHKLST_ANS (
            SBMSNID
          , QITEMID
          , SE_CD
          , CN
          , IDNTY_MTTR
          , SCR
          , ORDR
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
        ) VALUES(
            #{sbmsnid  }
          , #{qitemid  }
          , #{seCd     }
          , #{cn       }
          , #{idntyMttr}
          , #{scr      }
          , #{ordr     }
          , NOW()
          , #{user.userid}
          , NOW()
          , #{user.userid}
        )
    </insert>

    <!-- 지원단심사의견 수정 -->
    <update id="updateSprtgrpOpnn" parameterType="AsgsysSrngVo" >
        /* AsgsysSrngDao.updateSprtgrpOpnn */
        UPDATE
            TB_ASS_SPRTGRP_SRNG
        SET
            SRNG_OPNN = #{srngOpnn}
          , MDFCN_DT  = NOW()
          , MDFRID    = #{user.userid}
        WHERE SPRTGRPID= #{sprtgrpid}
    </update>

    <!-- 파일목록 조회 -->
    <select id="selectEvdncDcmntFileList" resultType="FileVo">
        SELECT
            B.FILEID
          , A.FILEGRPID
          , B.FILE_IDNTFC_KEY
          , B.FILE_PATH
          , B.SAVE_FILE_NM
          , B.ORGINL_FILE_NM
          , B.FILE_EXTSN
          , B.FILE_SIZE
          , B.ORD
        FROM
            TB_CMM_FILEGRP A
        LEFT OUTER JOIN
            TB_CMM_FILE B ON A.FILEGRPID = B.FILEGRPID
        WHERE 1=1
        AND   A.FILEGRPID = #{filegrpid}
    </select>

    <!-- 회원목록 조회 -->
    <select id="selectMbrList" resultType="MemberVo">
        <include refid="PaginationMapper.header"/>
        SELECT
            A.USERID
          , A.INSTID
          , A.ACNT
          , A.NM
          , A.MOBLPHON
          , A.EML
          , B.INST_NM
        FROM
        TB_CMM_USER A
        LEFT OUTER JOIN
            TB_CMM_INST B ON A.INSTID = B.INSTID
        WHERE 1=1
<!--         AND A.INSTID = #{instid} -->
        <include refid="PaginationMapper.footer"/>
    </select>

    <!-- 담당자 변경 -->
    <update id="updateMbr" parameterType="AsgsysSrngVo" >
        /* AsgsysSrngDao.updateMbr*/
        UPDATE
            TB_ASS_PRGRM
        SET
            APLCNTID  = #{aplcntid}
          , APLCNT_NM = #{aplcntNm}
        WHERE
            PRGRMID   = #{prgrmid}
    </update>


    <!-- 담당자 심사위원 등록 -->
    <insert id="insertPicJdgs" parameterType="AsgsysSrngVo" >
        INSERT INTO
            TB_ASS_PRGRM_JDGS(
                PRGRMID
              , JDGSID
              , SRNG_STTS_CD
              , MDFCN_DT
              , MDFRID
              , REG_DT
              , RGTRID
        ) VALUES (
                #{prgrmid}
              , #{jdgsid}
              , #{srngSttsCd}
              , NOW()
              , #{user.userid}
              , NOW()
              , #{user.userid}
        )
    </insert>

    <!-- 담당자 지원단 등록 -->
    <insert id="insertPicSprtgrp" parameterType="AsgsysSrngVo" >
        INSERT INTO
            TB_ASS_SPRTGRP_SRNG(
                PRGRMID
              , SPRTGRPID
              , VST_DE
              , VST_HR
              , VST_MNT
              , SPLMNT_DMND_OPNN
              , SRNG_OPNN
              , SRGN_STTS_CD
              , MDFCN_DT
              , MDFRID
              , REG_DT
              , RGTRID
        ) VALUES (
                #{prgrmid}
              , #{sprtgrpid}
              , #{vstDe}
              , #{vstHr}
              , #{vstMnt}
              , #{splmntDmndOpnn}
              , #{srngOpnn}
              , #{srgnSttsCd}
              , NOW()
              , #{user.userid}
              , NOW()
              , #{user.userid}
        )
    </insert>

    <!-- 담당자 심사위원 삭제 -->
    <delete id="deletePicJdgs" parameterType="AsgsysSrngVo" >
        DELETE FROM
            TB_ASS_PRGRM_JDGS
        WHERE PRGRMID = #{prgrmid}
        AND   JDGSID = #{jdgsid}
    </delete>

    <!-- 담당자 지원단 삭제 -->
    <delete id="deletePicSprtgrp" parameterType="AsgsysSrngVo" >
        DELETE FROM
            TB_ASS_SPRTGRP_SRNG
        WHERE PRGRMID = #{prgrmid}
        AND   SPRTGRPID = #{sprtgrpid}
    </delete>


    <!-- 담당자(지원단)배정 목록 조회-->
    <select id="selectSprtgrpPicList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">

        <include refid="PaginationMapper.header"/>
        SELECT
            AA.USERID
          , ACNT
          , SEARCH_STR
          , NM
          , EML
          , TELNO
          , MOBLPHON
          , CRTFCT_NM
          , SBJCT_CD
          , RGN_CD
        FROM
            TB_ASS_EXPRT  AA
        INNER JOIN
            (
                SELECT
                    A.USERID
                  , B.ACNT
                  , B.NM
                  , CONCAT( B.ACNT," ",B.NM) AS SEARCH_STR
                  , B.EML
                  , B.TELNO
                  , B.MOBLPHON
                  , GROUP_CONCAT(C.CRTFCT_NM ) AS CRTFCT_NM
                  , D.SBJCT_CD
                  , E.RGN_CD
                FROM
                    TB_ASS_EXPRT A
                INNER JOIN
                    TB_CMM_USER B ON A.USERID = B.USERID
                LEFT OUTER JOIN    /*전문가 자격증*/
                    TB_ASS_EXPRT_CRTFCT C ON A.USERID = C.USERID
                LEFT OUTER JOIN    /* 전문가 주제? */
                    TB_ASS_EXPRT_SBJCT D ON A.USERID = D.USERID
                LEFT OUTER JOIN    /* 전문가 범위 */
                    TB_ASS_EXPRT_ACTVT_SCOPE E ON A.USERID = E.USERID
            ) BB ON AA.USERID = BB.USERID
        WHERE 1=1
        <!-- 키워드.계정 -->
        <if test="searchKeyword != null and searchKeyword != ''">
            AND SEARCH_STR LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 키워드.자격증명 -->
        <if test="searchCrtfctNm != null and searchCrtfctNm != ''">
            AND CRTFCT_NM LIKE CONCAT('%',#{searchCrtfctNm},'%')
        </if>
        <!-- 전문분야(환경주제)  -->
        <if test="searchSbjctCd != null and searchSbjctCd != ''">
            AND SBJCT_CD = #{searchSbjctCd}
        </if>
        <!-- 활동가능지역 -->
        <if test="searchRgnCd != null and searchRgnCd != ''">
            AND RGN_CD = #{searchRgnCd}
        </if>

        <include refid="PaginationMapper.footer"/>
    </select>

    <!-- 담당자(심사위원) 목록 조회-->
    <select id="selectjdgsPicList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        <include refid="PaginationMapper.header"/>
        SELECT
            GRP_ID
          , GRP_NM
          , USE_YN
          , REG_DT
          , REG_EXPRT_CNT
          , USERID_GRP
          , USER_ACNT_GRP
          , USER_NM_GRP
          , USER_EML_GRP
          , USER_MOBLPHON_GRP
        FROM (
             SELECT
                 A.GRP_ID
               , A.GRP_NM
               , A.USE_YN
               , A.REG_DT
               , COUNT(B.USERID)          AS REG_EXPRT_CNT
               , GROUP_CONCAT(B.USERID)   AS USERID_GRP
               , GROUP_CONCAT(C.ACNT)     AS USER_ACNT_GRP
               , GROUP_CONCAT(C.NM)       AS USER_NM_GRP
               , GROUP_CONCAT(C.EML)      AS USER_EML_GRP
               , GROUP_CONCAT(C.MOBLPHON) AS USER_MOBLPHON_GRP
            FROM
                TB_ASS_EXPRT_GRP A
            LEFT OUTER JOIN
                TB_ASS_EXPRT_GRP_MAPNG B ON A.GRP_ID = B.GRP_ID
            LEFT OUTER JOIN
                TB_CMM_USER C ON B.USERID = C.USERID
            GROUP BY A.GRP_ID
            ) AA
        WHERE 1=1
        <!-- 키워드.그룹명-->
        <if test="searchKeyword != null and searchKeyword != ''">
            AND A.GRP_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>

        <include refid="PaginationMapper.footer"/>

    </select>


</mapper>