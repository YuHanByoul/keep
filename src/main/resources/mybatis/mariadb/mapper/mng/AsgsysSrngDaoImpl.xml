<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SQL File Name : AsgsysSrngDaoImpl.xml
    Description : 지정제심사 관리
-->
<mapper namespace="com.kbrainc.plum.mng.asgsysSrng.model.AsgsysSrngDao">

    <!-- 지정신청 목록 조회. -->
    <select id="selectDsgnAplyList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectDsgnAplyList */
        <include refid="PaginationMapper.header"/>
        SELECT
            A.PRGRM_NM
          , A.PRGRMID
          , A.INST_NM
          , A.STTS_CD
          , A.APLY_DT
          , A.REG_DT
          , B.SRNG_STTS_CD
          , C.SRGN_STTS_CD
          , C.VST_DE
          , C.VST_HR
          , C.VST_MNT
        FROM
            TB_ASS_PRGRM A
        LEFT OUTER JOIN
        (   SELECT
                PRGRMID
              , SRNG_STTS_CD
            FROM
                TB_ASS_PRGRM_JDGS LIMIT 0,1 ) B ON A.PRGRMID  = B.PRGRMID
        LEFT OUTER JOIN
        (   SELECT
                PRGRMID
              , SRGN_STTS_CD
              , VST_DE
              , VST_HR
              , VST_MNT
            FROM
                TB_ASS_SPRTGRP_SRNG LIMIT 0,1 ) C ON A.PRGRMID  = C.PRGRMID
        LEFT OUTER JOIN
        TB_CMM_INST D ON A.INSTID  = D.INSTID
        WHERE 1=1
        <!-- 키워드.프로그램명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchPrgrmNm'">
            AND A.PRGRM_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 키워드.기관명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchInstNm'">
            AND A.INST_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 진행상태  -->
        <if test="searchSttsCd != null and searchSttsCd != ''">
            AND A.STTS_CD = #{searchSttsCd}
        </if>
        <!-- 신청일 검색시작일  -->
        <if test="searchAplyStartDt != null and searchAplyStartDt != ''">
            AND A.APLY_DT >= #{searchAplyStartDt}
        </if>
        <!-- 신청일 검색종료일  -->
        <if test="searchAplyEndDt  != null and searchAplyEndDt != ''">
            AND A.APLY_DT <![CDATA[<]]> CAST(CONCAT(#{searchAplyEndDt},' 23:59:59') AS DATETIME)
        </if>
        <!-- 심사위원 심사상태-->
        <if test="searchSrngSttsCd != null and searchSrngSttsCd != ''">
            AND B.SRNG_STTS_CD = #{searchSrngSttsCd}
        </if>
        <!-- 지원단 심사상태-->
        <if test="searchSrgnSttsCd != null and searchSrgnSttsCd != ''">
            AND C.SRGN_STTS_CD = #{searchSrgnSttsCd }
        </if>
        <!-- 현장점검지정일 시작일-->
        <if test="searchChckDsgnStartDt != null and searchChckDsgnStartDt != ''">
            AND C.VST_DE >= #{searchChckDsgnStartDt}
        </if>
        <!-- 현장점검지정일 종료일-->
        <if test="searchChckDsgnEndDt != null and searchChckDsgnEndDt != ''">
            AND C.VST_DE <![CDATA[<]]> CAST(CONCAT(#{searchChckDsgnEndDt},' 23:59:59') AS DATETIME)
        </if>
        <include refid="PaginationMapper.footer"/>
    </select>

    <!-- 지정신청 목록 엑셀 다운로드 -->
    <select id="aplyExcelDownList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.aplyExcelDownList */
        SELECT
            A.PRGRM_NM
          , A.PRGRMID
          , A.INST_NM
          , A.STTS_CD
          , A.APLY_DT
          , A.REG_DT
          , B.SRNG_STTS_CD
          , C.SRGN_STTS_CD
          , C.VST_DE
          , C.VST_HR
          , C.VST_MNT
        FROM
            TB_ASS_PRGRM A
        LEFT OUTER JOIN
        (   SELECT
                PRGRMID
              , SRNG_STTS_CD
            FROM
                TB_ASS_PRGRM_JDGS LIMIT 0,1 ) B ON A.PRGRMID  = B.PRGRMID
        LEFT OUTER JOIN
        (   SELECT
                PRGRMID
              , SRGN_STTS_CD
              , VST_DE
              , VST_HR
              , VST_MNT
            FROM
                TB_ASS_SPRTGRP_SRNG LIMIT 0,1 ) C ON A.PRGRMID  = C.PRGRMID
        LEFT OUTER JOIN
        TB_CMM_INST D ON A.INSTID  = D.INSTID
        WHERE 1=1
        <!-- 키워드.프로그램명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchPrgrmNm'">
            AND A.PRGRM_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 키워드.기관명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchInstNm'">
            AND A.INST_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 키워드.사업자번호 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchBrno'">
            AND D.BRNO LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 진행상태  -->
        <if test="searchSttsCd != null and searchSttsCd != ''">
            AND A.STTS_CD = #{searchSttsCd}
        </if>
        <!-- 신청일 검색시작일  -->
        <if test="searchAplyStartDt != null and searchAplyStartDt != ''">
            AND A.APLY_DT >= #{searchAplyStartDt}
        </if>
        <!-- 신청일 검색종료일  -->
        <if test="searchAplyEndDt  != null and searchAplyEndDt != ''">
            AND A.APLY_DT <![CDATA[<]]> CAST(CONCAT(#{searchAplyEndDt},' 23:59:59') AS DATETIME)
        </if>
        <!-- 심사위원 심사상태-->
        <if test="searchSrngSttsCd != null and searchSrngSttsCd != ''">
            AND B.SRNG_STTS_CD = #{searchSrngSttsCd}
        </if>
        <!-- 지원단 심사상태-->
        <if test="searchSrgnSttsCd != null and searchSrgnSttsCd != ''">
            AND C.SRGN_STTS_CD = #{searchSrgnSttsCd }
        </if>
        <!-- 현장점검지정일 시작일-->
        <if test="searchChckDsgnStartDt != null and searchChckDsgnStartDt != ''">
            AND C.VST_DE >= #{searchChckDsgnStartDt}
        </if>
        <!-- 현장점검지정일 종료일-->
        <if test="searchChckDsgnEndDt != null and searchChckDsgnEndDt != ''">
            AND C.VST_DE <![CDATA[<]]> CAST(CONCAT(#{searchChckDsgnEndDt},' 23:59:59') AS DATETIME)
        </if>
    </select>

    <!-- 지정신청상세 조회. -->
    <select id="selectDsgnAplyDtlInfo" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
    SELECT
        INSTID              /* 기관아이디 */
      , APLCNTID            /* 신청자아이디 */
      , APLCNT_NM           /* 신청자_이름 */
      , APLCNT_EML          /* 신청자_이메일 */
      , APLCNT_MOBLPHON     /* 신청자_휴대폰 */
      , INST_NM             /* 기관_이름 */
      , INST_EML            /* 기관_이메일 */
      , INST_CNTCT          /* 기관_연락처 */
      , INST_HMPG           /* 기관_홈페이지 */
      , INST_TYPE_CD        /* 기관_유형_코드 */
      , INST_RGN_CD         /* 기관_지역_코드 */
      , INST_ZIP            /* 기관_우편번호 */
      , INST_ADDR           /* 기관_주소 */
      , INST_DTLADDR        /* 기관_상세주소 */
      , PRGRM_NM            /* 프로그램_이름 */
      , FILEGRPID           /* 파일그룹아이디 */
      , STTS_CD             /* 상태_코드 */
      , DSGN_CYCL           /* 지정_차수 */
      , DSGN_NO             /* 지정_번호 */
      , DSGN_DE             /* 지정_일자 */
      , DSGN_BGNG_DE        /* 지정_시작_일자 */
      , DSGN_END_DE         /* 지정_종료_일자 */
      , AUTZRID             /* 승인자아이디 */
      , CHKLSTID            /* 체크리스트아이디 */
      , CNSLTNG_PRGRS_YN    /* 컨설팅__진행_여부 */
      , CNSLTNGID           /* 컨설텅아이디 */
      , APLY_DT             /* 신청_일시 */
      , MDFCN_DT            /* 수정_일시 */
      , MDFRID              /* 수정자아이디 */
      , REG_DT              /* 등록_일시 */
      , RGTRID              /* 등록자아이디 */
    FROM TB_ASS_PRGRM
    WHERE 1=1
    AND PRGRMID = #{prgrmid}

    </select>

    <!-- 프로그램 우수성 조회. -->
    <select id="selectPrgrmDstnctn" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        SELECT
            A.PRGRMID                /* 프로그램아이디           */
          , A.PRGRM_NM               /* 프로그램이름             */
<!-- 컨설팅 진행여부 -->
          , B.STY_YN                 /* 숙박_여부                */
          , B.STY_NIGHT              /* 숙박_밤                  */
          , B.STY_DAYTM              /* 숙박_낮                  */
          , B.OPER_FRM_CD            /* 운영_형태_코드           */
          , B.JAN                    /* 1월                      */
          , B.FEB                    /* 2월                      */
          , B.MAR                    /* 3월                      */
          , B.APR                    /* 4월                      */
          , B.MAY                    /* 5월                      */
          , B.JUNE                   /* 6월                      */
          , B.JULY                   /* 7월                      */
          , B.AUG                    /* 8월                      */
          , B.SEPT                   /* 9월                      */
          , B.OCT                    /* 10월                     */
          , B.NOV                    /* 11월                     */
          , B.DCM                    /* 12월                     */
          , B.WHOL_MM                /* 전체_월                  */
          , B.INFNT                  /* 유아                     */
          , B.SCHBOY                 /* 초등학생                 */
          , B.MSKLSD                 /* 중학생                   */
          , B.HGSCHST                /* 고등학생                 */
          , B.ADULT                  /* 성인                     */
          , B.WHOL_AGE               /* 전체_연령                */
          , B.EDU_PLC                /* 교육_장소                */
          , B.EDU_NOPE               /* 교육_인원수              */
          , B.EDU_CNT                /* 교육_횟수                */
          , B.EDU_HR                 /* 교육_시간                */
          , B.EDU_MNT                /* 교육_분                  */
          , B.PCHRG_YN               /* 유료_여부                */
          , B.ETRFEE                 /* 참가비                   */
          , B.EDU_PRPS               /* 교육_목적                */
          , B.APPRO                  /* 적절성                   */
          , B.DSTNCTN                /* 우수성                   */
          , B.EDU_CN                 /* 교육_내용                */
          , B.WETHER_STTN            /* 기상_상황                */
          , B.ACTN_MTHD              /* 조치_방법                */
          , B.EDU_PHOTO_FILEGRPID    /* 교육_사진_파일그룹아이디 */
          , B.MDFCN_DT               /* 수정_일시                */
          , B.MDFRID                 /* 수정자아이디             */
          , B.REG_DT                 /* 등록_일시                */
          , B.RGTRID                 /* 등록자아이디             */
          , (SELECT GROUP_CONCAT(EDU_SBJCT_CD SEPARATOR',') FROM TB_ASS_PRGRM_EDU_SBJCT WHERE PRGRMID = #{prgrmid}) AS EDU_SBJCT_CD
        FROM
            TB_ASS_PRGRM A
        /*프로그램 우수성*/
        INNER JOIN
            TB_ASS_PRGRM_DSTNCTN B ON A.PRGRMID = B.PRGRMID
        WHERE A.PRGRMID = #{prgrmid}
    </select>

    <!-- 프로그램 운영관리 조회 -->
    <select id="selectPrgrmOperMng" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectPrgrmOperMng */
        SELECT
            PRGRMID
          , ETRFEE_INCM
          , ETC_INCM
          , SLFPY
          , OPER_BFR_PRMTN_SESS
          , OPER_BFR_PRMTN_MTHD
          , OPER_MDL_PRMTN_SESS
          , OPER_MDL_PRMTN_MTHD
          , OPER_AFTR_PRMTN_SESS
          , OPER_AFTR_PRMTN_MTHD
          , TEL_RCPT_YN
          , APLFRM_RCPT_YN
          , ONLN_APLY_YN
          , ETC_YN
          , ETC_CN
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
        FROM
            TB_ASS_PRGRM_OPER_MNG
        WHERE PRGRMID = #{prgrmid}
    </select>

    <!-- 프로그램운영관리 수정 -->
    <update id="updatePrgrmOperMng" parameterType="AsgsysSrngVo" >
    /* AsgsysSrngDao.updatePrgrmOperMng */
        UPDATE
            TB_ASS_PRGRM_OPER_MNG
        SET
            ETRFEE_INCM            = #{etrfeeIncm }
          , ETC_INCM               = #{etcIncm }
          , SLFPY                  = #{slfpy }
          , OPER_BFR_PRMTN_SESS    = #{operBfrPrmtnSess }
          , OPER_BFR_PRMTN_MTHD    = #{operBfrPrmtnMthd }
          , OPER_MDL_PRMTN_SESS    = #{operMdlPrmtnSess }
          , OPER_MDL_PRMTN_MTHD    = #{operMdlPrmtnMthd }
          , OPER_AFTR_PRMTN_SESS   = #{operAftrPrmtnSess }
          , OPER_AFTR_PRMTN_MTHD   = #{operAftrPrmtnMthd }
          , TEL_RCPT_YN            = #{telRcptYn }
          , APLFRM_RCPT_YN         = #{aplfrmRcptYn }
          , ONLN_APLY_YN           = #{onlnAplyYn }
          , ETC_YN                 = #{etcYn }
          , ETC_CN                 = #{etcCn }
          , MDFCN_DT               = NOW()
          , MDFRID                 = #{user.userid}
        WHERE PRGRMID = #{prgrmid}
    </update>

    <!-- 교구 및 시설목록조회 -->
    <select id="selecttchaidFcltList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selecttchaidFcltList */
        SELECT
            TCHAIDFCLTID
          , PRGRMID
          , DTL_PRGRM_NM
          , EDU_PLC
          , TCHAID
          , QNTY
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
        FROM
            TB_ASS_TCHAID_FCLT
        WHERE PRGRMID = #{prgrmid}
    </select>

    <!-- 프로그램 평가 조회 -->
    <select id="selectPrgrmEvl" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectPrgrmEvl*/
        SELECT
            PRGRMID
          , EVL_PRPS
          , BFR_LDR_EVL_ARTCL
          , BFR_LDR_EVL_TL
          , AFTR_LDR_EVL_ARTCL
          , AFTR_LDR_EVL_TL
          , BFR_PRTPNT_EVL_ARTCL
          , BFR_PRTPNT_EVL_TL
          , AFTR_PRTPNT_EVL_ARTCL
          , AFTR_PRTPNT_EVL_TL
          , BFR_GDR_EVL_ARTCL
          , AFTR_GDR_EVL_TL
          , DATABASE_WRT_YN
          , CLSJRNL_WRT_YN
          , ETC_YN
          , ETC_CN
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
        FROM
            TB_ASS_PRGRM_EVL
        WHERE PRGRMID = #{prgrmid}
    </select>

    <!-- 지정제 프로그램 등록 -->
    <insert id="insertPrgrm" parameterType="AsgsysSrngVo" >
    /* AsgsysSrngDao.insertPrgrm */
    INSERT INTO
        TB_ASS_PRGRM (
            PRGRMID,
          , INSTID
          , APLCNTID
          , APLCNT_NM
          , APLCNT_EML
          , APLCNT_MOBLPHON
          , INST_NM
          , INST_EML
          , INST_CNTCT
          , INST_HMPG
          , INST_TYPE_CD
          , INST_RGN_CD
          , INST_ZIP
          , INST_ADDR
          , INST_DTLADDR
          , PRGRM_NM
          , FILEGRPID
          , STTS_CD
          , DSGN_CYCL
          , DSGN_NO
          , DSGN_DE
          , DSGN_BGNG_DE
          , DSGN_END_DE
          , AUTZRID
          , CHKLSTID
          , CNSLTNG_PRGRS_YN
          , CNSLTNGID
          , APLY_DT
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
    ) VALUES(
            #{prgrmid       }
          , #{instid        }
          , #{aplcntid      }
          , #{aplcntNm      }
          , #{aplcntEml     }
          , #{aplcntMoblphon}
          , #{instNm        }
          , #{instEml       }
          , #{instCntct     }
          , #{instHmpg      }
          , #{instTypeCd    }
          , #{instRgnCd     }
          , #{instZip       }
          , #{instAddr      }
          , #{instDtladdr   }
          , #{prgrmNm       }
          , #{filegrpid     }
          , #{sttsCd        }
          , #{dsgnCycl      }
          , #{dsgnNo        }
          , #{dsgnDe        }
          , #{dsgnBgngDe    }
          , #{dsgnEndDe     }
          , #{autzrid       }
          , #{chklstid      }
          , #{cnsltngPrgrsYn}
          , #{cnsltngid     }
          , #{aplyDt        }
          , NOW()
          , #{mdfrid        }
          , NOW()
          , #{rgtrid        }
    )
    </insert>

    <!-- 지정제 프로그램 수정 -->
    <update id="updatePrgrm" parameterType="AsgsysSrngVo" >
    /* AsgsysSrngDao.updatePrgrm */
    UPDATE TB_ASS_PRGRM SET
        INSTID              = #{instid        }    /* 기관아이디 */
      , APLCNTID            = #{aplcntid      }    /* 신청자아이디 */
      , APLCNT_NM           = #{aplcntNm      }    /* 신청자_이름 */
      , APLCNT_EML          = #{aplcntEml     }    /* 신청자_이메일 */
      , APLCNT_MOBLPHON     = #{aplcntMoblphon}    /* 신청자_휴대폰 */
      , INST_NM             = #{instNm        }    /* 기관_이름 */
      , INST_EML            = #{instEml       }    /* 기관_이메일 */
      , INST_CNTCT          = #{instCntct     }    /* 기관_연락처 */
      , INST_HMPG           = #{instHmpg      }    /* 기관_홈페이지 */
      , INST_TYPE_CD        = #{instTypeCd    }    /* 기관_유형_코드 */
      , INST_RGN_CD         = #{instRgnCd     }    /* 기관_지역_코드 */
      , INST_ZIP            = #{instZip       }    /* 기관_우편번호 */
      , INST_ADDR           = #{instAddr      }    /* 기관_주소 */
      , INST_DTLADDR        = #{instDtladdr   }    /* 기관_상세주소 */
      , PRGRM_NM            = #{prgrmNm       }    /* 프로그램_이름 */
      , FILEGRPID           = #{filegrpid     }    /* 파일그룹아이디 */
      , STTS_CD             = #{sttsCd        }    /* 상태_코드 */
      , DSGN_CYCL           = #{dsgnCycl      }    /* 지정_차수 */
      , DSGN_NO             = #{dsgnNo        }    /* 지정_번호 */
      , DSGN_DE             = #{dsgnDe        }    /* 지정_일자 */
      , DSGN_BGNG_DE        = #{dsgnBgngDe    }    /* 지정_시작_일자 */
      , DSGN_END_DE         = #{dsgnEndDe     }    /* 지정_종료_일자 */
      , AUTZRID             = #{autzrid       }    /* 승인자아이디 */
      , CHKLSTID            = #{chklstid      }    /* 체크리스트아이디 */
      , CNSLTNG_PRGRS_YN    = #{cnsltngPrgrsYn}    /* 컨설팅__진행_여부 */
      , CNSLTNGID           = #{cnsltngid     }    /* 컨설텅아이디 */
      , APLY_DT             = #{aplyDt        }    /* 신청_일시 */
      , MDFCN_DT            = NOW()                /* 수정_일시 */
      , MDFRID              = #{mdfrid        }    /* 수정자아이디 */
      , REG_DT              = NOW()                /* 등록_일시 */
      , RGTRID              = #{rgtrid        }    /* 등록자아이디 */
    WHERE PRGRMID = #{prgrmid}
    </update>

    <!-- 지정신청 진행상태 조회 -->
    <select id="selectPrgrmSttsCd" parameterType="AsgsysSrngVo" resultType="String">
    SELECT
        STTS_CD
    FROM
        TB_ASS_PRGRM
    WHERE
        PRGRMID = #{prgrmid}
    </select>


    <!-- 지정신청 진행상태 수정 -->
    <update id="updatePrgrSttsCd" parameterType="AsgsysSrngVo" >
    UPDATE TB_ASS_PRGRM SET
        STTS_CD = #{sttsCd}    /* 상태_코드 */
    WHERE PRGRMID = #{prgrmid}
    </update>

    <!-- 보완요청 목록조회 -->
    <select id="selectSplmntDmndList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectSplmntDmndList*/
        <include refid="PaginationMapper.header"/>
        SELECT
            SPLMNT_DMNDID    /* 보완_요청아이디 */
          , PRGRMID          /* 프로그램아이디 */
          , STTS_CD          /* 상태_코드 */
          , OPNN_CN          /* 의견_내용 */
          , CMPTN_PRCS_DE    /* 완료_처리_일자 */
          , MDFCN_DT         /* 수정_일시 */
          , MDFRID           /* 수정자아이디 */
          , REG_DT           /* 등록_일시 */
          , RGTRID           /* 등록자아이디 */
        FROM
            TB_ASS_PRGRM_SPLMNT_DMND
        WHERE 1=1
        AND PRGRMID = #{prgrmid}
        <include refid="PaginationMapper.footer"/>
    </select>

    <!-- 신청정보탭 안전관리 상세 조회 -->
    <select id="selectSftyMng" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        SELECT
            PRGRMID
          , FILEGRPID
          , LDR_EDU_SESS
          , LDR_EDU_PIC
          , LDR_EDU_CN
          , PRTCPNT_EDU_SESS
          , PRTCPNT_EDU_PIC
          , PRTCPNT_EDU_CN
          , BFR_CERT_YN
          , BFR_CERT_FILEGRPID
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
        FROM
            TB_ASS_SFTY_MNG
        WHERE 1=1
        AND PRGRMID = #{prgrmid}

    </select>

    <!-- 안전관리 수정 -->
    <update id="updateSftyMng" parameterType="AsgsysSrngVo" >
    /* AsgsysSrngDao.updatePrgrm */
    UPDATE
        TB_ASS_SFTY_MNG
    SET
        LDR_EDU_SESS          = #{ldrEduSess}
      , LDR_EDU_PIC           = #{ldrEduPic}
      , LDR_EDU_CN            = #{ldrEduCn}
      , PRTCPNT_EDU_SESS      = #{prtcpntEduSess}
      , PRTCPNT_EDU_PIC       = #{prtcpntEduPic}
      , PRTCPNT_EDU_CN        = #{prtcpntEduCn}
      , BFR_CERT_YN           = #{bfrCertYn}
      , BFR_CERT_FILEGRPID    = #{bfrCertFilegrpid}
      , MDFCN_DT              = NOW()
      , MDFRID                = #{user.userid}
    WHERE PRGRMID = #{prgrmid}
    </update>

    <!-- 심사위원심사 -->
    <!-- 심사위원심사 목록조회-->
    <select id="selectJdgsSrngList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectJdgsSrngList*/
        <include refid="PaginationMapper.header"/>
            SELECT
                 A.PRGRMID
               , A.JDGSID
               , '' AS JDGS_NM
               , B.PRGRM_NM
               , B.INST_NM
               , A.SRNG_STTS_CD
               , A.REG_DT          /*배정일*/
               , C.STY_YN          /*숙박여부*/
               , D.SRNG_DT         /* 심사일 */
               , A.MDFCN_DT
               , A.MDFRID
               , A.RGTRID
            FROM
                TB_ASS_PRGRM_JDGS A
            INNER JOIN
                TB_ASS_PRGRM B ON A.PRGRMID = B.PRGRMID
            LEFT OUTER JOIN
                TB_ASS_PRGRM_DSTNCTN C ON A.PRGRMID = C.PRGRMID
            LEFT OUTER JOIN
                TB_ASS_SRNG_RSLT D ON A.PRGRMID = D.PRGRMID
            WHERE 1=1
        <!-- 키워드.전체 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == ''">
            AND (B.PRGRM_NM LIKE CONCAT('%',#{searchKeyword},'%') OR B.INST_NM LIKE CONCAT('%',#{searchKeyword},'%'))
        </if>
        <!-- 키워드.프로그램명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchPrgrmNm'">
            AND B.PRGRM_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 키워드.기관명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchInstNm'">
            AND B.INST_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 심사진행상태  -->
        <if test="searchSrngSttsCd != null and searchSrngSttsCd != ''">
            AND A.SRNG_STTS_CD = #{searchSrngSttsCd}
        </if>
        <!-- 배정일 검색시작일  -->
        <if test="searchRegStartDt != null and searchRegStartDt != ''">
            AND A.REG_DT >= #{searchRegStartDt}
        </if>
        <!-- 배정일 검색종료일  -->
        <if test="searchRegEndDt != null and searchRegEndDt != ''">
            AND A.REG_DT  <![CDATA[<]]> CAST(CONCAT(#{searchRegEndDt},' 23:59:59') AS DATETIME)
        </if>
        <!-- 숙박여부-->
        <if test="searchStyYn!= null and searchStyYn != ''">
            AND C.STY_YN = #{searchStyYn}
        </if>
        <include refid="PaginationMapper.footer"/>
    </select>


    <select id="jdgsSrngListExcelDown" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.jdgsSrngListExcelDown */
            SELECT
                 A.PRGRMID
               , A.JDGSID
               , '' AS JDGS_NM
               , B.PRGRM_NM
               , B.INST_NM
               , A.SRNG_STTS_CD
               , A.REG_DT          /*배정일*/
               , C.STY_YN          /*숙박여부*/
               , D.SRNG_DT         /* 심사일 */
               , A.MDFCN_DT
               , A.MDFRID
               , A.RGTRID
            FROM
                TB_ASS_PRGRM_JDGS A
            INNER JOIN
                TB_ASS_PRGRM B ON A.PRGRMID = B.PRGRMID
            LEFT OUTER JOIN
                TB_ASS_PRGRM_DSTNCTN C ON A.PRGRMID = C.PRGRMID
            LEFT OUTER JOIN
                TB_ASS_SRNG_RSLT D ON A.PRGRMID = D.PRGRMID
            WHERE 1=1
        <!-- 키워드.전체 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == ''">
            AND (B.PRGRM_NM LIKE CONCAT('%',#{searchKeyword},'%') OR B.INST_NM LIKE CONCAT('%',#{searchKeyword},'%'))
        </if>
        <!-- 키워드.프로그램명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchPrgrmNm'">
            AND B.PRGRM_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 키워드.기관명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchInstNm'">
            AND B.INST_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 심사진행상태  -->
        <if test="searchSrngSttsCd != null and searchSrngSttsCd != ''">
            AND A.SRNG_STTS_CD = #{searchSrngSttsCd}
        </if>
        <!-- 배정일 검색시작일  -->
        <if test="searchRegStartDt != null and searchRegStartDt != ''">
            AND A.REG_DT >= #{searchRegStartDt}
        </if>
        <!-- 배정일 검색종료일  -->
        <if test="searchRegEndDt != null and searchRegEndDt != ''">
            AND A.REG_DT  <![CDATA[<]]> CAST(CONCAT(#{searchRegEndDt},' 23:59:59') AS DATETIME)
        </if>
        <!-- 숙박여부-->
        <if test="searchStyYn!= null and searchStyYn != ''">
            AND C.STY_YN = #{searchStyYn}
        </if>
    </select>

    <select id="selectJdgsSrngDetail" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectJdgsSrngDetail */
            SELECT
                 A.PRGRMID
               , A.JDGSID
               , G.FORMID       /*양식ID*/
               , F.RSLTID
               , B.PRGRM_NM
               , B.INST_NM
               , C.STY_YN    /*숙박여부*/
               , C.STY_NIGHT
               , C.STY_DAYTM
               , C.OPER_FRM_CD
               , NULLIF(E.PRGRMID,'N') AS SFTY_MNG_YN
    --         , '첨부파일'
    --         , '증빙서류'
               , A.SRNG_STTS_CD
               , A.REG_DT    /*배정일*/
               , F.SRNG_OPNN    /*심사의견*/
               , G.FORMID       /*양식ID*/
            FROM
                TB_ASS_PRGRM_JDGS A
            INNER JOIN
                TB_ASS_PRGRM B ON A.PRGRMID = B.PRGRMID
            LEFT OUTER JOIN
                TB_ASS_PRGRM_DSTNCTN C ON A.PRGRMID = C.PRGRMID
            LEFT OUTER JOIN
                TB_ASS_SRNG_RSLT D ON A.PRGRMID = D.PRGRMID
            LEFT OUTER JOIN
                TB_ASS_SFTY_MNG E ON A.PRGRMID = E.PRGRMID
            LEFT OUTER JOIN
                TB_ASS_SRNG_RSLT F ON A.PRGRMID = F.PRGRMID
            INNER JOIN
                TB_ASS_SRNG_FORM G ON G.FORMID = F.FORMID
            WHERE 1=1
            AND A.JDGSID = #{jdgsid}
    </select>


    <!-- 심사위원심사 등록 -->
    <insert id="insertJdgsSrngDetail" parameterType="AsgsysSrngVo" >
    /* AsgsysSrngDao.insertJdgsSrngDetail */
    INSERT INTO TB_ASS_SRNG_RSLT (
        PRGRMID
      , FORMID
      , JDGSID
      , SRNG_DT
      , SUM_SCR
      , SRNG_OPNN
      , MDFCN_DT
      , MDFRID
      , REG_DT
      , RGTRID
    ) VALUES (
        #{prgrmid }
      , #{formid  }
      , #{jdgsid  }
      , #{srngDt  }
      , #{sumScr  }
      , #{srngOpnn}
      , NOW()
      , #{user.userid}
      , NOW()
      , #{user.userid}
    )
    </insert>

    <!-- 심사위원심사 상세 수정-->
    <update id="updateJdgsSrngDetail" parameterType="AsgsysSrngVo" >
    /* AsgsysSrngDao.updateJdgsSrngDetail*/
    UPDATE
        TB_ASS_SRNG_RSLT
    SET
        FORMID      = #{formid}
      , JDGSID      = #{jdgsid}
      , SRNG_DT     = NOW()
      , SUM_SCR     = #{sumScr}
      , SRNG_OPNN   = #{srngOpnn}
      , MDFCN_DT    = NOW()
      , MDFRID      = #{user.userid}
    WHERE
        RSLTID = #{rsltid}
    </update>
</mapper>