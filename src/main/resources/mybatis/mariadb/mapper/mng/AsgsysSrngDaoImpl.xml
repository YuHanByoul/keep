<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SQL File Name : AsgsysSrngDaoImpl.xml
    Description : 지정제심사 관리
-->
<mapper namespace="com.kbrainc.plum.mng.asgsysSrng.model.AsgsysSrngDao">

    <!-- 프로그램 목록 조회 -->
    <sql id="searchCondition1">
        <!-- 키워드.프로그램명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchPrgrmNm'">
            AND A.PRGRM_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 키워드.기관명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchInstNm'">
            AND A.INST_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 진행상태  -->
        <if test="searchSttsCd != null and searchSttsCd != ''">
            AND A.STTS_CD = #{searchSttsCd}
        </if>
        <!-- 신청일 검색시작일  -->
        <if test="searchAplyStartDt != null and searchAplyStartDt != ''">
            AND A.APLY_DT >= #{searchAplyStartDt}
        </if>
        <!-- 신청일 검색종료일  -->
        <if test="searchAplyEndDt  != null and searchAplyEndDt != ''">
            AND A.APLY_DT <![CDATA[<]]> CAST(CONCAT(#{searchAplyEndDt},' 23:59:59') AS DATETIME)
        </if>
        <!-- 심사위원 심사상태-->
        <if test="searchSrngSttsCd != null and searchSrngSttsCd != ''">
            AND B.SRNG_STTS_CD = #{searchSrngSttsCd}
        </if>
        <!-- 지원단 심사상태-->
        <if test="searchSrgnSttsCd != null and searchSrgnSttsCd != ''">
            AND C.SRGN_STTS_CD = #{searchSrgnSttsCd }
        </if>
        <!-- 현장점검지정일 시작일-->
        <if test="searchChckDsgnStartDt != null and searchChckDsgnStartDt != ''">
            AND C.VST_DE >= #{searchChckDsgnStartDt}
        </if>
        <!-- 현장점검지정일 종료일-->
        <if test="searchChckDsgnEndDt != null and searchChckDsgnEndDt != ''">
            AND C.VST_DE <![CDATA[<]]> CAST(CONCAT(#{searchChckDsgnEndDt},' 23:59:59') AS DATETIME)
        </if>
    </sql>

    <!-- 지정신청 목록 조회. -->
    <select id="selectDsgnAplyList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectDsgnAplyList */
        <include refid="PaginationMapper.header"/>
        SELECT
            A.PRGRM_NM
          , A.PRGRMID
          , A.INST_NM
          , A.STTS_CD
          , A.APLY_DT
          , A.REG_DT
          , B.SRNG_STTS_CD
          , C.SRGN_STTS_CD
          , C.VST_DE
          , C.VST_HR
          , C.VST_MNT
          , CONCAT(C.VST_DE , " " , C.VST_HR , ":" , C.VST_MNT) AS VST_DT
          , C.SPLMNT_DMND_OPNN
          , C.SRNG_OPNN
          , A.MDFCN_DT
        FROM
            TB_ASS_PRGRM A
        LEFT OUTER JOIN    /* 심사위원 */
        (
            SELECT
                PRGRMID
              , SRNG_STTS_CD
              , JDGSID
              , COUNT(1) AS CNT
            FROM TB_ASS_PRGRM_JDGS
        ) B ON A.PRGRMID  = B.PRGRMID
        LEFT OUTER JOIN    /* 지원단 */
            TB_ASS_SPRTGRP_SRNG C ON A.PRGRMID  = C.PRGRMID
        LEFT OUTER JOIN
            TB_CMM_INST D ON A.INSTID  = D.INSTID
        WHERE 1=1
        <include refid="searchCondition1"/>
        <include refid="PaginationMapper.footer"/>
    </select>

    <!-- 지정신청 목록 엑셀 다운로드 -->
    <select id="aplyExcelDownList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.aplyExcelDownList */
        SELECT
            A.PRGRM_NM
          , A.PRGRMID
          , A.INST_NM
          , A.STTS_CD
          , A.APLY_DT
          , A.REG_DT
          , B.SRNG_STTS_CD
          , C.SRGN_STTS_CD
          , C.VST_DE
          , C.VST_HR
          , C.VST_MNT
          , A.MDFCN_DT
        FROM
            TB_ASS_PRGRM A
        LEFT OUTER JOIN
        (   SELECT
                PRGRMID
              , SRNG_STTS_CD
            FROM
                TB_ASS_PRGRM_JDGS LIMIT 0,1 ) B ON A.PRGRMID  = B.PRGRMID
        LEFT OUTER JOIN
        (   SELECT
                PRGRMID
              , SRGN_STTS_CD
              , VST_DE
              , VST_HR
              , VST_MNT
            FROM
                TB_ASS_SPRTGRP_SRNG LIMIT 0,1 ) C ON A.PRGRMID  = C.PRGRMID
        LEFT OUTER JOIN
        TB_CMM_INST D ON A.INSTID  = D.INSTID
        WHERE 1=1
        <include refid="searchCondition1"/>
    </select>

    <!-- 지정신청프로그램상세 조회. -->
    <select id="selectDsgnAplyDtlInfo" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        SELECT
            A.PRGRMID
          , A.INSTID              /* 기관아이디 */
          , A.APLCNTID            /* 신청자아이디 */
          , A.APLCNT_NM           /* 신청자_이름 */
          , A.APLCNT_EML          /* 신청자_이메일 */
          , A.APLCNT_MOBLPHON     /* 신청자_휴대폰 */
          , A.INST_NM             /* 기관_이름 */
          , A.INST_EML            /* 기관_이메일 */
          , A.INST_CNTCT          /* 기관_연락처 */
          , A.INST_HMPG           /* 기관_홈페이지 */
          , A.INST_TYPE_CD        /* 기관_유형_코드 */
          , A.INST_RGN_CD         /* 기관_지역_코드 */
          , A.INST_ZIP            /* 기관_우편번호 */
          , A.INST_ADDR           /* 기관_주소 */
          , A.INST_DTLADDR        /* 기관_상세주소 */
          , A.PRGRM_NM            /* 프로그램_이름 */
          , A.FILEGRPID           /* 파일그룹아이디 */
          , A.STTS_CD             /* 상태_코드 */
          , A.DSGN_CYCL           /* 지정_차수 */
          , A.DSGN_NO             /* 지정_번호 */
          , A.DSGN_DE             /* 지정_일자 */
          , A.DSGN_BGNG_DE        /* 지정_시작_일자 */
          , A.DSGN_END_DE         /* 지정_종료_일자 */
          , A.AUTZRID             /* 승인자아이디 */
          , A.CHKLSTID            /* 체크리스트아이디 */
          , A.CNSLTNG_PRGRS_YN    /* 컨설팅__진행_여부 */
          , A.CNSLTNGID           /* 컨설텅아이디 */
          , A.APLY_DT             /* 신청_일시 */
          , A.MDFCN_DT            /* 수정_일시 */
          , A.MDFRID              /* 수정자아이디 */
          , A.REG_DT              /* 등록_일시 */
          , A.RGTRID              /* 등록자아이디 */
          , CONCAT(A.DSGN_CYCL, "/", A.DSGN_NO)    AS CYCL_NO
          , CONCAT(A.DSGN_BGNG_DE, " ~ ", A.DSGN_END_DE )   AS DSGN_PRD
          , (SELECT ACNT FROM TB_CMM_USER WHERE USERID = A.APLCNTID) AS ACNT
          , B.SPLMNT_DMNDID
          , C.USERID_GRP
          , C.USER_ACNT_GRP
          , C.USER_NM_GRP
          , C.USER_EML_GRP
          , C.USER_MOBLPHON_GRP
          , D.SPRTGRPID
          , D.SPRTGRP_ACNT
          , D.SPRTGRP_NM
          , D.SPRTGRP_EML
          , D.SPRTGRP_MOBLPHON
          , E.SBMSNID
        FROM
            TB_ASS_PRGRM A
        LEFT OUTER JOIN
        (
            SELECT
                MAX(SPLMNT_DMNDID)    AS SPLMNT_DMNDID
              , PRGRMID
            FROM TB_ASS_PRGRM_SPLMNT_DMND
            WHERE PRGRMID = #{prgrmid}
        ) B ON A.PRGRMID = B.PRGRMID
        LEFT OUTER JOIN    /* 심사위원 */
        (
            SELECT
                AA.PRGRMID
              , GROUP_CONCAT(AA.JDGSID)   AS USERID_GRP
              , GROUP_CONCAT(BB.ACNT)     AS USER_ACNT_GRP
              , GROUP_CONCAT(BB.NM)       AS USER_NM_GRP
              , GROUP_CONCAT(BB.EML)      AS USER_EML_GRP
              , GROUP_CONCAT(BB.MOBLPHON) AS USER_MOBLPHON_GRP
            FROM
                TB_ASS_PRGRM_JDGS AA
            INNER JOIN
                TB_CMM_USER BB ON AA.JDGSID = BB.USERID
            WHERE AA.PRGRMID = #{prgrmid}
            GROUP BY
                AA.PRGRMID
        ) C ON A.PRGRMID = C.PRGRMID
        LEFT OUTER JOIN    /* 지원단 */
        (
            SELECT
                AA.PRGRMID
              , AA.SPRTGRPID
              , BB.ACNT     AS SPRTGRP_ACNT
              , BB.NM       AS SPRTGRP_NM
              , BB.EML      AS SPRTGRP_EML
              , BB.MOBLPHON AS SPRTGRP_MOBLPHON
            FROM
                TB_ASS_SPRTGRP_SRNG AA
            INNER JOIN
                TB_CMM_USER BB ON AA.SPRTGRPID = BB.USERID
        ) D ON A.PRGRMID = D.PRGRMID
        LEFT OUTER JOIN
        (
        /*지원단 체크리스트*/
            SELECT
                SRNG.PRGRMID
              , CHK.SBMSNID
            FROM
                TB_ASS_SPRTGRP_SRNG SRNG
            LEFT OUTER JOIN
                TB_ASS_CHKLST_SBMSN CHK ON SRNG.PRGRMID = CHK.PRGRMID
                                       AND SRNG.SPRTGRPID = CHK.USERID
        ) E ON A.PRGRMID = E.PRGRMID
        WHERE 1=1
        AND A.PRGRMID = #{prgrmid}
    </select>

    <!-- 프로그램 우수성 조회. -->
    <select id="selectPrgrmDstnctn" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        SELECT
            A.PRGRMID                /* 프로그램아이디           */
          , B.PRGRMID    AS PRGRM_KEY    /* 우수성 아이디            */
          , A.PRGRM_NM               /* 프로그램이름             */
          , A.CNSLTNG_PRGRS_YN       /* 컨설팅 진행여부          */
          , C.CNSLTNG_KND_CD         /* 컨설팅 종류코드          */
          , B.STY_YN                 /* 숙박_여부                */
          , B.STY_NIGHT              /* 숙박_밤                  */
          , B.STY_DAYTM              /* 숙박_낮                  */
          , B.OPER_FRM_CD            /* 운영_형태_코드           */
          , B.JAN                    /* 1월                      */
          , B.FEB                    /* 2월                      */
          , B.MAR                    /* 3월                      */
          , B.APR                    /* 4월                      */
          , B.MAY                    /* 5월                      */
          , B.JUNE                   /* 6월                      */
          , B.JULY                   /* 7월                      */
          , B.AUG                    /* 8월                      */
          , B.SEPT                   /* 9월                      */
          , B.OCT                    /* 10월                     */
          , B.NOV                    /* 11월                     */
          , B.DCM                    /* 12월                     */
          , B.WHOL_MM                /* 전체_월                  */
          , B.INFNT                  /* 유아                     */
          , B.SCHBOY                 /* 초등학생                 */
          , B.MSKLSD                 /* 중학생                   */
          , B.HGSCHST                /* 고등학생                 */
          , B.ADULT                  /* 성인                     */
          , B.WHOL_AGE               /* 전체_연령                */
          , B.EDU_PLC                /* 교육_장소                */
          , B.EDU_NOPE               /* 교육_인원수              */
          , B.EDU_CNT                /* 교육_횟수                */
          , B.EDU_HR                 /* 교육_시간                */
          , B.EDU_MNT                /* 교육_분                  */
          , B.PCHRG_YN               /* 유료_여부                */
          , B.ETRFEE                 /* 참가비                   */
          , B.EDU_PRPS               /* 교육_목적                */
          , B.APPRO                  /* 적절성                   */
          , B.DSTNCTN                /* 우수성                   */
          , B.EDU_CN                 /* 교육_내용                */
          , B.WETHER_STTN            /* 기상_상황                */
          , B.ACTN_MTHD              /* 조치_방법                */
          , B.EDU_PHOTO_FILEGRPID    /* 교육_사진_파일그룹아이디 */
          , B.MDFCN_DT               /* 수정_일시                */
          , B.MDFRID                 /* 수정자아이디             */
          , B.REG_DT                 /* 등록_일시                */
          , B.RGTRID                 /* 등록자아이디             */
          , (SELECT GROUP_CONCAT(EDU_SBJCT_CD SEPARATOR',') FROM TB_ASS_PRGRM_EDU_SBJCT WHERE PRGRMID = #{prgrmid}) AS EDU_SBJCT_CD_LST
        FROM
            TB_ASS_PRGRM A
        /*프로그램 우수성*/
        LEFT OUTER JOIN
            TB_ASS_PRGRM_DSTNCTN B ON A.PRGRMID = B.PRGRMID
        LEFT OUTER JOIN    /*컨설팅*/
            TB_ASS_CNSLTNG C ON A.CNSLTNGID = C.CNSLTNGID
        WHERE A.PRGRMID = #{prgrmid}
    </select>

    <!-- 프로그램 운영일정 목록 조회 -->
    <select id="selectPrgrmSchdlList" parameterType="PrgrmSchdlVo" resultType="PrgrmSchdlVo">
        SELECT
            PRGRMID
          , SCHDLID
          , RND
          , BGNG_HR
          , BGNG_MNT
          , END_HR
          , END_MNT
          , PRGRM_NM
          , CRS
          , REG_DT
          , RGTRID
          , MDFRID
        FROM
            TB_ASS_PRGRM_SCHDL    /*ASS_프로그램_일정*/
        WHERE PRGRMID = #{prgrmid}
    </select>

    <!-- 프로그램 운영일정 수정 -->
    <update id="updatePrgrmSchdl" parameterType="PrgrmSchdlVo" >
    UPDATE
        TB_ASS_PRGRM_SCHDL
    SET
        PRGRMID    = #{prgrmid }
      , RND        = #{rnd     }
      , BGNG_HR    = #{bgngHr  }
      , BGNG_MNT   = #{bgngMnt }
      , END_HR     = #{endHr   }
      , END_MNT    = #{endMnt  }
      , PRGRM_NM   = #{prgrmNm }
      , CRS        = #{crs     }
      , MDFCN_DT   = NOW()
      , MDFRID     = #{user.userid}
    WHERE SCHDLID  = #{schdlid}

    </update>

    <!-- 프로그램 운영일정 등록 -->
    <insert id="insertPrgrmSchdl" parameterType="PrgrmSchdlVo" >
        INSERT INTO
            TB_ASS_PRGRM_SCHDL (
                PRGRMID
              , RND
              , BGNG_HR
              , BGNG_MNT
              , END_HR
              , END_MNT
              , PRGRM_NM
              , CRS
              , MDFCN_DT
              , MDFRID
              , REG_DT
              , RGTRID
        ) VALUES(
                #{prgrmid }
              , #{rnd     }
              , #{bgngHr  }
              , #{bgngMnt }
              , #{endHr   }
              , #{endMnt  }
              , #{prgrmNm }
              , #{crs     }
              , NOW()
              , #{user.userid}
              , NOW()
              , #{user.userid}
        )
    </insert>

    <!-- 프로그램 운영일정 삭제 -->
    <delete id="deletePrgrmSchdl" parameterType="PrgrmSchdlVo" >
        DELETE FROM
            TB_ASS_PRGRM_SCHDL
        WHERE PRGRMID = #{prgrmid}
    </delete>

    <!-- 비상조치계획 목록조회 -->
    <select id="selectEmrgcyActnPlanList" parameterType="AsgsysSrngVo" resultType="EmrgcyActnPlanVo">
        SELECT
            PLANID
          , PRGRMID
          , PRGRM_NM
          , SBSTN_PRGRM_NM
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
        FROM
            TB_ASS_EMRGCY_ACTN_PLAN
        WHERE PRGRMID = #{prgrmid}
    </select>

    <!-- 비상조치계획 등록 -->
    <insert id="insertEmrgcyActnPlan" parameterType="EmrgcyActnPlanVo" >
        INSERT INTO
            TB_ASS_EMRGCY_ACTN_PLAN(
                PRGRMID
              , PRGRM_NM
              , SBSTN_PRGRM_NM
              , MDFCN_DT
              , MDFRID
              , REG_DT
              , RGTRID
        ) VALUES (
                #{prgrmid}
              , #{prgrmNm}
              , #{sbstnPrgrmNm}
              , NOW()
              , #{user.userid}
              , NOW()
              , #{user.userid}
        )
    </insert>

    <!-- 비상조치계획 수정 -->
    <update id="updateEmrgcyActnPlan" parameterType="EmrgcyActnPlanVo" >
        UPDATE
            TB_ASS_EMRGCY_ACTN_PLAN
        SET
            PRGRM_NM       =  #{prgrmNm}
          , SBSTN_PRGRM_NM =  #{sbstnPrgrmNm}
          , MDFCN_DT       =  NOW()
          , MDFRID         =  #{user.userid}
    </update>

    <!-- 비상조치계획 삭제 -->
    <delete id="deleteEmrgcyActnPlan" parameterType="EmrgcyActnPlanVo" >
        DELETE FROM
            TB_ASS_EMRGCY_ACTN_PLAN
        WHERE PRGRMID = #{prgrmid}
    </delete>

    <!-- 프로그램우수성 등록 -->
    <insert id="insertPrgrmDstnctn" parameterType="AsgsysSrngVo" >
    /* AsgsysSrngDao.insertPrgrmDstnctn */
    INSERT
        INTO TB_ASS_PRGRM_DSTNCTN (
            PRGRMID
          , STY_YN
          , STY_NIGHT
          , STY_DAYTM
          , OPER_FRM_CD
          , JAN
          , FEB
          , MAR
          , APR
          , MAY
          , JUNE
          , JULY
          , AUG
          , SEPT
          , OCT
          , NOV
          , DCM
          , WHOL_MM
          , INFNT
          , SCHBOY
          , MSKLSD
          , HGSCHST
          , ADULT
          , WHOL_AGE
          , EDU_PLC
          , EDU_NOPE
          , EDU_CNT
          , EDU_HR
          , EDU_MNT
          , PCHRG_YN
          , ETRFEE
          , EDU_PRPS
          , APPRO
          , DSTNCTN
          , EDU_CN
          , WETHER_STTN
          , ACTN_MTHD
          , EDU_PHOTO_FILEGRPID
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
          ) VALUES (
            #{prgrmid          }
          , #{styYn            }
          , #{styNight         }
          , #{styDaytm         }
          , #{operFrmCd        }
          , #{jan              }
          , #{feb              }
          , #{mar              }
          , #{apr              }
          , #{may              }
          , #{june             }
          , #{july             }
          , #{aug              }
          , #{sept             }
          , #{oct              }
          , #{nov              }
          , #{dcm              }
          , #{wholMm           }
          , #{infnt            }
          , #{schboy           }
          , #{msklsd           }
          , #{hgschst          }
          , #{adult            }
          , #{wholAge          }
          , #{eduPlc           }
          , #{eduNope          }
          , #{eduCnt           }
          , #{eduHr            }
          , #{eduMnt           }
          , #{pchrgYn          }
          , #{etrfee           }
          , #{eduPrps          }
          , #{appro            }
          , #{dstnctn          }
          , #{eduCn            }
          , #{wetherSttn       }
          , #{actnMthd         }
          , #{eduPhotoFilegrpid}
          , NOW()
          , #{user.userid}
          , NOW()
          , #{user.userid}
          )
    </insert>

    <!-- 프로그램우수성 수정 -->
    <update id="updatePrgrmDstnctn" parameterType="AsgsysSrngVo" >
    /* AsgsysSrngDao.updatePrgrmDstnctn */
        UPDATE
            TB_ASS_PRGRM_DSTNCTN
        SET
            STY_YN                  = #{styYn            }
          , STY_NIGHT               = #{styNight         }
          , STY_DAYTM               = #{styDaytm         }
          , OPER_FRM_CD             = #{operFrmCd        }
          , JAN                     = #{jan              }
          , FEB                     = #{feb              }
          , MAR                     = #{mar              }
          , APR                     = #{apr              }
          , MAY                     = #{may              }
          , JUNE                    = #{june             }
          , JULY                    = #{july             }
          , AUG                     = #{aug              }
          , SEPT                    = #{sept             }
          , OCT                     = #{oct              }
          , NOV                     = #{nov              }
          , DCM                     = #{dcm              }
          , WHOL_MM                 = #{wholMm           }
          , INFNT                   = #{infnt            }
          , SCHBOY                  = #{schboy           }
          , MSKLSD                  = #{msklsd           }
          , HGSCHST                 = #{hgschst          }
          , ADULT                   = #{adult            }
          , WHOL_AGE                = #{wholAge          }
          , EDU_PLC                 = #{eduPlc           }
          , EDU_NOPE                = #{eduNope          }
          , EDU_CNT                 = #{eduCnt           }
          , EDU_HR                  = #{eduHr            }
          , EDU_MNT                 = #{eduMnt           }
          , PCHRG_YN                = #{pchrgYn          }
          , ETRFEE                  = #{etrfee           }
          , EDU_PRPS                = #{eduPrps          }
          , APPRO                   = #{appro            }
          , DSTNCTN                 = #{dstnctn          }
          , EDU_CN                  = #{eduCn            }
          , WETHER_STTN             = #{wetherSttn       }
          , ACTN_MTHD               = #{actnMthd         }
          , EDU_PHOTO_FILEGRPID     = #{eduPhotoFilegrpid}
          , MDFCN_DT                = NOW()
          , MDFRID                  = #{user.userid      }
        WHERE
            PRGRMID = #{prgrmid}
    </update>

    <!-- 프로그램우수성 수정 -->
    <update id="updateEduPhotoFilegrpid" parameterType="AsgsysSrngVo" >
    /* AsgsysSrngDao.updateEduPhotoFilegrpid */
        UPDATE TB_ASS_PRGRM_DSTNCTN
        SET
            EDU_PHOTO_FILEGRPID     = #{eduPhotoFilegrpid}
          , MDFCN_DT                = NOW()
          , MDFRID                  = #{user.userid}
        WHERE PRGRMID = #{prgrmid}

    </update>



    <!-- 프로그램 운영관리 조회 -->
    <select id="selectPrgrmOperMng" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectPrgrmOperMng */
        SELECT
            A.PRGRMID
          , B.PRGRMID   AS OPER_MNG_PRGRMID
          , B.ETRFEE_INCM
          , B.ETC_INCM
          , B.SLFPY
          , IFNULL(B.ETRFEE_INCM,0) + IFNULL(B.ETC_INCM,0) + IFNULL(B.SLFPY,0) AS BTG_SUM
          , B.OPER_BFR_PRMTN_SESS
          , B.OPER_BFR_PRMTN_MTHD
          , B.OPER_MDL_PRMTN_SESS
          , B.OPER_MDL_PRMTN_MTHD
          , B.OPER_AFTR_PRMTN_SESS
          , B.OPER_AFTR_PRMTN_MTHD
          , B.TEL_RCPT_YN
          , B.APLFRM_RCPT_YN
          , B.ONLN_APLY_YN
          , B.ETC_YN
          , B.ETC_CN
          , B.MDFCN_DT
          , B.MDFRID
          , B.REG_DT
          , B.RGTRID
        FROM
            TB_ASS_PRGRM A
        LEFT OUTER JOIN
            TB_ASS_PRGRM_OPER_MNG B ON A.PRGRMID = B.PRGRMID
        WHERE A.PRGRMID = #{prgrmid}
    </select>

    <!-- 프로그램운영관리 수정 -->
    <update id="updatePrgrmOperMng" parameterType="AsgsysSrngVo" >
    /* AsgsysSrngDao.updatePrgrmOperMng */
        UPDATE
            TB_ASS_PRGRM_OPER_MNG
        SET
            ETRFEE_INCM            = #{etrfeeIncm }
          , ETC_INCM               = #{etcIncm }
          , SLFPY                  = #{slfpy }
          , OPER_BFR_PRMTN_SESS    = #{operBfrPrmtnSess }
          , OPER_BFR_PRMTN_MTHD    = #{operBfrPrmtnMthd }
          , OPER_MDL_PRMTN_SESS    = #{operMdlPrmtnSess }
          , OPER_MDL_PRMTN_MTHD    = #{operMdlPrmtnMthd }
          , OPER_AFTR_PRMTN_SESS   = #{operAftrPrmtnSess }
          , OPER_AFTR_PRMTN_MTHD   = #{operAftrPrmtnMthd }
          , TEL_RCPT_YN            = #{telRcptYn }
          , APLFRM_RCPT_YN         = #{aplfrmRcptYn }
          , ONLN_APLY_YN           = #{onlnAplyYn }
          , ETC_YN                 = #{etcYn }
          , ETC_CN                 = #{etcCn }
          , MDFCN_DT               = NOW()
          , MDFRID                 = #{user.userid}
        WHERE PRGRMID = #{prgrmid}
    </update>

    <!-- 프로그램운영관리 등록 -->
    <insert id="insertPrgrmOperMng" parameterType="AsgsysSrngVo" >
        INSERT INTO
            TB_ASS_PRGRM_OPER_MNG(
                PRGRMID
              , ETRFEE_INCM
              , ETC_INCM
              , SLFPY
              , OPER_BFR_PRMTN_SESS
              , OPER_BFR_PRMTN_MTHD
              , OPER_MDL_PRMTN_SESS
              , OPER_MDL_PRMTN_MTHD
              , OPER_AFTR_PRMTN_SESS
              , OPER_AFTR_PRMTN_MTHD
              , TEL_RCPT_YN
              , APLFRM_RCPT_YN
              , ONLN_APLY_YN
              , ETC_YN
              , ETC_CN
              , MDFCN_DT
              , MDFRID
              , REG_DT
              , RGTRID
        ) VALUES (
                #{prgrmid}
              , #{etrfeeIncm}
              , #{etcIncm}
              , #{slfpy}
              , #{operBfrPrmtnSess}
              , #{operBfrPrmtnMthd}
              , #{operMdlPrmtnSess}
              , #{operMdlPrmtnMthd}
              , #{operAftrPrmtnSess}
              , #{operAftrPrmtnMthd}
              , #{telRcptYn}
              , #{aplfrmRcptYn}
              , #{onlnAplyYn}
              , #{etcYn}
              , #{etcCn}
              , NOW()
              , #{user.userid}
              , NOW()
              , #{user.userid}
        )
    </insert>

    <!-- 교육주제 등록 -->
    <insert id="insertEduSbjct" >
    INSERT INTO
        TB_ASS_PRGRM_EDU_SBJCT(
            PRGRMID
          , EDU_SBJCT_CD
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
        ) VALUES
        <foreach item="item" collection="eduSbjctCdArr" separator=",">
        (
            #{asgsysSrngVo.prgrmid}
          , #{item}
          , NOW()
          , #{user.userid}
          , NOW()
          , #{user.userid}
        )
        </foreach>
    </insert>

    <!-- 교육주제 삭제 -->
    <delete id="deleteEduSbjct" parameterType="AsgsysSrngVo">
        /* AsgsysSrngDao.insertExpndArtclt */
        DELETE FROM
            TB_ASS_PRGRM_EDU_SBJCT
        WHERE PRGRMID = #{prgrmid}
    </delete>

    <!-- 지출항목 목록 조회 -->
    <select id="selectExpndArtclList" parameterType="ExpndArtclVo" resultType="ExpndArtclVo">
        /* AsgsysSrngDao.selectExpndArtclList*/
        SELECT
            ARTCLID
          , PRGRMID
          , EXPND_ARTCL
          , AMT
          , SUM(AMT) OVER() AS SUM_AMT
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
        FROM
            TB_ASS_EXPND_ARTCL
        WHERE
            PRGRMID = #{prgrmid}
        ORDER BY
            ARTCLID
    </select>

    <!-- 지출항목 등록 -->
     <insert id="insertExpndArtcl" parameterType="ExpndArtclVo" >
        /* AsgsysSrngDao.insertExpndArtclt */
        INSERT INTO
            TB_ASS_EXPND_ARTCL(
                PRGRMID
              , EXPND_ARTCL
              , AMT
              , MDFCN_DT
              , MDFRID
              , REG_DT
              , RGTRID
        ) VALUES (
                #{prgrmid}
              , #{expndArtcl}
              , #{amt}
              , NOW()
              , #{user.userid}
              , NOW()
              , #{user.userid}
        )
     </insert>

    <!-- 지출항목 목록 삭제 -->
    <delete id="deleteExpndArtcl" parameterType="ExpndArtclVo">
        /* AsgsysSrngDao.insertExpndArtclt */
        DELETE FROM
            TB_ASS_EXPND_ARTCL
        WHERE PRGRMID = #{prgrmid}
    </delete>

    <!-- 교구 및 시설목록조회 -->
    <select id="selectTchaidFcltList" parameterType="TchaidFcltVo" resultType="TchaidFcltVo">
        /* AsgsysSrngDao.selecttchaidFcltList */
        SELECT
            TCHAIDFCLTID
          , PRGRMID
          , DTL_PRGRM_NM
          , EDU_PLC
          , TCHAID
          , QNTY
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
        FROM
            TB_ASS_TCHAID_FCLT
        WHERE PRGRMID = #{prgrmid}
    </select>

    <!-- 교구 및 시설 등록 -->
    <insert id="insertTchaidFclt" parameterType="TchaidFcltVo">
        INSERT INTO
            TB_ASS_TCHAID_FCLT(
                PRGRMID
              , DTL_PRGRM_NM
              , EDU_PLC
              , TCHAID
              , QNTY
              , MDFCN_DT
              , MDFRID
              , REG_DT
              , RGTRID
        ) VALUES (
                #{prgrmid}
              , #{dtlPrgrmNm}
              , #{eduPlc}
              , #{tchaid}
              , #{qnty}
              , NOW()
              , #{user.userid}
              , NOW()
              , #{user.userid}
        )
    </insert>

    <!-- 교구 및 시설 삭제 -->
    <delete id="deleteTchaidFclt" parameterType="TchaidFcltVo">
        DELETE FROM
            TB_ASS_TCHAID_FCLT
        WHERE PRGRMID = #{prgrmid}
    </delete>

    <!-- 프로그램 평가 조회 -->
    <select id="selectPrgrmEvl" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectPrgrmEvl*/
        SELECT A.PRGRMID
             , B.PRGRMID    AS EVLID
             , B.EVL_PRPS
             , B.BFR_LDR_EVL_ARTCL
             , B.BFR_LDR_EVL_TL
             , B.AFTR_LDR_EVL_ARTCL
             , B.AFTR_LDR_EVL_TL
             , B.BFR_PRTPNT_EVL_ARTCL
             , B.BFR_PRTPNT_EVL_TL
             , B.AFTR_PRTPNT_EVL_ARTCL
             , B.AFTR_PRTPNT_EVL_TL
             , B.BFR_GDR_EVL_ARTCL
             , B.BFR_GDR_EVL_TL
             , B.AFTR_GDR_EVL_ARTCL
             , B.AFTR_GDR_EVL_TL
             , B.DATABASE_WRT_YN
             , B.CLSJRNL_WRT_YN
             , B.ETC_YN
             , B.ETC_CN
             , B.MDFCN_DT
             , B.MDFRID
             , B.REG_DT
             , B.RGTRID
        FROM
            TB_ASS_PRGRM A
        LEFT OUTER JOIN
            TB_ASS_PRGRM_EVL B ON A.PRGRMID = B.PRGRMID
        WHERE A.PRGRMID = #{prgrmid}
    </select>

    <!-- 프로그램평가 등록 -->
    <insert id="insertPrgrmEvl" parameterType="AsgsysSrngVo">
    INSERT INTO
        TB_ASS_PRGRM_EVL(
            PRGRMID
          , EVL_PRPS
          , BFR_LDR_EVL_ARTCL
          , BFR_LDR_EVL_TL
          , AFTR_LDR_EVL_ARTCL
          , AFTR_LDR_EVL_TL
          , BFR_PRTPNT_EVL_ARTCL
          , BFR_PRTPNT_EVL_TL
          , AFTR_PRTPNT_EVL_ARTCL
          , AFTR_PRTPNT_EVL_TL
          , BFR_GDR_EVL_ARTCL
          , BFR_GDR_EVL_TL
          , AFTR_GDR_EVL_ARTCL
          , AFTR_GDR_EVL_TL
          , DATABASE_WRT_YN
          , CLSJRNL_WRT_YN
          , ETC_YN
          , ETC_CN
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
    ) VALUES (
            #{prgrmid}
          , #{evlPrps}
          , #{bfrLdrEvlArtcl}
          , #{bfrLdrEvlTl}
          , #{aftrLdrEvlArtcl}
          , #{aftrLdrEvlTl}
          , #{bfrPrtpntEvlArtcl}
          , #{bfrPrtpntEvlTl}
          , #{aftrPrtpntEvlArtcl}
          , #{aftrPrtpntEvlTl}
          , #{bfrGdrEvlArtcl}
          , #{bfrGdrEvlTl}
          , #{aftrGdrEvlArtcl}
          , #{aftrGdrEvlTl}
          , #{databaseWrtYn}
          , #{clsjrnlWrtYn}
          , #{etcYn}
          , #{etcCn}
          , NOW()
          , #{user.userid}
          , NOW()
          , #{user.userid}
    )
    </insert>

    <!-- 프로그램평가 수정 -->
    <update id="updatePrgrmEvl" parameterType="AsgsysSrngVo" >
        /* AsgsysSrngDao.updatePrgrm */
        UPDATE TB_ASS_PRGRM_EVL SET
            EVL_PRPS                 = #{evlPrps}
          , BFR_LDR_EVL_ARTCL        = #{bfrLdrEvlArtcl}
          , BFR_LDR_EVL_TL           = #{bfrLdrEvlTl}
          , AFTR_LDR_EVL_ARTCL       = #{aftrLdrEvlArtcl}
          , AFTR_LDR_EVL_TL          = #{aftrLdrEvlTl}
          , BFR_PRTPNT_EVL_ARTCL     = #{bfrPrtpntEvlArtcl}
          , BFR_PRTPNT_EVL_TL        = #{bfrPrtpntEvlTl}
          , AFTR_PRTPNT_EVL_ARTCL    = #{aftrPrtpntEvlArtcl}
          , AFTR_PRTPNT_EVL_TL       = #{aftrPrtpntEvlTl}
          , BFR_GDR_EVL_ARTCL        = #{bfrGdrEvlArtcl}
          , BFR_GDR_EVL_TL           = #{bfrGdrEvlTl}
          , AFTR_GDR_EVL_ARTCL       = #{aftrGdrEvlArtcl}
          , AFTR_GDR_EVL_TL          = #{aftrGdrEvlTl}
          , DATABASE_WRT_YN          = #{databaseWrtYn}
          , CLSJRNL_WRT_YN           = #{clsjrnlWrtYn}
          , ETC_YN                   = #{etcYn}
          , ETC_CN                   = #{etcCn}
          , MDFCN_DT                 = NOW()
          , MDFRID                   = #{user.userid}
        WHERE PRGRMID = #{prgrmid}
    </update>

    <!-- 책임개발자 목록 조회 -->
    <select id="selectLdrList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectLdrList*/
        SELECT
            A.PRGRMID
          , B.LDRID
          , B.PRGRMID
          , B.SE
          , B.NM
          , B.TASK_CN
          , B.SNRSTFDVLPR_YN
          , B.MDFCN_DT
          , B.MDFRID
          , B.REG_DT
          , B.RGTRID
        FROM
            TB_ASS_PRGRM A
        LEFT OUTER JOIN
            TB_ASS_PRGRM_LDR B ON A.PRGRMID = B.PRGRMID
        WHERE A.PRGRMID = #{prgrmid}
        ORDER BY B.SNRSTFDVLPR_YN DESC
    </select>

    <!-- 책임개발자 지도자 등록 -->
    <insert id="insertLdr" parameterType="LdrVo" >
        /* AsgsysSrngDao.insertLdr*/
        INSERT INTO TB_ASS_PRGRM_LDR
        (
            PRGRMID
          , SE
          , NM
          , TASK_CN
          , SNRSTFDVLPR_YN
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
        ) VALUES (
            #{prgrmid      }
          , #{se           }
          , #{nm           }
          , #{taskCn       }
          , #{snrstfdvlprYn}
          , NOW()
          , #{user.userid}
          , NOW()
          , #{user.userid}
        )
    </insert>

    <!-- 책임개발자 지도자 목록 삭제 -->
    <delete id="deleteLdrList" parameterType="AsgsysSrngVo" >
        /* AsgsysSrngDao.deleteLdrList*/
        DELETE FROM
            TB_ASS_PRGRM_LDR
        WHERE
            PRGRMID = #{prgrmid}
    </delete>

    <!-- 책임개발자 학력 등록 -->
    <insert id="insertAcbg" parameterType="AcbgVo" >
    /* AsgsysSrngDao.insertAcbg*/
        INSERT INTO TB_ASS_SNRSTFDVLPR_ACBG
        (
             PRGRMID
           , BGNG_DE
           , END_DE
           , SCHL_NM
           , MJR
           , DGR
           , MDFCN_DT
           , MDFRID
           , REG_DT
           , RGTRID
        ) VALUES
        (
             #{prgrmid }
           , #{bgngDe  }
           , #{endDe   }
           , #{schlNm  }
           , #{mjr     }
           , #{dgr     }
           , NOW()
           , #{user.userid}
           , NOW()
           , #{user.userid}
        )
    </insert>

    <!-- 책임개발자 학력 목록 삭제 -->
    <delete id="deleteAcbgList" parameterType="AsgsysSrngVo" >
        /* AsgsysSrngDao.deleteAcbgList*/
        DELETE FROM
            TB_ASS_SNRSTFDVLPR_ACBG
        WHERE
            PRGRMID = #{prgrmid}
    </delete>

    <!-- 책임개발자 경력 등록 -->
    <insert id="insertCareer" parameterType="CareerVo" >
        /* AsgsysSrngDao.insertCareer*/
        INSERT INTO TB_ASS_SNRSTFDVLPR_CAREER
        (
            PRGRMID
          , BGNG_DE
          , END_DE
          , ACTVT_NM
          , ACTVT_TYPE
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
        ) VALUES
        (   #{prgrmid}
          , #{bgngDe}
          , #{endDe}
          , #{actvtNm }
          , #{actvtType}
          , NOW()
          , #{user.userid}
          , NOW()
          , #{user.userid}
        )
    </insert>

    <!-- 책임개발자 경력 목록 삭제 -->
    <delete id="deleteCareerList" parameterType="AsgsysSrngVo" >
        /* AsgsysSrngDao.deleteCareerList*/
        DELETE FROM
            TB_ASS_SNRSTFDVLPR_CAREER
        WHERE
            PRGRMID = #{prgrmid}
    </delete>

    <!-- 책임개발자 자격 등록 -->
    <insert id="insertQlfc" parameterType="QlfcVo" >
        /* AsgsysSrngDao.insertQlfc*/
        INSERT INTO TB_ASS_SNRSTFDVLPR_QLFC
        (
            PRGRMID
          , QLFC_NM
          , GRD
          , ACQS_DE
          , WRKPLC
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
        ) VALUES
        (
            #{prgrmid }
          , #{qlfcNm  }
          , #{grd     }
          , #{acqsDe  }
          , #{wrkplc  }
          , NOW()
          , #{user.userid}
          , NOW()
          , #{user.userid}
        )
    </insert>

    <!-- 책임개발자 자격 목록 삭제 -->
    <delete id="deleteQlfcList" parameterType="AsgsysSrngVo" >
        /* AsgsysSrngDao.deleteQlfcList*/
        DELETE FROM
            TB_ASS_SNRSTFDVLPR_QLFC
        WHERE
            PRGRMID = #{prgrmid}
    </delete>

    <!-- 책임개발자 이력 조회 -->
    <select id="selectSnrstfdvlprHstry" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectSnrstfdvlprHstry*/
        SELECT
            A.PRGRMID
          , B.PRGRMID    AS HSTRYID
          , B.NM
          , B.BRDT
        FROM
            TB_ASS_PRGRM A
        LEFT OUTER JOIN
            TB_ASS_SNRSTFDVLPR_HSTRY B ON A.PRGRMID = B.PRGRMID
        WHERE A.PRGRMID = #{prgrmid}
    </select>

    <!-- 책임개발자 이력 등록 -->
    <insert id="insertSnrstfdvlprHstry" parameterType="AsgsysSrngVo" >
    /* AsgsysSrngDao.insertSnrstfdvlprHstry*/
        INSERT INTO TB_ASS_SNRSTFDVLPR_HSTRY
        (
            PRGRMID
          , NM
          , BRDT
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
        ) VALUES
        (
            #{prgrmid}
          , #{nm}
          , #{brdt}
          , NOW()
          , #{user.userid}
          , NOW()
          , #{user.userid}
        )
    </insert>

    <!-- 책임개발자 이력 수정 -->
    <update id="updateSnrstfdvlprHstry" parameterType="AsgsysSrngVo" >
        /* AsgsysSrngDao.updateSnrstfdvlprHstry*/
        UPDATE
            TB_ASS_SNRSTFDVLPR_HSTRY
        SET NM         = #{nm}           /*이름*/
          , BRDT       = #{brdt}         /*생년월일*/
          , MDFCN_DT   = NOW()          /*수정_일시*/
          , MDFRID     = #{user.userid} /*수정자아이디*/
        WHERE PRGRMID  = #{prgrmid}     /*프로그램아이디*/
    </update>

    <!-- 책임개발자 학력사항 목록조회 -->
    <select id="selectSnrstfdvlprAcbgList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectSnrstfdvlprAcbgList*/
        SELECT
            A.PRGRMID,
            B.ACBGID,
            B.BGNG_DE,
            B.END_DE,
            B.SCHL_NM,
            B.MJR,
            B.DGR,
            B.MDFCN_DT,
            B.MDFRID,
            B.REG_DT,
            B.RGTRID
        FROM
            TB_ASS_PRGRM A
        LEFT OUTER JOIN
            TB_ASS_SNRSTFDVLPR_ACBG B ON A.PRGRMID = B.PRGRMID
        WHERE A.PRGRMID = #{prgrmid}
    </select>

    <!-- 책임개발자 자격사항 목록조회 -->
    <select id="selectSnrstfdvlprQlfcList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectSnrstfdvlprQlfcList*/
        SELECT
            A.PRGRMID,
            B.QLFCID,
            B.QLFC_NM,
            B.GRD,
            B.ACQS_DE,
            B.WRKPLC,
            B.MDFCN_DT,
            B.MDFRID,
            B.REG_DT,
            B.RGTRID
        FROM
            TB_ASS_PRGRM A
        LEFT OUTER JOIN
            TB_ASS_SNRSTFDVLPR_QLFC B ON A.PRGRMID = B.PRGRMID
        WHERE A.PRGRMID = #{prgrmid}
    </select>

    <!-- 책임개발자 경력사항 목록조회 -->
    <select id="selectSnrstfdvlprCareerList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectSnrstfdvlprCareerList*/
        SELECT
            A.PRGRMID,
            B.CAREERID,
            B.BGNG_DE,
            B.END_DE,
            B.ACTVT_NM,
            B.ACTVT_TYPE,
            B.MDFCN_DT,
            B.MDFRID,
            B.REG_DT,
            B.RGTRID
        FROM
            TB_ASS_PRGRM A
        LEFT OUTER JOIN
            TB_ASS_SNRSTFDVLPR_CAREER B ON A.PRGRMID = B.PRGRMID
        WHERE A.PRGRMID = #{prgrmid}
    </select>

    <!-- 지정제 프로그램 등록 -->
    <insert id="insertPrgrm" parameterType="AsgsysSrngVo" >
    /* AsgsysSrngDao.insertPrgrm */
    INSERT INTO
        TB_ASS_PRGRM (
            PRGRMID,
          , INSTID
          , APLCNTID
          , APLCNT_NM
          , APLCNT_EML
          , APLCNT_MOBLPHON
          , INST_NM
          , INST_EML
          , INST_CNTCT
          , INST_HMPG
          , INST_TYPE_CD
          , INST_RGN_CD
          , INST_ZIP
          , INST_ADDR
          , INST_DTLADDR
          , PRGRM_NM
          , FILEGRPID
          , STTS_CD
          , DSGN_CYCL
          , DSGN_NO
          , DSGN_DE
          , DSGN_BGNG_DE
          , DSGN_END_DE
          , AUTZRID
          , CHKLSTID
          , CNSLTNG_PRGRS_YN
          , CNSLTNGID
          , APLY_DT
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
    ) VALUES(
            #{prgrmid       }
          , #{instid        }
          , #{aplcntid      }
          , #{aplcntNm      }
          , #{aplcntEml     }
          , #{aplcntMoblphon}
          , #{instNm        }
          , #{instEml       }
          , #{instCntct     }
          , #{instHmpg      }
          , #{instTypeCd    }
          , #{instRgnCd     }
          , #{instZip       }
          , #{instAddr      }
          , #{instDtladdr   }
          , #{prgrmNm       }
          , #{filegrpid     }
          , #{sttsCd        }
          , #{dsgnCycl      }
          , #{dsgnNo        }
          , #{dsgnDe        }
          , #{dsgnBgngDe    }
          , #{dsgnEndDe     }
          , #{autzrid       }
          , #{chklstid      }
          , #{cnsltngPrgrsYn}
          , #{cnsltngid     }
          , #{aplyDt        }
          , NOW()
          , #{user.userid}
          , NOW()
          , #{user.userid}
    )
    </insert>

    <!-- 지정제 프로그램 수정 -->
    <update id="updatePrgrm" parameterType="AsgsysSrngVo" >
    /* AsgsysSrngDao.updatePrgrm */
    UPDATE TB_ASS_PRGRM SET
        INSTID              = #{instid        }    /* 기관아이디 */
      , APLCNTID            = #{aplcntid      }    /* 신청자아이디 */
      , APLCNT_NM           = #{aplcntNm      }    /* 신청자_이름 */
      , APLCNT_EML          = #{aplcntEml     }    /* 신청자_이메일 */
      , APLCNT_MOBLPHON     = #{aplcntMoblphon}    /* 신청자_휴대폰 */
      , INST_NM             = #{instNm        }    /* 기관_이름 */
      , INST_EML            = #{instEml       }    /* 기관_이메일 */
      , INST_CNTCT          = #{instCntct     }    /* 기관_연락처 */
      , INST_HMPG           = #{instHmpg      }    /* 기관_홈페이지 */
      , INST_TYPE_CD        = #{instTypeCd    }    /* 기관_유형_코드 */
      , INST_RGN_CD         = #{instRgnCd     }    /* 기관_지역_코드 */
      , INST_ZIP            = #{instZip       }    /* 기관_우편번호 */
      , INST_ADDR           = #{instAddr      }    /* 기관_주소 */
      , INST_DTLADDR        = #{instDtladdr   }    /* 기관_상세주소 */
      , PRGRM_NM            = #{prgrmNm       }    /* 프로그램_이름 */
      , FILEGRPID           = #{filegrpid     }    /* 파일그룹아이디 */
      , STTS_CD             = #{sttsCd        }    /* 상태_코드 */
      , DSGN_CYCL           = #{dsgnCycl      }    /* 지정_차수 */
      , DSGN_NO             = #{dsgnNo        }    /* 지정_번호 */
      , DSGN_DE             = #{dsgnDe        }    /* 지정_일자 */
      , DSGN_BGNG_DE        = #{dsgnBgngDe    }    /* 지정_시작_일자 */
      , DSGN_END_DE         = #{dsgnEndDe     }    /* 지정_종료_일자 */
      , AUTZRID             = #{autzrid       }    /* 승인자아이디 */
      , CHKLSTID            = #{chklstid      }    /* 체크리스트아이디 */
      , CNSLTNG_PRGRS_YN    = #{cnsltngPrgrsYn}    /* 컨설팅__진행_여부 */
      , CNSLTNGID           = #{cnsltngid     }    /* 컨설텅아이디 */
      , APLY_DT             = #{aplyDt        }    /* 신청_일시 */
      , MDFCN_DT            = NOW()                /* 수정_일시 */
      , MDFRID              = #{mdfrid        }    /* 수정자아이디 */
      , REG_DT              = NOW()                /* 등록_일시 */
      , RGTRID              = #{rgtrid        }    /* 등록자아이디 */
    WHERE PRGRMID = #{prgrmid}
    </update>

    <!-- 지정신청 진행상태 조회 -->
    <select id="selectPrgrmSttsCd" parameterType="AsgsysSrngVo" resultType="String">
    SELECT
        STTS_CD
    FROM
        TB_ASS_PRGRM
    WHERE
        PRGRMID = #{prgrmid}
    </select>


    <!-- 지정신청 진행상태 수정 -->
    <update id="updatePrgrSttsCd" parameterType="AsgsysSrngVo" >
    UPDATE TB_ASS_PRGRM SET
        STTS_CD = #{sttsCd}    /* 상태_코드 */
    WHERE PRGRMID = #{prgrmid}
    </update>

    <!-- 보완요청 목록조회 -->
    <select id="selectSplmntDmndList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectSplmntDmndList*/
        <include refid="PaginationMapper.header"/>
        SELECT
            SPLMNT_DMNDID    /* 보완_요청아이디 */
          , PRGRMID          /* 프로그램아이디 */
          , STTS_CD
          , OPNN_CN          /* 의견_내용 */
          , CMPTN_PRCS_DE    /* 완료_처리_일자 */
          , MDFCN_DT         /* 수정_일시 */
          , MDFRID           /* 수정자아이디 */
          , REG_DT           /* 등록_일시 */
          , RGTRID           /* 등록자아이디 */
        FROM
            TB_ASS_PRGRM_SPLMNT_DMND
        WHERE 1=1
        AND PRGRMID = #{prgrmid}
        <if test="sttsCd != null and sttsCd != '' and sttsCd == ''">
            AND STTS_CD = #{sttsCd}
        </if>
        <include refid="PaginationMapper.footer"/>
    </select>

    <!-- 보완요청 조회 -->
    <select id="selectSplmntDmnd" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectSplmntDmnd */

        SELECT
            SPLMNT_DMNDID    /* 보완_요청아이디 */
          , PRGRMID          /* 프로그램아이디 */
          , STTS_CD          /* 상태_코드 */
          , OPNN_CN          /* 의견_내용 */
          , CMPTN_PRCS_DE    /* 완료_처리_일자 */
          , MDFCN_DT         /* 수정_일시 */
          , MDFRID           /* 수정자아이디 */
          , REG_DT           /* 등록_일시 */
          , RGTRID           /* 등록자아이디 */
        FROM
            TB_ASS_PRGRM_SPLMNT_DMND
        WHERE 1=1
        AND SPLMNT_DMNDID = #{splmntDmndid}

    </select>

    <!-- 보완요청 등록 -->
    <insert id="insertSplmntDmnd" parameterType="AsgsysSrngVo" >
        /* AsgsysSrngDao.insertSplmntDmnd*/
        INSERT INTO
        TB_ASS_PRGRM_SPLMNT_DMND (
            PRGRMID
          , STTS_CD
          , OPNN_CN
          , CMPTN_PRCS_DE
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
        ) VALUES (
            #{prgrmid    }
          , #{sttsCd     }
          , #{opnnCn     }
          , #{cmptnPrcsDe}
          , NOW()
          , #{user.userid}
          , NOW()
          , #{user.userid}
        )
    </insert>

    <!-- 보완요청 수정 -->
    <update id="updateSplmntDmnd" parameterType="AsgsysSrngVo" >
        /* AsgsysSrngDao.updateSplmntDmnd*/
        UPDATE
            TB_ASS_PRGRM_SPLMNT_DMND
        SET
            STTS_CD       = #{sttsCd}
          , OPNN_CN       = #{opnnCn}
          , CMPTN_PRCS_DE = #{cmptnPrcsDe}
          , MDFCN_DT      = NOW()
          , MDFRID        = #{user.userid}
        WHERE
            SPLMNT_DMNDID = #{splmntDmndid}

    </update>

    <!-- 보완요청 삭제 -->
    <delete id="deleteSplmntDmnd" parameterType="AsgsysSrngVo" >
        /* AsgsysSrngDao.deleteSplmntDmnd*/
        DELETE FROM
            TB_ASS_PRGRM_SPLMNT_DMND
        WHERE
            SPLMNT_DMNDID = #{splmntDmndid}
    </delete>

    <!-- 신청정보탭 안전관리 상세 조회 -->
    <select id="selectSftyMng" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        SELECT
            A.PRGRMID
          , A.FILEGRPID
          , A.LDR_EDU_SESS
          , A.LDR_EDU_PIC
          , A.LDR_EDU_CN
          , A.PRTCPNT_EDU_SESS
          , A.PRTCPNT_EDU_PIC
          , A.PRTCPNT_EDU_CN
          , A.BFR_CERT_YN
          , A.BFR_CERT_FILEGRPID
          , A.MDFCN_DT
          , A.MDFRID
          , A.REG_DT
          , A.RGTRID
        FROM
            TB_ASS_SFTY_MNG A
        WHERE
            A.PRGRMID = #{prgrmid}
    </select>

    <!-- 안전관리 등록 -->
    <update id="insertSftyMng" parameterType="AsgsysSrngVo" >
        /* AsgsysSrngDao.insertSftyMng */
        INSERT INTO
            TB_ASS_SFTY_MNG(
                PRGRMID
              , FILEGRPID
              , LDR_EDU_SESS
              , LDR_EDU_PIC
              , LDR_EDU_CN
              , PRTCPNT_EDU_SESS
              , PRTCPNT_EDU_PIC
              , PRTCPNT_EDU_CN
              , BFR_CERT_YN
              , BFR_CERT_FILEGRPID
              , MDFCN_DT
              , MDFRID
              , REG_DT
              , RGTRID
            ) VALUES (
                #{prgrmid}
              , #{filegrpid}
              , #{ldrEduSess}
              , #{ldrEduPic}
              , #{ldrEduCn}
              , #{prtcpntEduSess}
              , #{prtcpntEduPic}
              , #{prtcpntEduCn}
              , #{bfrCertYn}
              , #{bfrCertFilegrpid}
              , NOW()
              , #{user.userid}
              , NOW()
              , #{user.userid}
            )

    </update>

    <!-- 안전관리 수정 -->
    <update id="updateSftyMng" parameterType="AsgsysSrngVo" >
    /* AsgsysSrngDao.updateSftyMng */
    UPDATE
        TB_ASS_SFTY_MNG
    SET
        FILEGRPID             = #{filegrpid}
      , LDR_EDU_SESS          = #{ldrEduSess}
      , LDR_EDU_PIC           = #{ldrEduPic}
      , LDR_EDU_CN            = #{ldrEduCn}
      , PRTCPNT_EDU_SESS      = #{prtcpntEduSess}
      , PRTCPNT_EDU_PIC       = #{prtcpntEduPic}
      , PRTCPNT_EDU_CN        = #{prtcpntEduCn}
      , BFR_CERT_YN           = #{bfrCertYn}
      , BFR_CERT_FILEGRPID    = #{bfrCertFilegrpid}
      , MDFCN_DT              = NOW()
      , MDFRID                = #{user.userid}
    WHERE PRGRMID = #{prgrmid}

    </update>

    <!-- 심사위원심사 목록조회-->
    <select id="selectJdgsSrngList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectJdgsSrngList*/
        <include refid="PaginationMapper.header"/>
            SELECT
                 A.PRGRMID
               , A.JDGSID
               , (SELECT NM FROM TB_CMM_USER WHERE USERID = A.JDGSID) AS JDGS_NM
               , B.PRGRM_NM
               , B.INST_NM
               , A.SRNG_STTS_CD
               , A.REG_DT          /* 배정일*/
               , C.STY_YN          /* 숙박여부*/
               , D.SBMSN_DT        /* 심사일 */
               , A.MDFCN_DT
               , A.MDFRID
               , A.RGTRID
            FROM
                TB_ASS_PRGRM_JDGS A
            INNER JOIN
                TB_ASS_PRGRM B ON A.PRGRMID = B.PRGRMID
            LEFT OUTER JOIN
                TB_ASS_PRGRM_DSTNCTN C ON A.PRGRMID = C.PRGRMID
            LEFT OUTER JOIN
                TB_ASS_SRNG_SBMSN D ON A.PRGRMID = D.PRGRMID AND A.JDGSID = D.USERID
            WHERE 1=1
        <!-- 키워드.전체 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == ''">
            AND (B.PRGRM_NM LIKE CONCAT('%',#{searchKeyword},'%') OR B.INST_NM LIKE CONCAT('%',#{searchKeyword},'%'))
        </if>
        <!-- 키워드.프로그램명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchPrgrmNm'">
            AND B.PRGRM_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 키워드.기관명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchInstNm'">
            AND B.INST_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 심사진행상태  -->
        <if test="searchSrngSttsCd != null and searchSrngSttsCd != ''">
            AND A.SRNG_STTS_CD = #{searchSrngSttsCd}
        </if>
        <!-- 배정일 검색시작일  -->
        <if test="searchRegStartDt != null and searchRegStartDt != ''">
            AND A.REG_DT >= #{searchRegStartDt}
        </if>
        <!-- 배정일 검색종료일  -->
        <if test="searchRegEndDt != null and searchRegEndDt != ''">
            AND A.REG_DT  <![CDATA[<]]> CAST(CONCAT(#{searchRegEndDt},' 23:59:59') AS DATETIME)
        </if>
        <!-- 숙박여부-->
        <if test="searchStyYn!= null and searchStyYn != ''">
            AND C.STY_YN = #{searchStyYn}
        </if>
        <include refid="PaginationMapper.footer"/>
    </select>

    <select id="jdgsSrngListExcelDown" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.jdgsSrngListExcelDown */
            SELECT
            A.PRGRM_NM
          , A.PRGRMID
          , A.INST_NM
          , A.STTS_CD
          , A.APLY_DT
          , A.REG_DT
          , B.SRNG_STTS_CD
          , C.SRGN_STTS_CD
          , C.VST_DE
          , C.VST_HR
          , C.VST_MNT
          , CONCAT(C.VST_DE , " " , C.VST_HR , ":" , C.VST_MNT) AS VST_DT
          , C.SPLMNT_DMND_OPNN
          , C.SRNG_OPNN
        FROM
            TB_ASS_PRGRM A
        LEFT OUTER JOIN    /* 심사위원 */
        (
            SELECT
                PRGRMID
              , SRNG_STTS_CD
              , JDGSID
              , COUNT(1) AS CNT
            FROM TB_ASS_PRGRM_JDGS
        ) B ON A.PRGRMID  = B.PRGRMID
        LEFT OUTER JOIN    /* 지원단 */
            TB_ASS_SPRTGRP_SRNG C ON A.PRGRMID  = C.PRGRMID
        LEFT OUTER JOIN
            TB_CMM_INST D ON A.INSTID  = D.INSTID
        WHERE 1=1
        <!-- 키워드.전체 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == ''">
            AND (B.PRGRM_NM LIKE CONCAT('%',#{searchKeyword},'%') OR B.INST_NM LIKE CONCAT('%',#{searchKeyword},'%'))
        </if>
        <!-- 키워드.프로그램명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchPrgrmNm'">
            AND B.PRGRM_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 키워드.기관명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchInstNm'">
            AND B.INST_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 심사진행상태  -->
        <if test="searchSrngSttsCd != null and searchSrngSttsCd != ''">
            AND A.SRNG_STTS_CD = #{searchSrngSttsCd}
        </if>
        <!-- 배정일 검색시작일  -->
        <if test="searchRegStartDt != null and searchRegStartDt != ''">
            AND A.REG_DT >= #{searchRegStartDt}
        </if>
        <!-- 배정일 검색종료일  -->
        <if test="searchRegEndDt != null and searchRegEndDt != ''">
            AND A.REG_DT  <![CDATA[<]]> CAST(CONCAT(#{searchRegEndDt},' 23:59:59') AS DATETIME)
        </if>
        <!-- 숙박여부-->
        <if test="searchStyYn!= null and searchStyYn != ''">
            AND C.STY_YN = #{searchStyYn}
        </if>
    </select>

    <!-- 지원단 캘린더 목록 조회 -->
    <select id="selectSprtgrpClndrList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        SELECT
            A.PRGRMID
          , A.PRGRM_NM
          , A.INST_NM
          , B.VST_DE
          , B.VST_HR
          , B.VST_MNT
          , B.SPRTGRPID
          , CONCAT(C.NM, '(', C.ACNT, ')')    AS SPRTGRP_NM_ACNT
          , C.NM
          , CONCAT(B.VST_DE , ' ', B.VST_HR  ,' : ',  B.VST_MNT)    AS VST_DE
        FROM
            TB_ASS_PRGRM A
        LEFT OUTER JOIN
            TB_ASS_SPRTGRP_SRNG B ON A.PRGRMID = B.PRGRMID
        LEFT OUTER JOIN
            TB_CMM_USER C ON B.SPRTGRPID = C.USERID
        WHERE 1=1
        <if test="searchAplyStartDt != null and searchAplyStartDt != '' ">
            AND B.VST_DE <![CDATA[>=]]> #{searchAplyStartDt}
        </if>
        <if test="searchAplyEndDt != null and searchAplyEndDt != '' ">
            AND   B.VST_DE <![CDATA[<=]]> #{searchAplyEndDt}
        </if>
        ORDER BY VST_DE, VST_HR, VST_MNT
    </select>

    <!-- 신청정보 조회 -->
    <select id="selectAplyInfo" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        SELECT
            A.PRGRMID
          , A.PRGRM_NM
          , A.INSTID
          , A.INST_NM
          , A.CHKLSTID
          , B.STY_YN
          , B.STY_NIGHT
          , B.STY_DAYTM
          , B.OPER_FRM_CD
          , C.BFR_CERT_YN
          , C.BFR_CERT_FILEGRPID
          , A.FILEGRPID  AS APLY_FILEGRPID
          , A.STTS_CD
          , D.SPRTGRPID
          , D.VST_DT
          , D.NM
          , D.SPLMNT_DMND_OPNN
          , D.SRNG_OPNN
          , E.SBMSNID
        FROM
            TB_ASS_PRGRM A
        LEFT OUTER JOIN
            TB_ASS_PRGRM_DSTNCTN B ON A.PRGRMID = B.PRGRMID
        LEFT OUTER JOIN
            TB_ASS_SFTY_MNG C ON A.PRGRMID = C.PRGRMID
        LEFT OUTER JOIN
        (
            SELECT
                AA.PRGRMID
              , AA.SPRTGRPID
              , CONCAT(BB.NM,"( ",BB.ACNT," )") AS NM
              , CONCAT(AA.VST_DE , " " , AA.VST_HR , ":" , AA.VST_MNT) AS VST_DT
              , AA.SPLMNT_DMND_OPNN
              , AA.SRNG_OPNN
            FROM
                TB_ASS_SPRTGRP_SRNG AA
            INNER JOIN
                TB_CMM_USER BB ON AA.SPRTGRPID = BB.USERID
        ) D ON A.PRGRMID = D.PRGRMID
        LEFT OUTER JOIN
        (
        /*지원단 체크리스트*/
            SELECT
                SRNG.PRGRMID
              , CHK.SBMSNID
            FROM
                TB_ASS_SPRTGRP_SRNG SRNG
            LEFT OUTER JOIN
                TB_ASS_CHKLST_SBMSN CHK ON SRNG.PRGRMID = CHK.PRGRMID
                                       AND SRNG.SPRTGRPID = CHK.USERID
        ) E ON A.PRGRMID = E.PRGRMID
        WHERE 1=1
        AND A.PRGRMID = #{prgrmid}
    </select>

    <!-- 심사위원 심사 상세 조회 -->
    <select id="selectJdgsSrngDetail" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectJdgsSrngDetail */
            SELECT
                 A.PRGRMID
               , A.JDGSID
               , F.FORMID       /*양식ID*/
               , F.SBMSNID
               , B.PRGRM_NM
               , B.INST_NM
               , C.STY_YN       /*숙박여부*/
               , C.STY_NIGHT
               , C.STY_DAYTM
               , C.OPER_FRM_CD
               , NULLIF(E.PRGRMID,'N') AS SFTY_MNG_YN
    --         , '첨부파일'
    --         , '증빙서류'
               , A.SRNG_STTS_CD
               , A.REG_DT       /*배정일*/
               , F.SRNG_OPNN    /*심사의견*/
            FROM
                TB_ASS_PRGRM_JDGS A
            INNER JOIN
                TB_ASS_PRGRM B ON A.PRGRMID = B.PRGRMID
            LEFT OUTER JOIN
                TB_ASS_PRGRM_DSTNCTN C ON A.PRGRMID = C.PRGRMID
            LEFT OUTER JOIN
                TB_ASS_SFTY_MNG E ON A.PRGRMID = E.PRGRMID
            LEFT OUTER JOIN
                TB_ASS_SRNG_SBMSN F ON A.PRGRMID = F.PRGRMID AND A.JDGSID =F.USERID
            WHERE 1=1
            AND A.JDGSID = #{jdgsid}
            AND B.PRGRMID =  #{prgrmid}
    </select>

    <!-- 심사양식목록 조회 -->
    <select id="selectDsgnSrgnFormList" parameterType="DsgnSrngFormVO" resultType="DsgnSrngFormVO">
            SELECT
                  C.DSGNCRTR_CD
                , B.IDNTY_MTTR
                , C.ORDR             AS DSGNCRTR_ORDR
                , A.QITEMID          AS QITEMID
                , A.CHKLST_SE_CD     AS CHKLST_SE_CD
                , B.ALTM
                , E.SCR
                , SUM(B.ALTM) OVER() AS ALLALTM
                , SUM(E.SCR) OVER()  AS ALLSCR
                , SBMSN.PRGRMID
                , SBMSN.FORMID
                , SBMSN.SBMSNID
                , A.ORDR
                , ROW_NUMBER() OVER(PARTITION BY C.DSGNCRTR_CD ORDER BY A.ORDR ASC) AS RNK
                , COUNT(1) OVER (PARTITION  BY C.DSGNCRTR_CD ASC) AS ROWSPAN
                , CHK.SCR    as CHK_LST_SCR
            FROM TB_ASS_SRNG_SBMSN SBMSN
            LEFT OUTER JOIN
                TB_ASS_SRNG_FORM_QITEM_MAPNG A    ON SBMSN.FORMID = A.FORMID
            LEFT OUTER JOIN
                TB_ASS_SRNG_QITEM B    ON B.QITEMID = A.QITEMID
            LEFT OUTER JOIN
                TB_ASS_SRNG_FORM_DSGNCRTR_ORDR C    ON C.FORMID = A.FORMID AND B.DSGNCRTR_CD = C.DSGNCRTR_CD
            LEFT OUTER JOIN
                TB_ASS_PRGRM_JDGS D    ON SBMSN.PRGRMID = D.PRGRMID  AND SBMSN.USERID =D.JDGSID
            LEFT OUTER JOIN
                TB_ASS_SRNG_ANS   E    ON SBMSN.SBMSNID = E.SBMSNID  AND A.QITEMID = E.QITEMID
            LEFT OUTER JOIN
                TB_CMM_CD CD ON A.CHKLST_SE_CD = CD.CD
            LEFT OUTER JOIN
            (
                SELECT
                    A.QITEMID
                  , A.SE_CD
                  , SUM(A.SCR) SCR
                  , SBMSNID
                FROM
                    TB_ASS_CHKLST_ANS A
                WHERE A.SBMSNID = #{sbmsnid}
                GROUP BY A.SE_CD
            ) CHK ON A.CHKLST_SE_CD = CHK.SE_CD
            WHERE SBMSN.PRGRMID = #{prgrmid}
            AND   D.JDGSID = #{jdgsid}
            AND   SBMSN.SBMSNID = #{sbmsnid}
            ORDER BY
                C.DSGNCRTR_CD , C.ORDR ,A.ORDR
    </select>

    <!-- 심사양식 문항목록 조회 -->
    <select id="selectSrngFormQitemList" parameterType="DsgnSrngFormVO" resultType="DsgnSrngFormVO">
        /* SrngDao.selectSrngFormQitemList */
        WITH RECURSIVE CODE_VIEW(DSGNCRTR_CD, IDNTY_MTTR, DSGNCRTR_ORDR, TREE_ORD, QITEMID, CHKLST_SE_CD)  AS (
            SELECT
                SFDO.DSGNCRTR_CD AS DSGNCRTR_CD
                , CONCAT(CD_NM) AS IDNTY_MTTR
                , SFDO.ORDR AS DSGNCRTR_ORDR
                , 1 AS TREE_ORD
                , 0 AS QITEMID
                , 0 AS CHKLST_SE_CD
            FROM
                TB_CMM_CD CCD
            LEFT OUTER JOIN TB_ASS_SRNG_FORM_DSGNCRTR_ORDR SFDO
                ON SFDO.DSGNCRTR_CD = CCD.CD
            WHERE
                1 = 1
                AND CCD.CDGRPID != 'G0001'
                AND CCD.CDGRPID  = '149'
                AND SFDO.FORMID = #{formid}
            UNION ALL
            SELECT
                C.DSGNCRTR_CD
                , B.IDNTY_MTTR
                , C.ORDR AS DSGNCRTR_ORDR
                , 2 AS TREE_ORD
                , A.QITEMID AS QITEMID
                , A.CHKLST_SE_CD AS CHKLST_SE_CD
            FROM
                TB_ASS_SRNG_FORM_QITEM_MAPNG A
            LEFT OUTER JOIN TB_ASS_SRNG_QITEM B
                ON B.QITEMID = A.QITEMID
            LEFT OUTER JOIN TB_ASS_SRNG_FORM_DSGNCRTR_ORDR C
                ON C.FORMID = A.FORMID AND B.DSGNCRTR_CD = C.DSGNCRTR_CD
            WHERE
                A.FORMID = #{formid}
        )
        SELECT
            CV.DSGNCRTR_CD
            , CV.IDNTY_MTTR
            , CV.DSGNCRTR_ORDR
            , CV.TREE_ORD
            , CV.QITEMID
            , CV.CHKLST_SE_CD
            , BB.QITEM_ORDR
            , BB.ALTM
            , ROW_NUMBER() OVER(PARTITION BY CV.DSGNCRTR_CD ORDER BY BB.QITEM_ORDR ASC) AS RNK
            , COUNT(1) OVER (PARTITION  BY CV.DSGNCRTR_CD ASC) AS ROWSPAN
        FROM
            CODE_VIEW CV
        LEFT OUTER JOIN (
            SELECT
                SFQM.FORMID
                , SQ.DSGNCRTR_CD
                , SFQM.QITEMID
                , SQ.IDNTY_MTTR
                , SFQM.ORDR QITEM_ORDR
                , SFDO.ORDR DSGNCRTR_ORDR
                , SFQM.CHKLST_SE_CD
                , SQ.ALTM
            FROM
                TB_ASS_SRNG_FORM_QITEM_MAPNG SFQM
            LEFT OUTER JOIN TB_ASS_SRNG_QITEM SQ
                ON SQ.QITEMID = SFQM.QITEMID
            LEFT OUTER JOIN TB_ASS_SRNG_FORM_DSGNCRTR_ORDR SFDO
                ON SFDO.FORMID = SFQM.FORMID AND SQ.DSGNCRTR_CD = SFDO.DSGNCRTR_CD
            WHERE
                SFQM.FORMID = #{formid}
        ) BB ON BB.QITEMID = CV.QITEMID
                ORDER BY CV.DSGNCRTR_ORDR, CV.TREE_ORD,BB.QITEM_ORDR
    </select>

    <!-- 심사양식 문항목록 조회 -->
    <select id="selectChkScrList" parameterType="DsgnSrngFormVO" resultType="DsgnSrngFormVO">
        SELECT
            A.PRGRMID
          , B.SBMSNID
          , B.USERID
          , C.SCR
        FROM
        TB_ASS_PRGRM A
        LEFT OUTER JOIN
        TB_ASS_CHKLST_SBMSN B ON A.PRGRMID = B.PRGRMID
         LEFT OUTER JOIN
         (
            SELECT
                A.SBMSNID
              , SUM(A.SCR)   SCR
              , CD.UPPR_CD
            FROM TB_ASS_CHKLST_ANS A
            INNER JOIN
            TB_CMM_CD CD ON A.SE_CD = CD.CD
            WHERE 1=1
            GROUP BY SBMSNID
            ORDER BY SBMSNID
         ) C ON B.SBMSNID =  C.SBMSNID
         WHERE A.PRGRMID = #{prgrmid}
    </select>


    <!-- 심사위원심사 등록 -->
    <insert id="insertJdgsSrngDetail" parameterType="AsgsysSrngVo" >
    /* AsgsysSrngDao.insertJdgsSrngDetail */
        INSERT INTO TB_ASS_SRNG_SBMSN (
            PRGRMID
          , FORMID
          , USERID
          , SBMSN_DT
          , SBMSN_STTS_CD
          , USER_IP
          , SCR
          , SRNG_OPNN
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
        )
        VALUES (
            #{prgrmid    }
          , #{formid     }
          , #{user.userid}
          , #{sbmsnDt    }
          , #{sbmsnSttsCd}
          , #{userIp     }
          , #{scr        }
          , #{srngOpnn   }
          , NOW()
          , #{user.userid}
          , NOW()
          , #{user.userid}
        )
    </insert>

    <!-- 심사위원심사 상세 수정-->
    <update id="updateJdgsSrngDetail" parameterType="AsgsysSrngVo" >
    /* AsgsysSrngDao.updateJdgsSrngDetail*/
        UPDATE
            TB_ASS_SRNG_SBMSN
        SET
            USERID        = #{userid}
          , SBMSN_DT      = NOW()
          , SBMSN_STTS_CD = #{sbmsnSttsCd}
          , USER_IP       = #{userIp     }
          , SCR           = #{scr        }
          , SRNG_OPNN     = #{srngOpnn   }
          , MDFCN_DT      = NOW()
          , MDFRID        = #{user.userid}
          , REG_DT        = NOW()
          , RGTRID        = #{user.userid}
        WHERE
            SBMSNID       = #{sbmsnid    }
    </update>

    <!-- 심사위원심사 점수 헤더 조회 -->
    <select id="selectSrngScrHeader" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        SELECT
             MAX(CASE WHEN BB.DSGNCRTR_CD = '149101' THEN BB.DSGNCRTR_NM END) AS COL_VAL1
           , MAX(CASE WHEN BB.DSGNCRTR_CD = '149102' THEN BB.DSGNCRTR_NM END) AS COL_VAL2
           , MAX(CASE WHEN BB.DSGNCRTR_CD = '149103' THEN BB.DSGNCRTR_NM END) AS COL_VAL3
           , MAX(CASE WHEN BB.DSGNCRTR_CD = '149104' THEN BB.DSGNCRTR_NM END) AS COL_VAL4
           , MAX(CASE WHEN BB.DSGNCRTR_CD = '149105' THEN BB.DSGNCRTR_NM END) AS COL_VAL5
           , MAX(CASE WHEN BB.DSGNCRTR_CD = '149106' THEN BB.DSGNCRTR_NM END) AS COL_VAL6
           , MAX(CASE WHEN BB.DSGNCRTR_CD = '149107' THEN BB.DSGNCRTR_NM END) AS COL_VAL7
           , MAX(CASE WHEN BB.DSGNCRTR_CD = '149108' THEN BB.DSGNCRTR_NM END) AS COL_VAL8
           , MAX(CASE WHEN BB.DSGNCRTR_CD = '149109' THEN BB.DSGNCRTR_NM END) AS COL_VAL9
           , MAX(CASE WHEN BB.DSGNCRTR_CD = '149110' THEN BB.DSGNCRTR_NM END) AS COL_VAL10
        FROM
        (
            SELECT
                  A.FORMID
                , B.DSGNCRTR_CD
                , (select CD_NM  from TB_CMM_CD where CD = B.DSGNCRTR_CD) as DSGNCRTR_NM
                , A.QITEMID
                , B.IDNTY_MTTR
                , A.ORDR QITEM_ORDR
                , C.ORDR DSGNCRTR_ORDR
                , A.CHKLST_SE_CD
            FROM
                TB_ASS_SRNG_FORM_QITEM_MAPNG A
            LEFT OUTER JOIN TB_ASS_SRNG_QITEM B
                ON B.QITEMID = A.QITEMID
            LEFT OUTER JOIN TB_ASS_SRNG_FORM_DSGNCRTR_ORDR C
                ON C.FORMID = A.FORMID AND B.DSGNCRTR_CD = C.DSGNCRTR_CD
            WHERE
                A.FORMID = #{formid}
        ) BB

    </select>

    <select id="selectSrngFormList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        SELECT
            A.QITEMID
          , A.DSGNCRTR_CD
          , A.IDNTY_MTTR
          , SUM(A.ALTM ) AS SUM_ALTM
          , CD.CD_NM
          , B.CHKLST_SE_CD
        FROM
            TB_ASS_SRNG_QITEM A
        INNER JOIN
            TB_ASS_SRNG_FORM_QITEM_MAPNG B ON A.QITEMID =B.QITEMID
        LEFT OUTER JOIN
            TB_CMM_CD CD ON A.DSGNCRTR_CD =CD.CD
        WHERE B.FORMID = #{formid}
        GROUP BY DSGNCRTR_CD

    </select>


    <select id="selectSrngScrList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        SELECT
            A.PRGRMID
          , A.JDGSID
          , B.SBMSNID
          , B.FORMID
          , B.USERID
          , (SELECT NM FROM TB_CMM_USER WHERE USERID = A.JDGSID ) AS JDGS_NM
          , B.SBMSN_DT
          , CASE WHEN 0 <![CDATA[<]]> SUM(COL_VAL1) OVER() THEN IFNULL(COL_VAL1,0) END AS COL_VAL1
          , CASE WHEN 0 <![CDATA[<]]> SUM(COL_VAL2) OVER() THEN IFNULL(COL_VAL2,0) END AS COL_VAL2
          , CASE WHEN 0 <![CDATA[<]]> SUM(COL_VAL3) OVER() THEN IFNULL(COL_VAL3,0) END AS COL_VAL3
          , CASE WHEN 0 <![CDATA[<]]> SUM(COL_VAL4) OVER() THEN IFNULL(COL_VAL4,0) END AS COL_VAL4
          , CASE WHEN 0 <![CDATA[<]]> SUM(COL_VAL5) OVER() THEN IFNULL(COL_VAL5,0) END AS COL_VAL5
          , CASE WHEN 0 <![CDATA[<]]> SUM(COL_VAL6) OVER() THEN IFNULL(COL_VAL6,0) END AS COL_VAL6
          , B.SCR    AS SUM_SCR
          , ROUND(SUM(SCR) / COUNT(A.JDGSID),2)          AS SUM_AVG
          , B.SRNG_OPNN
        FROM
            TB_ASS_PRGRM_JDGS A
        LEFT OUTER JOIN
            TB_ASS_SRNG_SBMSN B ON A.PRGRMID =B.PRGRMID AND A.JDGSID = B.USERID
        LEFT OUTER JOIN
        (
            SELECT
                 AA.SBMSNID
               , SUM(CASE WHEN AA.DSGNCRTR_CD = '149101' THEN AA.SCR END) AS COL_VAL1
               , SUM(CASE WHEN AA.DSGNCRTR_CD = '149102' THEN AA.SCR END) AS COL_VAL2
               , SUM(CASE WHEN AA.DSGNCRTR_CD = '149103' THEN AA.SCR END) AS COL_VAL3
               , SUM(CASE WHEN AA.DSGNCRTR_CD = '149104' THEN AA.SCR END) AS COL_VAL4
               , SUM(CASE WHEN AA.DSGNCRTR_CD = '149105' THEN AA.SCR END) AS COL_VAL5
               , SUM(CASE WHEN AA.DSGNCRTR_CD = '149106' THEN AA.SCR END) AS COL_VAL6
               , SUM(CASE WHEN AA.DSGNCRTR_CD = '149107' THEN AA.SCR END) AS COL_VAL7
               , SUM(CASE WHEN AA.DSGNCRTR_CD = '149108' THEN AA.SCR END) AS COL_VAL8
               , SUM(CASE WHEN AA.DSGNCRTR_CD = '149109' THEN AA.SCR END) AS COL_VAL9
               , SUM(CASE WHEN AA.DSGNCRTR_CD = '149110' THEN AA.SCR END) AS COL_VAL10
            FROM
            (
                SELECT
                     SBMSNID
                   , DSGNCRTR_CD
                   , SUM(SCR) SCR
                FROM
                TB_ASS_SRNG_ANS
                GROUP BY SBMSNID, DSGNCRTR_CD
            ) AA
            GROUP BY SBMSNID
        ) C ON B.SBMSNID = C.SBMSNID
        WHERE
            A.PRGRMID = #{prgrmid}
        GROUP BY
            A.JDGSID
    </select>

    <!-- 심사위원심사 답변 등록 -->
    <insert id="insertJdgsSrngAns" parameterType="DsgnSrngFormVo" >
        /* AsgsysSrngDao.insertJdgsSrngAns */
        INSERT INTO
            TB_ASS_SRNG_ANS(
                SBMSNID
              , QITEMID
              , DSGNCRTR_CD
              , IDNTY_MTTR
              , CHKLST_SE_CD
              , SCR
              , ORDR
              , MDFCN_DT
              , MDFRID
              , REG_DT
              , RGTRID
        ) VALUES (
                #{sbmsnid}
              , #{qitemid}
              , #{dsgncrtrCd}
              , #{idntyMttr}
              , #{chklstSeCd}
              , #{scr}
              , #{ordr}
              , NOW()
              , #{user.userid}
              , NOW()
              , #{user.userid}
        )
    </insert>

    <!-- ASS_심사_양식_지정기준_순서_답변 등록 -->
    <insert id="insertJdgsSrngOrdrAns" parameterType="DsgnSrngFormVo" >
        /* AsgsysSrngDao.insertJdgsSrngOrdrAns */
        INSERT INTO TB_ASS_SRNG_FORM_DSGNCRTR_ORDR_ANS
        (
            SBMSNID
          , SE_CD
          , ORDR
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
        ) VALUES (
            #{sbmsnid}
          , #{qitemid}
          , #{ordr   }
          , NOW()
          , #{user.userid}
          , NOW()
          , #{user.userid}
        )
    </insert>

    <delete id="deleteJdgsSrngOrdrAns" parameterType="DsgnSrngFormVo" >
        DELETE FROM
            TB_ASS_SRNG_FORM_DSGNCRTR_ORDR_ANS
        WHERE SBMSNID = #{sbmsnid}
    </delete>

    <!-- 심사위원심사 답변 수정 -->
    <update id="updateJdgsSrngAns" parameterType="DsgnSrngFormVo" >
        UPDATE TB_ASS_SRNG_ANS SET
            DSGNCRTR_CD  = #{dsgncrtrCd}
          , IDNTY_MTTR   = #{idntyMttr}
          , CHKLST_SE_CD = #{chklstSeCd}
          , SCR          = #{scr}
          , ORDR         = #{ordr}
          , MDFCN_DT     = #{mdfcnDt}
          , MDFRID       = #{mdfrid}
        WHERE QITEMID    = #{qitemid}
    </update>

    <delete id="deleteJdgsSrngAns" parameterType="DsgnSrngFormVo" >
        DELETE FROM
            TB_ASS_SRNG_ANS
        WHERE SBMSNID = #{sbmsnid}
    </delete>

    <!-- 지원단심사 목록 조회 -->
    <select id="selectSprtgrpSrngList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectSprtgrpSrngList*/
        <include refid="PaginationMapper.header"/>
            SELECT
                A.PRGRMID
              , A.SPRTGRPID
              , B.PRGRM_NM        /* 프로그램명 */
              , B.INST_NM         /* 기관명 */
              , A.SRGN_STTS_CD    /* (지원단)심사 진행상태 */
              , A.REG_DT          /* 배정일 */
              , A.VST_DE          /* (현장점검) 방문일 */
              , A.VST_HR          /* (현장점검) 방문시 */
              , A.VST_MNT         /* (현장점검) 방문분 */
              , CONCAT(A.VST_DE , " " , A.VST_HR , ":" , A.VST_MNT) AS VST_DT
              , C.STY_YN          /* 숙박여부 */
              , A.SPLMNT_DMND_OPNN
              , A.SRNG_OPNN
              , A.MDFCN_DT
              , A.MDFRID
              , A.RGTRID
        FROM
            TB_ASS_SPRTGRP_SRNG A
        INNER JOIN
            TB_ASS_PRGRM B ON A.PRGRMID = B.PRGRMID
        LEFT OUTER JOIN
            TB_ASS_PRGRM_DSTNCTN C ON A.PRGRMID = C.PRGRMID
        WHERE 1=1
        <!-- 키워드.프로그램명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchPrgrmNm'">
            AND B.PRGRM_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 키워드.기관명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchInstNm'">
            AND B.INST_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- (지원단)진행상태  -->
        <if test="searchSttsCd != null and searchSttsCd != ''">
            AND A.SRGN_STTS_CD = #{searchSrgnSttsCd}
        </if>
        <!-- 배정일 검색시작일  -->
        <if test="searchRegStartDt != null and searchRegStartDt != ''">
            AND A.REG_DT >= #{searchRegStartDt}
        </if>
        <!-- 배정일 검색종료일  -->
        <if test="searchRegEndDt != null and searchRegEndDt != ''">
            AND A.REG_DT  <![CDATA[<]]> CAST(CONCAT(#{searchRegEndDt},' 23:59:59') AS DATETIME)
        </if>
        <!-- 현장점검지정일 시작일-->
        <if test="searchChckDsgnStartDt != null and searchChckDsgnStartDt != ''">
            AND A.VST_DE >= #{searchChckDsgnStartDt}
        </if>
        <!-- 현장점검지정일 종료일-->
        <if test="searchChckDsgnEndDt != null and searchChckDsgnEndDt != ''">
            AND A.VST_DE <![CDATA[<]]> CAST(CONCAT(#{searchChckDsgnEndDt},' 23:59:59') AS DATETIME)
        </if>
        <!-- 숙박여부-->
        <if test="searchStyYn!= null and searchStyYn != ''">
            AND C.STY_YN = #{searchStyYn}
        </if>
        <include refid="PaginationMapper.footer"/>
    </select>

    <!-- 지원단심사 상세 조회 -->
    <select id="selectSprtgrpSrng" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectSprtgrpSrng*/
        SELECT
                A.PRGRMID
              , A.SPRTGRPID
              , B.PRGRM_NM        /* 프로그램명 */
              , B.INST_NM         /* 기관명 */
              , A.SRGN_STTS_CD    /* (지원단)심사 진행상태 */
              , A.REG_DT          /* 배정일 */
              , C.STY_YN          /* 숙박여부 */
              , A.SPLMNT_DMND_OPNN
              , A.SRNG_OPNN
              , A.MDFCN_DT
              , A.MDFRID
              , A.RGTRID
              , C.STY_NIGHT
              , C.STY_DAYTM
              , C.OPER_FRM_CD
              , IFNULL(E.PRGRMID,'N') AS SFTY_MNG_YN
    --        , '첨부파일'
    --        , '증빙서류'
              , CONCAT(A.VST_DE , " " , A.VST_HR , ":" , A.VST_MNT) AS VST_DT
              , B.CHKLSTID
              , G.CHKLST_RSLT_CN
              , G.SBMSNID
              , G.SCR
              , H.SBMSNID    AS APLCNT_SBMSNID
        FROM
            TB_ASS_SPRTGRP_SRNG A
        LEFT OUTER JOIN
            TB_ASS_PRGRM B ON A.PRGRMID = B.PRGRMID
        LEFT OUTER JOIN
            TB_ASS_PRGRM_DSTNCTN C ON A.PRGRMID = C.PRGRMID
        LEFT OUTER JOIN
            TB_ASS_SFTY_MNG E ON A.PRGRMID = E.PRGRMID
        LEFT OUTER JOIN
            TB_ASS_SPRTGRP_SRNG F ON A.PRGRMID = F.PRGRMID
        LEFT OUTER JOIN
            TB_ASS_CHKLST_SBMSN G ON A.PRGRMID = G.PRGRMID AND F.SPRTGRPID = G.USERID
        LEFT OUTER JOIN
            TB_ASS_CHKLST_SBMSN H ON A.PRGRMID = H.PRGRMID AND B.APLCNTID = H.USERID /*자가진단*/
        WHERE 1=1
        AND  A.PRGRMID = #{prgrmid}
    </select>

    <!-- 지원단심사 체크리스트 조회 -->
    <select id="selectCheckList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        /* AsgsysSrngDao.selectCheckList*/
        WITH RECURSIVE CODE_CTE(LV1KEY, LV2KEY, TITLE, TREE_ORD, QITEMID) AS (
        SELECT
            IFNULL(UPPR_CD , '')  AS LV1KEY
          , CD AS LV2KEY
          , CONCAT(CD_NM) AS TITLE
          , CASE WHEN UPPR_CD  = 0 THEN 1 ELSE 2 END AS TREE_ORD
          , 0 AS QITEMID
        FROM
            TB_CMM_CD
        WHERE
            1 = 1
            AND CDGRPID != 'G0001'
            AND CDGRPID  = '140'
        UNION ALL
        SELECT
            IFNULL(UPPR_CD, '') AS LV1KEY
          , CD AS LV2KEY
          , CD_NM AS TITLE
          , 3 AS TREE_ORD
          , D.QITEMID AS QITEMID
        FROM (
            SELECT
                (SELECT UPPR_CD FROM TB_CMM_CD WHERE C.SE_CD = CD) AS UPPR_CD
               , C.SE_CD AS CD
               , C.CN AS CD_NM
               , B.ORDR AS ORD
               , C.QITEMID
            FROM
                TB_ASS_CHKLST_QITEM_MAPNG B
            LEFT OUTER JOIN
                TB_ASS_CHKLST_QITEM C ON (B.QITEMID = C.QITEMID)
            WHERE
                1 = 1
                AND B.CHKLSTID = #{chklstid}
                AND C.USE_YN = 'Y'
        ) D
        JOIN
            CODE_CTE C
        WHERE
            UPPR_CD = C.LV2KEY
        )
        SELECT
             A.LV1KEY
           , A.LV2KEY
           , A.TITLE    AS CN
           , A.TREE_ORD
           , A.QITEMID
           , B.ALTM
           , B.ORDR
           , B.SCR
           , B.APLCNT_SCR
        FROM
            CODE_CTE A
        LEFT OUTER JOIN (
            SELECT
                B.QITEMID
              , C.SE_CD
              , C.CN
              , C.IDNTY_MTTR
              , C.ALTM
              , C.USE_YN
              , C.MDFCN_DT
              , C.MDFRID
              , C.REG_DT
              , C.RGTRID
              , B.CHKLSTID
              , B.ORDR
              , D.SCR
              , E.SCR    AS APLCNT_SCR
            FROM
                TB_ASS_CHKLST_QITEM_MAPNG B
            LEFT OUTER JOIN
                TB_ASS_CHKLST_QITEM C ON (B.QITEMID = C.QITEMID)
            LEFT OUTER JOIN
            (
                SELECT
                    SBMSNID
                  , QITEMID
                  , SCR
                FROM
                    TB_ASS_CHKLST_ANS
                WHERE
                    SBMSNID = #{sbmsnid}
            ) D ON (C.QITEMID = D.QITEMID)
            LEFT OUTER JOIN
            (
                SELECT
                    SBMSNID
                  , QITEMID
                  , SCR
                FROM
                    TB_ASS_CHKLST_ANS
                WHERE
                    SBMSNID = #{aplcntSbmsnid}
            ) E ON (C.QITEMID = E.QITEMID)
            WHERE
                B.CHKLSTID = #{chklstid}
        ) B ON (A.QITEMID = B.QITEMID)
        ORDER BY LV2KEY, TREE_ORD, B.ORDR
    </select>

    <!-- 체크리스트제출 등록 -->
    <insert id="insertChklstSbmsn" parameterType="AsgsysSrngVo" >
        INSERT INTO
            TB_ASS_CHKLST_SBMSN
            (
                CHKLSTID
              , PRGRMID
              , USERID
              , SBMSN_DT
              , SBMSN_STTS_CD
              , USER_IP
              , SCR
              , CHKLST_RSLT_CN
              , MDFCN_DT
              , MDFRID
              , REG_DT
              , RGTRID
            ) VALUES(
                #{chklstid     }
              , #{prgrmid      }
              , #{userid}
              , #{sbmsnDt      }
              , #{sbmsnSttsCd  }
              , #{userIp       }
              , #{scr          }
              , #{chklstRsltCn }
              , NOW()
              , #{user.userid}
              , NOW()
              , #{user.userid}
            )
    </insert>

    <!-- 체크리스트 제출 수정 -->
    <update id="updateChklstSbmsn" parameterType="AsgsysSrngVo" >

        UPDATE
            TB_ASS_CHKLST_SBMSN
        SET
            SCR             = #{scr}
          , CHKLST_RSLT_CN  = #{chklstRsltCn}
          , USER_IP         = #{userIp}
          , SBMSN_STTS_CD   = #{sbmsnSttsCd}
          , SBMSN_DT        = NOW()
          , USERID          = #{userid}
          , MDFCN_DT        = NOW()
          , MDFRID          = #{user.userid}
        WHERE SBMSNID       = #{sbmsnid}

    </update>

   <!-- 체크리스트 순서 답변 등록 -->
    <insert id="insertChklstSeOrdrAnsList" parameterType="ChklstAnsVo" >
    INSERT INTO TB_ASS_CHKLST_SE_ORDR_ANS
    (
        SBMSNID
      , SE_CD
      , ORDR
      , MDFCN_DT
      , MDFRID
      , REG_DT
      , RGTRID
    ) VALUES (
        #{sbmsnid}
      , #{seCd}
      , #{ordr}
      , NOW()
      , #{user.userid}
      , NOW()
      , #{user.userid}
    )
    </insert>

    <!-- 체크리스트 순서 답변 삭제 -->
    <delete id="deleteChklstSeOrdrAnsList" parameterType="ChklstAnsVo" >
        DELETE FROM
            TB_ASS_CHKLST_SE_ORDR_ANS
        WHERE SBMSNID = #{sbmsnid}
    </delete>

    <!-- 지원단심사 수정 -->
    <update id="updateSprtgrpSrng" parameterType="AsgsysSrngVo" >
        /* AsgsysSrngDao.updateSprtgrpSrng */
        UPDATE
            TB_ASS_SPRTGRP_SRNG
        SET
            MDFCN_DT  = NOW()
          , MDFRID    = #{user.userid}
          <if test="srngOpnn!= null and srngOpnn != ''">
          , SRNG_OPNN = #{srngOpnn}
          </if>
          <if test="SRGN_STTS_CD!= null and srngOpnn != ''">
          , SRGN_STTS_CD = #{srgnSttsCd}
          </if>
        WHERE SPRTGRPID= #{sprtgrpid}

    </update>



    <select id="selectKeyCntChklstAns" parameterType="ChklstAnsVo" resultType="int">
        SELECT
            COUNT(QITEMID) AS KEY_CNT
        FROM
            TB_ASS_CHKLST_ANS
        WHERE 1=1
        AND SBMSNID = #{sbmsnid}
        AND QITEMID = #{qitemid}

    </select>
    <update id="updateChklstAns" parameterType="ChklstAnsVo" >
        UPDATE
            TB_ASS_CHKLST_ANS
        SET
            SE_CD         = #{seCd      }
          , CN            = #{cn        }
          , IDNTY_MTTR    = #{idntyMttr }
          , SCR           = #{scr       }
          , ORDR          = #{ordr      }
          , MDFCN_DT      = NOW()
          , MDFRID        = #{user.userid}
        WHERE
            SBMSNID       = #{sbmsnid   }
        AND QITEMID       = #{qitemid   }
    </update>

    <insert id="insertChklstAns" parameterType="ChklstAnsVo" >
    INSERT INTO
        TB_ASS_CHKLST_ANS (
            SBMSNID
          , QITEMID
          , SE_CD
          , CN
          , IDNTY_MTTR
          , SCR
          , ORDR
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
        ) VALUES(
            #{sbmsnid  }
          , #{qitemid  }
          , #{seCd     }
          , #{cn       }
          , #{idntyMttr}
          , #{scr      }
          , #{ordr     }
          , NOW()
          , #{user.userid}
          , NOW()
          , #{user.userid}
        )
    </insert>

    <!-- 지원단심사의견 수정 -->
    <update id="updateSprtgrpOpnn" parameterType="AsgsysSrngVo" >
        /* AsgsysSrngDao.updateSprtgrpOpnn */
        UPDATE
            TB_ASS_SPRTGRP_SRNG
        SET
            SRNG_OPNN = #{srngOpnn}
          , MDFCN_DT  = NOW()
          , MDFRID    = #{user.userid}
        WHERE SPRTGRPID= #{sprtgrpid}
    </update>

    <!-- 파일목록 조회 -->
    <select id="selectEvdncDcmntFileList" resultType="FileVo">
        SELECT
            B.FILEID
          , A.FILEGRPID
          , B.FILE_IDNTFC_KEY
          , B.FILE_PATH
          , B.SAVE_FILE_NM
          , B.ORGINL_FILE_NM
          , B.FILE_EXTSN
          , B.FILE_SIZE
          , B.ORD
        FROM
            TB_CMM_FILEGRP A
        LEFT OUTER JOIN
            TB_CMM_FILE B ON A.FILEGRPID = B.FILEGRPID
        WHERE 1=1
        AND   A.FILEGRPID = #{filegrpid}
    </select>

    <!-- 회원목록 조회 -->
    <select id="selectMbrList" resultType="MemberVo">
        <include refid="PaginationMapper.header"/>
        SELECT
            A.USERID
          , A.INSTID
          , A.ACNT
          , A.NM
          , A.MOBLPHON
          , A.EML
          , B.INST_NM
        FROM
        TB_CMM_USER A
        LEFT OUTER JOIN
            TB_CMM_INST B ON A.INSTID = B.INSTID
        WHERE 1=1
        <!-- 키워드.사용자 명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchUserNm'">
            AND A.NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 키워드.기관명 -->
        <if test="searchKeyword != null and searchKeyword != '' and searchType == 'searchInstNm'">
            AND A.INST_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <include refid="PaginationMapper.footer"/>
    </select>

    <!-- 담당자 변경 -->
    <update id="updateMbr" parameterType="AsgsysSrngVo" >
        /* AsgsysSrngDao.updateMbr*/
        UPDATE
            TB_ASS_PRGRM
        SET
            APLCNTID  = #{aplcntid}
          , APLCNT_NM = #{aplcntNm}
        WHERE
            PRGRMID   = #{prgrmid}
    </update>


    <!-- 담당자 심사위원 등록 -->
    <insert id="insertPicJdgs" parameterType="AsgsysSrngVo" >
        INSERT INTO
            TB_ASS_PRGRM_JDGS(
                PRGRMID
              , JDGSID
              , SRNG_STTS_CD
              , MDFCN_DT
              , MDFRID
              , REG_DT
              , RGTRID
        ) VALUES (
                #{prgrmid}
              , #{jdgsid}
              , #{srngSttsCd}
              , NOW()
              , #{user.userid}
              , NOW()
              , #{user.userid}
        )
    </insert>

    <!-- 담당자 지원단 등록 -->
    <insert id="insertPicSprtgrp" parameterType="AsgsysSrngVo" >
        INSERT INTO
            TB_ASS_SPRTGRP_SRNG(
                PRGRMID
              , SPRTGRPID
              , VST_DE
              , VST_HR
              , VST_MNT
              , SPLMNT_DMND_OPNN
              , SRNG_OPNN
              , SRGN_STTS_CD
              , MDFCN_DT
              , MDFRID
              , REG_DT
              , RGTRID
        ) VALUES (
                #{prgrmid}
              , #{sprtgrpid}
              , #{vstDe}
              , #{vstHr}
              , #{vstMnt}
              , #{splmntDmndOpnn}
              , #{srngOpnn}
              , #{srgnSttsCd}
              , NOW()
              , #{user.userid}
              , NOW()
              , #{user.userid}
        )
    </insert>

    <!-- 담당자 심사위원 삭제 -->
    <delete id="deletePicJdgs" parameterType="AsgsysSrngVo" >
        DELETE FROM
            TB_ASS_PRGRM_JDGS
        WHERE PRGRMID = #{prgrmid}
        AND   JDGSID = #{jdgsid}
    </delete>

    <!-- 담당자 지원단 삭제 -->
    <delete id="deletePicSprtgrp" parameterType="AsgsysSrngVo" >
        DELETE FROM
            TB_ASS_SPRTGRP_SRNG
        WHERE PRGRMID = #{prgrmid}
        AND   SPRTGRPID = #{sprtgrpid}
    </delete>


    <!-- 담당자(지원단)배정 목록 조회-->
    <select id="selectSprtgrpPicList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">

        <include refid="PaginationMapper.header"/>
        SELECT
            AA.USERID
          , ACNT
          , SEARCH_STR
          , NM
          , EML
          , TELNO
          , MOBLPHON
          , CRTFCT_NM
          , SBJCT_CD
          , RGN_CD
        FROM
            TB_ASS_EXPRT  AA
        INNER JOIN
            (
                SELECT
                    A.USERID
                  , B.ACNT
                  , B.NM
                  , CONCAT( B.ACNT," ",B.NM) AS SEARCH_STR
                  , B.EML
                  , B.TELNO
                  , B.MOBLPHON
                  , GROUP_CONCAT(C.CRTFCT_NM ) AS CRTFCT_NM
                  , D.SBJCT_CD
                  , E.RGN_CD
                FROM
                    TB_ASS_EXPRT A
                INNER JOIN
                    TB_CMM_USER B ON A.USERID = B.USERID
                LEFT OUTER JOIN    /*전문가 자격증*/
                    TB_ASS_EXPRT_CRTFCT C ON A.USERID = C.USERID
                LEFT OUTER JOIN    /* 전문가 주제? */
                    TB_ASS_EXPRT_SBJCT D ON A.USERID = D.USERID
                LEFT OUTER JOIN    /* 전문가 범위 */
                    TB_ASS_EXPRT_ACTVT_SCOPE E ON A.USERID = E.USERID
            ) BB ON AA.USERID = BB.USERID
        WHERE 1=1
        <!-- 키워드.계정 -->
        <if test="searchKeyword != null and searchKeyword != ''">
            AND SEARCH_STR LIKE CONCAT('%',#{searchKeyword},'%')
        </if>
        <!-- 키워드.자격증명 -->
        <if test="searchCrtfctNm != null and searchCrtfctNm != ''">
            AND CRTFCT_NM LIKE CONCAT('%',#{searchCrtfctNm},'%')
        </if>
        <!-- 전문분야(환경주제)  -->
        <if test="searchSbjctCd != null and searchSbjctCd != ''">
            AND SBJCT_CD = #{searchSbjctCd}
        </if>
        <!-- 활동가능지역 -->
        <if test="searchRgnCd != null and searchRgnCd != ''">
            AND RGN_CD = #{searchRgnCd}
        </if>

        <include refid="PaginationMapper.footer"/>
    </select>

    <!-- 담당자(심사위원) 목록 조회-->
    <select id="selectjdgsPicList" parameterType="AsgsysSrngVo" resultType="AsgsysSrngVo">
        <include refid="PaginationMapper.header"/>
        SELECT
            GRP_ID
          , GRP_NM
          , USE_YN
          , REG_DT
          , REG_EXPRT_CNT
          , USERID_GRP
          , USER_ACNT_GRP
          , USER_NM_GRP
          , USER_EML_GRP
          , USER_MOBLPHON_GRP
        FROM (
             SELECT
                 A.GRP_ID
               , A.GRP_NM
               , A.USE_YN
               , A.REG_DT
               , COUNT(B.USERID)          AS REG_EXPRT_CNT
               , GROUP_CONCAT(B.USERID)   AS USERID_GRP
               , GROUP_CONCAT(C.ACNT)     AS USER_ACNT_GRP
               , GROUP_CONCAT(C.NM)       AS USER_NM_GRP
               , GROUP_CONCAT(C.EML)      AS USER_EML_GRP
               , GROUP_CONCAT(C.MOBLPHON) AS USER_MOBLPHON_GRP
            FROM
                TB_ASS_EXPRT_GRP A
            LEFT OUTER JOIN
                TB_ASS_EXPRT_GRP_MAPNG B ON A.GRP_ID = B.GRP_ID
            LEFT OUTER JOIN
                TB_CMM_USER C ON B.USERID = C.USERID
            GROUP BY A.GRP_ID
            ) AA
        WHERE 1=1
        <!-- 키워드.그룹명-->
        <if test="searchKeyword != null and searchKeyword != ''">
            AND A.GRP_NM LIKE CONCAT('%',#{searchKeyword},'%')
        </if>

        <include refid="PaginationMapper.footer"/>

    </select>

</mapper>