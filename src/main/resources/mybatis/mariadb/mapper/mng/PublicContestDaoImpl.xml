<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
	SQL File Name : PublicContestDaoImpl.xml
	Description : 체험환경교육 지원사업 > 사업신청 관리 > 공모관리
-->
<mapper namespace="com.kbrainc.plum.mng.bizAply.pcntst.model.PublicContestDao">
    
    <!-- 신청관리 목록 검색 조건 -->
    <sql id="searchCondition">
        <if test="searchFldCd != null and searchFldCd != ''">
        AND A.FLD_CD = #{searchFldCd}
        </if>
        <if test="searchPcntstNm != null and searchPcntstNm != ''">
        AND A.PCNTST_NM LIKE CONCAT('%',#{searchPcntstNm},'%')
        </if>
        <if test="searchAplyBgngDe != null and searchAplyBgngDe != ''">
        <![CDATA[
        AND (DATE_FORMAT(A.APLY_BGNG_DT, '%Y-%m-%d') BETWEEN #{searchAplyBgngDe} AND #{searchAplyEndDe}
        OR DATE_FORMAT(A.APLY_END_DT, '%Y-%m-%d') BETWEEN #{searchAplyBgngDe} AND #{searchAplyEndDe})
        ]]>
        </if>
        <if test="searchBsnsBgngDe != null and searchBsnsBgngDe != ''">
        <![CDATA[
        AND (DATE_FORMAT(A.BSNS_BGNG_DE, '%Y-%m-%d') BETWEEN #{searchBsnsBgngDe} AND #{searchBsnsEndDe}
        OR DATE_FORMAT(A.BSNS_END_DE, '%Y-%m-%d') BETWEEN #{searchBsnsBgngDe} AND #{searchBsnsEndDe})
        ]]>
        </if>
        <if test="status != null and status != ''">
            <choose>
                <when test="status == 'before'">
                <![CDATA[
                AND NOW() < APLY_BGNG_DT
                ]]>
                </when>
                <when test="status == 'ing'">
                <![CDATA[
                AND NOW() >= APLY_BGNG_DT AND NOW() <= APLY_END_DT
                ]]>
                </when>
                <when test="status == 'end'">
                <![CDATA[
                AND NOW() > APLY_END_DT
                ]]>
                </when>
            </choose>            
        </if>
    </sql>
    
    <!-- 공모관리 목록 조회 -->
    <select id="selectContestList" parameterType="PublicContestVo" resultType="PublicContestVo">
        /* PublicContestDao.selectContestList */
        <include refid="PaginationMapper.header"/>
        SELECT
            PCNTSTID
            , FLD_CD
            , B.CD_NM AS FLD_NM
            , PCNTST_NM
            , APLY_BGNG_DT
            , APLY_END_DT
            , CONCAT(DATE_FORMAT(APLY_BGNG_DT, '%Y-%m-%d %H:%i'), ' - ', DATE_FORMAT(APLY_END_DT, '%Y-%m-%d %H:%i')) AS APLY_DT
            <![CDATA[
            , CASE WHEN NOW() < APLY_BGNG_DT THEN '진행전' 
                WHEN NOW() >= APLY_BGNG_DT AND  NOW() <= APLY_END_DT THEN '진행중'
                WHEN NOW() > APLY_END_DT THEN '마감'
                ELSE ''
                END AS STATUS
            ]]>
            , TRGT_CD
            , C.CD_NM AS TRGT_NM
            , BSNS_BGNG_DE
            , BSNS_END_DE
            , CONCAT(BSNS_BGNG_DE, ' - ', BSNS_END_DE) AS BSNS_DE
            , MDL_REPORT_YN
            , CNSLTNG_USE_CD
            , CNSLTNG_OPER_CD
            , D.CD_NM AS CNSLTNG_USE_NM
            , WCT_DELVRY_CNT
            , CASE WHEN WCT_DELVRY_CNT = 1 THEN 'N' ELSE 'Y' END AS WCT_DELVRY_CNT_YN  
            , ONLN_SRNG_TYPE_CD
            , E.CD_NM AS ONLN_SRNG_TYPE_NM 
            , BSNS_CN
            , SRNG_FORMID_FIRST
            , SRNG_FORMID_SCND
            , SRNG_BGNG_DT
            , SRNG_END_DT
            , DELVRY_APLY_PRSNTN_BGNG_DT
            , DELVRY_APLY_PRSNTN_END_DT
<!--             , DELVRY_APLY_BGNG_DT_FIRST -->
<!--             , DELVRY_APLY_END_DT_FIRST -->
<!--             , DELVRY_APLY_BGNG_DT_SCND -->
<!--             , DELVRY_APLY_END_DT_SCND -->
<!--             , DELVRY_CFMTN_PRSNTN_BGNG_DT -->
<!--             , DELVRY_CFMTN_PRSNTN_END_DT -->
<!--             , CPTAL_EXCUT_BGNG_DT_FIRST -->
<!--             , CPTAL_EXCUT_END_DT_FIRST -->
<!--             , CPTAL_EXCUT_BGNG_DT_SCND -->
<!--             , CPTAL_EXCUT_END_DT_SCND -->
            , CNSLTNG_APLY_BGNG_DT
            , CNSLTNG_APLY_END_DT
            , MDL_REPORT_BGNG_DT
            , MDL_REPORT_END_DT
            , RSLT_REPORT_BGNG_DT
            , RSLT_REPORT_END_DT
            , EXCCLC_REPORT_BGNG_DT
            , EXCCLC_REPORT_END_DT
            , FILEGRPID
            , RT_USE_YN
            , TOP_SCR_EXCL_YN
            , LWET_SCR_EXCL_YN
            , LWET_CRTR_SCR_USE_YN_FIRST
            , LWET_CRTR_SCR_FIRST
            , LWET_CRTR_SCR_USE_YN_SCND
            , LWET_CRTR_SCR_SCND
            , NOPE_LMT_USE_YN
            , NOPE_LMT
            , SRNG_RT_USE_YN
            , RT_FIRST
            , RT_SCND
            , A.USE_YN
            , A.MDFCN_DT
            , A.MDFRID
            , A.REG_DT
            , A.RGTRID
        FROM    
            TB_SPB_PCNTST A
            LEFT OUTER JOIN TB_CMM_CD B ON A.FLD_CD = B.CD
            LEFT OUTER JOIN TB_CMM_CD C ON A.TRGT_CD = C.CD
            LEFT OUTER JOIN TB_CMM_CD D ON A.CNSLTNG_USE_CD = D.CD
            LEFT OUTER JOIN TB_CMM_CD E ON A.ONLN_SRNG_TYPE_CD = E.CD
        WHERE 
            1 = 1
            <include refid="searchCondition"/>
            <if test="pcntstid != null and pcntstid != ''">
            AND A.PCNTSTID = #{pcntstid}
            </if>
        <include refid="PaginationMapper.footer"/>
    </select>
    
    <!-- 교부정보 조회 -->
    <select id="selectDelevery" parameterType="PublicContestVo" resultType="PublicContestVo">
        /* PublicContestDao.selectDelevery */
        SELECT
            DELVRYID
            , PCNTSTID
            , DELVRY_APLY_BGNG_DT
            , DELVRY_APLY_END_DT
            , DELVRY_CFMTN_PRSNTN_BGNG_DT
            , DELVRY_CFMTN_PRSNTN_END_DT
            , CPTAL_EXCUT_BGNG_DT
            , CPTAL_EXCUT_END_DT
            , CYCL
        FROM
            TB_SPB_DELVRY
        WHERE PCNTSTID = #{pcntstid}
        ORDER BY CYCL
    </select>
    
    <!--  교부 정보 등록 -->
    <insert id="insertDelevery" parameterType="PublicContestVo">
        /* PublicContestDao.insertDelevery */
        INSERT INTO TB_SPB_DELVRY (
            PCNTSTID
            , DELVRY_APLY_BGNG_DT
            , DELVRY_APLY_END_DT
            , DELVRY_CFMTN_PRSNTN_BGNG_DT
            , DELVRY_CFMTN_PRSNTN_END_DT
            , CPTAL_EXCUT_BGNG_DT
            , CPTAL_EXCUT_END_DT
            , CYCL
            , MDFCN_DT
            , MDFRID
            , REG_DT
            , RGTRID
        ) VALUES (
            #{pcntstid}
            , #{delvryAplyBgngDt}
            , #{delvryAplyEndDt}
            , #{delvryCfmtnPrsntnBgngDt}
            , #{delvryCfmtnPrsntnEndDt}
            , #{cptalExcutBgngDt}
            , #{cptalExcutEndDt}
            , #{cycl}
            , NOW()
            , #{user.userid}
            , NOW()
            , #{user.userid}
        ) 
    </insert>
    
    <delete id="deleteDelevery" parameterType="PublicContestVo">
        /* PublicContestDao.deleteDelevery */
        DELETE FROM TB_SPB_DELVRY WHERE PCNTSTID = #{pcntstid}
    </delete>
    
    <!-- 교부 정보 수정 -->
    <update id="updateDelevery" parameterType="PublicContestVo">
        /* PublicContestDao.updateDelevery */
        UPDATE TB_SPB_DELVRY SET
            DELVRY_APLY_BGNG_DT = #{delvryAplyBgngDt}
            , DELVRY_APLY_END_DT = #{delvryAplyEndDt}
            , DELVRY_CFMTN_PRSNTN_BGNG_DT = #{delvryCfmtnPrsntnBgngDt}
            , DELVRY_CFMTN_PRSNTN_END_DT = #{delvryCfmtnPrsntnEndDt}
            , CPTAL_EXCUT_BGNG_DT = #{delvryCfmtnPrsntnEndDt}
            , CPTAL_EXCUT_END_DT = #{cptalExcutEndDt}
            , MDFCN_DT = NOW()
            , MDFRID = #{user.userid}
        WHERE DELVRYID = #{delvryid}
    </update>
    
    <!-- 담당자 배정 조회 -->
    <select id="selectMngList" parameterType="PublicContestMngGrpVo" resultType="PublicContestMngGrpVo">
        /* PublicContestDao.selectMngList */
        SELECT 
            PCNTSTID
            , JDGSID
            , CYCL
            , A.MDFCN_DT
            , A.MDFRID
            , A.REG_DT
            , A.RGTRID
            , B.USERID 
            , B.NM
            , B.MOBLPHON
            , B.EML
            , B.ACNT
        FROM TB_SPB_JDGS A
        INNER JOIN TB_CMM_USER B ON A.JDGSID = B.USERID
        WHERE PCNTSTID = #{pcntstid}
        AND CYCL = #{cycl}
    </select>
    
    <!-- 심사표 조회 -->
    <select id="selectEvalSheetList" parameterType="PublicContestVo" resultType="org.egovframe.rte.psl.dataaccess.util.EgovMap">
        /* PublicContestDao.selectEvalSheetList */
        SELECT 
            FORMID AS SRNG_FORM_ID
            , FORM_NM AS SRNG_FORM_NM
        FROM TB_SPB_SRNG_FORM
    </select>
    
    <!-- 심사배분율 조회 -->
    <select id="selectGradeList" parameterType="GradeVo" resultType="GradeVo">
        /* PublicContestDao.selectGradeList */
        SELECT
            STNGID
            , PCNTSTID
            , GRD_NM
            , RT
            , RKNG
            , MDFCN_DT
            , MDFRID
            , REG_DT
            , RGTRID
        FROM
            TB_SPB_SRNG_GRD_STNG
        WHERE PCNTSTID = #{pcntstid}
        ORDER BY GRD_NM
    </select>
    
    <!-- 심사배분율 등록 -->
    <insert id="insertGrade" parameterType="GradeVo">
        /* PublicContestDao.insertGrade */
        INSERT INTO TB_SPB_SRNG_GRD_STNG (
            PCNTSTID
            , GRD_NM
            , RT
            , RKNG
            , MDFCN_DT
            , MDFRID
            , REG_DT
            , RGTRID
        ) VALUES (
            #{pcntstid}
            , #{grdNm}
            , #{rt}
            , #{rkng}
            , NOW()
            , #{user.userid}
            , NOW()
            , #{user.userid}
        ) 
    </insert>
    
    <!-- 심사배분율 삭제 -->
    <delete id="deleteGrade" parameterType="GradeVo">
        /* PublicContestDao.deleteGrade */
        DELETE FROM TB_SPB_SRNG_GRD_STNG
        WHERE PCNTSTID = #{pcntstid}
    </delete>
    
    <!-- 공모관리 등록 -->
    <insert id="insertContest" parameterType="PublicContestVo" useGeneratedKeys="true" keyProperty="pcntstid">
        /* PublicContestDao.insertContest */
        INSERT INTO 
            TB_SPB_PCNTST (
                PCNTSTID
                , FLD_CD
                , PCNTST_NM
                , APLY_BGNG_DT
                , APLY_END_DT
                , TRGT_CD
                , BSNS_BGNG_DE
                , BSNS_END_DE
                , MDL_REPORT_YN
                , CNSLTNG_USE_CD
                , WCT_DELVRY_CNT
                , ONLN_SRNG_TYPE_CD
                , BSNS_CN
                , SRNG_FORMID_FIRST
                , SRNG_FORMID_SCND
                , SRNG_BGNG_DT
                , SRNG_END_DT
                , DELVRY_APLY_PRSNTN_BGNG_DT
                , DELVRY_APLY_PRSNTN_END_DT
<!--                 , DELVRY_APLY_BGNG_DT_FIRST -->
<!--                 , DELVRY_APLY_END_DT_FIRST -->
<!--                 , DELVRY_APLY_BGNG_DT_SCND -->
<!--                 , DELVRY_APLY_END_DT_SCND -->
<!--                 , DELVRY_CFMTN_PRSNTN_BGNG_DT -->
<!--                 , DELVRY_CFMTN_PRSNTN_END_DT -->
<!--                 , CPTAL_EXCUT_BGNG_DT_FIRST -->
<!--                 , CPTAL_EXCUT_END_DT_FIRST -->
<!--                 , CPTAL_EXCUT_BGNG_DT_SCND -->
<!--                 , CPTAL_EXCUT_END_DT_SCND -->
                , CNSLTNG_APLY_BGNG_DT
                , CNSLTNG_APLY_END_DT
                , MDL_REPORT_BGNG_DT
                , MDL_REPORT_END_DT
                , RSLT_REPORT_BGNG_DT
                , RSLT_REPORT_END_DT
                , EXCCLC_REPORT_BGNG_DT
                , EXCCLC_REPORT_END_DT
                , FILEGRPID
                , RT_USE_YN
                , TOP_SCR_EXCL_YN
                , LWET_SCR_EXCL_YN
                , LWET_CRTR_SCR_USE_YN_FIRST
                , LWET_CRTR_SCR_FIRST
                , LWET_CRTR_SCR_USE_YN_SCND
                , LWET_CRTR_SCR_SCND
                , NOPE_LMT_USE_YN
                , NOPE_LMT
                , SRNG_RT_USE_YN
                , RT_FIRST
                , RT_SCND
                , USE_YN
                , MDFCN_DT
                , MDFRID
                , REG_DT
                , RGTRID
                , CNSLTNG_OPER_CD
            ) VALUES ( 
                #{pcntstid}
                , #{fldCd}
                , #{pcntstNm}
                , NULLIF(#{aplyBgngDt}, '')
                , NULLIF(#{aplyEndDt}, '')
                , #{trgtCd}
                , #{bsnsBgngDe}
                , #{bsnsEndDe}
                , #{mdlReportYn}
                , #{cnsltngUseCd}
                , #{wctDelvryCnt}
                , #{onlnSrngTypeCd}
                , #{bsnsCn}
                , #{srngFormidFirst}
                , #{srngFormidScnd}
                , NULLIF(#{srngBgngDt}, '')
                , NULLIF(#{srngEndDt}, '')
                , NULLIF(#{delvryAplyPrsntnBgngDt}, '')
                , NULLIF(#{delvryAplyPrsntnEndDt}, '')
<!--                 , NULLIF(#{delvryAplyBgngDtFirst}, '') -->
<!--                 , NULLIF(#{delvryAplyEndDtFirst}, '') -->
<!--                 , NULLIF(#{delvryAplyBgngDtScnd}, '') -->
<!--                 , NULLIF(#{delvryAplyEndDtScnd}, '') -->
<!--                 , NULLIF(#{delvryCfmtnPrsntnBgngDt}, '') -->
<!--                 , NULLIF(#{delvryCfmtnPrsntnEndDt}, '') -->
<!--                 , NULLIF(#{cptalExcutBgngDtFirst}, '') -->
<!--                 , NULLIF(#{cptalExcutEndDtFirst}, '') -->
<!--                 , NULLIF(#{cptalExcutBgngDtScnd}, '') -->
<!--                 , NULLIF(#{cptalExcutEndDtScnd}, '') -->
                , NULLIF(#{mdlReportBgngDt}, '')
                , NULLIF(#{mdlReportEndDt}, '')
                , NULLIF(#{rsltReportBgngDt}, '')
                , NULLIF(#{rsltReportEndDt}, '')
                , NULLIF(#{excclcReportBgngDt}, '')
                , NULLIF(#{excclcReportEndDt}, '')
                , #{filegrpid}
                , #{rtUseYn}
                , #{topScrExclYn}
                , #{lwetScrExclYn}
                , #{lwetCrtrScrUseYnFirst}
                , #{lwetCrtrScrFirst}
                , #{lwetCrtrScrUseYnScnd}
                , #{lwetCrtrScrScnd}
                , #{nopeLmtUseYn}
                , #{nopeLmt}
                , #{srngRtUseYn}
                , #{rtFirst}
                , #{rtScnd}
                , #{useYn}
                , NOW()
                , #{user.userid}
                , NOW()
                , #{user.userid}
                , #{cnsltngOperCd}
            )
    </insert>
    
    <!-- 담당자 등록 -->
    <insert id="insertMng" parameterType="PublicContestMngGrpVo">
        /* PublicContestDao.insertMng */
        INSERT INTO TB_SPB_JDGS (
            PCNTSTID
            , JDGSID
            , CYCL
            , MDFCN_DT
            , MDFRID
            , REG_DT
            , RGTRID
        ) VALUES 
        <foreach item="item" collection="pcntstids" separator=",">
        ( 
            #{pcntstid}
            , #{item}
            , #{cycl}
            , NOW()
            , #{user.userid}
            , NOW()
            , #{user.userid}
        )
        </foreach>
    </insert>
    
    <!-- 담당자 삭제 -->
    <delete id="deleteMng" parameterType="PublicContestMngGrpVo">
        /* PublicContestDao.deleteMng */
        DELETE FROM TB_SPB_JDGS
        WHERE PCNTSTID = #{pcntstid}
        AND CYCL = #{cycl}
    </delete>
    
    <!-- 공모관리 수정 -->
    <update id="updateContest" parameterType="PublicContestVo">
        /* PublicContestDao.updateContest */
        UPDATE TB_SPB_PCNTST SET 
            FLD_CD = #{fldCd}
            , PCNTST_NM = #{pcntstNm}
            , APLY_BGNG_DT = NULLIF(#{aplyBgngDt}, '')
            , APLY_END_DT = NULLIF(#{aplyEndDt}, '')
            , TRGT_CD = #{trgtCd}
            , BSNS_BGNG_DE = #{bsnsBgngDe}
            , BSNS_END_DE = #{bsnsEndDe}
            , MDL_REPORT_YN = #{mdlReportYn}
            , CNSLTNG_USE_CD = #{cnsltngUseCd}
            , WCT_DELVRY_CNT = #{wctDelvryCnt}
            , ONLN_SRNG_TYPE_CD = #{onlnSrngTypeCd}
            , BSNS_CN = #{bsnsCn}
            , SRNG_FORMID_FIRST = #{srngFormidFirst}
            , SRNG_FORMID_SCND = #{srngFormidScnd}
            , SRNG_BGNG_DT = NULLIF(#{srngBgngDt}, '')
            , SRNG_END_DT = NULLIF(#{srngEndDt}, '')
            , DELVRY_APLY_PRSNTN_BGNG_DT = NULLIF(#{delvryAplyPrsntnBgngDt}, '')
            , DELVRY_APLY_PRSNTN_END_DT = NULLIF(#{delvryAplyPrsntnEndDt}, '')
<!--             , DELVRY_APLY_BGNG_DT_FIRST = NULLIF(#{delvryAplyBgngDtFirst}, '') -->
<!--             , DELVRY_APLY_END_DT_FIRST = NULLIF(#{delvryAplyEndDtFirst}, '') -->
<!--             , DELVRY_APLY_BGNG_DT_SCND = NULLIF(#{delvryAplyBgngDtScnd}, '') -->
<!--             , DELVRY_APLY_END_DT_SCND = NULLIF(#{delvryAplyEndDtScnd}, '') -->
<!--             , DELVRY_CFMTN_PRSNTN_BGNG_DT = NULLIF(#{delvryCfmtnPrsntnBgngDt}, '') -->
<!--             , DELVRY_CFMTN_PRSNTN_END_DT = NULLIF(#{delvryCfmtnPrsntnEndDt}, '') -->
<!--             , CPTAL_EXCUT_BGNG_DT_FIRST = NULLIF(#{cptalExcutBgngDtFirst}, '') -->
<!--             , CPTAL_EXCUT_END_DT_FIRST = NULLIF(#{cptalExcutEndDtFirst}, '') -->
<!--             , CPTAL_EXCUT_BGNG_DT_SCND = NULLIF(#{cptalExcutBgngDtScnd}, '') -->
<!--             , CPTAL_EXCUT_END_DT_SCND = NULLIF(#{cptalExcutEndDtScnd}, '') -->
            , CNSLTNG_APLY_BGNG_DT = NULLIF(#{cnsltngAplyBgngDt}, '')
            , CNSLTNG_APLY_END_DT = NULLIF(#{cnsltngAplyEndDt}, '')
            , MDL_REPORT_BGNG_DT = NULLIF(#{mdlReportBgngDt}, '')
            , MDL_REPORT_END_DT = NULLIF(#{mdlReportEndDt}, '')
            , RSLT_REPORT_BGNG_DT = NULLIF(#{rsltReportBgngDt}, '')
            , RSLT_REPORT_END_DT = NULLIF(#{rsltReportEndDt}, '')
            , EXCCLC_REPORT_BGNG_DT = NULLIF(#{excclcReportBgngDt}, '')
            , EXCCLC_REPORT_END_DT = NULLIF(#{excclcReportEndDt}, '')
            , FILEGRPID = #{filegrpid}
            , RT_USE_YN = #{rtUseYn}
            , TOP_SCR_EXCL_YN = #{topScrExclYn}
            , LWET_SCR_EXCL_YN = #{lwetScrExclYn}
            , LWET_CRTR_SCR_USE_YN_FIRST = #{lwetCrtrScrUseYnFirst}
            <if test="lwetCrtrScrFirst != null and lwetCrtrScrFirst != ''">
            , LWET_CRTR_SCR_FIRST = #{lwetCrtrScrFirst}
            </if>
            , LWET_CRTR_SCR_USE_YN_SCND = #{lwetCrtrScrUseYnScnd}
            <if test="lwetCrtrScrScnd != null and lwetCrtrScrScnd != ''">
            , LWET_CRTR_SCR_SCND = #{lwetCrtrScrScnd}
            </if>
            , NOPE_LMT_USE_YN = #{nopeLmtUseYn}
            , NOPE_LMT = #{nopeLmt}
            , SRNG_RT_USE_YN = #{srngRtUseYn}
            <if test="rtFirst != null and rtFirst != ''">
            , RT_FIRST = #{rtFirst}
            </if>
            <if test="rtScnd != null and rtScnd != ''">
            , RT_SCND = #{rtScnd}
            </if>
            , USE_YN = #{useYn}
            , MDFCN_DT = NOW()
            , MDFRID = #{user.userid}
            , CNSLTNG_OPER_CD = #{cnsltngOperCd}
        WHERE PCNTSTID = #{pcntstid}
    </update>
    
    <!-- 엑셀다운로드 -->
    <select id="publicContestListExcelDownload" parameterType="PublicContestVo" resultType="PublicContestVo">
        /* PublicContestDao.publicContestListExcelDownload */
        SELECT
            B.CD_NM AS FLD_NM
            , PCNTST_NM
            , CONCAT(DATE_FORMAT(APLY_BGNG_DT, '%Y-%m-%d %H:%i'), ' - ', DATE_FORMAT(APLY_END_DT, '%Y-%m-%d %H:%i')) AS APLY_DT
            <![CDATA[
            , CASE WHEN NOW() < APLY_BGNG_DT THEN '진행전' 
                WHEN NOW() >= APLY_BGNG_DT AND  NOW() <= APLY_END_DT THEN '진행중'
                WHEN NOW() > APLY_END_DT THEN '마감'
                ELSE ''
                END AS STATUS
            ]]>
            , C.CD_NM AS TRGT_NM
            , CONCAT(DATE_FORMAT(BSNS_BGNG_DE, '%Y-%m-%d %H:%i'), ' - ', DATE_FORMAT(BSNS_END_DE, '%Y-%m-%d %H:%i')) AS BSNS_DE
            , CONCAT(DATE_FORMAT(SRNG_BGNG_DT, '%Y-%m-%d %H:%i'), ' - ', DATE_FORMAT(SRNG_END_DT, '%Y-%m-%d %H:%i')) AS SRNG_DT   
            , (SELECT CONCAT(DATE_FORMAT(TSD.DELVRY_APLY_BGNG_DT, '%Y-%m-%d %H:%i'), ' - ', DATE_FORMAT(TSD.DELVRY_APLY_END_DT, '%Y-%m-%d %H:%i')) FROM TB_SPB_DELVRY TSD WHERE A.PCNTSTID = TSD.PCNTSTID AND CYCL = 1) AS DELVRY_APLY_DT_FIRST   
            , (SELECT CONCAT(DATE_FORMAT(TSD.DELVRY_APLY_BGNG_DT, '%Y-%m-%d %H:%i'), ' - ', DATE_FORMAT(DELVRY_APLY_END_DT, '%Y-%m-%d %H:%i')) FROM TB_SPB_DELVRY TSD WHERE A.PCNTSTID = TSD.PCNTSTID AND CYCL = 2) AS DELVRY_APLY_DT_SCND   
            , (SELECT CONCAT(DATE_FORMAT(TSD.DELVRY_CFMTN_PRSNTN_BGNG_DT, '%Y-%m-%d %H:%i'), ' - ', DATE_FORMAT(TSD.DELVRY_CFMTN_PRSNTN_END_DT, '%Y-%m-%d %H:%i')) FROM TB_SPB_DELVRY TSD WHERE A.PCNTSTID = TSD.PCNTSTID AND CYCL = 1) AS DELVRY_CFMTN_PRSNTN_DT
        --     , (SELECT CONCAT(DATE_FORMAT(TSD.DELVRY_CFMTN_PRSNTN_BGNG_DT, '%Y-%m-%d %H:%i'), ' - ', DATE_FORMAT(TSD.DELVRY_CFMTN_PRSNTN_END_DT, '%Y-%m-%d %H:%i')) FROM TB_SPB_DELVRY TSD WHERE A.PCNTSTID = TSD.PCNTSTID AND CYCL = 2) AS DELVRY_CFMTN_PRSNTN_DT
            , (SELECT CONCAT(DATE_FORMAT(TSD.CPTAL_EXCUT_BGNG_DT, '%Y-%m-%d %H:%i'), ' - ', DATE_FORMAT(CPTAL_EXCUT_END_DT, '%Y-%m-%d %H:%i')) FROM TB_SPB_DELVRY TSD WHERE A.PCNTSTID = TSD.PCNTSTID AND CYCL = 1) AS CPTAL_EXCUT_DT_FIRST
            , (SELECT CONCAT(DATE_FORMAT(TSD.CPTAL_EXCUT_BGNG_DT, '%Y-%m-%d %H:%i'), ' - ', DATE_FORMAT(CPTAL_EXCUT_END_DT, '%Y-%m-%d %H:%i')) FROM TB_SPB_DELVRY TSD WHERE A.PCNTSTID = TSD.PCNTSTID AND CYCL = 2) AS CPTAL_EXCUT_DT_SCND
            , CONCAT(DATE_FORMAT(MDL_REPORT_BGNG_DT, '%Y-%m-%d %H:%i'), ' - ', DATE_FORMAT(MDL_REPORT_END_DT, '%Y-%m-%d %H:%i')) AS MDL_REPORT_DT
            , CONCAT(DATE_FORMAT(RSLT_REPORT_BGNG_DT, '%Y-%m-%d %H:%i'), ' - ', DATE_FORMAT(RSLT_REPORT_END_DT, '%Y-%m-%d %H:%i')) AS RSLT_REPORT_DT
            , CONCAT(DATE_FORMAT(EXCCLC_REPORT_BGNG_DT, '%Y-%m-%d %H:%i'), ' - ', DATE_FORMAT(EXCCLC_REPORT_END_DT, '%Y-%m-%d %H:%i')) AS EXCCLC_REPORT_DT
            , DATE_FORMAT(A.REG_DT, '%Y-%m-%d %H:%i') AS REG_DT
        FROM    
            TB_SPB_PCNTST A
            LEFT OUTER JOIN TB_CMM_CD B ON A.FLD_CD = B.CD
            LEFT OUTER JOIN TB_CMM_CD C ON A.TRGT_CD = C.CD
            LEFT OUTER JOIN TB_CMM_CD D ON A.CNSLTNG_USE_CD = D.CD
            LEFT OUTER JOIN TB_CMM_CD E ON A.ONLN_SRNG_TYPE_CD = E.CD
        WHERE 
            1 = 1
            <include refid="searchCondition"/>
    </select>
    
    <!-- 심사위원 그룹 조회 -->
    <select id="selectMngGrpList" parameterType="PublicContestMngGrpVo" resultType="PublicContestMngGrpVo">
        /* PublicContestDao.selectMngGrpList */
        <include refid="PaginationMapper.header"/>
        SELECT 
            A.GRPID
            , A.GRP_NM
            , A.REG_DT
            , COUNT(B.USERID) AS EXPRT_CNT
            , group_concat(C.NM) AS GRP_EXPRT_NM
            , group_concat(C.USERID) AS GRP_EXPRT_IDS
            , group_concat(concat(C.USERID,',',C.NM,'(',C.ACNT,') | ',C.EML,' | ',C.MOBLPHON) SEPARATOR ':' ) AS GRP_EXPRT_STR
        FROM TB_SPB_JDGS_GRP A
        LEFT OUTER JOIN TB_SPB_JDGS_GRP_MAPNG B ON A.GRPID = B.GRPID
        LEFT OUTER JOIN TB_CMM_USER C ON B.USERID = C.USERID
        WHERE 1 = 1
        <if test="searchGrpNm != null and searchGrpNm != '' ">
        AND A.GRP_NM LIKE CONCAT('%',#{searchGrpNm},'%')
        </if>
        GROUP BY A.GRPID
        <include refid="PaginationMapper.footer"/>
    </select>

</mapper>