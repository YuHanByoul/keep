<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SQL File Name : MapDaoImpl.xml
    Description : 지도기반데이터관리
-->
<mapper namespace="com.kbrainc.plum.mng.map.model.MapDao">

    <!-- 지도기반 데이터 목록 조회 -->
    <select id="selectMapList" parameterType="MapVo" resultType="MapVo">
        <include refid="PaginationMapper.header"/>
        SELECT
             A.RESRCEID
           , A.RESRCE_SE_CD
           , CD.CD_NM    AS RESRCE_SE_CD_NM    /*자원_구분_코드*/
           , A.CTPRVN_CD
           , CTPRVN.CTPRVN_NM
           , A.RESRCE_NM
           , A.USE_YN
           , A.INST_NM
           , A.EDU_TRGT
           , A.EDU_NOPE
           , A.EDU_SBJCT
           , A.HMPG
           , A.ADDR
           , A.ADDR_DTL
           , A.MDFCN_DT
           , A.MDFRID
           , A.REG_DT
           , A.RGTRID
           , CONCAT( USR.NM, '(', USR.ACNT ,')' ) AS RGTR_NM
        FROM
            TB_CMM_MAP_INDICT_RESRCE A
        LEFT OUTER JOIN
            TB_CMM_ADDR_CTPRVN CTPRVN ON A.CTPRVN_CD = CTPRVN.CTPRVN_CD
        LEFT OUTER JOIN
            TB_CMM_USER USR ON A.RGTRID=USR.USERID
        LEFT OUTER JOIN
            TB_CMM_CD CD ON A.RESRCE_SE_CD = CD.CD
        WHERE 1=1
       <!-- 구분 -->
        <if test="searchResrceSeCd!= null and searchResrceSeCd != ''">
            AND A.RESRCE_SE_CD = #{searchResrceSeCd}
        </if>
        <!-- 지역 -->
        <if test="searchCtprvnCd != null and searchCtprvnCd != ''">
            AND A.CTPRVN_CD = #{searchCtprvnCd}
        </if>
        <!-- 환경자원명  -->
        <if test="searchResrceNm != null and searchResrceNm != ''">
            AND A.RESRCE_NM LIKE CONCAT('%',#{searchResrceNm},'%')
        </if>
        <!-- 사용여부  -->
        <if test="searchUseYn != null and searchUseYn != ''">
            AND A.USE_YN = #{searchUseYn}
        </if>
        <include refid="PaginationMapper.footer"/>
    </select>

    <insert id="insertMap" parameterType="MapVo" >
        /* mapDao.insertMap*/
        INSERT INTO
            TB_CMM_MAP_INDICT_RESRCE
        (
            RESRCE_NM
          , INST_NM
          , RESRCE_SE_CD
          , TELNO
          , EDU_TRGT
          , EDU_NOPE
          , EDU_SBJCT
          , HMPG
          , ADDR
          , ADDR_DTL
          , CTPRVN_CD
          , USE_YN
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
        ) VALUES
        (
            #{resrceNm}     /*자원이름*/
          , #{instNm}       /*기관이름*/
          , #{resrceSeCd}
          , #{telno}
          , #{eduTrgt}      /*교육대상*/
          , #{eduNope}      /*교육인원수*/
          , #{eduSbjct}     /*교육주제*/
          , #{hmpg}         /*홈페이지*/
          , #{addr}         /*주소*/
          , #{addrDtl}      /*주소상세*/
          , #{ctprvnCd}     /*시도코드*/
          , #{useYn}        /*사용여부*/
          , NOW()
          , #{user.userid}
          , NOW()
          , #{user.userid}
        )
    </insert>

    <!-- 지역 리스트 조회 -->
    <select id="selectCtprvnList" parameterType="mapVo" resultType="mapVo">
        /* MapDao.selectCtprvnList */
        SELECT
            CTPRVN_CD
          , CTPRVN_NM
          FROM
            TB_CMM_ADDR_CTPRVN
         ORDER BY CTPRVN_CD ASC
    </select>

    <select id="selectMap" parameterType="mapVo" resultType="mapVo">
        /* MapDao.selectMap */
        SELECT
             A.RESRCEID        /*자원아이디*/
           , A.RESRCE_SE_CD    /*자원_구분_코드*/
           , CD.CD_NM    AS RESRCE_SE_CD_NM    /*자원_구분_코드*/
           , A.RESRCE_NM       /*자원_이름*/
           , A.TELNO           /*전화번호*/
           , A.INST_NM         /*기관_이름*/
           , A.EDU_TRGT        /*교육_대상*/
           , A.EDU_NOPE        /*교육_인원수*/
           , A.EDU_SBJCT       /*교육_주제*/
           , A.HMPG            /*홈페이지*/
           , A.ADDR            /*주소*/
           , A.ADDR_DTL        /*주소_상세*/
           , A.CTPRVN_CD       /*시도_코드*/
           , CTPRVN.CTPRVN_NM
           , A.USE_YN          /*사용_여부*/
           , A.MDFCN_DT        /*수정_일시*/
           , A.MDFRID          /*수정자아이디*/
           , A.REG_DT          /*등록_일시*/
           , A.RGTRID          /*등록자아이디*/
           , CONCAT( USR.NM, '(', USR.ACNT ,')' ) AS RGTR_NM
        FROM TB_CMM_MAP_INDICT_RESRCE A
        LEFT OUTER JOIN
            TB_CMM_ADDR_CTPRVN CTPRVN ON A.CTPRVN_CD = CTPRVN.CTPRVN_CD
        LEFT OUTER JOIN
            TB_CMM_USER USR ON A.RGTRID=USR.USERID
        LEFT OUTER JOIN
            TB_CMM_CD CD ON A.RESRCE_SE_CD = CD.CD
        WHERE RESRCEID = #{resrceid}
    </select>

    <update id="updateMap" parameterType="mapVo" >
        UPDATE TB_CMM_MAP_INDICT_RESRCE SET
            RESRCE_SE_CD = #{resrceSeCd}    /*자원_구분_코드*/
          , RESRCE_NM    = #{resrceNm}      /*자원_이름*/
          , TELNO        = #{telno}         /*전화번호*/
          , INST_NM      = #{instNm}        /*기관_이름*/
          , EDU_TRGT     = #{eduTrgt}       /*교육_대상*/
          , EDU_NOPE     = #{eduNope}       /*교육_인원수*/
          , EDU_SBJCT    = #{eduSbjct}      /*교육_주제*/
          , HMPG         = #{hmpg}          /*홈페이지*/
          , ADDR         = #{addr}          /*주소*/
          , ADDR_DTL     = #{addrDtl}       /*주소_상세*/
          , CTPRVN_CD    = #{ctprvnCd}      /*시도_코드*/
          , USE_YN       = #{useYn}         /*사용_여부*/
          , MDFCN_DT     = NOW()
          , MDFRID       = #{user.userid}   /*수정자아이디*/
        WHERE RESRCEID   = #{resrceid}      /*자원아이디*/
    </update>

</mapper>