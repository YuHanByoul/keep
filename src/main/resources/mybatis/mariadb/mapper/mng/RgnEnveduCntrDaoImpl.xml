<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
	SQL File Name : RgnEnveduCntrDaoImpl.xml
	Description : 지역환경교육센터 현황
-->
<mapper namespace="com.kbrainc.plum.mng.rgnEnveduCntr.model.RgnEnveduCntrDao">
    
    <!-- 지역환경교육센터 목록 조회 -->
    <select id="selectRgnEnveduCntrList" parameterType="RgnEnveduCntrVo" resultType="RgnEnveduCntrVo">
        /* RgnEnveduCntrDao.selectRgnEnveduCntrList */
        <include refid="PaginationMapper.header"/>
        SELECT
        	A.ORDRID
        	, B.CD_NM AS SE_CD
        	, C.CTPRVN_NM AS RGN_CD
        	, A.CNTR_NM
            , A.INST_NM
            , A.HMPG
            , A.REG_DT
        FROM 
            TB_CMM_ENVEDU_CNTR A
            LEFT OUTER JOIN TB_CMM_CD B ON A.SE_CD = B.CD
            LEFT OUTER JOIN TB_CMM_ADDR_CTPRVN C ON A.RGN_CD = C.CTPRVN_CD
        WHERE 
            1=1
            <if test="seCd != null and seCd != ''">
            AND SE_CD = #{seCd}
            </if>
            <if test="rgnCd != null and rgnCd != ''">
            AND RGN_CD = #{rgnCd}
            </if>
            <if test="instNm != null and instNm != ''">
	        AND INST_NM LIKE CONCAT('%',#{instNm},'%')
	        </if>                        
        <include refid="PaginationMapper.footer"/>
    </select>
    
    <!-- 지역 코드 목록 조회 -->
    <select id="selectAddrCtpvnList" parameterType="RgnEnveduCntrVo" resultType="RgnEnveduCntrVo">
        /* RgnEnveduCntrDao.selectAddrCtpvnList */
        SELECT
            CTPRVN_CD
            ,CTPRVN_NM 
        FROM 
            TB_CMM_ADDR_CTPRVN 
    </select>
    
    <!-- 구분코드(공통코드) 목록 조회 -->
    <select id="selectCmmCdList" parameterType="RgnEnveduCntrVo" resultType="RgnEnveduCntrVo">
        /* RgnEnveduCntrDao.selectAddrCtpvnList */
        SELECT
            CD
            ,CD_NM 
        FROM 
            TB_CMM_CD 
        WHERE
            CDGRPID = 138
    </select>
    
    <!-- 엑셀다운로드 목록 조회 -->
    <select id="selectRgnEnveduCntrExcelDownload" parameterType="RgnEnveduCntrVo" resultType="RgnEnveduCntrVo">
        /* RgnEnveduCntrDao.selectRgnEnveduCntrExcelDownload */
        SELECT
            SE_CD
            , RGN_CD
            , CNTR_NM
            , INST_NM
            , HMPG
        FROM 
            TB_CMM_ENVEDU_CNTR
        WHERE 
            1=1
            <if test="seCd != null and seCd != ''">
            AND SE_CD = #{seCd}
            </if>
            <if test="rgnCd != null and rgnCd != ''">
            AND RGN_CD = #{rgnCd}
            </if>
            <if test="instNm != null and instNm != ''">
            AND INST_NM LIKE CONCAT('%',#{instNm},'%')
            </if>
    </select>
    
    <!-- 지역환경교육센터 등록 --> 
    <insert id="insertRgnEnveduCntr" parameterType="RgnEnveduCntrVo">
        /* RgnEnveduCntrDao.insertRgnEnveduCntr */
        INSERT INTO TB_CMM_ENVEDU_CNTR (
            SE_CD
            , RGN_CD
            , CNTR_NM
            , INST_NM
            , HMPG
            , MDFCN_DT
            , MDFRID
            , REG_DT
            , RGTRID
        )VALUES(
            #{seCd}
            ,#{rgnCd}
            ,#{cntrNm}
            ,#{instNm}
            ,#{hmpg}
            ,NOW()
            ,#{user.userid}
            ,NOW()
            ,#{user.userid}
        )
    </insert>
    
    <!-- 지역환경교육센터 상세조회 -->
    <select id="selectRgnEnveduCntrInfo" parameterType="RgnEnveduCntrVo" resultType="RgnEnveduCntrVo"> 
        /* RgnEnveduCntrDao.selectRgnEnveduCntrInfo */
        SELECT 
        	ORDRID
        	, SE_CD
        	, RGN_CD
        	, CNTR_NM
            , INST_NM
            , HMPG
        FROM TB_CMM_ENVEDU_CNTR
       WHERE ORDRID = #{ordrid}
    </select>
    
    <!-- 지역환경교육센터 삭제 -->
    <delete id="deleteRgnEnveduCntr" parameterType="RgnEnveduCntrVo">
        /* RgnEnveduCntrDao.deleteRgnEnveduCntr */
        DELETE FROM TB_CMM_ENVEDU_CNTR
        WHERE ORDRID = #{ordrid}
    </delete>     
    
    <!-- 지역환경교육센터 수정 -->
    <update id="updateRgnEnveduCntr" parameterType="RgnEnveduCntrVo">
        /* RgnEnveduCntrDao.updateRgnEnveduCntr */
        UPDATE TB_CMM_ENVEDU_CNTR SET
                SE_CD               = #{seCd}
                ,RGN_CD             = #{rgnCd} 
                ,CNTR_NM            = #{cntrNm}
                ,INST_NM            = #{instNm}
                ,HMPG               = #{hmpg}
                ,MDFCN_DT           = NOW() 
                ,MDFRID             = #{user.userid}
         WHERE ORDRID = #{ordrid}
    </update>    
</mapper>