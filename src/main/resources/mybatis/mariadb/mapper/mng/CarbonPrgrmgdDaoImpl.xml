<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
	SQL File Name : PrgrmgdDaoImpl.xml
	Description : 탄소중립환경교육 -> 프로그램안내관리
-->
<mapper namespace="com.kbrainc.plum.mng.wbzn.carbon.prgrmgd.model.CarbonPrgrmgdDao">
    
    <!-- 프로그램안내관리 게시글 목록 조회 -->
    <select id="selectPrgrmgdList" parameterType="CarbonPrgrmgdVo" resultType="CarbonPrgrmgdVo">
        /* CarbonPrgrmgdDao.selectPrgrmgdList */
        <include refid="PaginationMapper.header"/>
        SELECT
        	  A.PRGRMID
        	, A.CLSF_CD
        	, A.RGN_CD
            , D.CD_NM AS RGNCDNM
        	, CONCAT(A.YR, '-' ,A.QU) AS YRQU
            , A.YR
            , A.QU
        	, A.TTL
            , A.SCHDL
        	, A.URL
        	, A.THMBN_FILEID
            , C.FILEGRPID
        	, A.CN_STYLE
        	, A.CN
        	, A.MDFCN_DT
        	, A.MDFRID
        	, A.REG_DT
        	, A.RGTRID
            , B.NM
        FROM 
            TB_CMM_WBZN_PRGRM A
            LEFT OUTER JOIN TB_CMM_USER B ON A.RGTRID = B.USERID
            LEFT OUTER JOIN TB_CMM_FILE C ON A.THMBN_FILEID = C.FILEID
            LEFT OUTER JOIN TB_CMM_CD D ON A.RGN_CD = D.CD
        WHERE 
            1=1
            <if test="clsfCd != null and clsfCd != ''">
            AND A.CLSF_CD = #{clsfCd}
            </if>
            <if test="searchKeyword != null and searchKeyword != '' and searchType == 'ttl'">
            AND A.TTL LIKE CONCAT('%',#{searchKeyword},'%')
            </if>
            <if test="searchRgnCd != null and searchRgnCd != ''">
            AND A.RGN_CD = #{searchRgnCd}
            </if>
            <if test="searchYr != null and searchYr != ''">
            AND A.YR = #{searchYr}
            </if>
            <if test="searchQu != null and searchQu != ''">
            AND A.QU = #{searchQu}
            </if>                        
        <include refid="PaginationMapper.footer"/>
    </select>
    
    <!-- 프로그램안내관리 게시글 등록 --> 
    <insert id="insertPrgrmgd" parameterType="CarbonPrgrmgdVo" keyProperty="CarbonPrgrmgdVo">
        /* CarbonPrgrmgdDao.insertPrgrmgd */
        INSERT INTO TB_CMM_WBZN_PRGRM (
            CLSF_CD
            , RGN_CD
            , YR
            , QU
            , TTL
            , SCHDL
            <if test="url != null and url != ''">
            , URL
            </if>
            , THMBN_FILEID
            , TYPE_CD
            <if test="cnStyle != null and cnStyle != ''">
            , CN_STYLE
            </if>
            <if test="cn != null and cn != ''">
            , CN
            </if>
            , CN_SUMRY
            , MDFCN_DT
            , MDFRID
            , REG_DT
            , RGTRID
        )VALUES(
            #{clsfCd}
            ,#{rgnCd}
            ,#{yr}
            ,#{qu}
            ,#{ttl}
            ,#{schdl}
            <if test="url != null and url != ''">
            ,#{url}
            </if>
            ,#{thmbnFileid}
            ,#{typeCd}
            <if test="cnStyle != null and cnStyle != ''">
            ,#{cnStyle}
            </if>
            <if test="cn != null and cn != ''">
            ,#{cn}
            </if>
            ,#{cnSumry}
            ,NOW()
            ,#{user.userid}
            ,NOW()
            ,#{user.userid}
        )
    </insert>
    
    <!-- 프로그램안내관리 상세조회 -->
    <select id="selectPrgrmgdInfo" parameterType="CarbonPrgrmgdVo" resultType="CarbonPrgrmgdVo"> 
        /* CarbonPrgrmgdDao.selectPrgrmgdInfo */
        SELECT 
        	  A.PRGRMID
        	, A.CLSF_CD
        	, A.RGN_CD
            , A.YR
        	, A.QU
        	, A.TTL
            , A.SCHDL
        	, A.URL
        	, A.THMBN_FILEID
            , B.FILEGRPID
            , B.FILE_IDNTFC_KEY
            , B.ORGINL_FILE_NM
            , A.TYPE_CD
        	, A.CN_STYLE
        	, A.CN
            , A.CN_SUMRY
        FROM TB_CMM_WBZN_PRGRM A
        LEFT OUTER JOIN TB_CMM_FILE B ON A.THMBN_FILEID = B.FILEID
       WHERE PRGRMID = #{prgrmid}
    </select>
    
    <!-- 프로그램안내관리 게시글 수정 -->
    <update id="updatePrgrmgd" parameterType="CarbonPrgrmgdVo" keyProperty="CarbonPrgrmgdVo">
        /* CarbonPrgrmgdDao.updatePrgrmgd */
        UPDATE TB_CMM_WBZN_PRGRM SET
                RGN_CD              = #{rgnCd}
                , YR                     = #{yr} 
                , QU                     = #{qu} 
                , TTL                    = #{ttl}
                , SCHDL                  = #{schdl}
                , THMBN_FILEID           = #{thmbnFileid}
                , TYPE_CD                = #{typeCd}
                <if test="url != null and url != ''">
                , url                    = #{url}
                </if>
                <if test="cnStyle != null and cnStyle != ''">
                , CN_STYLE               = #{cnStyle}
                </if>
                <if test="cn != null and cn != ''">
                , CN                     = #{cn}
                </if>
                , CN_SUMRY               = #{cnSumry}
                , MDFCN_DT               = NOW() 
                , MDFRID                 = #{user.userid}
         WHERE PRGRMID = #{prgrmid}
    </update>    
</mapper>