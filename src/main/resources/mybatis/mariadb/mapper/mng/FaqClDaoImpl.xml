<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    SQL File Name : FaqClDaoImpl.xml
    Description : FAQ 분류 관리
-->
<mapper namespace="com.kbrainc.plum.mng.faq.model.FaqClDao">

    <!-- 분류 리스트 가져옴 -->
    <select id="getList" parameterType="FaqClVo" resultType="FaqClVo">
        <include refid="PaginationMapper.header"/>
        SELECT
            CLID, CL_NM, ORD, USE_YN, SITEID
        FROM
            TB_CMM_FAQ_CL AS TCFC
        WHERE 1=1
        <bind name="searchSiteValue" value="searchSite" />
        <include refid="SearchMapper.siteLmtCondition">
            <property name="tableAlias" value="TCFC" />
        </include>
        <include refid="PaginationMapper.footer"/>
    </select>
    
    <!-- 모든 리스트 가져옴 -->
    <select id="getAllList" parameterType="FaqClVo" resultType="FaqClVo">
        SELECT
              CLID, CL_NM, SITEID, ORD, USE_YN
        FROM
              TB_CMM_FAQ_CL
        WHERE 1=1
         <if test=' useYn.equalsIgnoreCase("Y") or useYn.equalsIgnoreCase("N")' >
          AND USE_YN = UPPER(#{useYn})
        </if>
        <if test=" siteid != null"  >
          AND SITEID =  #{siteid}
        </if>
        <if test=" clid != null" >
            AND CLID = #{clid}
        </if>
    </select>

    <!-- 분류 추가 -->
    <insert id="addFaqCl" useGeneratedKeys="true" keyProperty="clid" parameterType="FaqClVo">
	    <selectKey keyProperty="ord" resultType="Int" order="BEFORE">
	       SELECT
		     IFNULL (Max(ORD),0) +1
		   from TB_CMM_FAQ_CL
		    WHERE 1=1
		     AND SITEID = #{siteid}
	     </selectKey>
    	INSERT INTO TB_CMM_FAQ_CL
    		(SITEID, CL_NM, ORD, USE_YN)
    	VALUES 
    		(#{siteid}, #{clNm}, #{ord}, #{useYn})
    </insert>
    
    <!-- 분류 수정 -->
    <update id="updateFaqCl" parameterType="FaqClVo">
    	UPDATE TB_CMM_FAQ_CL SET
    		CL_NM = #{clNm},
    		ORD = #{ord},
    		USE_YN = #{useYn}
    	WHERE
    		CLID = #{clid}
    </update>
    
    <!-- 분류 삭제 -->
    <delete id="deleteFaqCl"  parameterType="FaqClVo">
        DELETE FROM TB_CMM_FAQ_CL
        WHERE
            CLID = #{clid}
    </delete>

    <!-- 분류순서 수정(UP) -->
    <update id="updateFaqClOrdUp" parameterType="FaqClVo">
		 UPDATE TB_CMM_FAQ_CL
		   SET 
		    ORD = ORD + 1
		  WHERE ORD   = #{newOrd} 
		     AND SITEID  = #{siteid}
	</update>
	
	<!-- 분류순서 수정(DOWN) -->
	<update id="updateFaqClOrdDown" parameterType="FaqClVo" >
		 UPDATE TB_CMM_FAQ_CL
		   SET 
		    ORD = ORD - 1
		  WHERE ORD   = #{newOrd}
            AND SITEID  = #{siteid}
    </update>
    
    <!-- 분류순서 수정 -->
    <update id="updateFaqClOrdByfaqid" parameterType="FaqClVo" >
         UPDATE TB_CMM_FAQ_CL
           SET 
            ORD =  #{newOrd}
          WHERE CLID  = #{clid}
            AND SITEID = #{siteid}
    </update>    
</mapper>