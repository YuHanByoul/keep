<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
	SQL File Name : EnvWordDaoImpl.xml
	Description : 환경교육용어사전
-->
<mapper namespace="com.kbrainc.plum.mng.envWord.model.EnvWordDao">
    
    <!-- 환경교육용어사전 게시글 목록 조회 -->
    <select id="selectEnvWordList" parameterType="EnvWordVo" resultType="EnvWordVo">
        /* EnvWordDao.selectEnvWordList */
        <include refid="PaginationMapper.header"/>
        SELECT
	        A.WORDID
          , A.WORD
          , A.WORD_ENGL AS WORDENGL
          , A.DEL_YN AS DELYN
          , A.REG_DT REGDT
        FROM 
            TB_CMM_ENV_WORD A
        WHERE 
            1=1
            <!-- 키워드 -->
            <if test="searchKeyword != null and searchKeyword != '' and searchType == 'word'">
            AND A.WORD LIKE CONCAT('%',#{searchKeyword},'%')
            </if>
            <if test="searchKeyword != null and searchKeyword != '' and searchType == 'cn'">
            AND A.CN LIKE CONCAT('%',#{searchKeyword},'%')
            </if>
            <if test="searchKeyword != null and searchKeyword != '' and searchType == 'wordCn'">
            AND A.WORD LIKE CONCAT('%',#{searchKeyword},'%')
            AND A.CN LIKE CONCAT('%',#{searchKeyword},'%')
            </if>
            
            <!-- 영문 -->
            <if test="searchEngl != null and searchEngl != ''">
            AND A.WORD_ENGL LIKE CONCAT('%',#{searchEngl},'%')
            </if>
            
            <!-- 등록일(시작일, 종료일) -->
            <if test="searchBgngDt != null and searchBgngDt != ''">
            <![CDATA[
                AND DATE(A.REG_DT) >= #{searchBgngDt}
            ]]>
            </if>
            <if test="searchEndDt != null and searchEndDt != ''">
            <![CDATA[
                AND DATE(A.REG_DT) <= #{searchEndDt}
            ]]>
            </if> 
        <include refid="PaginationMapper.footer"/>
    </select>
    
    <!-- 환경교육용어사전 게시글 등록 --> 
    <insert id="insertEnvWord" parameterType="EnvWordVo" keyProperty="wordid" useGeneratedKeys="true">
        /* EnvWordDao.insertEnvWord */
        INSERT INTO TB_CMM_ENV_WORD (
          WORD
          , WORD_ENGL
          , CN_SUMRY
          , CN
          , DEL_YN
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
          )VALUES(
            #{word}
            ,#{wordEngl}
            ,#{cnSumry}
            ,#{cn}
            ,'N'
            ,NOW()
            ,#{user.userid}
            ,NOW()
            ,#{user.userid}
          )
    </insert>
    
    <!-- 환경교육용어사전 게시글 상세조회 -->
    <select id="selectEnvWordInfo" parameterType="EnvWordVo" resultType="EnvWordVo"> 
        /* EnvWordDao.selectEnvWordInfo */
        SELECT 
              WORDID
            , WORD
            , WORD_ENGL
            , CN_SUMRY
            , CN
            , DATE(A.REG_DT) AS REG_DT
            , A.RGTRID
            , CONCAT(B.ACNT,'(',B.NM,')') AS rgtridNm          
        FROM 
            TB_CMM_ENV_WORD A
            LEFT OUTER JOIN TB_CMM_USER B ON A.RGTRID = B.USERID        
       WHERE WORDID = #{wordid}
    </select>
    
    <!-- 환경교육용어사전 게시글 수정 -->
    <update id="updateEnvWord" parameterType="EnvWordVo" keyProperty="userid">
        /* EnvWordDao.updateEnvWord */
        UPDATE TB_CMM_ENV_WORD SET
                WORD                    = #{word}
                ,WORD_ENGL              = #{wordEngl} 
                ,CN_SUMRY              = #{cnSumry} 
                ,CN                     = #{cn}
                ,MDFCN_DT               = NOW() 
                ,MDFRID                 = #{user.userid}
         WHERE WORDID = #{wordid}
    </update>
    
    <!-- 환경교육용어사전 게시글 삭제 -->
    <update id="deleteEnvWord" parameterType="envWordVo">
        /* EnvWordDao.deleteEnvWord */
        UPDATE TB_CMM_ENV_WORD
        SET
            DEL_YN   = 'Y'
          , MDFCN_DT = NOW()
          , MDFRID   = #{user.userid}
        WHERE WORDID IN 
        <foreach item="item" collection="wordids" open="(" close=")" separator=",">
        #{item}
        </foreach>        
    </update>
    
</mapper>