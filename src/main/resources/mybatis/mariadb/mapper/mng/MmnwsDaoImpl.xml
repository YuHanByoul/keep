<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
	SQL File Name : MmnwsDaoImpl.xml
	Description : 언론보도관리
-->
<mapper namespace="com.kbrainc.plum.mng.mmnws.model.MmnwsDao">
    
    <!-- 언론보도관리 게시글 목록 조회 -->
    <select id="selectMmnwsList" parameterType="MmnwsVo" resultType="MmnwsVo">
        /* MmnwsDao.selectMmnwsList */
        <include refid="PaginationMapper.header"/>
        SELECT
	        A.NSCVRGID
          , C.CD_NM AS CLSFCD
          , A.OXPR_NM AS OXPRNM
          , A.TTL
          , A.URL
          , A.WRT_DE AS WRTDE
          , A.MDFCN_DT
          , A.MDFRID
          , A.REG_DT
          , A.RGTRID
          , B.NM
        FROM 
            TB_CMM_PRS_NSCVRG A
            LEFT OUTER JOIN TB_CMM_USER B ON A.RGTRID = B.USERID
            LEFT OUTER JOIN TB_CMM_CD C ON A.CLSF_CD = C.CD
        WHERE 
            1=1
            AND A.RGTRID = B.USERID
            <if test="searchKeyword != null and searchKeyword != '' and searchType == 'oxprNm'">
            AND OXPR_NM LIKE CONCAT('%',#{searchKeyword},'%')
            </if>
            <if test="searchKeyword != null and searchKeyword != '' and searchType == 'ttl'">
            AND TTL LIKE CONCAT('%',#{searchKeyword},'%')
            </if>
            <if test="searchCd != null and searchCd != ''">
            AND CLSF_CD = #{searchCd}
            </if>
        <include refid="PaginationMapper.footer"/>
    </select>
    
    <!-- 언론보도관리 게시글 등록 --> 
    <insert id="insertMmnws" parameterType="MmnwsVo" keyProperty="userid">
        /* MmnwsDao.insertMmnws */
        INSERT INTO TB_CMM_PRS_NSCVRG (
          CLSF_CD
          , OXPR_NM
          , TTL
          , URL
          , WRT_DE
          , MDFCN_DT
          , MDFRID
          , REG_DT
          , RGTRID
          )VALUES(
            #{clsfCd}
            ,#{oxprNm}
            ,#{ttl}
            ,#{url}
            ,#{wrtDe}
            ,NOW()
            ,#{user.userid}
            ,NOW()
            ,#{user.userid}
          )
    </insert>
    
    <!-- 언론보도관리 게시글 상세조회 -->
    <select id="selectMmnwsInfo" parameterType="MmnwsVo" resultType="MmnwsVo"> 
        /* MmnwsDao.selectMmnwsInfo */
        SELECT 
  	        NSCVRGID
          , CLSF_CD
          , OXPR_NM
          , TTL
          , URL
          , WRT_DE
        FROM TB_CMM_PRS_NSCVRG
       WHERE NSCVRGID = #{nscvrgid}
    </select>
    
    <!-- 언론보도관리 게시글 수정 -->
    <update id="updateMmnws" parameterType="MmnwsVo" keyProperty="userid">
        /* MmnwsDao.updateMmnws */
        UPDATE TB_CMM_PRS_NSCVRG SET
                CLSF_CD                 = #{clsfCd}
                ,OXPR_NM                = #{oxprNm} 
                ,TTL                    = #{ttl} 
                ,URL                    = #{url} 
                ,WRT_DE                 = #{wrtDe} 
                ,MDFCN_DT               = NOW() 
                ,MDFRID                 = #{user.userid}
         WHERE NSCVRGID = #{nscvrgid}
    </update>
    
    <!-- 언론보도관리 게시글 삭제 -->
    <delete id="deleteMmnws" parameterType="java.util.ArrayList">
        /* MmnwsDao.deleteMmnws */
		DELETE FROM TB_CMM_PRS_NSCVRG 
        WHERE NSCVRGID IN 
        <foreach item="item" collection="array" index="nscvrgid" open="(" close=")" separator=",">
        #{item}
        </foreach>
    </delete>
    
</mapper>