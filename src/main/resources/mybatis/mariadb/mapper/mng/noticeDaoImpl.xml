<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kbrainc.plum.mng.notice.model.NoticeDao">

    <select id="selectNoticeList" parameterType="NoticeVo" resultType="NoticeVo">
        <include refid="PaginationMapper.header"/>
            SELECT CONCAT(TCS.SITE_NM, '(', TCI.INST_NM , ')') AS SITE_NM
                   TITLE,
                   FXD_NTC_YN,
                   HITS,
                   TCU.NM AS REG_USER_NM,
                   REG_DT
            FROM TB_CMM_PST TCP
            INNER JOIN (SELECT SITEID, SITE_NM, INSTID FROM TB_CMM_SITE) TCS  ON TCS.SITEID = TCP.SITEID
            INNER JOIN (SELECT INSTID, INST_NM FROM TB_CMM_INST) TCI ON TCS.INSTID = TCI.INSTID
            INNER JOIN (SELECT USERID, NM  FROM TB_CMM_USER ) TCU ON TCP.RGTRID = TCU.USERID
        WHERE 1=1
            <bind name="searchSiteValue" value="searchSite" />
            <include refid="SearchMapper.siteLmtCondition">
                <property name="tableAlias" value="TCP" />
            </include>
            <if test="searchType != null and searchType == 'title' ">
                AND TCP.TITLE LIKE CONCAT('%', #{searchKeyword}, '%')
            </if>
            <if test="searchType != null and searchType == 'cntnts' ">
                AND TCP.CNTNTS LIKE CONCAT('%', #{searchKeyword}, '%')
            </if>
            <include refid="PaginationMapper.footer"/>

    </select>
</mapper>