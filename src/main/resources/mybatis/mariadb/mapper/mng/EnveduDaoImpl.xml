<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
	SQL File Name : EnveduDaoImpl.xml
	Description : 환경교육 NOW -> 환경교육관리
-->
<mapper namespace="com.kbrainc.plum.mng.wbzn.model.EnveduDao">
    
    <!-- 언론사관리 목록 조회 -->
    <select id="selectEnveduList" parameterType="EnveduVo" resultType="EnveduVo">
        /* MmnwsDao.selectMmnwsList */
        <include refid="PaginationMapper.header"/>
        SELECT
        	  A.ENVEDUID
        	, A.CLSF_CD
        	, A.ENVEDU_SE_CD
        	, CONCAT(A.YR, '-' ,A.MM) AS YRMM
            , A.YR
        	, A.MM
        	, A.TTL
        	, A.URL
        	, A.THMBN_FILEID
        	, A.CN_STYLE
        	, A.CN
        	, A.MDFCN_DT
        	, A.MDFRID
        	, A.REG_DT
        	, A.RGTRID
            , B.NM
        FROM 
            TB_CMM_WBZN_ENVEDU A
            LEFT OUTER JOIN TB_CMM_USER B ON A.RGTRID = B.USERID
        WHERE 
            1=1
            <if test="searchKeyword != null and searchKeyword != '' and searchType == 'ttl'">
            AND A.TTL LIKE CONCAT('%',#{searchKeyword},'%')
            </if>
            <if test="searchSeCd != null and searchSeCd != ''">
            AND A.ENVEDU_SE_CD = #{searchSeCd}
            </if>
            <if test="searchYr != null and searchYr != ''">
            AND A.YR = #{searchYr}
            </if>
            <if test="searchMm != null and searchMm != ''">
            AND A.MM = #{searchMm}
            </if>                        
        <include refid="PaginationMapper.footer"/>
    </select>
    
    <!-- 언론보도 저장 --> 
    <insert id="insertEnvedu" parameterType="EnveduVo" keyProperty="EnveduVo">
        /* MmnwsDao.insertMmnws */
        INSERT INTO TB_CMM_WBZN_ENVEDU (
            CLSF_CD
            , ENVEDU_SE_CD
            , YR
            , MM
            , TTL
            <if test="url != null and url != ''">
            , URL
            </if>
            , THMBN_FILEID
            <if test="cnStyle != null and cnStyle != ''">
            , CN_STYLE
            </if>
            <if test="cn != null and cn != ''">
            , CN
            </if>
            , MDFCN_DT
            , MDFRID
            , REG_DT
            , RGTRID
        )VALUES(
            #{clsfCd}
            ,#{enveduSeCd}
            ,#{yr}
            ,#{mm}
            ,#{ttl}
            <if test="url != null and url != ''">
            ,#{url}
            </if>
            ,#{thmbnFileid}
            <if test="cnStyle != null and cnStyle != ''">
            ,#{cnStyle}
            </if>
            <if test="cn != null and cn != ''">
            ,#{cn}
            </if>
            ,NOW()
            ,#{user.userid}
            ,NOW()
            ,#{user.userid}
        )
    </insert>
    
    <!-- 언론보도 상세조회 -->
    <select id="selectEnveduInfo" parameterType="EnveduVo" resultType="EnveduVo"> 
        /* MmnwsDao.selectMmnwsInfo */
        SELECT 
        	  ENVEDUID
        	, CLSF_CD
        	, ENVEDU_SE_CD
            , YR
        	, MM
        	, TTL
        	, URL
        	, THMBN_FILEID
        	, CN_STYLE
        	, CN
        FROM TB_CMM_WBZN_ENVEDU
       WHERE ENVEDUID = #{enveduid}
    </select>
    
    <!-- 사용자상세수정 -->
    <update id="updateEnvedu" parameterType="EnveduVo" keyProperty="EnveduVo">
        /* MmnwsDao.updateMmnws */
        UPDATE TB_CMM_PRS_NSCVRG SET
                CLSF_CD                 = #{clsfCd}
                ,OXPR_NM                = #{oxprNm} 
                ,TTL                    = #{ttl} 
                ,URL                    = #{url} 
                ,WRT_DE                 = #{wrtDe} 
                ,MDFCN_DT               = NOW() 
                ,MDFRID                 = #{user.userid}
         WHERE NSCVRGID = #{nscvrgid}
    </update>
    
    <!-- 사용자상세수정 -->
    <delete id="deleteEnvedu" parameterType="EnveduVo">
        /* MmnwsDao.updateMmnws */
		DELETE FROM TB_CMM_PRS_NSCVRG WHERE NSCVRGID = #{nscvrgid}
    </delete>
    
</mapper>