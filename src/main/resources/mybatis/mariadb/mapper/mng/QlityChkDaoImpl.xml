<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
	SQL File Name : QlityChkDaoImpl.xml
	Description : 콘텐츠 관리
-->
<mapper namespace="com.kbrainc.plum.mng.qlityChk.model.QlityChkDao">
    
    <!-- 컨텐츠 관리 게시글 목록 조회 -->
    <select id="selectQlityChkList" resultType="QlityChklstVo">
        /* QlityChkDao.selectQlityChkList */
        SELECT
            CHKLSTID
          , A.FLD_CD
          , ORDR
          , CN
          
          , B.COUNT
          , CD1.CD_NM AS FLD_CD_NM
        FROM
            TB_CMM_CNTNTS_QLITY_CHKLST A
                LEFT OUTER JOIN (
                                SELECT
                                    FLD_CD
                                  , COUNT(FLD_CD) AS COUNT
                                FROM
                                    TB_CMM_CNTNTS_QLITY_CHKLST
                                GROUP BY FLD_CD
                                ) B ON A.FLD_CD = B.FLD_CD
                LEFT OUTER JOIN TB_CMM_CD CD1 ON A.FLD_CD = CD1.CD
    </select>
    
    <!-- 컨텐츠 관리 게시글 목록 조회 -->
    <select id="selectQlityChkArtclList" resultType="QlityChkArtclVo">
        /* QlityChkDao.selectQlityChkArtclList */
        SELECT
            B.FLD_CD
          , B.CN
        FROM
            TB_CMM_CNTNTS_QLITY_CECK A
                LEFT OUTER JOIN TB_CMM_CNTNTS_QLITY_CECK_ARTCL B ON A.CECKID = B.CECKID
        WHERE
            1 = 1
    </select>

    
    <insert id="insertQlityChkList" useGeneratedKeys="true" keyProperty="ceckid" parameterType="QlityChkVo">
        INSERT INTO TB_CMM_CNTNTS_QLITY_CECK (
            USERID
            , TRGT_CD
            , EVNT_CD
            , CNTNTSID
            , MDFCN_DT
            , MDFRID
            , REG_DT
            , RGTRID
        ) VALUES (
            #{user.userid}              
            , 246
            , 247001
            , 0
            , NOW()
            , #{user.userid}
            , NOW()
            , #{user.userid}
        )
    </insert>
    
    <insert id="insertQlityChkArtclList" parameterType="QlityChkArtclVo">
        INSERT INTO TB_CMM_CNTNTS_QLITY_CECK_ARTCL (
            CECKID
            , CHKLSTID
            , FLD_CD
            , ORDR
            , CN
            , REG_DT
            , RGTRID
        ) VALUES 
        <foreach item="item" collection="chklstid" separator=",">
           (
                #{ceckid}              
                , #{item}
                , (SELECT A.FLD_CD FROM TB_CMM_CNTNTS_QLITY_CHKLST A WHERE A.CHKLSTID = #{item})
                , (SELECT A.ORDR FROM TB_CMM_CNTNTS_QLITY_CHKLST A WHERE A.CHKLSTID = #{item})
                , (SELECT A.CN FROM TB_CMM_CNTNTS_QLITY_CHKLST A WHERE A.CHKLSTID = #{item})
                , NOW()
                , #{user.userid}
            )
        </foreach>
    </insert>   
</mapper>