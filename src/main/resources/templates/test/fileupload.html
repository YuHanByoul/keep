<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
	layout:decorate="layout/subLayout">
<head>
<meta charset="utf-8" />
<body>
	<div layout:fragment="content">

		<div class="upload-container">
			<div class="upload-header">
				<h2>File Upload Test</h2>
			</div>
			<div class="upload-content">
				<div class="single-upload">
					<h3>단일 파일 업로드 테스트</h3>

					<label class="btn btn-primary btn-file"> 
						단일파일 업로드 <input id="singleFileInput" type="file" name="file" style="display: none;">
					</label>
					<div class="upload-response">
						<div id="singleFileUploadError"></div>
						<div id="singleFileUploadSuccess"></div>
					</div>

				</div>
				<div class="multiple-upload">
					<h3>다중 파일 업로드 테스트</h3>
					<label class="btn btn-primary btn-file"> 
						다중파일 업로드 <input id="multiFileInput" type="file" name="files" multiple required style="display: none;">
					</label>
					<div class="upload-response">
						<div id="multipleFileUploadError"></div>
						<div id="multipleFileUploadSuccess"></div>
					</div>
				</div>
			</div>
		</div>

		<script>
			$(function() {
				$('#singleFileInput').on('change', function(event) {
					var formData = new FormData();
					var objFile = $('#singleFileInput');
					formData.append("file", objFile[0].files[0]);

					$.ajax({
						url : '/uploadFile.do',
						processData : false,
						contentType : false,
						data : formData,
						type : 'POST',
						success : function(response) {
							$('#singleFileUploadSuccess').html("<p>File Uploaded 성공!</p><p>DownloadUrl : <a href='" + response.fileDownloadUri + "' target='_blank'>" + response.fileDownloadUri + "</a></p>");
						}
					});

					event.preventDefault();

				})

				$('#multiFileInput').on('change', function(event) {
					var formData = new FormData();
					var objFile = document.querySelector('#multiFileInput');
					//var objFile = $('#multiFileInput');
				    for(var index = 0; index < objFile.files.length; index++) {
				        formData.append("files", objFile.files[index]);
				    }

					$.ajax({
						url : '/uploadMultipleFiles.do',
						processData : false,
						contentType : false,
						data : formData,
						type : 'POST',
						success : function(response) {
							var content = "<p>All Files Uploaded Successfully</p>";
				            for(var i = 0; i < response.length; i++) {
				                content += "<p>DownloadUrl : <a href='" + response[i].fileDownloadUri + "' target='_blank'>" + response[i].fileDownloadUri + "</a></p>";
				            }
							$('#multipleFileUploadSuccess').html(content);
						}
					});

					event.preventDefault();

				})
			});
		</script>


	</div>
	<!-- fragment="content" -->

</body>
</html>