<form id="rcpmnyBfeUpdate" >
    <input type="hidden" id="aplyid" name="aplyid" th:value="${rcpmnyBfe.aplyid}">
    <!--탭영역 start -->
        <div class="tab-pane active" id="agencyInfo" role="tabpanel">
                <!-- 예약 정보 -->
                <div class="card-header p-b-0">
                    <h3 class="sub-title"><strong>예약 정보</strong></h3>
                </div>
                <div class="card-block-small p-t-0">
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>운영기관</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${rcpmnyBfe.instNm}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>시설</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${rcpmnyBfe.fcltNm}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>공간</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${rcpmnyBfe.spceNm}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>이용일(시)</strong></label>
                                <div class="col-12">
                                <th:block th:with="exid= ${#strings.arraySplit(rcpmnyBfe.resveDt,'/')} ">
	                                <th:block th:each="item:${exid}" >
	                                    <input type="text" class="form-control form-control-sm mb-2" readonly="" th:value ="${item}"/>
	                                </th:block>
                                </th:block>
                            </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>신청상태</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${rcpmnyBfe.aplySttsCdNm}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>예약신청일시</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${#dates.format(rcpmnyBfe.aplyDt, 'yyyy-MM-dd HH:mm:ss')}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>결제금액</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${#numbers.formatInteger(rcpmnyBfe.amt, 0, 'COMMA') + '원'}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>결제상태</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${rcpmnyBfe.stlmSttsCdNm}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <th:block th:if ="${rcpmnyBfe.aplySttsCd} == '160103'">
                        <!-- 취소상태 -->
                        <div class="row">
                            <div class="col-12 col-lg-6 mb-3">
                                <div class="mb-0 form-group">
                                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>예약취소일시</strong></label>
                                    <div class="col-12">
                                        <input type="text" class="form-control form-control-sm" readonly="" th:value="${#dates.format(rcpmnyBfe.cnclDt, 'yyyy-MM-dd HH:mm:ss')}">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row form-group mb-3">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>예약취소사유</strong></label>
                            <div class="col-12">
                                <textarea rows="5" cols="5" class="form-control form-control-sm" readonly=""><th:block th:text="${rcpmnyBfe.cnclRsnCdNm}"/><th:block th:if ="${rcpmnyBfe.rsvtCnclRsn != null and rcpmnyBfe.rsvtCnclRsn != ''}" th:text="'  :  '+${rcpmnyBfe.rsvtCnclRsn}"/>
                                </textarea>
                            </div>
                        </div>
                    </th:block>
                </div>
                <!-- 신청자 정보 -->
                <div class="card-header p-t-0 p-b-0">
                    <h3 class="sub-title"><strong>신청자 정보</strong></h3>
                </div>
                <div class="card-block-small p-t-0">
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>신청자 ID</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${rcpmnyBfe.acnt}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>이름/기관명</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${rcpmnyBfe.nm}+' / '+${rcpmnyBfe.userInstNm}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>회원유형</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${rcpmnyBfe.rolecdnm}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>기관유형</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${rcpmnyBfe.instTypeCdNm}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>휴대전화</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${rcpmnyBfe.moblphon}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>이메일</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${rcpmnyBfe.eml}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 mb-3">
                            <div class="mb-0 form-group">
                                <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>이용인원</strong></div>
                                <div class="col-12 row align-items-center">
                                    <div class="col-auto p-r-0">
                                        성인
                                    </div>
                                    <div class="col-auto">
                                        <input type="text" class="col-lg-auto form-control form-control-sm" style="width: 80px;" readonly="" th:value="${rcpmnyBfe.nopeAdult}">
                                    </div>
                                    <div class="col-auto p-l-0 p-r-0">
                                        명
                                    </div>
                                    <div class="col-auto p-r-0">
                                        아동
                                    </div>
                                    <div class="col-auto">
                                        <input type="text" class="col-lg-auto form-control form-control-sm" style="width: 80px;" readonly="" th:value="${rcpmnyBfe.nopeChil}">
                                    </div>
                                    <div class="col-auto p-l-0 p-r-0">
                                        명
                                    </div>
                                    <div class="col-auto p-r-0">
                                        유아
                                    </div>
                                    <div class="col-auto">
                                        <input type="text" class="col-lg-auto form-control form-control-sm" style="width: 80px;" readonly="" th:value="${rcpmnyBfe.nopeInfnt}">
                                    </div>
                                    <div class="col-auto p-l-0 p-r-0">
                                        명
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row form-group mb-3">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>이용목적</strong></label>
                        <div class="col-12">
                            <textarea rows="5" cols="5" class="form-control form-control-sm" readonly=""><th:block th:text="${rcpmnyBfe.utztnPrps}"/></textarea>
                        </div>
                    </div>
                </div>
                <!-- 예약자 정보 -->
                <div class="card-header p-t-0 p-b-0">
                    <h3 class="sub-title"><strong>예약자 정보</strong></h3>
                </div>
                <div class="card-block-small p-t-0">
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>이름</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${rcpmnyBfe.aplcntNm}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>휴대전화</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${rcpmnyBfe.aplcntMoblphon}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-0 row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>이메일</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${rcpmnyBfe.aplcntEml}">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 입금/환불정보 -->
                <div class="card-header p-t-0 p-b-0">
                    <h3 class="sub-title"><strong>입금/환불정보</strong></h3>
                </div>
                <div class="card-block-small p-t-0">
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>결제방법</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${rcpmnyBfe.stlmMthdCdNm}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>입금계좌</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${rcpmnyBfe.dpstBankCdNm+' '+rcpmnyBfe.dpstBacnt}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>입금자명</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${rcpmnyBfe.pyrNm}">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
         <div class="tab-pane" id="managerInfo" role="tabpanel"></div>
</form>
<div class="card-block-small" th:if = "${rcpmnyBfe.aplySttsCd != '160103' }">
    <th:block sec:authorize-url="/mng/rcpmnyBfe/resveCancelPopup.html">
    <button class="btn btn-disabled m-r-5" onclick="processDsptForDetail('C')">신청취소</button>
    </th:block>
    <th:block sec:authorize-url="/mng/rcpmnyBfe/dsptCheckPopup.html">
    <button class="btn btn-primary" onclick="processDsptForDetail('D')">입금확인</button>
    </th:block>
    
</div>

<script th:inline="javascript">
    /*<![CDATA[*/
    var selectAplyid =/*[[${rcpmnyBfe.aplyid}]]*/null;
    /*]]>*/
    
    processDsptForDetail=(mode)=>{
        
        let openPopUrl = "";
        let alertStr = "";
        
        if(mode=='C'){ //신청취소 
            openPopUrl = "/mng/rcpmnyBfe/resveCancelPopup.html?aplyids="+selectAplyid;
            alertStr = "신청취소";
        }else{//입금확인
            openPopUrl = "/mng/rcpmnyBfe/dsptCheckPopup.html?aplyid="+selectAplyid;
            alertStr = "입금확인";
        }

	    if(displayWorkProgress() ){
	        $.ajax({
	            type: "GET",
	            contentType: "application/json; charset=utf-8",
	            url: "/mng/resveReqst/selectResveReqstList.do",
	            dataType: "json",
	            data : {selectedApplyid : selectAplyid},
	            success : function (response){
	            	closeWorkProgress();
	                if(response.totalCount == 0){
	                    alert("신청건이 존재하지 않습니다. 새로 고침 후 확인해주십시오");
	                    return;
	                }else if(response.totalCount >= 2){
	                    alert("중복 신청건이 존재합니다. 새로 고침 후 확인해주십시오");
	                    return;
	                }else{
	                    if(response.list[0].aplySttsCd == "160103"){
	                        alert("예약 취소 건은 처리가 불가합니다.");
	                        return false;
	                    }else{
	                        openDsptPop(openPopUrl);
	                    }
	                }
	            }
	        });
       }
    }

    
</script>

