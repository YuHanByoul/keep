<form id ="clclnBlncIntDetailInfoForm" name="clclnBlncIntDetailInfoForm">
<input type="hidden" name="pcntstid" th:value="${clclnBlncInt.pcntstid}"/>
<input type="hidden" name="aplyid" th:value="${clclnBlncInt.aplyid}"/>
	<div class="col-12">
	    <!-- 신청정보 -->
	    <div class="card">
	        <div class="card-header p-b-0">
	            <h3 class="sub-title"><strong>신청정보</strong></h3>
	        </div>
	        <div class="card-block-small p-t-0">
	            <div class="row">
	                <div class="col-12 col-md-6 col-lg-3 mb-3">
	                    <div class="mb-0 form-group">
	                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>접수번호</strong></label>
	                        <div class="col-sm-12">
	                            <input type="text" id="rcptno" name="rcptno" class="form-control form-control-sm" placeholder="" th:value="${clclnBlncInt.rcptno}" readonly>
	                        </div>
	                    </div>
	                </div>
	                <div class="col-12 col-md-6 col-lg-3 mb-3">
	                    <div class="mb-0 form-group">
	                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>기관명</strong></label>
	                        <div class="col-sm-12">
	                            <input type="text" id="instNm" name="instNm" class="form-control form-control-sm" placeholder="" th:value="${clclnBlncInt.instNm}" readonly>
	                        </div>
	                    </div>
	                </div>
	                <div class="col-12 col-lg-6 mb-3">
	                    <div class="mb-0 form-group">
	                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>프로그램명</strong></label>
	                        <div class="col-12">
	                            <input type="text" id="prgrmNm" name="prgrmNm" class="form-control form-control-sm" placeholder="" th:value="${clclnBlncInt.prgrmNm}" readonly>
	                        </div>
	                    </div>
	                </div>
	            </div>
	            <div class="row">
	                <div class="col-12 col-md-6 col-lg-3 mb-3">
	                    <div class="mb-0 form-group">
	                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>신청자</strong></label>
	                        <div class="col-sm-12">
	                            <input type="text" id="aplcntNm" name="aplcntNm" class="form-control form-control-sm" placeholder="" th:value="${clclnBlncInt.aplcntNm}" readonly>
	                        </div>
	                    </div>
	                </div>
	                <div class="col-12 col-md-6 col-lg-3 mb-3">
	                    <div class="mb-0 form-group">
	                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>예산액</strong></label>
	                        <div class="col-sm-12">
	                            <input type="hidden" id="bgtAmt" name="bgtAmt" th:value="${clclnBlncInt.bgtAmt}" />
	                            <input type="text" id="bgtAmtDesc" class="form-control form-control-sm" placeholder="" th:value="${#numbers.formatDecimal(clclnBlncInt.bgtAmt, 0,'COMMA',0,'POINT')}" readonly>
	                        </div>
	                    </div>
	                </div>
	                <div class="col-12 col-md-6 col-lg-3 mb-3">
	                    <div class="mb-0 form-group">
	                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>지출액</strong></label>
	                        <div class="col-sm-12">
                                <input type="hidden" id="expndAmt" name="expndAmt" th:value="${clclnBlncInt.expndAmt}" />	                           
	                            <input type="text" id="expndAmtDesc" class="form-control form-control-sm" placeholder="" th:value="${#numbers.formatDecimal(clclnBlncInt.expndAmt, 0,'COMMA',0,'POINT')}" readonly>
	                        </div>
	                    </div>
	                </div>
	                <div class="col-12 col-md-6 col-lg-3 mb-3">
	                    <div class="mb-0 form-group">
	                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>집행잔액</strong></label>
	                        <div class="col-sm-12">
	                            <input type="hidden" id="implBlncAmt" name="implBlncAmt" th:value="${clclnBlncInt.implBlncAmt}" />
	                            <input type="text" id="implBlncAmtDesc" class="form-control form-control-sm" placeholder="" th:value="${#numbers.formatDecimal(clclnBlncInt.implBlncAmt, 0,'COMMA',0,'POINT')}" readonly>
	                        </div>
	                    </div>
	                </div>
	            </div>
	            <div class="row">
	                <div class="col-12 col-md-6 col-lg-3 mb-3">
	                    <div class="mb-0 form-group">
	                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>이자+캐쉬백</strong></label>
	                        <div class="col-sm-12">
	                            <input type="hidden" id="intCashbAmt" name="intCashbAmt" th:value="${clclnBlncInt.intCashbAmt}" />
	                            <input type="text" id="intCashbAmtDesc" class="form-control form-control-sm" placeholder="" th:value="${#numbers.formatDecimal(clclnBlncInt.intCashbAmt, 0,'COMMA',0,'POINT')}" readonly>
	                        </div>
	                    </div>
	                </div>
	                <div class="col-12 col-md-6 col-lg-3 mb-3">
	                    <div class="mb-0 form-group">
	                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>잔액(집행 잔액 + 이자발생분)</strong></label>
	                        <div class="col-sm-12">
	                            <input type="hidden" id="implBlncIntAmt" name="implBlncIntAmt" th:value="${clclnBlncInt.implBlncIntAmt}" />
	                            <input type="text" id="implBlncIntAmtDesc" class="form-control form-control-sm" placeholder="" th:value="${#numbers.formatDecimal(clclnBlncInt.implBlncIntAmt, 0,'COMMA',0,'POINT')}" readonly>
	                        </div>
	                    </div>
	                </div>
	                <div class="col-12 col-md-6 col-lg-3 mb-3">
	                    <div class="mb-0 form-group">
	                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>잔액+이자 반납</strong></label>
	                        <div class="col-sm-12">
	                            <th:block th:if="${clclnBlncInt.rturnYn eq 'Y'}">
	                               <input type="text" id="sbmsnDt" name="sbmsnDt" class="form-control form-control-sm" placeholder="" th:value="|${#numbers.formatDecimal(clclnBlncInt.rturnAmt, 0,'COMMA',0,'POINT')} (반납완료 : ${clclnBlncInt.rturnDt})|" readonly>
	                            </th:block>
	                            <th:block th:if="${clclnBlncInt.rturnYn ne 'Y'}">
	                               <button type="button" class="btn btn-inverse btn-sm" onclick="fn_rturn();">반납</button>
                               </th:block>
	                        </div>
	                    </div>
	                </div>
	                <div class="col-12 col-md-6 col-lg-3 mb-3">
	                    <div class="mb-0 form-group">
	                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>반납상태</strong></label>
	                        <div class="col-sm-12">
	                            <input type="text" id="rturnYn" name="rturnYn" class="form-control form-control-sm" placeholder="" th:value="${clclnBlncInt.rturnYn == 'Y' ? '반납' : '미반납'}" readonly>
	                        </div>
	                    </div>
	                </div>
	            </div>
	        </div>
	
	        <div class="card-header p-t-0 p-b-0">
	            <div class="sub-title">
	                <div class="row align-items-end">
	                    <div class="col">
	                        <strong>집행내역 개요서</strong>
	                    </div>
	                    <div class="col-auto btn-group-sm">
	                        <button type="button" class="btn btn-primary" onclick="openExcelDownRsnPopup('dwnldDsctnPopup', 'clclnBlncIntDetailInfoForm', '/mng/clclnMng/clclnBlncInt/clclnBlncIntOutlListExcelDownList.do');">엑셀다운로드</button>
	                    </div>
	                </div>
	            </div>
	        </div>
	        <div class="card-block-small p-t-0">
	            <div class="table-responsive">
	                <table id="outlListTbl" class="table table-framed table-bordered">
	                    <thead>
	                    <tr class="border-bottom-inverse">
	                        <th class="text-center v-middle">항목</th>
	                        <th class="text-center v-middle">세부항목</th>
	                        <th class="text-center v-middle">예산액</th>
	                        <th class="text-center v-middle">지출금액</th>
	                        <th class="text-center v-middle">집행건수</th>
	                        <th class="text-center v-middle">집행잔액</th>
	                        <th class="text-center v-middle">집행비율</th>
	                    </tr>
	                    </thead>
	                    <tbody id="outlListTbody">
	                        <th:block th:each="item , status : ${outlList}">
			                    <tr>
			                        <th class="text-center v-middle" th:text="${item.upprNm}" addClass="upprNm"></th>
			                        <td class="text-left v-middle" th:text="${item.expitmNm}"></td>
			                        <td class="text-right v-middle" th:text="${#numbers.formatDecimal(item.bgtAmt, 0,'COMMA',0,'POINT')}"></td>
			                        <td class="text-right v-middle" th:text="${#numbers.formatDecimal(item.expndAmt, 0,'COMMA',0,'POINT')}"></td>
			                        <td class="text-right v-middle" th:text="${#numbers.formatDecimal(item.implCnt, 0,'COMMA',0,'POINT')}"></td>
			                        <td class="text-right v-middle" th:text="${#numbers.formatDecimal(item.implBlncAmt, 0,'COMMA',0,'POINT')}"></td>
			                        <td class="text-center v-middle" th:text="${#numbers.formatDecimal(item.implRt, 0,'COMMA',0,'POINT')}"></td>
			                    </tr>
                                    <th:block th:if="${(status.index > 0 && outlList[status.index-1].upprCd != outlList[status.index].upprCd) || (status.size == status.count) || (status.index < status.size && outlList[status.index+1].upprCd != outlList[status.index].upprCd)}" >			                    
					                    <tr>
					                        <td class="text-center v-middle table-light" colspan="2"><strong>소계</strong></td>
					                        <td class="text-right v-middle table-light" th:text="${#numbers.formatDecimal(item.bgtAmtRp, 0,'COMMA',0,'POINT')}"><span></span></td>
					                        <td class="text-right v-middle table-light" th:text="${#numbers.formatDecimal(item.expndAmtRp, 0,'COMMA',0,'POINT')}"><span></span></td>
					                        <td class="text-right v-middle table-light" th:text="${#numbers.formatDecimal(item.implCntRp, 0,'COMMA',0,'POINT')}"><span></span></td>
					                        <td class="text-right v-middle table-light" th:text="${#numbers.formatDecimal(item.implBlncAmtRp, 0,'COMMA',0,'POINT')}"><span></span></td>
					                        <td class="text-center v-middle table-light" th:text="${#numbers.formatDecimal(item.implRtRp, 0,'COMMA',0,'POINT')}"><span>%</span></td>
					                    </tr>
				                    </th:block>
	                        </th:block>
	                    </tbody>
	                    <tfoot>
	 	                    <tr>
		                        <td class="text-center v-middle table-active" colspan="2"><strong>합계</strong></td>
		                        <td class="text-right v-middle table-active"><strong th:text="${#numbers.formatDecimal(calculateInfo.bgtAmtSum, 0,'COMMA',0,'POINT')}"></strong></td>
		                        <td class="text-right v-middle table-active"><strong th:text="${#numbers.formatDecimal(calculateInfo.expndAmtSum, 0,'COMMA',0,'POINT')}"></strong></td>
		                        <td class="text-right v-middle table-active"><strong th:text="${#numbers.formatDecimal(calculateInfo.implCntSum, 0,'COMMA',0,'POINT')}"></strong></td>
		                        <td class="text-right v-middle table-active"><strong th:text="${#numbers.formatDecimal(calculateInfo.implBlncAmtSum, 0,'COMMA',0,'POINT')}"></strong></td>
		                        <td class="text-center v-middle table-active"><strong th:text="${#numbers.formatDecimal(calculateInfo.implRtSum, 0,'COMMA',0,'POINT')}"></strong></td>
		                    </tr>
	                    </tfoot>
	                </table>
	            </div>
	        </div>
	        <div class="card-block-small">
	            <button type="button" class="btn btn-inverse m-r-5" onclick="goListPage();">목록</button>
	        </div>
	    </div>
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script type="text/javascript" src="/js/common/jsgrid-master/dist/jsgrid.min.js"></script>
<script th:inline="javascript">
    $(function() {
        $('#outlListTbl').rowspan(0);
    });
        
	$.fn.rowspan = function(colIdx, isStats) {       
	    return this.each(function(){      
	    	var that;
	    	var idx = 0;
	    	  $('tr', this).each(function(row) {
	    	  $('th:eq('+colIdx+')', this).filter(':visible').each(function(col) {
	    	      if ($(this).html() == $(that).html()) {
	    	        rowspan = $(that).attr("rowSpan");
	    	        if (rowspan == undefined) {
	    	 
	    	          $(that).attr("rowSpan",1);
	    	          rowspan = $(that).attr("rowSpan");
	    	        }
	    	        rowspan = Number(rowspan)+1;
	    	        $(that).attr("rowSpan",rowspan); // do your action for the colspan cell here
	
	    	        $(this).hide(); // .remove(); // do your action for the old cell here
	    	      } else {
	    	        that = this;
	    	      }
	    	      that = (that == null) ? this : that; // set the that if not already set
	    	      idx++;
	    	  });
	    	});  
	    });  
	};     
	
    function fn_rturn(){
        if(!confirm("잔액 반납처리를 하시겠습니까?")) return;
        var data =  $("#clclnBlncIntDetailInfoForm").serialize();
        if(displayWorkProgress()){
            $.ajax({
                url : "/mng/clclnMng/clclnBlncInt/updateClclnBlncIntRturnYn.do",
                type: 'POST',
                cache : false,
                dataType: 'json',
                data : data,
                success : function (data){
                    if(data.result=="success"){
                    	alert(data.msg);
                    	gridHelper2.resetListContent();
                    }else{
                        alert(data.msg);
                    }
                    closeWorkProgress();
                }
            });
        }
    }	
    
    /* 엑셀 다운로드 */
    function fn_excelOutlListDownload(){
        var f = document.clclnBlncIntDetailInfoForm;
        f.action ="/mng/clclnMng/clclnBlncInt/clclnBlncIntOutlListExcelDownList.do";
        f.submit();
    }
    
    function goListPage() {
        location.href = "/mng/clclnMng/clclnBlncInt/clclnBlncIntListForm.html";
    }
    
</script>	
	</div>
</form>