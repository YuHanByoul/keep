<form id="refndCompleteFrm">
    <input type="hidden" id="aplyid" name="aplyid" th:value="${aplyVo.aplyid}">

    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content type_2">
            <div class="modal-header">
                <h4 class="modal-title">환불확인</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true"></span>
                </button>
            </div>
            <div class="modal-body">
                <div class="card m-b-10">
                    <div class="card-block-small">
                        <div class="table-responsive">
                            <table class="table table-bordered td-wrap">
                                <colgroup>
                                    <col style="width:18%">
                                    <col style="width:32%">
                                    <col style="width:18%">
                                    <col style="width:32%">
                                </colgroup>
                                <tbody>
                                <tr>
                                    <th class="table-light text-center">시설</th>
                                    <td><th:block th:text="${aplyVo.fcltNm}"/></td>
                                    <th class="table-light text-center">공간</th>
                                    <td><th:block th:text="${aplyVo.spceNm}"/></td>
                                </tr>
                                <tr>
                                    <th class="table-light text-center">이용일시</th>
                                    <td class="v-middle">
                                        <th:block th:with="exid= ${#strings.arraySplit(aplyVo.resveDt,'/')} ">
                                            <th:block th:each="item:${exid}" >[[${item}]]<br/>
                                            </th:block>
                                        </th:block>
                                    </td>
                                    <th class="table-light text-center">결제금액</th>
                                    <td><th:block th:text="${#numbers.formatInteger(aplyVo.amt, 0, 'COMMA') + '원'}"/></td>
                                </tr>
                                <tr>
                                    <th class="table-light text-center">입금금액</th>
                                    <td><th:block th:text="${#numbers.formatInteger(aplyVo.dpstAmt, 0, 'COMMA') + '원'}"/></td>
                                    <th class="table-light text-center">입금일</th>
                                    <td><th:block th:text="${aplyVo.dpstDe}"/></td>
                                </tr>
                                <tr>
                                    <th class="table-light text-center">환불요청금액</th>
                                    <td><th:block th:text="${#numbers.formatInteger(aplyVo.rfndDmndAmt, 0, 'COMMA') + '원'}"/></td>
                                    <th class="table-light text-center">환불요청일시</th>
                                    <td><th:block th:text="${#dates.format(aplyVo.rfndDmndDt, 'yyyy-MM-dd HH:mm:ss')}"/></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <h3 class="sub-title mt-2"><strong>환불정보</strong></h3>
                        <div class="row">
                            <div class="col-12 col-lg-6 mb-3">
                                <div class="mb-0 form-group required">
                                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>환불일</strong></label>
                                    <div class="col-12">
                                        <input type="date" class="form-control form-control-sm" id="rfndDe" name="rfndDe" th:value="${aplyVo.rfndDe}">
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-lg-6 mb-3">
                                <div class="mb-0 form-group required">
                                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>환불금액</strong></label>
                                    <div class="d-flex align-items-center">
                                        <div class="col">
                                            <input type="text" class="form-control form-control-sm" id="rfndAmt" name="rfndAmt" th:value="${aplyVo.dpstAmt}">
                                        </div>
                                        <span class="ps-2">원</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>환불계좌정보</strong></label>
                            <div class="col-12 row m-r-0 m-l-0">
                                <div class="col-3 p-l-0 p-r-0">
                                    <span kattr:select_code="rfndBankCd" grpCd="154" firstOptTxt="- 선택 -" th:attr="selectedCd=${aplyVo.rfndBankCd}" name="rfndBankCd" addClass="form-select form-select-sm form-control-sm" ></span>
                                </div>
                                <div class="col-6 p-r-0">
                                    <input type="text" class="form-control form-control-sm" name="rfndBacnt" th:value="${aplyVo.rfndBacnt}">
                                </div>
                                <div class="col-3 p-r-0">
                                    <input type="text" class="form-control form-control-sm" name="rfndPyrNm" th:value="${aplyVo.rfndPyrNm}">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary waves-effect waves-light" onclick="saveDsptCheck();">저장</button>
            </div>
        </div>
    </div>
</form>
<script th:inline="javascript">

   $(function(){
	   $("#rfndDe").val(new Date().toISOString().slice(0, 10));
   })
   
   var validator= $("#refndCompleteFrm").validate({
      onsubmit: false,
        rules: {
      	     rfndDe   : { required: true }
      	     ,rfndAmt : { required: true, number: true}
          },
          messages: {
      	     rfndDe   :  { required: "환불일을 지정해주십시오" }
      	     ,rfndAmt :  { required: "환불금액 지정해주십시오", number: "숫자만 입력 가능합니다."}
          }
   })

   function saveDsptCheck() {

	if(!($("#refndCompleteFrm").valid())) return;
	
	if(!confirm("환불완료처리 하시겠습니까?")){return;}

	var data = {
        "aplyid"       : $('#refndCompleteFrm input[name="aplyid"]').val()
        , "rfndDe"     : $('#refndCompleteFrm input[name="rfndDe"]').val()
        , "rfndAmt"    : $('#refndCompleteFrm input[name="rfndAmt"]').val()
        , "rfndBankCd" : $('#refndCompleteFrm select[name="rfndBankCd"]').val()
        , "rfndBacnt"  : $('#refndCompleteFrm input[name="rfndBacnt"]').val()
        , "rfndPyrNm"  : $('#refndCompleteFrm input[name="rfndPyrNm"]').val()
    }
    
    if(displayWorkProgress()){
        $.ajax({
            url: "/mng/refndMng/updateRefndComplete.do",
            type: 'POST',
            cache : false,
            dataType: 'json',
            data : data,
            success : function (data){
                closeWorkProgress();
                if(data.result=="success"){
                    alert(data.msg);
                    refndModal.hide();
                    gridHelper2.resetPageContent();
                }else{
                    alert(data.msg);
                }
            },
            error : function (error){
            }
       });
     }
 };
</script>