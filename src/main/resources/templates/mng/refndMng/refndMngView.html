<form id="refndMngUpdate" >
    <input type="hidden" id="aplyid" name="aplyid" th:value="${refndMng.aplyid}">
    <!--탭영역 start -->
    <div class="tab-content tabs p-t-20">

        <div class="tab-pane active" id="agencyInfo" role="tabpanel">
            <div class="card">
                <!-- 예약 정보 -->
                <div class="card-header p-b-0">
                    <h3 class="sub-title"><strong>예약 정보</strong></h3>
                </div>
                <div class="card-block-small p-t-0">
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>운영기관</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${refndMng.instNm}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>시설</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${refndMng.fcltNm}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>공간</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${refndMng.spceNm}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>이용일(시)</strong></label>
                                <div class="col-12">
                                    <th:block th:if ="${refndMng.alldayYn} == 'N'">
                                        <input type="text" class="form-control form-control-sm" readonly="" th:value="${#dates.format(refndMng.bgngDt, 'yyyy-MM-dd HH:mm')}+' ~ '+${#dates.format(refndMng.endDt, 'HH:mm')}">
                                    </th:block>
                                    <th:block th:if ="${refndMng.alldayYn} == 'Y' and ${#dates.format(refndMng.bgngDt, 'yyyy-MM-dd')} == ${#dates.format(refndMng.endDt, 'yyyy-MM-dd')}">
                                        <input type="text" class="form-control form-control-sm" readonly="" th:value="${#dates.format(refndMng.bgngDt, 'yyyy-MM-dd')}">
                                    </th:block>
                                    <th:block th:if ="${refndMng.alldayYn} == 'Y' and ${#dates.format(refndMng.bgngDt, 'yyyy-MM-dd')} != ${#dates.format(refndMng.endDt, 'yyyy-MM-dd')}">
                                        <input type="text" class="form-control form-control-sm" readonly="" th:value="${#dates.format(refndMng.bgngDt, 'yyyy-MM-dd')}+' ~ '+${#dates.format(refndMng.endDt, 'yyyy-MM-dd')}">
                                    </th:block>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>신청상태</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${refndMng.aplySttsCdNm}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>예약승인일시</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${#dates.format(refndMng.aplyDt, 'yyyy-MM-dd HH:mm:ss')}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>결제금액</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${#numbers.formatInteger(refndMng.amt, 0, 'COMMA') + '원'}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>결제상태</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${refndMng.stlmSttsCdNm}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>환불요청금액</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${#numbers.formatInteger(refndMng.rfndDmndAmt, 0, 'COMMA') + '원'}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row form-group mb-3">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>환불요청일시</strong></label>
                        <div class="col-12">
                            <input type="text" class="form-control form-control-sm" readonly="" th:value="${#dates.format(refndMng.rfndDmndDt, 'yyyy-MM-dd HH:mm:ss')}">
                        </div>
                    </div>
                </div>
                <!-- 신청자 정보 -->
                <div class="card-header p-t-0 p-b-0">
                    <h3 class="sub-title"><strong>신청자 정보</strong></h3>
                </div>
                <div class="card-block-small p-t-0">
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>신청자 ID</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${refndMng.acnt}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>이름/기관명</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${refndMng.nm}+' / '+${refndMng.userInstNm}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>회원유형</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${refndMng.rolecdnm}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>기관유형</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${refndMng.instTypeCdNm}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>휴대전화</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${refndMng.moblphon}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>이메일</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${refndMng.eml}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 mb-3">
                            <div class="mb-0 form-group">
                                <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>이용인원</strong></div>
                                <div class="col-12 row align-items-center">
                                    <div class="col-auto p-r-0">
                                        성인
                                    </div>
                                    <div class="col-auto">
                                        <input type="text" class="col-lg-auto form-control form-control-sm" style="width: 80px;" readonly="" th:value="${refndMng.nopeAdult}">
                                    </div>
                                    <div class="col-auto p-l-0 p-r-0">
                                        명
                                    </div>
                                    <div class="col-auto p-r-0">
                                        아동
                                    </div>
                                    <div class="col-auto">
                                        <input type="text" class="col-lg-auto form-control form-control-sm" style="width: 80px;" readonly="" th:value="${refndMng.nopeChil}">
                                    </div>
                                    <div class="col-auto p-l-0 p-r-0">
                                        명
                                    </div>
                                    <div class="col-auto p-r-0">
                                        유아
                                    </div>
                                    <div class="col-auto">
                                        <input type="text" class="col-lg-auto form-control form-control-sm" style="width: 80px;" readonly="" th:value="${refndMng.nopeInfnt}">
                                    </div>
                                    <div class="col-auto p-l-0 p-r-0">
                                        명
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row form-group mb-3">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>이용목적</strong></label>
                        <div class="col-12">
                            <textarea rows="5" cols="5" class="form-control form-control-sm" readonly=""><th:block th:text="${refndMng.utztnPrps}"/></textarea>
                        </div>
                    </div>
                </div>
                <!-- 예약자 정보 -->
                <div class="card-header p-t-0 p-b-0">
                    <h3 class="sub-title"><strong>예약자 정보</strong></h3>
                </div>
                <div class="card-block-small p-t-0">
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>이름</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${refndMng.aplcntNm}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>휴대전화</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${refndMng.aplcntMoblphon}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-0 row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>이메일</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${refndMng.aplcntEml}">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 입금정보 -->
                <div class="card-header p-t-0 p-b-0">
                    <h3 class="sub-title"><strong>입금정보</strong></h3>
                </div>
                <div class="card-block-small p-t-0">
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>결제방법</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${refndMng.stlmMthdCdNm}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>입금계좌</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${refndMng.bankCdNm}+' '+${refndMng.bacntNo}+' '+${refndMng.dpstrNm}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>입금자명</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${refndMng.pyrNm}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>입금금액</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${#numbers.formatInteger(refndMng.dpstAmt, 0, 'COMMA') + '원'}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>입금일</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${refndMng.dpstDe}">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 환불정보 -->
                <div class="card-header p-t-0 p-b-0">
                    <h3 class="sub-title"><strong>환불정보</strong></h3>
                </div>
                <div class="card-block-small p-t-0">
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 row form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="rfndBankCd"><strong>환불계좌</strong></label>
                                <div class="col-12 row m-r-0 m-l-0">
                                    <div class="col-3 p-l-0 p-r-0">
                                        <span kattr:select_code="rfndBankCd" id="rfndBankCd" grpCd="154" firstOptTxt="- 선택 -" th:attr="selectedCd=${refndMng.rfndBankCd}" addClass="form-select form-select-sm form-control-sm" disabled=""></span>
                                    </div>
                                    <div class="col-6 p-r-0">
                                        <input type="text" class="form-control form-control-sm" name="rfndBacnt" id="rfndBacnt" readonly="" th:value="${refndMng.rfndBacnt}">
                                    </div>
                                    <div class="col-3 p-r-0">
                                        <input type="text" class="form-control form-control-sm" name="rfndPyrNm" id="rfndPyrNm" readonly="" th:value="${refndMng.rfndPyrNm}">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <th:block th:if ="${refndMng.stlmSttsCd} == '161104'">
                            <div class="col-12 col-lg-6 mb-3">
                                <div class="mb-0 form-group">
                                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="rfndAmt"><strong>환불금액</strong></label>
                                    <div class="col-12">
                                        <input type="text" class="form-control form-control-sm" name="rfndAmt" id="rfndAmt" readonly="" th:value="${refndMng.rfndAmt}">
                                    </div>
                                </div>
                            </div>
                        </th:block>
                    </div>
                    <th:block th:if ="${refndMng.stlmSttsCd} == '161104'">
                        <div class="row">
                            <div class="col-12 col-lg-6 mb-3">
                                <div class="mb-0 form-group">
                                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="rfndDe"><strong>환불일</strong></label>
                                    <div class="col-12">
                                        <input type="text" class="form-control form-control-sm" name="rfndDe" id="rfndDe" readonly="" th:value="${refndMng.rfndDe}">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </th:block>
                </div>
            </div>

            <div class="tab-pane" id="managerInfo" role="tabpanel"></div>

        </div>

    </div>
</form>
<div class="card-block-small">
    <th:block th:if ="${refndMng.stlmSttsCd} == '161103'">
        <button class="btn btn-disabled m-r-5" onclick="fn_openRefndCancelModal()">환불요청취소</button>
        <button class="btn btn-primary" onclick="fn_openRefndCompleteModal()">환불완료</button>
    </th:block>
    <th:block th:if ="${refndMng.stlmSttsCd} == '161104'">
        <button class="btn btn-primary" onclick="updateRefndRollback()">환불완료취소</button>
    </th:block>
</div>
<!-- 임시비밀번호발급 Start -->
<div class="modal fade" id="popCon1" tabindex="-1" role="dialog" aria-labelledby="popCon1Title" aria-hidden="true"></div>
<!-- 임시비밀번호발급 End -->

<script type="text/javascript" src="/files/assets/pages/advance-elements/swithces.js"></script>
<script type="text/javascript" src="/files/assets/pages/advance-elements/select2-custom.js"></script>
<div class="modal fade" data-bs-backdrop="static" id="refndCancelPopup"></div>
<div class="modal fade" data-bs-backdrop="static" id="resveCancelPopup"></div>

<script th:inline="javascript">

    // 환불완료 팝업
    /*<![CDATA[*/
    var refndCancelPopupUrl = "/mng/refndMng/refndCompletePopup.html?"+"aplyid=" + /*[[${refndMng.aplyid}]]*/null;
    /*]]>*/
    var refndCancelAddModal;

    var fn_openRefndCompleteModal = () => {
        $("#refndCancelPopup").load(refndCancelPopupUrl, function(response, status, xhr) {
            if (status == "success") {
                refndCancelAddModal = new bootstrap.Modal($('#refndCancelPopup'));
                refndCancelAddModal.show();
            }
        });
    }

    // 환불요청취소 팝업
    var resveCancelPopupUrl = "/mng/refndMng/refndCancelPopup.html?"+"aplyid=" + /*[[${refndMng.aplyid}]]*/null;
    var resveCancelAddModal;

    var fn_openRefndCancelModal = () => {
        $("#resveCancelPopup").load(resveCancelPopupUrl, function(response, status, xhr) {
            if (status == "success") {
                resveCancelAddModal = new bootstrap.Modal($('#resveCancelPopup'));
                resveCancelAddModal.show();
            }
        });
    }

    function updateRefndRollback() {

        if(!confirm("환불완료를 취소 하시겠습니까?\n환불요청 상태로 전환됩니다.")){return;}

        var data = {
            "aplyid"      : $("#aplyid").val()
        }

        $.ajax({
            url: "/mng/refndMng/updateRefndRollback.do",
            type: 'POST',
            cache : false,
            dataType: 'json',
            data : data,
            success : function (data){
                if(data.result=="success"){
                    alert("환불요청 상태로 변경 되었습니다.");
                    gridHelperComplete.resetPageContent();
                }else{
                    alert("환불완료취소 처리중 에러가 발생하였습니다. 관리자에게 문의 부탁드립니다.");
                }
            },
            error : function (error){
            }
        });
    };
</script>

