<form id="refndMngUpdate" >
    <input type="hidden" id="aplyid" name="aplyid" th:value="${aplyVo.aplyid}">
    <!--탭영역 start -->
    <div class="tab-content tabs p-t-20">

        <div class="tab-pane active" id="agencyInfo" role="tabpanel">
                <!-- 예약 정보 -->
                <div class="card-header p-b-0">
                    <h3 class="sub-title"><strong>예약 정보</strong></h3>
                </div>
                <div class="card-block-small p-t-0">
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>운영기관</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${aplyVo.instNm}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>시설</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${aplyVo.fcltNm}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>공간</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${aplyVo.spceNm}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>이용일(시)</strong></label>
                                <div class="col-12">
                                <th:block th:with="exid= ${#strings.arraySplit(aplyVo.resveDt,'/')} ">
                                    <th:block th:each="item:${exid}" >
                                        <input type="text" class="form-control form-control-sm mb-2" readonly="" th:value ="${item}"/>
                                    </th:block>
                                </th:block>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>신청상태</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${aplyVo.aplySttsCdNm}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group" >
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>예약승인일시</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${#dates.format(aplyVo.dpstIdntyDt, 'yyyy-MM-dd HH:mm:ss')}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>결제금액</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${#numbers.formatInteger(aplyVo.amt, 0, 'COMMA') + '원'}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>결제상태</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${aplyVo.stlmSttsCdNm}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>환불요청금액</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${#numbers.formatInteger(aplyVo.rfndDmndAmt, 0, 'COMMA') + '원'}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row form-group mb-3">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>환불요청일시</strong></label>
                        <div class="col-12">
                            <input type="text" class="form-control form-control-sm" readonly="" th:value="${#dates.format(aplyVo.rfndDmndDt, 'yyyy-MM-dd HH:mm:ss')}">
                        </div>
                    </div>
                </div>
                <!-- 신청자 정보 -->
                <div class="card-header p-t-0 p-b-0">
                    <h3 class="sub-title"><strong>신청자 정보</strong></h3>
                </div>
                <div class="card-block-small p-t-0">
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>신청자 ID</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${aplyVo.acnt}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>이름/기관명</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${aplyVo.nm}+' / '+${aplyVo.userInstNm}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>회원유형</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${aplyVo.rolecdnm}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>기관유형</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${aplyVo.instTypeCdNm}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>휴대전화</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${aplyVo.moblphon}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>이메일</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${aplyVo.eml}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 mb-3">
                            <div class="mb-0 form-group">
                                <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>이용인원</strong></div>
                                <div class="col-12 row align-items-center">
                                    <div class="col-auto p-r-0">
                                        성인
                                    </div>
                                    <div class="col-auto">
                                        <input type="text" class="col-lg-auto form-control form-control-sm" style="width: 80px;" readonly="" th:value="${aplyVo.nopeAdult}">
                                    </div>
                                    <div class="col-auto p-l-0 p-r-0">
                                        명
                                    </div>
                                    <div class="col-auto p-r-0">
                                        아동
                                    </div>
                                    <div class="col-auto">
                                        <input type="text" class="col-lg-auto form-control form-control-sm" style="width: 80px;" readonly="" th:value="${aplyVo.nopeChil}">
                                    </div>
                                    <div class="col-auto p-l-0 p-r-0">
                                        명
                                    </div>
                                    <div class="col-auto p-r-0">
                                        유아
                                    </div>
                                    <div class="col-auto">
                                        <input type="text" class="col-lg-auto form-control form-control-sm" style="width: 80px;" readonly="" th:value="${aplyVo.nopeInfnt}">
                                    </div>
                                    <div class="col-auto p-l-0 p-r-0">
                                        명
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row form-group mb-3">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>이용목적</strong></label>
                        <div class="col-12">
                            <textarea rows="5" cols="5" class="form-control form-control-sm" readonly=""><th:block th:text="${aplyVo.utztnPrps}"/></textarea>
                        </div>
                    </div>
                </div>
                <!-- 예약자 정보 -->
                <div class="card-header p-t-0 p-b-0">
                    <h3 class="sub-title"><strong>예약자 정보</strong></h3>
                </div>
                <div class="card-block-small p-t-0">
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>이름</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${aplyVo.aplcntNm}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>휴대전화</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${aplyVo.aplcntMoblphon}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-0 row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>이메일</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${aplyVo.aplcntEml}">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 입금정보 -->
                <div class="card-header p-t-0 p-b-0">
                    <h3 class="sub-title"><strong>입금정보</strong></h3>
                </div>
                <div class="card-block-small p-t-0">
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>결제방법</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${aplyVo.stlmMthdCdNm}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>입금계좌</strong></label>
                                <div class="col-12">
                                                                        <input type="text" class="form-control form-control-sm" readonly="" th:value="${aplyVo.dpstBankCdNm+' '+aplyVo.dpstBacnt}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>입금자명</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${aplyVo.pyrNm}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>입금금액</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${#numbers.formatInteger(aplyVo.dpstAmt, 0, 'COMMA') + '원'}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>입금일</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${aplyVo.dpstDe}">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 환불정보 -->
                <div class="card-header p-t-0 p-b-0" th:if ="${aplyVo.stlmSttsCd} == '161104'">
                    <h3 class="sub-title"><strong>환불정보</strong></h3>
                </div>
                <div class="card-block-small p-t-0" th:if ="${aplyVo.stlmSttsCd} == '161104'" >
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 row form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="rfndBankCd"><strong>환불계좌</strong></label>
                                <div class="col-12 row m-r-0 m-l-0">
                                    <div class="col-3 p-l-0 p-r-0">
                                        <span kattr:select_code="rfndBankCd" id="rfndBankCd" grpCd="154" firstOptTxt="- 선택 -" th:attr="selectedCd=${aplyVo.rfndBankCd}" addClass="form-select form-select-sm form-control-sm" disabled=""></span>
                                    </div>
                                    <div class="col-6 p-r-0">
                                        <input type="text" class="form-control form-control-sm" name="rfndBacnt" id="rfndBacnt" readonly="" th:value="${aplyVo.rfndBacnt}">
                                    </div>
                                    <div class="col-3 p-r-0">
                                        <input type="text" class="form-control form-control-sm" name="rfndPyrNm" id="rfndPyrNm" readonly="" th:value="${aplyVo.rfndPyrNm}">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- <th:block th:if ="${aplyVo.stlmSttsCd} == '161104'"> -->
                            <div class="col-12 col-lg-6 mb-3">
                                <div class="mb-0 form-group">
                                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="rfndAmt"><strong>환불금액</strong></label>
                                    <div class="col-12">
                                        <input type="text" class="form-control form-control-sm" name="rfndAmt" id="rfndAmt" readonly="" th:value="${aplyVo.rfndAmt}">
                                    </div>
                                </div>
                            </div>
<!--                         </th:block> -->
                    </div>
<!--                     <th:block th:if ="${aplyVo.stlmSttsCd} == '161104'"> -->
                        <div class="row">
                            <div class="col-12 col-lg-6 mb-3">
                                <div class="mb-0 form-group">
                                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="rfndDe"><strong>환불일</strong></label>
                                    <div class="col-12">
                                        <input type="text" class="form-control form-control-sm" name="rfndDe" id="rfndDe" readonly="" th:value="${aplyVo.rfndDe}">
                                    </div>
                                </div>
                            </div>
                        </div>
<!--                     </th:block> -->
                </div>
            </div>
            <div class="tab-pane" id="managerInfo" role="tabpanel"></div>
    </div>
</form>
<div class="card-block-small">
    <th:block th:if ="${aplyVo.stlmSttsCd} == '161103'">
        <button class="btn btn-disabled m-r-5" onclick="fn_openRefndCancelModal()">환불요청취소</button>
        <button class="btn btn-primary" onclick="fn_openRefndCompleteModal()">환불완료</button>
    </th:block>
    <th:block th:if ="${aplyVo.stlmSttsCd} == '161104'">
        <button class="btn btn-primary" onclick="updateRefndRollback()">환불완료취소</button>
    </th:block>
</div>

<script th:inline="javascript">

    //환불 요청 취소  
    var fn_openRefndCancelModal=()=>{
    	openCancelRefundPopup($("#aplyid").val());
    }
    //환불완료
    var fn_openRefndCompleteModal=()=>{
        completeRefund($("#aplyid").val())
    }
    //환불 완료 취소
    function updateRefndRollback() {
    	cancelRefund($("#aplyid").val());
    };
</script>

