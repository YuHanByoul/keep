<form id="modifyFrm" action="" onsubmit="return false;">
    <div class="col-12">
       <div class="card">
           <div class="card-header p-b-0">
               <h3 class="sub-title"><strong>기본 정보</strong></h3>
           </div>
           <div class="card-block-small p-t-0">
               <div class="row">
                   <div class="col-12 col-lg-6 mb-3">
                       <div class="mb-2 form-group required">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="rcritNm"><strong>대여모집명</strong></label>
                           <div class="col-12">
                               <input type="text" class="form-control form-control-sm" name="rcritNm" id="rcritNm" />
                           </div>
                       </div>
                   </div>
                   
                   <div class="col-12 col-lg-6 mb-3">
                      <div class="mb-0 form-group required">
                           <div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
                               <strong>모집 여부</strong></div>
                           <div class="col-12">
                               <div class="form-radio">
                                   <div class="radio radio-inline">
                                       <label class="mb-0 form-label">
                                           <input type="radio" name="operYn" value="Y" checked>
                                           <i class="helper"></i>Y
                                       </label>
                                   </div>
                                   <div class="radio radio-inline">
                                       <label class="mb-0 form-label">
                                           <input type="radio" name="operYn" value="N" >
                                           <i class="helper"></i>N
                                       </label>
                                   </div>
                               </div>
                           </div>
                       </div>
                   </div>
                   
               </div>
           </div>
           <div class="card-header p-t-0 p-b-0">
               <h3 class="sub-title"><strong>대여접수 설정</strong></h3>
           </div>
           <div class="card-block-small p-t-0">
               <div class="row">
                   <div class="col-12 col-md-6 col-lg-3 mb-3">
                       <div class="mb-0 form-group required">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="bgngDt"><strong>대여 접수 시작일시</strong></label>
                           <div class="col-12">
                               <input type="datetime-local" class="form-control form-control-sm" name="bgngDt" id="bgngDt">
                           </div>
                       </div>
                   </div>
                   <div class="col-12 col-md-6 col-lg-3 mb-3">
                       <div class="mb-0 form-group required">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="endDt"><strong>대여 접수 마감일시</strong></label>
                           <div class="col-12">
                               <input type="datetime-local"  class="form-control form-control-sm" name="endDt" id="endDt" >
                           </div>
                       </div>
                   </div>
                   <div class="col-12 col-md-6 col-lg-3 mb-3">
                       <div class="mb-2 form-group required">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="rentalRecruitmentName"><strong>대여 차수/수량 제한</strong></label>
                           <div class="col-12">
                           <span kattr:select_code="lmtCd" grpCd="225" firstOptTxt="-전체 -"  addClass="form-select form-select-sm " ></span>
                           </div>
                       </div>
                   </div>
               </div>
           </div>
           <div class="row">
               <div class="col-12">
                   <div class="card-header p-t-0 p-b-0">
                       <h3 class="sub-title"><strong>대여차시 설정</strong></h3>
                   </div>
                     <div class="card-block-small p-t-0" id="rndArea">
                     
	                       <div class="row mb-3 rnd-frm"  id="frm1" data-chasi = "1" >
	                       
	                           <div class="col-md-auto mt-1 mt-md-0">
	                               <button class="input-group-text btn btn-primary btn-sm" onclick="plusFrm(1)">+</button>
	                               <button class="input-group-text btn btn-primary btn-sm" onclick="minusFrm(1)"disabled>-</button>
	                           </div>
	                           <div class="col-md-auto mt-1 mt-md-0" id="rndNum"  >1차</div>
	                           <div class="col-md">
	                               <div class="row">
	                                   <div class="col-md-auto mt-1 mt-md-0">
	                                       <div class="col-form-label col-sm-12 p-t-0 pb-1"><strong>대여 시작일</strong></div>
	                                       <div class="col-12">
	                                           <input type="date" class="form-control form-control-sm" aria-label="대여 시작일" id="bgngDe"> 
	                                       </div>
	                                   </div>
	                                   <div class="col-md-auto mt-2 mt-md-0">
	                                       <div class="col-form-label col-sm-12 p-t-0 pb-1"><strong>대여 반납일</strong></div>
	                                       <div class="col-12">
	                                           <input type="date" class="form-control form-control-sm" aria-label="대여 반납일" id="endDe">
	                                       </div>
	                                   </div>
	                               </div>
	                               <div class="d-flex align-items-center mt-2">
	                                   <div class="dropdown-primary dropdown">
	                                       <button class="btn btn-primary dropdown-toggle btn-sm" type="button" id="dropdown-1" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">+ 꾸러미 개체 추가</button>
	                                       <div class="dropdown-menu" aria-labelledby="dropdown-1" data-dropdown-in="fadeIn" data-dropdown-out="fadeOut">
	                                           <a class="dropdown-item " href="javascript:searchRndPack('1')" >꾸러미 개체 검색</a>
	                                           <a class="dropdown-item " href="javascript:preRndPack('1')">이전 차시 꾸러미</a>
	                                       </div>
	                                   </div>
	                                   <sapn class="text-md-center ms-3"  ><strong >총 <span id="packCnt">0</span>개</strong></sapn>
	                               </div>
	                               <div class="bg-light border mt-2 p-10 rounded"  id="packArea" style="min-height:34px;">
							       </div>
	                           </div>
	                       </div>
                       
                   </div>
               </div>
           </div>
           
           
           <div class="card-header p-t-0 p-b-0">
               <h3 class="sub-title"><strong>이미지/안내자료 업로드</strong></h3>
           </div>
           <div class="card-block-small p-t-0">
               <div class="row">
               
                   <!--대표 이미지-->
                   <div class="col-12 col-lg-6 mb-3">
                       <div class="mb-0 form-group">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="rentalRecruitmentMainImage"><strong>대표 이미지</strong></label>
                           <div class="col-12">
                               <input type="file" id="rprsImgFile" name="rprsImgFile" class="form-control form-control-sm"/>
                           </div>
                           <div class="mt-2 row">
                               <div class="col-auto">
                                 <input type="hidden" id="rprsImgFileGrpid" name="rprsImgFileGrpid" value="0"/>
                                 <input type="hidden" id="rprsImgFileid" name="rprsImgFileid" />
                                 <!-- 파일 명 및 삭제 버튼 영역-->
                                 <span id="rprsImgFileArea"></span>
                               </div>
                           </div>
                       </div>
                   </div>
                   
                   <!-- 상세 이미지-->
                   <div class="col-12 col-lg-6 mb-3">
                       <div class="mb-0 form-group">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="rentalRecruitmentDetailImage"><strong>상세 이미지</strong></label>
                           <div class="col-12">
                               <input type="file" multiple class="form-control form-control-sm" name="dtlImgFile" id="dtlImgFile"/>
                           </div>
                           <div class="mt-2 row">
                               <div class="col-auto" >
                                 <input type="hidden" id="dtlImgFilegrpid" name="dtlImgFilegrpid" value="0"/>
                                 <input type="hidden" id="dtlImgFileid" name="dtlImgFileid" />
                                 <!-- 파일 명 및 삭제 버튼 영역-->
                                 <span id="dtlImgFileArea"></span>
                                   
                               </div>
                           </div>
                       </div>
                   </div>
               </div>
               <div class="mb-0 row">
               
                   <!-- 지도안 -->
                   <div class="col-12 col-lg-6 mb-3">
                       <div class="mb-0 form-group">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="rentalRecruitmentMap"><strong>지도안</strong></label>
                           <div class="col-12">
                               <input type="file" multiple class="form-control form-control-sm" name="mapFile" id="mapFile"/>
                           </div>
                           <div class="mt-2 row">
                               <div class="col-auto">
                                 <input type="hidden" id="mapFilegrpid" name="mapFilegrpid" value="0"/>
                                 <!-- 파일 명 및 삭제 버튼 영역-->
                                 <span id="mapFileArea"></span>
                           
                               </div>
                           </div>
                       </div>
                   </div>
                   
                   <!-- 교육사진-->
                   <div class="col-12 col-lg-6 mb-3">
                       <div class="mb-0 form-group">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="rentalRecruitmentEduPicture"><strong>교육사진</strong></label>
                           <div class="col-12">
                               <input type="file" multiple class="form-control form-control-sm" name="eduPhotoFile" id="eduPhotoFile"/>
                           </div>
                           <div class="mt-2 row">
                               <div class="col-auto">
                                 <input type="hidden" id="eduPhotoFilegrpid" name="eduPhotoFilegrpid" value="0"/>
                                 <!-- 파일 명 및 삭제 버튼 영역-->
                                 <span id="eduPhotoFileArea"></span>
                               </div>
                           </div>
                       </div>
                   </div>
                   
               </div>
           </div>
           <div class="card-header p-t-0 p-b-0">
               <h3 class="sub-title"><strong>상세 정보</strong></h3>
           </div>
           <div class="card-block-small p-t-0">
               <div class="mb-3 form-group row">
                   <div class="col-12">
                       <textarea rows="5" cols="5" class="form-control form-control-sm"  id="dtlCn" name="dtlCn"></textarea>
                   </div>
               </div>
               <div class="row">
                   <div class="col-12 col-lg-6 mb-3">
                       <div class="mb-0 form-group">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="rentalRecruitmentVideoUrl"><strong>유튜브 동영상 URL</strong>
                               <a href="javascript:void(0)" data-bs-toggle="tooltip" data-bs-html="true" data-bs-original-title="ex) https://www.youtube.com/watch?v= <span class='text-danger'>E4Qct1k3s_Q</span><br/>&#8251; Youtube 주소에서 붉은색 부분을 복사해서 넣어주세요.">
                                   <i class="fa fa-question-circle-o"></i>
                                   <div class="col-auto border p-2 bg-white pos-absolute rounded" style="display: none;">
                                       ex) https://www.youtube.com/watch?v= <span class="text-danger">E4Qct1k3s_Q</span><br/>
                                       &#8251; Youtube 주소에서 붉은색 부분을 복사해서 넣어주세요.
                                   </div>
                               </a>
                           </label>
                           <div class="col-12 d-flex align-items-center text-nowrap">
                               https://www.youtube.com/watch?v=
                               <input type="text" class="col-lg-auto form-control form-control-sm" name="mvpUrl" id="mvpUrl">
                           </div>
                       </div>
                   </div>
                   <div class="col-12 col-lg-6 mb-3">
                       <div class="mb-0 form-group required">
                           <div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
                               <strong>동영상 위치 설정</strong></div>
                           <div class="col-12">
                           
                               <div class="form-radio">
                                 <span kattr:radio_code="mvpPstnCd" grpCd="226"  selectedCd="226101" isAdmin="true">
                               </div>

                           </div>
                       </div>
                   </div>
               </div>
           </div>
           <div class="card-header p-t-0 p-b-0">
               <h3 class="sub-title"><strong>유의사항</strong></h3>
           </div>
           <div class="card-block-small p-t-0">
               <div class="mb-3 form-group row">
                   <div class="col-12">
                       <textarea rows="5" cols="5" class="form-control form-control-sm" id="atentMttr" name="atentMttr"></textarea>
                   </div>
               </div>
           </div>
           <div class="card-block-small">
               <button type="button"class="btn btn-disabled m-r-5" onclick="javascript:gridHelper1.removeHighlight(); gridHelper1.toggleContent();">취소</button>
               <button type="button"class="btn btn-primary" onclick="save()">저장</button>
           </div>
       </div>
   </div>
</form>

<script type="text/javascript" src="/files/assets/pages/advance-elements/select2-custom.js"></script>


<script  id="rndFrm" type="text/x-handlebars-template">
 <div class="row mb-3 rnd-frm"  id="frm{{frmNum}}" data-chasi ="0" >
     <div class="col-md-auto mt-1 mt-md-0">
         <button type="button" class="input-group-text btn btn-primary btn-sm"onclick="plusFrm({{frmNum}})" >+</button>
         <button type="button" class="input-group-text btn btn-primary btn-sm"onclick="minusFrm({{frmNum}})">-</button>
     </div>
     <div class="col-md-auto mt-1 mt-md-0" id="rndNum" > {{rndNum}} 차  </div>
     <div class="col-md">
         <div class="row">
             <div class="col-md-auto mt-1 mt-md-0">
                 <div class="col-form-label col-sm-12 p-t-0 pb-1"><strong>대여 시작일</strong></div>
                 <div class="col-12">
                     <input type="date" class="form-control form-control-sm" aria-label="대여 시작일" id="bgngDe" >
                 </div>
             </div>
             <div class="col-md-auto mt-2 mt-md-0">
                 <div class="col-form-label col-sm-12 p-t-0 pb-1"><strong>대여 반납일</strong></div>
                 <div class="col-12">
                     <input type="date" class="form-control form-control-sm" aria-label="대여 반납일" id="endDe">
                 </div>
             </div>
         </div>
         <div class="d-flex align-items-center mt-2">
             <div class="dropdown-primary dropdown">
                 <button class="btn btn-primary dropdown-toggle btn-sm" type="button" id="dropdown-5" 
                         data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" >+ 꾸러미 개체 추가</button>

                 <div class="dropdown-menu" aria-labelledby="dropdown-5" data-dropdown-in="fadeIn" data-dropdown-out="fadeOut">
                     <a class="dropdown-item " href="javascript:searchRndPack({{frmNum}})">꾸러미 개체 검색</a>
                     <a class="dropdown-item " href="javascript:preRndPack({{frmNum}})">이전 차시 꾸러미</a>
                 </div>
             </div>
             <sapn class="text-md-center ms-3"><strong >총 <span id="packCnt">0</span>개 </strong></sapn>
         </div>
         <div class="bg-light border mt-2 p-10 rounded"  id="packArea" style="min-height:36px;"></div>
     </div>
 </div>
</script>

<script  id="packageSpan" type="text/x-handlebars-template">
   <span class="label label-inverse pack-{{frmNum}}" id="{{frmNum}}_{{packageindvdid}}" 
                  data-packageindvdid = "{{packageindvdid}}" 
                  data-packageindvdnm = "{{packageindvdNm}}" 
                  data-indvdno = "{{indvdno}}" 
                  data-frmNum = "{{frmNum}}" 
   >
       {{packageindvdNm}} ({{indvdno}}) <a href="javascript:removePack('{{frmNum}}_{{packageindvdid}}','{{frmNum}}');" class="text-white">X</a>
   </span>
</script>

<script th:inline="javascript">

    var maxFrmNum = 1;
    var modalFrmNum ;
    
    $(function(){
    	$('[data-bs-toggle="tooltip"]').tooltip();
    	bindMultipleLendFile("dtlImgFile","dtlImgFilegrpid","dtlImgFileArea");
    	bindMultipleLendFile("mapFile","mapFilegrpid","mapFileArea");
    	bindMultipleLendFile("eduPhotoFile","eduPhotoFilegrpid","eduPhotoFileArea");
    })
    
    resetRndNumber=()=>{
        var frmCnt = 0;
        $(".rnd-frm").each(function(){
           frmCnt = frmCnt+1;
           var id = $(this).attr("id");
           $("#"+id).attr("data-chasi",frmCnt);
           $("#"+id+"  #rndNum").text(frmCnt+"차");
        })
    }
    
    plusFrm=()=>{
        
        var frmCnt = 0 ; 
        $(".rnd-frm").each(function(){ frmCnt++ })
        
        if(frmCnt >= 10){
            alert("차시는 10회까지 가능합니다.");
            return;
        }
        maxFrmNum = maxFrmNum + 1;
        var source = $("#rndFrm").html();
        var template = Handlebars.compile(source);
        var data = { frmNum : maxFrmNum };
        $("#rndArea").append(template(data));
        resetRndNumber();
    }
    minusFrm=(frmNum)=>{
        $("#frm"+frmNum).remove();
        resetRndNumber();
    }
    searchRndPack=(frmNum)=>{
    	openSearchModal(frmNum);
    }
    removePack=(elId,frmNum)=>{
        $("#"+elId).remove();
        resetPackCnt(frmNum);
    }
    resetPackCnt=(frmNum)=>{
        var packCnt = 0;
    	$(".pack-"+frmNum).each(function(){	packCnt++; })
    	$("#frm"+frmNum+"  #packCnt").text(packCnt);
    }
    preRndPack=(frmNum)=>{
    	var frmCnt = 0;
    	var frmCntArr=[];
    	
    	$(".rnd-frm").each(function(){ 
        	frmCnt++;
        })
        
        var chasi = $("#frm"+frmNum).data("chasi");
        
    	if(chasi==1){
        	alert("이전차시가 없습니다.")
        	return;
        }
        
        var preChasi = Number(chasi)-1;
        var preFrmNum = ($("[data-chasi='"+preChasi+"']").attr("id")).replace("frm","");
        
        if($(".pack-"+preFrmNum).length<=0){
            alert("이전 차시에 선택된 꾸러미 개체가 없습니다.");
            return;
        }

        $("#frm"+frmNum+ "  #packArea").html("");

        var preItems = []
        $(".pack-"+preFrmNum).each(function(){
        	preItems.push(
            {
            	packageindvdid:$(this).data("packageindvdid"),
            	packageindvdNm:$(this).data("packageindvdnm"),
            	indvdno :$(this).data("indvdno"),
            	frmNum : frmNum
            }
            )
        })
        
        preItems.forEach(function(item){
            
             var source = $("#packageSpan").html();
             var template = Handlebars.compile(source);
             var data = { 
                     frmNum : frmNum,
                     packageindvdid :item.packageindvdid,
                     packageindvdNm :item.packageindvdNm,
                     indvdno:item.indvdno
                     };
             $("#frm"+frmNum+ "  #packArea").append(template(data));
        })

        resetPackCnt(frmNum);
    }


    
    openSearchModal = (frmNum) => {
    	modalFrmNum = frmNum;
        var url = "/mng/lend/searchPackageindvdPopup.html";
        $("#lendModal").load(url, function(response, status, xhr) {
            if (status == "success") {
            	lendModal = new bootstrap.Modal($('#lendModal'));
            	lendModal.show();
            }
        });
    }

    //대표이미지  첨부 
    $('#rprsImgFile').on('change', function(event) {
        
         var formData = new FormData();
         var objFile = event.target;
         
         formData.append("file", objFile.files[0]);
         formData.append("filegrpNm", "lendLogo_file");
         
         if($('#rprsImgFileGrpid').val() != '')
             formData.append("filegrpid", $('#rprsImgFileGrpid').val());

         if(displayWorkProgress()){
             $.ajax({
                 url : '/uploadFile.do',
                 processData : false,
                 contentType : false,
                 data : formData,
                 type : 'POST',
                 success : function(response) {
                     
                     if(response.result == 'fail'){
                         alert(response.msg);
                     }else if(response.filegrpid != undefined && response.filegrpid != ''){
                         $("#rprsImgFileGrpid").val(response.filegrpid);
                         $("#rprsImgFileid").val(response.fileid);
                         let imageStr = '<span id="logo_img_'+response.fileid+'" class="label label-inverse">'+response.orginlFileNm
                                        +' &nbsp;&nbsp;&nbsp;<a href="javascript:deleteLogoFile('+response.fileid+','+response.fileIdntfcKey+')" class="text-white">X</a>'
                                        +'</span>'

                         $("#rprsImgFileArea").html(imageStr);
                         clearFileInput("rprsImgFile");
                     }
                     closeWorkProgress();
                 }
             });
         }
         event.preventDefault();
    });
    
    bindMultipleLendFile=(fileInputId, fileGrpId, fileInfoAppendAreaId)=>{
        
        $('#'+fileInputId).on("change", function(event) {
           var objFile = document.querySelector('#'+fileInputId);
           var formData = new FormData();
           var content = "";
           var uploadFileCnt = 0;
           
           for( i = 0 ; i < objFile.files.length ; i++) {
               formData.append("files", objFile.files[i]);
               uploadFileCnt++;
           }
           
           formData.append("filegrpid", $("#"+fileGrpId).val());
           formData.append("filegrpNm", "lend_file");
           
               $.ajax({
                   url : '/uploadMultipleFiles.do',
                   processData : false,
                   contentType : false,
                   data : formData,
                   type : 'POST',
                   success : function(response) {
                       if(response.result == 'fail'){
                          alert(response.msg);
                       }else{
                           
                           if($("#"+fileGrpId).val()=='0' || $("#"+fileGrpId).val()=='' || $("#"+fileGrpId).val()==null ){
                               $("#"+fileGrpId).val( response[0].filegrpid );
                           }
                           for(i = 0 ;i < response.length; i++ ){
                               content = "<span class ='label label-inverse mb-2' id='lendFile_"+response[i].fileid+"'>"+response[i].orginlFileNm ;
                               content +="&nbsp;&nbsp;  <a  class = 'text-white' href = javascript:fn_deleteInstFile('"+response[i].fileid+"','"+response[i].fileIdntfcKey+"')>X</a></span>";
                               $('#'+fileInfoAppendAreaId).append(content);
                           }
                       }
                       clearFileInput(fileInputId);
                   }
               })
        });
    }
    
    clearFileInput=(fileInputid)=>{
        if (detectBrowser() == "other") { 
            $("#"+fileInputid).val("");
        } else {   
           $("#"+fileInputid).replaceWith( $("#"+fileInputid).clone(true)) 
        }
    } 

    var validator= $("#modifyFrm").validate({
		    onsubmit: false,
	          rules: {
		        	     rcritNm      :   { required: true , maxlength: 50 }
		        	    ,bgngDt       :   { required: true }
		        	    ,endDt        :   { required: true }
		        	    ,lmtCd        :   { required: true }  
		        	    ,mvpPstnCd    :   { required: true }  
	            },
	            messages: {
		        	     rcritNm      :   { required: "대여모집명을 입력해주십시오" , maxlength: 50 }
		        	    ,bgngDt       :   { required: "대여 접수 시작 일시를 입력해주십시오" }
		        	    ,endDt        :   { required: "대여 접수 시작 종료일을 입력해주십시오" }
		        	    ,lmtCd        :   { required: "대여차수/제한 코드를 선택해주십시오" }  
		        	    ,mvpPstnCd    :   { required: "동영상 위치 설정을 입력해주십시오" }  
	            }
	})
	
 	function save(){
     	
	 	if(!($("#modifyFrm").valid())) return;
	 	
	 	var rndArr = [];
        $(".rnd-frm").each(function(){
            
            var id     = ($(this).attr("id")).replace("frm","");
            var ordr  = $("#frm"+id).data("chasi");
            var bgngDe = $("#frm"+id+"  #bgngDe").val();
            var endDe  = $("#frm"+id+"  #endDe").val();

            var packindvdids =[];
            $(".pack-"+id).each(function(){
            	packindvdids.push($(this).data("packageindvdid"))
            })
            rndArr.push(
                    {
                        frmNum  : id
                        ,ordr  : ordr
                        ,bgngDe : bgngDe
                        ,endDe  : endDe
                        ,lendRndPackageindvdids : packindvdids
                    }
            )
        })
        
        //대여시작/반납일, 개체 추가 여부 체크
        var bgngDeErrorNum = 0;
        var endDeErrorNum = 0;
        var noPackageErrorNum = 0;
        var isBeforeBgngDtErrorNum = 0;
        var isOverChasiDtErrorNum = 0;
        var bgngDt = ($("#bgngDt").val()).substring(0,10).replaceAll("-","") ;
        var isError = false;
        var preItem = null;
        
        rndArr.forEach(function(item){
            
            if((item.bgngDe==null || item.bgngDe=="" || typeof  item.bgngDe=="undefined" )&& !isError ){
                bgngDeErrorNum = ( bgngDeErrorNum > 0)? bgngDeErrorNum:item.frmNum;
                isError = true;
            }
            if((item.endDe==null || item.endDe=="" || typeof item.endDe=="undefined")&& !isError ){
                endDeErrorNum = ( endDeErrorNum > 0)? endDeErrorNum:item.frmNum;
                isError = true;
            }
            if((item.lendRndPackageindvdids==null || item.lendRndPackageindvdids=="" || typeof item.lendRndPackageindvdids=="undefined")&& !isError ){
                noPackageErrorNum = ( noPackageErrorNum > 0)? noPackageErrorNum:item.frmNum;
                isError = true;
            }
            if((bgngDt > item.endDe)&& !isError ){
                isBeforeBgngDtErrorNum = ( isBeforeBgngDtErrorNum > 0)? isBeforeBgngDtErrorNum:item.frmNum;
                isError = true;
            }
            
            if(preItem != null && preItem.bgngDe > item.bgngDe &&  preItem.endDe > item.endDe){
                isOverChasiDtErrorNum = ( isOverChasiDtErrorNum > 0)? isOverChasiDtErrorNum:item.frmNum;
                isError = true;
            }
            preItem = item;
            
        })
        
        if(bgngDeErrorNum > 0 ){
            alert("대여 시작일을 입력해주십시오.");
            showErrorMark("#frm"+bgngDeErrorNum+"  #bgngDe");
            return;
        }
        if(endDeErrorNum > 0 ){
            alert("대여 종료일을 입력해주십시오.");
            showErrorMark("#frm"+endDeErrorNum+"  #endDe");
            return;
        }
        if(noPackageErrorNum > 0 ){
            alert("꾸러미 개체를 추가해주십시오.");
            showErrorMark("#frm"+noPackageErrorNum+"  .dropdown");
            return;
        }
        if(noPackageErrorNum > 0 ){
            alert("대여 반납일은 대여접수 시작일시 이후여야 합니다.");
            showErrorMark("#frm"+isBeforeBgngDtErrorNum+"  #endDe");
            return;
        }
        if(isOverChasiDtErrorNum > 0 ){
            alert("이전 차시의 대여일보다 이후여야 합니다.");
            showErrorMark("#frm"+isOverChasiDtErrorNum+"  #bgngDe");
            showErrorMark("#frm"+isOverChasiDtErrorNum+"  #endDe");
            return;
        }
        
        //대여일자 중복 체크 
        var isBgngOverNum = 0;
        var isThereDuplData = false;
        rndArr.forEach(function(map){
        	if((map.bgngDe).replaceAll("-","")>(map.endDe).replaceAll("-","")){
        		isBgngOverNum = (isBgngOverNum>0)?isBgngOverNum :map.frmNum	;
            }
        	rndArr.forEach(function(item){
                
                let  compareBgngDe= (item.bgngDe).replaceAll("-","") 
                let  compareEndDe= (item.endDe).replaceAll("-","")
                
                if( bgngDe > compareBgngDe && bgngDe < compareEndDe ){
                	isThereDuplData = true;
                } 
                if( endDe > compareBgngDe && endDe < compareEndDe ){
                	isThereDuplData = true;
                } 
            })
        })
        
        if(isBgngOverNum > 0 ){
            alert("시작일자와 종료일자를 확인해주십시오.");
            showErrorMark("#frm"+isBgngOverNum+" #bgngDe");
            showErrorMark("#frm"+isBgngOverNum+" #endDe");
            return;
        }
        
        if(isThereDuplData){
            alert("중복된 일자가 있습니다.");
            return;
        }

        if(!confirm("저장하시겠습니까?"))return;

  	 	let params={
  	 	  	 	
  	 		rcritNm : $("#rcritNm").val(),
  	 		lmtCd : $("#lmtCd").val(),
  	 		dtlCn : $("#dtlCn").val(),
  	 		atentMttr : $("#atentMttr").val(),
  	 		mvpUrl : $("#mvpUrl").val(),
  	 		bgngDt : ($("#bgngDt").val()).replace("T"," "),
  	 		endDt : ($("#endDt").val()).replace("T"," "),
  	 		rprsImgFileid     : $("#rprsImgFileid").val(),
  	 		dtlImgFilegrpid   : $("#dtlImgFilegrpid").val(),
  	 		mapFilegrpid      : $("#mapFilegrpid").val(),
  	 		eduPhotoFilegrpid : $("#eduPhotoFilegrpid").val(),
  	 		operYn : $("input[name=operYn]:checked").val(),
  	 		mvpPstnCd : $("input[name=mvpPstnCd]:checked").val(),
  	 		lendRndList :rndArr
  	  	}

	    if(displayWorkProgress()){
			$.ajax({
				url : "/mng/lend/insertLend.do",
				type: 'POST',
				cache : false,
				traditional : true, //필수
				dataType: 'json',
				contentType: "application/json; charset=utf-8",
				data : JSON.stringify(params),
				success : function (data){
					if(data.result=="success"){
						alert(data.msg);
						gridHelper1.resetListContent();
					}else{
						alert(data.msg);
					}
					closeWorkProgress();
				}
			});
		}
	}
    
</script>