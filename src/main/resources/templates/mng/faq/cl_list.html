<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security" 
	xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout" 
	layout:decorator="layout/mng/subLayout" 
>
<head>
<meta charset="utf-8" />
<body>
    <div layout:fragment="content">
        <div class="panel-body">
            <div class="well well-sm row">
                <div class="form-group col-sm-10 form-control-static">
                    <label class="control-label ">대상</label>
                    <div class="faq-cl-radio"> 
                        <input type="radio" name="searchType" id="user_se_cd_11" value="P" ><label for="user_se_cd_11">개인</label>
                        <input type="radio" name="searchType" id="user_se_cd_22" value="C" ><label for="user_se_cd_22">기업</label>
                    </div>
                </div>
            </div>
        </div>
		
		<div class="text-right" style="margin-bottom: 5px;">
			<a  class="btn btn-sm btn-warning"  onclick="openRegForm()" > 분류 추가 </a>
		</div>
		
		<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true" style="padding-top:20px;" >
			<!-- List Area -->
			<div class="panel panel-default">
				<div class="panel-heading" role="tab" id="headingOne">
			  		<h4 class="panel-title">
			  		   <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne" onclick="toggleList();">목록</a>
			  		</h4>
				</div>
			<div id="collapseList" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
		  	     <div class="panel-body">
					<div class="row">
						<table id="jsGrid"></table>
						<div id="listPager" class="text-center"></div>
					</div>
				</div>
			</div>
		   </div>
		</div>
		
		     <div class="panel-group" id="regForm" role="tablist" aria-multiselectable="true" style="padding-top:20px;display:none;" >
					<!-- List Area -->
					<div class="panel panel-default">
				    	<div class="panel-heading" role="tab" id="headingOne">
				      		<h4 class="panel-title">
				        		등록
				      		</h4>
				    	</div>
				    	<div id="collapseList" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne" style="">
				      		<div class="panel-body">
				      		<div class="spacer-xs">
						  <div id="insertClForm" >
						  <form id="faqClForm">						  
						    <table class="table table-condensed ">
						     <tbody>
						       <tr>
						         <td style="width:15%">
						           <label class="control-label">분류코드 </label>
						         </td>
						         <td>
									<input type="text" class="form-control input-sm  inputForm" id="clid" name= "clid" placeholder="자동생성" readOnly />
						         </td>
						       </tr>
						       <tr>
						         <td style="width:15%">
						           <label class="control-label"><span class="text-danger">*</span>대상</label>
						         </td>
						         <td>
                        <div class="faq-radio"> 
                            <input type="radio" name="user_se_cd" id="user_se_cd_111" value="P" ><label for="user_se_cd_111">개인</label>
                            <input type="radio" name="user_se_cd" id="user_se_cd_222" value="C" ><label for="user_se_cd_222">기업</label>
                        </div>
	                               
						         </td>
						       </tr>
						       <tr>
						         <td style="width:15%">
						           <label class="control-label"><span class="text-danger">*</span> 분류명</label>
						         </td>
						         <td>
						           <input type="text" class="form-control input-sm inputForm" id="cl_nm" name= "cl_nm" placeholder="분류명" />
						         </td>
						       </tr>
						       <tr>
						         <td style="width:15%">
						           <label class="control-label"><span class="text-danger">*</span> 사용여부  </label>
						         </td>
						         <td>
						           <div >
						              <span kattr:radio_yn="use_yn" label1="사용" label2="미사용"  defaultVal="N" ></span>
						           </div>
						         </td>
						       </tr>
						       
	    		               <tr>
				                 <td class="hidden-phone" colspan="2">
	    			                 <div class="panel-body">
			   			              <div style= 'text-align : right'>
							           <input  type="button" class="btn btn-sm btn-primary" id="modifytFaqClBtn" onclick="fn_modifyFaqCl()" value="저장" />
							           <input type="button"  class="btn btn-sm btn-default"  onclick="hideRegForm()" value="취소"/>
				   		              </div>
							        </div>		
				                 </td>
				               </tr>
					       </tbody>
					      </table>
					      <input type="hidden" id="ord" name="id">
					   </form>
					  </div>
	    		</div>
			</div>
		</div>
	</div>
 </div>
		<link type="text/css" rel="stylesheet" href="/js/common/jsgrid-master/dist/jsgrid.min.css" />
		<link type="text/css" rel="stylesheet" href="/js/common/jsgrid-master/dist/jsgrid-theme.css" />
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.js"></script>
<!-- 		<script type="text/javascript" src="/js/validator/jquery.validate.js"></script>    
		<script type="text/javascript" src="/js/validator/jquery.validate.add.js"></script>    
		<script type="text/javascript" src="/js/validator/jquery.validate.setting.js"></script> -->
		
		<!-- <script type="text/javascript" src="/js/mng/faq/cl_main.js"></script> -->
<script>
/**
 * FAQ_CL
 */
var FAQ_CL = {
	/**
	 * 
	 */
	insert: function(item, callback){

			let data = {
					"user_se_cd": item.user_se_cd,
					"cl_nm": item.cl_nm,
					"ord": item.ord,
					"use_yn": item.use_yn
			};
			
			$.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "/mng/faq/addCl.do",
                data: JSON.stringify(data),
                dataType: "json"
              }).done(function(response){
            	  if(!response){
            		  alert("추가에 실패하였습니다. 권한이 있는지 확인 하십시오.");
            	  }
            	  
            	  if(typeof callback === 'function') callback();
              });
			
	},
		
	/**
	 * 
	 */
	update: function(item, callback){
			
		let data = {
				"clid": item.clid,
				"user_se_cd": item.user_se_cd,
				"cl_nm": item.cl_nm,
				"ord": item.ord,
				"use_yn": item.use_yn
		};
			
		$.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "/mng/faq/updateCl.do",
                data: JSON.stringify(data),
                dataType: "json"
              }).done(function(response){
            	  if(!response){
            		  alert("수정에 실패하였습니다. 권한이 있는지 확인 하십시오.");
            	  }

            	  if(typeof callback === 'function') callback();
        });
			
	},
	
	/**
	 * 
	 */
	delete: function(item, callback){
			
			$.ajax({
                type: "DELETE",
                contentType: "application/json; charset=utf-8",
                url: "/mng/faq/deleteCl.do?clid="+item.clid,
                dataType: "json"
              }).done(function(response){
            	  console.log(response);
            	  if(!response){
            		  alert("삭제에 실패하였습니다. 권한이 있는지 확인 하십시오.");
            	  }
            	  
            	  if(typeof callback === 'function') callback();
              });
		}
}


/**
 * 
 */

$.getScript( "/js/mng/faq/FAQ_CL.js" );

var FAQ_CL_TARGET = [
	{ Name: "개인", Id: 'P' },
	{ Name: "기업", Id: 'C' }
];

$(function(){
	//jsGrid Init
	$("#jsGrid").jsGrid({
	        height: "auto",
	        width: "100%",
	        autoload: true,
	        sorting: false,
	        paging: true,
	        pagerContainer: "#listPager",
	        pagerFormat: "{first} {prev} {pages} {next} {last}",
	        pagePrevText: "이전",
	        pageNextText: "다음",
	        pageFirstText: "< 처음 ㅣ",
	        pageLastText: "ㅣ마지막 >",
	        
	        pageSize: 10,
	        pageButtonCount: 10,
	        pageLoading: true,
	        pageIndex: 1,
	        
	        controller: {
	            loadData: function (filter) {
	            	var data = $.Deferred();
	            	
	            	var params = {
            			"pageNumber": filter.pageIndex,
            			"rowPerPage": filter.pageSize,
            			"searchType" : $('input[name=searchType]:checked').val()
	            	}
	            	
	                $.ajax({
	                  type: "GET",
	                  contentType: "application/json; charset=utf-8",
	                  url: "/mng/faq/faqClList.do",
	                  data: params,
	                  dataType: "json"
	                }).done(function(response){
	                	var da = {
                                data : escapeGridData(response.list),
                                itemsCount : response.totalCount
/*                                 pageSize: response.length,
                                pageIndex: response.page, */
                            };
	                  data.resolve(da);
	                });
	                
	                return data.promise();
	            },
		        insertItem: function(item) {
		            console.log(item);
		            FAQ_CL.insert(item);
		        },

		        updateItem: function(item) {
		            console.log(item);
		            FAQ_CL.update(item);
		        },

		        deleteItem: function(item) {
		            console.log(item);
		            FAQ_CL.delete(item, function(){ $("#jsGrid").jsGrid("refresh"); });

		        }
			
	        },
	        deleteConfirm: "정말 삭제하시겠습니까?",
	        fields: [ 
                { name: 'rowNumber', title:"번호", key: true, width: "3%", align:"center" , align: "center"},
                { name: 'user_se_cd'     , title:"대상"    , type: "select", items: FAQ_CL_TARGET, valueField: "Id", textField: "Name", width: "5%" , align: "center"},
                { name: 'cl_nm'    , title:"분류명" , type: "text", width: "20%" },
                { name: 'clid'     , title:"분류코드", type: "text", width: "5%" , align: "center"},
                { name: 'use_yn'   , title:"사용여부", width: "5%" , align: "center"},
                { name: 'ord'      , title:"순서", type: "number", width: "5%", align: "center" , sorting: false , align: "center"},
                { name: 'ord'      , title:"정렬", type: "number", width: "5%", align: "center" , align: "center"
                  	 ,itemTemplate: function(value, item) {
                  		 
	                   	    var firstObj = $("<a class='btn btn-xs btn-info' />").text("▲").on("click", function() { fn_changeOrd("OU",item);  return false;}).add("<span>&nbsp;</span>");
	                   	    var lastObj = $("<a class='btn btn-xs btn-info' />").text("▼").on("click", function() { fn_changeOrd("OD",item);  return false;});
		                   	    
			                   	if(item.totalCount==1 ){
		             	        	return "-" ;
		             	        }else if(item.rowNumber==1){
		                   	    	return firstObj;
		                   	    }else if(item.rowNumber==item.totalCount){
		                   	    	return lastObj
		                   	    }else{
		                   	    	return firstObj.add(lastObj);
		                   	    }
				         }
                }
	        ],
	        rowClick: function(args) {
	        	
	        	toggleList();
	        	$("#regForm ").show();
	        	$("#modifytFaqClBtn").val("수정");
	        	$("#clid").val(args.item.clid);
	        	$("#cl_nm").val(args.item.cl_nm);
	        	$('input:radio[name=user_se_cd]:input[value=' +args.item.user_se_cd+ ']').prop("checked", true);
	        	$("#ord").val(args.item.ord);
	        	$('input:radio[name=use_yn]:input[value=' +args.item.use_yn+ ']').prop("checked", true);
	        }
	        
	});
});

function openRegForm(){
	$('#collapseList').collapse('hide');
	//toggleList();
	listToggle = false;
	$("#regForm").show();
	fn_clearFaqClForm();
}
function hideRegForm(){
	toggleList();
	$("#accordion").show();
	$('#collapseList').collapse('show');
	listToggle = true;
	$("#regForm").hide();
	fn_clearFaqClForm();
}



function fn_clearFaqClForm(){
	$("#modifytFaqClBtn").val("저장");
	$("#clid").val("");
	$("#cl_nm").val("");
	$('input:radio[name=user_se_cd]:input[value="101102"]').prop("checked", true);
	$("#ord").val("");
	$('input:radio[name=use_yn]:input[value="N"]').prop("checked", true);
}




function fn_modifyFaqCl(){
	
	var params = {
			 clid  : $("#clid").val()
			,cl_nm : $("#cl_nm").val()
        	,user_se_cd  : $('input:radio[name=user_se_cd]:checked').val()
        	,ord   : $("#ord").val()
        	,use_yn: $('input:radio[name=use_yn]:checked').val()
	}
    var clid = $("#clid").val();
	
	var validator= $("#faqClForm").validate({
	    rules   : { cl_nm : { required: true } },
	    messages: {cl_nm : 	{ required: "분류명을 입력하십시오" } }
	 })
	
	if(($("#faqClForm").valid() == false)) return;
	
	if(clid!=null && clid !='' && clid !='0' ){
		FAQ_CL.update(params, function(){alert("수정되었습니다."); return false; });
	}else{
		FAQ_CL.insert(params, function(){alert("저장되었습니다."); return false; });
	}
	fn_clearFaqClForm();
	resetListContent();
	$("#regForm").hide();
}

function fn_changeOrd(mode,item){
	var params = {
			"user_se_cd" :item.user_se_cd,
			"clid": item.clid,
			"ord": item.ord,
			"mode": mode	
			}
	var updUrl = "/mng/faq/modifyFaqClOrd.do";
	$.ajax({
		url : updUrl,
		type: 'POST',
		cache : false,
		dataType: 'json',
		data : params,
		success : function (data){
			if(data){
				resetListContent();
			}else{
				alert("정렬이 실패하였습니다. 다시한번 시도해주십시오.");
			}
		},
	 	error : function (error){
		} 
	});
}

$('input[type=radio][name=searchType]').change(function(){
	resetListContent();
});
		
		
</script>
		
	</div>
</body>
</html>

