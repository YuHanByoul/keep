<form id="cmntyPstUpdateForm">
    <input type="hidden" name="pstid" id="pstid" th:value="${cmntyPst.cmntyPstInfo.pstid}" /> 
    <div class="card-header p-b-0">
        <h3 class="sub-title"><strong>기본정보</strong></h3>
    </div>
    <div class="card-block-small p-t-0">
        <div class="mb-2 form-group row">
            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="communityNoticeTitle"><strong>제목</strong></label>
            <div class="col-sm-12">
                <input type="text" class="form-control form-control-sm" name="ttl" id="ttl" th:value="${cmntyPst.cmntyPstInfo.ttl}" readonly/>
            </div>
        </div>
        <div class="mb-2 form-group row">
            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="nm"><strong>작성자</strong></label>
            <div class="col-sm-12">
                <input type="text" class="form-control form-control-sm" name="nm" id="nm" th:value="${cmntyPst.cmntyPstInfo.nm} + '(' + ${cmntyPst.cmntyPstInfo.acnt} + ')'" readonly/>
            </div>
        </div>
        <div class="mb-0 form-group row">
            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="cn"><strong>내용</strong></label>
            <div class="col-sm-12">
                <textarea rows="5" cols="5" class="form-control form-control-sm" id="cn" name="cn" th:text="${cmntyPst.cmntyPstInfo.cn}" readonly></textarea>
            </div>
        </div>
        <th:block th:if ="${cmntyPst.fileList != null}">
            <div class="mt-2 row">
                <ul>
                    <li th:each="file: ${cmntyPst.fileList}" th:id="${file.fileid}">
                        <a th:fileid='${file.fileid}' th:fileIdntfcKey="${file.fileIdntfcKey}" th:onclick="downloadFileByFileid(this.getAttribute('fileid'),this.getAttribute('fileIdntfcKey'));" href="javascript:void(0);">
                            <i class="ion-paperclip f-18"></i> <th:block th:text="${file.orginlFileNm}" />(<th:block th:text="${T(com.kbrainc.plum.rte.util.FileUtil).readableFileSize(file.fileSize)}" />)
                        </a>
                    </li>
                </ul>
            </div>
        </th:block>
    </div>
    
    <div id="cmntContainer" class="d-none">
        <div class="card-header p-b-0">
            <h3 class="sub-title"><strong id="totalCount"></strong></h3>
        </div>
        <div class="card-block-small p-t-0">
            <ul class="basic-list" id="cmntGrid">
                <!--
                <li>
                    <div class="col-12 mb-2 row align-items-center">
                        <div class="col-11">
                            <h6 class="m-b-0">홍길동 2017.07.19 16:03</h6>
                        </div>
                        <div class="col-1 text-right btn-group-sm p-r-0">
                            <a href="javascript:void(0)" class="btn btn-inverse">삭제</a>
                        </div>
                    </div>
                    <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Do</p>
                </li>
                <li class="m-l-25">
                    <div class="col-12 mb-2 row align-items-center">
                        <div class="col-11">
                            <h6 class="m-b-0">ㄴ 홍길동 2017.07.19 16:03</h6>
                        </div>
                        <div class="col-1 text-right btn-group-sm p-r-0">
                            <a href="javascript:void(0)" class="btn btn-inverse">삭제</a>
                        </div>
                    </div>
                    <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Do</p>
                </li>
                <li class="m-l-50">
                    <div class="col-12 mb-2 row align-items-center">
                        <div class="col-11">
                            <h6 class="m-b-0">ㄴ 홍길동 2017.07.19 16:03</h6>
                        </div>
                        <div class="col-1 text-right btn-group-sm p-r-0">
                            <a href="javascript:void(0)" class="btn btn-inverse">삭제</a>
                        </div>
                    </div>
                    <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Do</p>
                </li>
                <li class="m-l-25">
                    <div class="col-12 mb-2 row">
                        <div class="col-11">
                            <h6 class="m-b-0">ㄴ 홍길동 2017.07.19 16:03</h6>
                        </div>
                        <div class="col-1 text-right">
                            <a href="javascript:void(0)" class="text-muted">삭제</a>
                        </div>
                    </div>
                    <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Do</p>
                </li>
                <li>
                    <div class="col-12 mb-2 row">
                        <div class="col-11">
                            <h6 class="m-b-0">홍길동 2017.07.19 16:03</h6>
                        </div>
                        <div class="col-1 text-right">
                            <a href="javascript:void(0)" class="text-muted">삭제</a>
                        </div>
                    </div>
                    <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Do</p>
                </li>
                -->
            </ul>
            <!--
            <ul class="m-t-10 pagination justify-content-center">
                <li class="page-item">
                    <a class="page-link" href="#" aria-label="Previous">
                        <span aria-hidden="true">«</span>
                        <span class="sr-only">Previous</span>
                    </a>
                </li>
                <li class="page-item"><a class="page-link" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item">
                    <a class="page-link" href="#" aria-label="Next">
                        <span aria-hidden="true">»</span>
                        <span class="sr-only">Next</span>
                    </a>
                </li>
            </ul>
            -->
        </div>
    </div>
    
    <!--
    <th:block th:if="not ${cmntyCmntList.isEmpty()}">
        <div class="card-header p-t-0 p-b-0">
            <h3 class="sub-title"><strong>댓글 <th:block th:text="${cmntyCmntList[0].totalCount}" /></strong></h3>
        </div>
        <div class="card-block-small p-t-0">
            <ul class="basic-list">
                <li th:each="cmntyCmnt: ${cmntyCmntList}" th:style="'margin-left: ' + ${(cmntyCmnt.dpth - 1) * 15 + 'px;'}">
                    <div class="col-12 mb-2 row align-items-center">
                        <div class="col-11">
                            <th:block th:if="${cmntyCmnt.dpth == 1}">
                                <th:block th:if="${cmntyCmnt.delYn == 'N'}">
                                    <h6 class="m-b-0" th:text="${cmntyCmnt.nm} + ' ' + ${#dates.format(cmntyCmnt.regDt, 'yyyy.MM.dd HH:mm:ss')}"></h6>
                                </th:block>
                                <th:block th:unless="${cmntyCmnt.delYn == 'N'}">
                                    <h6 class="m-b-0">삭제된 댓글입니다.</h6>
                                </th:block>
                            </th:block>
                            <th:block th:unless="${cmntyCmnt.dpth == 1}">
                                <th:block th:if="${cmntyCmnt.delYn == 'N'}">
                                    <h6 class="m-b-0" th:text="'ㄴ ' + ${cmntyCmnt.nm} + ' ' + ${#dates.format(cmntyCmnt.regDt, 'yyyy.MM.dd HH:mm:ss')}"></h6>
                                </th:block>
                                <th:block th:unless="${cmntyCmnt.delYn == 'N'}">
                                    <h6 class="m-b-0">ㄴ 삭제된 댓글입니다.</h6>
                                </th:block>
                            </th:block>
                        </div>
                        <th:block sec:authorize-url="/mng/cmnty/deleteCmntyCmnt.do" th:if="${cmntyCmnt.delYn == 'N'}">
                            <div class="col-1 text-right btn-group-sm p-r-0">
                                <a href="javascript:void(0);" class="btn btn-inverse" th:cmntid="${cmntyCmnt.cmntid}" onclick="cmntyPstUpdate.onDelete(this.getAttribute('cmntid'));">삭제</a>
                            </div>
                        </th:block>
                    </div>
                    <p th:if="${cmntyCmnt.delYn == 'N'}" th:text=${cmntyCmnt.cn}></p>
                </li>
            </ul>
            <ul class="m-t-10 pagination justify-content-center">
                <li class="page-item">
                    <a class="page-link" href="#" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                        <span class="sr-only">Previous</span>
                    </a>
                </li>
                <li class="page-item"><a class="page-link" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item">
                    <a class="page-link" href="#" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                        <span class="sr-only">Next</span>
                    </a>
                </li>
            </ul>
        </div>
    </th:block>
    -->
</form>

<script th:inline="javascript">
    var cmntyPstUpdate = {
        pstid: /*[[${cmntyPst.cmntyPstInfo.pstid}]]*/
        , listUrl: "/mng/cmnty/selectCmntyCmntList.do"
        
        , init: function() {
            this.onLoadData();
            this.registEvent();
        }
        
        , registEvent: function() {
            // TODO
        }
        
        , onLoadData: function() {
            if(displayWorkProgress()) {
                var param = {
                    pstid: this.pstid
                    , pageNumber: 1
                    , rowPerPage: 0
                };
                $.ajax({
                    url: cmntyPstUpdate.listUrl
                    , cache: false
                    , dataType: "json"
                    , data: param
                    , type: "GET"
                    , success: function(response) {
                        if(response.totalCount > 0) {
                            $("#totalCount").text("댓글 " + response.totalCount);
                            $("#cmntContainer").removeClass("d-none");
                            cmntyPstUpdate.setList(response.list);
                        }
                        closeWorkProgress();
                    }
                });
            }
        }
        
        , setList: function(dataList) {
            $("#cmntGrid").empty();
             $(dataList).each(function(index, data) {
                $("#cmntGrid").append(cmntyPstUpdate.getListItem(data));
            });                        
        }
        
        , getListItem: function(data) {
            var marginLeft = data.dpth * 25;
            var marginClass = "m-l-" + marginLeft;
            var item = '<li>';
            if(data.dpth != 0) item = '<li class="' + marginClass + '">';
            item += '<div class="col-12 mb-2 row align-items-center">';
            item += '<div class="col-11">';
            if(data.delYn == "Y") {
                if(data.dpth == 0) item += '<h6 class="m-b-0">삭제된 게시글입니다.</h6>';
                else item += '<h6 class="m-b-0">ㄴ 삭제된 게시글입니다.</h6>';
            } else {
                if(data.dpth == 0) item += '<h6 class="m-b-0">' + data.nm + ' ' + data.regDt + '</h6>';
                else item += '<h6 class="m-b-0">ㄴ ' + data.nm + ' ' + data.regDt + '</h6>';
            }
            item += '</div>';
            item += '<div class="col-1 text-right btn-group-sm p-r-0">';
            item += '<a href="javascript:cmntyPstUpdate.onDelete(' + "'" + data.cmntid + "'" + ');" class="btn btn-inverse">삭제</a>';
            item += '</div>';
            item += '</div>';
            if(data.delYn == "N") {
                item += '<p>' + data.cn + '</p>';
            }
            item += '</li>'
            
            return item;
        } 
        
        , onDelete: function(cmntid) {
            if(confirm("삭제하시겠습니까?")) {
                var param = {cmntid: cmntid};
                if(displayWorkProgress()) {
                    $.ajax({
                        url : "/mng/cmnty/deleteCmntyCmnt.do",
                        type: "POST",
                        cache: false,
                        dataType: "json",
                        data: param,
                        success: function(response) {
                            if(response.result == "success") {
                                alert(response.msg);
                                var detailUrl = "/mng/cmnty/cmntyPstUpdateForm.html?pstid=" + $("#pstid").val();
                                cmntyPstGrid.loadContent(detailUrl);
                            } else {
                                alert(response.msg);
                            }
                            closeWorkProgress();
                        }
                    });
                }                
            }
        }
    };
    
    cmntyPstUpdate.init();
</script>