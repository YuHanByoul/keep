	
<form id="cnsltngFrm">
	<div class="tab-pane active" id="consultingInfo" role="tabpanel">
	
	    <div class="card-header p-t-0 p-b-0">
	        <h3 class="sub-title"><strong>컨설팅 신청 정보</strong></h3>
	    </div>
	    <div class="card-block-small p-t-0">
	        <div class="mb-2 row">
	            <div class="col-12 col-lg-6 mb-2 mb-lg-0">
	                <div class="mb-0 form-group">
	                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="consultingInfoProgramName"><strong>프로그램명</strong></label>
	                    <div class="col-sm-12">
	                        <input type="text" class="form-control form-control-sm" name="" id="" th:value="${resultVo.prgrmNm}" readonly/>
	                    </div>
	                </div>
	            </div>
	            <div class="col-12 col-lg-6">
	                <div class="mb-0 form-group">
	                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="consultingInfoConsultingManagerName"><strong>컨설팅 담당자</strong></label>
	                    <div class="col-sm-12">
	                        <input type="text" class="form-control form-control-sm" th:value="${resultVo.cnstntNm}" readonly/>
	                    </div>
	                </div>
	            </div>
	        </div>
	        <div class="mb-0 row">
	            <div class="col-12 col-lg-6 mb-2 mb-lg-0">
	                <div class="mb-0 form-group">
	                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>컨설팅 유형</strong></div>
	                    <div class="col-12 mt-lg-1">
	                        <div class="form-radio">
	                            <div class="radio radio-inline">
	                                <label class="mb-0 form-label">
	                                    <input type="radio" name="consultingInfoConsultingCategory" th:checked="${resultVo.cnsltngKndCd =='130101'}" disabled/>
	                                    <i class="helper"></i>증빙서류 작성
	                                </label>
	                            </div>
	                            <div class="radio radio-inline">
	                                <label class="mb-0 form-label">
	                                    <input type="radio" name="consultingInfoConsultingCategory" th:checked="${resultVo.cnsltngKndCd =='130102'}" disabled/>
	                                    <i class="helper"></i>현장방문 (신청 후 최소 10일 이후 가능)
	                                </label>
	                            </div>
	                        </div>
	                    </div>
	                </div>
	            </div>
	            <div class="col-12 col-lg-6">
	                <div class="mb-0 form-group">
	                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="consultingInfoConsultingRequestDate"><strong>신청일</strong></label>
	                    <div class="col-12">
	                        <input type="date" class="form-control form-control-sm" th:value="${#dates.format(resultVo.reqDt, 'yyyy-MM-dd')}" id="reqDate" readonly/>
	                    </div>
	                </div>
	            </div>
	        </div>
	        
	        <!--현장방문 선택시 나오는 영역-->
	        <div class="mt-2 row"   th:if="${resultVo.cnsltngKndCd =='130102'}" >
	            <div class="col-12 col-lg-6 mb-2 mb-lg-0">
	                <div class="mb-0 form-group">
	                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="consultingInfoConsultingFirstSiteVisitHopeDate"><strong>1차 현장방문 희망일</strong></label>
	                    <div class="col-12">
	                        <input type="date" class="form-control form-control-sm" th:value="${resultVo.hopeDe1}" readonly/>
	                    </div>
	                </div>
	            </div>
	            <div class="col-12 col-lg-6">
	                <div class="mb-0 form-group">
	                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="consultingInfoConsultingSecondSiteVisitHopeDate"><strong>2차 현장방문 희망일</strong></label>
	                    <div class="col-12">
	                        <input type="date" class="form-control form-control-sm" th:value="${resultVo.hopeDe1}" readonly/>
	                    </div>
	                </div>
	            </div>
	        </div>
	    </div>
	    <div class="card-header p-t-0 p-b-0"  th:if="${resultVo.cnsltngKndCd =='130102'}">
	        <h3 class="sub-title"><strong>현장방문일시</strong></h3>
	    </div>
	    <div class="card-block-small p-t-0" th:if="${resultVo.cnsltngKndCd =='130102'}">
	        <div class="mb-0 row">
	            <div class="col-12 col-lg-4 mb-2 mb-lg-0">
	                <div class="mb-0 form-group required">
	                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="consultingInfoSiteVisitDate"><strong>현장방문일</strong></label>
	                    <div class="col-sm-12">
	                        <input type="date" class="form-control form-control-sm" name="vstDe" id="vstDe" th:value="${resultVo.vstDe}" />
	                    </div>
	                </div>
	            </div>
	            <div class="col-12 col-lg-4 mb-2 mb-lg-0">
	                <div class="mb-0 form-group required">
	                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="consultingInfoSiteVisitStartTime"><strong>현장방문 시작시간</strong></label>
	                    <div class="col-12">
	                        <input type="time" class="form-control form-control-sm" name="vstBgngDt" id="vstBgngDt"  th:value="${#strings.substring(resultVo.vstBgngDt, 11,16)}" />
	                    </div>
	                </div>
	            </div>
	            <div class="col-12 col-lg-4">
	                <div class="mb-0 form-group required">
	                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="consultingInfoSiteVisitEndTime"><strong>현장방문 종료시간</strong></label>
	                    <div class="col-12">
	                        <input type="time" class="form-control form-control-sm" name="vstEndDt" id="vstEndDt"  th:value="${#strings.substring(resultVo.vstEndDt, 11,16)}"/>
	                    </div>
	                </div>
	            </div>
	        </div>
	    </div>
	    <div class="card-header p-t-0 p-b-0">
	        <h3 class="sub-title"><strong>컨설팅결과</strong></h3>
	    </div>
	    <div class="card-block-small p-t-0  p-b-0">
	        <div class="mb-2 form-group row required">
	            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="consultingInfoResultTotalOpinion"><strong>종합의견</strong></label>
	            <div class="col-12">
	                <textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="종합의견" id="gnrlzopnn" name="gnrlzopnn"><th:block th:utext="${resultVo.gnrlzopnn}"/></textarea>
	            </div>
	        </div>
	        <div class="mb-2 row">
	            <div class="col-12 col-lg-6 mb-2 mb-lg-0">
	                <div class="mb-0 form-group required">
	                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="consultingInfoResultTotalOpinion"><strong>프로그램 우수성 컨설팅 의견</strong></label>
	                    <div class="col-12">
	                        <textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="프로그램 우수성" id="dstnctn" name="dstnctn"><th:block th:utext="${resultVo.dstnctn}"/></textarea>
	                    </div>
	                </div>
	            </div>
	            <div class="col-12 col-lg-6">
	                <div class="mb-0 form-group">
	                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="consultingInfoProgramGreatNoteOpinion"><strong>비고</strong></label>
	                    <div class="col-12">
	                        <textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="비고" id="dstnctnRmrk" name="dstnctnRmrk"><th:block th:utext="${resultVo.dstnctnRmrk}"/></textarea>
	                    </div>
	                </div>
	            </div>
	        </div>
	        <div class="mb-2 row">
	            <div class="col-12 col-lg-6 mb-2 mb-lg-0">
	                <div class="mb-0 form-group required">
	                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="consultingInfoProgramOperationManagementConsultingOpinion"><strong>프로그램 운영관리 컨설팅 의견</strong></label>
	                    <div class="col-12">
	                        <textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="프로그램 운영관리" id="operMng" name="operMng"><th:block th:utext="${resultVo.operMng}"/></textarea>
	                    </div>
	                </div>
	            </div>
	            <div class="col-12 col-lg-6">
	                <div class="mb-0 form-group">
	                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="consultingInfoProgramOperationManagementNoteOpinion"><strong>비고</strong></label>
	                    <div class="col-12">
	                        <textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="비고" id="operMngRmrk" name="operMngRmrk"><th:block th:utext="${resultVo.operMngRmrk}"/></textarea>
	                    </div>
	                </div>
	            </div>
	        </div>
	        <div class="mb-2 row">
	            <div class="col-12 col-lg-6 mb-2 mb-lg-0">
	                <div class="mb-0 form-group required">
	                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="consultingInfoProgramEvaluationSystemConsultingOpinion"><strong>프로그램 평가체계 컨설팅 의견</strong></label>
	                    <div class="col-12">
	                        <textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="평가체계 " id="evlSys" name="evlSys"><th:block th:utext="${resultVo.evlSys}"/></textarea>
	                    </div>
	                </div>
	            </div>
	            <div class="col-12 col-lg-6">
	                <div class="mb-0 form-group">
	                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="consultingInfoProgramEvaluationSystemNoteOpinion"><strong>비고</strong></label>
	                    <div class="col-12">
	                        <textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="비고" id="evlSysRmrk" name="evlSysRmrk"><th:block th:utext="${resultVo.evlSysRmrk}"/></textarea>
	                    </div>
	                </div>
	            </div>
	        </div>
	        <div class="mb-2 row">
	            <div class="col-12 col-lg-6 mb-2 mb-lg-0">
	                <div class="mb-0 form-group required">
	                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="consultingInfoLeaderAreaConsultingOpinion"><strong>지도자 영역 컨설팅 의견</strong></label>
	                    <div class="col-12">
	                        <textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="지도자 영역" id="ldr" name="ldr"><th:block th:utext="${resultVo.ldr}"/></textarea>
	                    </div>
	                </div>
	            </div>
	            <div class="col-12 col-lg-6">
	                <div class="mb-0 form-group">
	                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="consultingInfoLeaderAreaNoteOpinion"><strong>비고</strong></label>
	                    <div class="col-12">
	                        <textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="비고" id="ldrRmrk" name="ldrRmrk"><th:block th:utext="${resultVo.ldrRmrk}"/></textarea>
	                    </div>
	                </div>
	            </div>
	        </div>
	        <div class="mb-2 row">
	            <div class="col-12 col-lg-6 mb-2 mb-lg-0">
	                <div class="mb-0 form-group required">
	                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="consultingInfoSafeManagementAreaConsultingOpinion"><strong>안전관리 영역 컨설팅 의견</strong></label>
	                    <div class="col-12">
	                        <textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="안전관리 영역 " id="sftyMng" name="sftyMng"><th:block th:utext="${resultVo.sftyMng}"/></textarea>
	                    </div>
	                </div>
	            </div>
	            <div class="col-12 col-lg-6">
	                <div class="mb-0 form-group">
	                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="consultingInfoSafeManagementAreaNoteOpinion"><strong>비고</strong></label>
	                    <div class="col-12">
	                        <textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="비고" id="sftyMngRmrk" name="sftyMngRmrk"><th:block th:utext="${resultVo.sftyMngRmrk}"/></textarea>
	                    </div>
	                </div>
	            </div>
	        </div>
	        <div class="mb-2 row">
	            <div class="col-12 col-lg-6 mb-2 mb-lg-0">
	                <div class="mb-0 form-group" >
	                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="consultingInfoEtcAreaConsultingOpinion"><strong>기타 영역 컨설팅 의견</strong></label>
	                    <div class="col-12">
	                        <textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="기타" id="etc" name="etc"><th:block th:utext="${resultVo.etc}"/></textarea>
	                    </div>
	                </div>
	            </div>
	            <div class="col-12 col-lg-6">
	                <div class="mb-0 form-group">
	                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="consultingInfoEtcAreaNoteOpinion"><strong>비고</strong></label>
	                    <div class="col-12">
	                        <textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="비고" id="etcRmrk" name="etcRmrk"><th:block th:utext="${resultVo.etcRmrk}"/></textarea>
	                    </div>
	                </div>
	            </div>
	        </div>
	        <div class="mb-0 form-group row">
	            <div class="mb-0 form-group">
	                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="consultingInfoResultFile">첨부파일</label>
	                <div class="col-12">
	                    <input type="file" multiple id="multiFileInput" name="multiFileInput" class="form-control form-control-sm"/>
	                </div>
	                <div class="mt-2 row">
	                    <div class="col-auto" id="fileListArea">
	                            <!-- 파일 명 및 삭제 버튼 영역-->
                                 <th:block th:if = "${fileList} != null ">
                                    <span th:each="item:${fileList}" class ='label label-inverse ' th:id="'file_'+${item.fileid}">
                                        <th:block th:text="${item.orginlFileNm}"></th:block>
                                        &nbsp;&nbsp;
                                        <a  class = 'text-white' href = "javascript:void(0)"
                                           th:name="${item.fileid}" th:attr="data-idntfc-key=${item.fileIdntfcKey}" 
                                           th:onclick="fn_deleteFile(this.name, this.dataset.idntfcKey)">X</a></span>
                                  </th:block>
	                    </div>
	                </div>
	            </div>
	        </div>
	    </div>
	    <div class="card-block-small">
	    
	        <button type="button" class="btn btn-disabled m-r-5" onclick="gridHelper1.toggleContent()" >취소</button>
	        <th:block sec:authorize-url="/mng/cnsltng/insertCnsltngResult.do">
		        <button type="button" class="btn btn-primary m-r-5"  onclick="tempSaveResult()">임시저장</button>
		        <button type="button" class="btn btn-primary m-r-5"  onclick="saveResult()">저장</button>
	        </th:block>
	        <button type="button" class="btn btn-primary" onclick="openReportPopup()">컨설팅결과 출력</button>
	        
	    </div>
	</div>
	
    <input type="hidden" id="filegrpid" name="filegrpid" th:value="${resultVo.filegrpid == null or resultVo.filegrpid == ''}? 0: ${resultVo.filegrpid}"/>
    <input type="hidden" id="cnsltngid" name="cnsltngid" th:value="${resultVo.cnsltngid}"/>
    <input type="hidden" id="tmprSaveYn" name="tmprSaveYn" value="N" />
    
    </form>
	<!--결과 탭 END  -->
<script th:inline="javascript">

	/*<![CDATA[*/
	var cnsltngid = /*[[${resultVo.cnsltngid}]]*/null;
	var cnsltngKndCd = /*[[${resultVo.cnsltngKndCd}]]*/null;
	/*]]>*/
	
	$(function(){
		
      $("#cnsltngFrm").validate({
             onsubmit: false,
             rules: {
                 vstDe      :   { required: true }
                 ,vstBgngDt :   { required: true }
                 ,vstEndDt  :   { required: true }
                 ,gnrlzopnn :   { required: true }
                 ,dstnctn   :   { required: true }
                 ,operMng   :   { required: true }
                 ,evlSys    :   { required: true }
                 ,ldr       :   { required: true }
                 ,sftyMng   :   { required: true }
             },
             messages: {
                 vstDe      :   { required: "방문일자를 입력해주십시오." }
                 ,vstBgngDt :   { required: "방문시각을 입력해주십시오." }
                 ,vstEndDt  :   { required: "방문종료시각을 입력해주십시오." }
                 ,gnrlzopnn :   { required: "종합 의견을 입력해주십시오." }
                 ,dstnctn   :   { required: "프로그램 우수성 의견을 입력해주십시오." }
                 ,operMng   :   { required: "운영관리 의견을 입력해주십시오." }
                 ,evlSys    :   { required: "평가체계의견을 입력해주십시오." }
                 ,ldr       :   { required: "지도자 영역 의견을 입력해주십시오." }
                 ,sftyMng   :   { required: "안전관리 영역 의견을 입력해주십시오." }
             }
        })
		
	})
	
	tempSaveResult =()=>{
		
		if(cnsltngKndCd =='130102'){
			
			var reqDate = $("#reqDate").val();
			var vstDe = $("#vstDe").val();
			var vstBgngDt = $("#vstBgngDt").val();
			var vstEndDt = $("#vstEndDt").val();
			
			if($("#vstDe").val()==null || $("#vstDe").val()==""){alert("방문일자를 입력해주십시오");showErrorMark("#vstDe");return;}
			if($("#vstBgngDt").val()==null || $("#vstBgngDt").val()==""){alert("방문일자를 입력해주십시오");showErrorMark("#vstBgngDt");return;}
			if($("#vstEndDt").val()==null || $("#vstEndDt").val()==""){alert("방문일자를 입력해주십시오");showErrorMark("#vstEndDt");return;}
			if(vstDe < reqDate ){alert("방문일은 신청일 이후여야 합니다.");showErrorMark("#vstDe");return;}
			if(vstBgngDt > vstEndDt ){alert("방문종료시각은 시작시각 이후여야 합니다.");showErrorMark("#vstEndDt");return;}
		}
		
	    $("#tmprSaveYn").val("Y");
        if(!confirm("임시저장 하시겠습니까?")){
            return;
        }
        mergeResult();
	}
	
	saveResult =()=>{
		
        if(!$("#cnsltngFrm").valid("sftyMng")) return;
        
	    $("#tmprSaveYn").val("N");
	    
        if(!confirm("저장 하시겠습니까?")){
            return;
        }
        mergeResult();
	}

	openReportPopup=()=>{
		alert("preparing reporting Tool")
	}

	function mergeResult(){
		
		if(displayWorkProgress()){
			$.ajax({
				url: "/mng/cnsltng/insertCnsltngResult.do",
				cache: false,
				dataType: 'json',
				data: $("#cnsltngFrm").serialize(),
				success: function(data){
					alert(data.msg);
					gridHelper1.resetListContent();
					closeWorkProgress();
				}
			});
		}
	}


    //파일 첨부 (멀티 파일) 
    $('#multiFileInput').on("change", function(event) {
       
       var objFile = document.querySelector('#multiFileInput');
       var formData = new FormData();
       var content = "";
       var uploadFileCnt = 0;
       
       for( i = 0 ; i < objFile.files.length ; i++) {
           formData.append("files", objFile.files[i]);
           uploadFileCnt++;
       }

       var filegrpid = $("#filegrpid").val();

       formData.append("filegrpid", $("#filegrpid").val());
       formData.append("filegrpNm", "cnsnltng_file");
       
           $.ajax({
               url : '/uploadMultipleFiles.do',
               processData : false,
               contentType : false,
               data : formData,
               type : 'POST',
               success : function(response) {
                   
                   if($("#filegrpid").val()=='0' || $("#filegrpid").val()==''  || $("#filegrpid").val()==null){
                       $("#filegrpid").val( response[0].filegrpid );
                   }
                   
                   for(i = 0 ;i < response.length; i++ ){
                       content = "<span class ='label label-inverse mb-2' id='file_"+response[i].fileid+"'>"+response[i].orginlFileNm ;
                       content +="&nbsp;&nbsp;  <a  class = 'text-white' href = javascript:fn_deleteFile('"+response[i].fileid+"','"+response[i].fileIdntfcKey+"')>X</a></span>&nbsp;&nbsp;";
                       $('#fileListArea').append(content);
                   }
               }
           })
           
          if (detectBrowser() == "other") { 
              $("#multiFileInput").val("");
          } else {   
             $("#multiFileInput").replaceWith( $("#multiFileInput").clone(true)) 
          }
           
    });
    
    function fn_deleteFile(fileid, fileIdntfcKey){
        if(!confirm("파일을 삭제 하시겠습니까?")){return;}
        
        var deleteFileUrl="/deleteFile.do?fileid="+fileid+"&file_idntfc_key=" + fileIdntfcKey;
         
        $.ajax({
          url : deleteFileUrl,
          type: 'GET',
          cache : false,
          dataType: 'json',
          success : function (data){
              $("#file_"+fileid).remove();
          },
          error : function (error){
          } 
       })
  };

    	
</script>    
