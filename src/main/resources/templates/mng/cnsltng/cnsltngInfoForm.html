   <form id="cnsntngInfoFrm"> 
       <div class="tab-pane active" id="applyInfo" role="tabpanel">
           <div class="card-header p-t-0 p-b-0">
               <h3 class="sub-title"><strong>신청기관 정보</strong></h3>
           </div>
           <div class="card-block-small p-t-0">
               <div class="mb-2 row">
                   <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                       <div class="mb-0 form-group">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="agencyName"><strong>기관명</strong></label>
                           <div class="col-sm-12">
                               <input type="text" class="form-control form-control-sm" placeholder="기관명" th:value="${cnsltngVo.instNm}" readonly/>
                           </div>
                       </div>
                   </div>
                   <div class="col-12 col-lg-6">
                       <div class="mb-0 form-group">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="applicantName"><strong>신청자명</strong></label>
                           <div class="col-sm-12">
                               <input type="text" class="form-control form-control-sm"  th:value="${cnsltngVo.userNm}" readonly/>
                           </div>
                       </div>
                   </div>
               </div>
               <div class="mb-2 row">
                   <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                       <div class="mb-0 form-group">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="agencyCategory"><strong>기관유형</strong></label>
                           <div class="col-sm-12">
                               <input type="text" class="form-control form-control-sm" th:value="${cnsltngVo.instTypeCdNm}" readonly/>
                           </div>
                       </div>
                   </div>
                   <div class="col-12 col-lg-6">
                       <div class="mb-0 form-group">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="managerPhoneNum"><strong>담당자연락처</strong></label>
                           <div class="col-sm-12">
                               <input type="text" class="form-control form-control-sm" th:value="${cnsltngVo.picTelno}" readonly/>
                           </div>
                       </div>
                   </div>
               </div>
               <div class="mb-2 row">
                   <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                       <div class="mb-0 form-group">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="agencyPhoneNum"><strong>기관연락처</strong></label>
                           <div class="col-sm-12">
                               <input type="text" class="form-control form-control-sm" th:value="${cnsltngVo.instTelno}" readonly/>
                           </div>
                       </div>
                   </div>
                   <div class="col-12 col-lg-6">
                       <div class="mb-0 form-group">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="managerEmail"><strong>담당자 이메일</strong></label>
                           <div class="col-sm-12">
                               <input type="text" class="form-control form-control-sm" th:value="${cnsltngVo.picEml}"readonly/>
                           </div>
                       </div>
                   </div>
               </div>
               <div class="mb-2 row">
                   <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                       <div class="mb-0 form-group">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="agencyAddress"><strong>기관주소</strong></label>
                           <div class="col-sm-12">
                               <input type="text" class="form-control form-control-sm" th:value="${cnsltngVo.addr}" readonly/>
                           </div>
                       </div>
                   </div>
                   <div class="col-12 col-lg-6">
                       <div class="mb-0 form-group">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="agencyDetailAddress"><strong>상세주소</strong></label>
                           <div class="col-sm-12">
                               <input type="text" class="form-control form-control-sm" th:value="${cnsltngVo.addrDtl}" readonly/>
                           </div>
                       </div>
                   </div>
               </div>
               <div class="mb-2 row">
                   <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                       <div class="mb-0 form-group">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="programName"><strong>프로그램명</strong></label>
                           <div class="col-sm-12">
                               <input type="text" class="form-control form-control-sm" th:value="${cnsltngVo.prgrmNm}" readonly/>
                           </div>
                       </div>
                   </div>
                   <div class="col-12 col-lg-6">
                       <div class="mb-0 form-group">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="operationStatus"><strong>진행상태</strong></label>
                           <div class="col-sm-12">
                               <input type="text" class="form-control form-control-sm" th:value="${cnsltngVo.sttsCdNm}" readonly/>
                           </div>
                       </div>
                   </div>
               </div>
               <div class="mb-2 row">
                   <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                       <div class="mb-0 form-group">
                           <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>컨설팅 유형</strong></div>
                           <div class="col-12 mt-lg-1">
                               <div class="form-radio">
                                   <div class="radio radio-inline">
                                       <label class="mb-0 form-label">
                                           <input type="radio" name="consultingCategory" th:checked="${cnsltngVo.cnsltngKndCd =='130101'}" disabled/>
                                           <i class="helper"></i>증빙서류 작성
                                       </label>
                                   </div>
                                   <div class="radio radio-inline">
                                       <label class="mb-0 form-label">
                                           <input type="radio" name="consultingCategory" th:checked="${cnsltngVo.cnsltngKndCd =='130102'}" disabled/>
                                           <i class="helper"></i>현장방문 (신청 후 최소 10일 이후 가능)
                                       </label>
                                   </div>
                               </div>
                           </div>
                       </div>
                   </div>
                   <div class="col-12 col-lg-6">
                       <div class="mb-0 form-group">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="requestDate"><strong>신청일</strong></label>
                           <div class="col-12">
                               <input type="text" class="form-control form-control-sm" th:value="${#dates.format(cnsltngVo.regDt, 'yyyy-MM-dd')}" readonly/>
                           </div>
                       </div>
                   </div>
               </div>
               <!--현장방문 선택시 나오는 영역-->
               <div class="mb-2 row"  th:if="${cnsltngVo.cnsltngKndCd =='131102'}">
                   <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                       <div class="mb-0 form-group">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="firstSiteVisitHopeDate"><strong>1차 현장방문 희망일</strong></label>
                           <div class="col-12">
                               <input type="text" class="form-control form-control-sm" th:value="${cnsltngVo.hopeDe1+' '} + ${(cnsltngVo.hopeDe1AmPmCd == 'AM')? '오전':'오후'}" readonly/>
                           </div>
                       </div>
                   </div>
                   <div class="col-12 col-lg-6">
                       <div class="mb-0 form-group">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="secondSiteVisitHopeDate"><strong>2차 현장방문 희망일</strong></label>
                           <div class="col-12">
                               <input type="text" class="form-control form-control-sm" th:value="${cnsltngVo.hopeDe2+' '} + ${(cnsltngVo.hopeDe2AmPmCd == 'AM')? '오전':'오후'}"  readonly/>
                           </div>
                       </div>
                   </div>
               </div>
               <!--//현장방문 선택시 나오는 영역-->
               <div class="mb-2 form-group row">
                   <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="programArea"><strong>프로그램 영역</strong></label>
                   <div class="col-12">
                       <textarea rows="5" cols="5" class="form-control form-control-sm"  readonly><th:block th:utext="${cnsltngVo.prgrm}"/></textarea>
                   </div>
               </div>
               <div class="mb-2 form-group row">
                   <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="leaderArea"><strong>지도자 영역</strong></label>
                   <div class="col-12">
                       <textarea rows="5" cols="5" class="form-control form-control-sm" readonly><th:block th:utext="${cnsltngVo.ldr}"/></textarea>
                   </div>
               </div>
               <div class="mb-2 form-group row">
                   <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="safeManagementArea"><strong>안전관리 영역</strong></label>
                   <div class="col-12">
                       <textarea rows="5" cols="5" class="form-control form-control-sm" readonly><th:block th:utext="${cnsltngVo.sftyMng}"/></textarea>
                   </div>
               </div>
               <div class="mb-2 form-group row">
                   <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="etcArea"><strong>기타 영역</strong></label>
                   <div class="col-12">
                       <textarea rows="5" cols="5" class="form-control form-control-sm" readonly><th:block th:utext="${cnsltngVo.etc}"/></textarea>
                   </div>
               </div>
               <div class="mb-2 form-group row">
                   <div class="mb-0 form-group mb-2">
                       <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>첨부파일</strong></div>
                       <div class="row">
                           <div class="col-auto">
                           
                                  <th:block th:if="${fileList}">
                                      <th:block th:each="item : ${fileList}" th:id="${item.fileid}">
                                          <span class ='label label-inverse mb-2 mr-0' th:id="'pst_'+${item.fileid}" >
                                          
                                          <a th:fileid ='${item.fileid}' th:fileIdntfcKey = "${item.fileIdntfcKey}" class = 'text-white'
                                            th:onclick="downloadFileByFileid(this.getAttribute('fileid'),this.getAttribute('fileIdntfcKey'))"
                                            href ="javascript:void(0)" >
                                          <th:block th:text="${item.orginlFileNm}"/>
                                          </a>
                                          <!--<a  class = 'text-white' href = "javascript:void(0)"
                                             th:name="${item.fileid}" th:attr="data-idntfc-key=${item.fileIdntfcKey}" 
                                             th:onclick="fn_deleteFile(this.name, this.dataset.idntfcKey)">X</a></span> -->
                                          </span>
                                      </th:block>
                                  </th:block>
                           
                               <!-- <span class="label label-inverse">
                                   sampleFile.pptx <a href="javascript:void(0)" class="text-white">X</a>
                               </span> -->
                               
                       </div>
                   </div>
               </div>
               </div>
               
               
               <div class="mb-2 form-group row" id="cnsltngManagerArea">
               
                   <div class="form-label col-sm-12 col-form-label p-t-0 pb-1 mb-2"><strong>컨설팅 담당자</strong>
                       &nbsp;&nbsp;&nbsp;<button type="button" class="btn btn-primary m-r-5 btn-mini btn-cnstnt" onclick="fn_openInstManagerSearchModal()">담당자 검색</button>
                   </div>
                   
                   <div class="m-0 row" >
                       <div class="col-12 row border rounded pt-1 pb-2 m-0 open-modal ">
                           <div class="col-auto"  id="cnstnt_list_area">
                           
                             <th:block th:each="item : ${cnstntList}" > 
		                       <span class="label label-inverse mb-2" th:id="'cnstnt_list_'+${item.cnstntid}" >
		                           <th:block th:text="${item.cnstntNm}+' '"></th:block>
		                           (<th:block th:text="${item.cnstntAcnt+' '}"></th:block>)|
		                           <th:block th:text="${item.cnstntEml}+' '"></th:block>|
		                           <th:block th:text="${item.cnstntMoblphon}+' '"></th:block>
		                           &nbsp;&nbsp;&nbsp;<a th:href="'javascript:deleteCnstnt('+${item.cnstntid}+')'" class="text-white delete-manager">X</a>
		                           <input type="hidden" th:id="'cnstnt'+${item.cnstntid}" name="cnstntids" th:value="${item.cnstntid}">
		                       </span>
		                     </th:block>
		                       
                           </div>
                       </div>
                   </div>
               </div>
               
               <div class="mb-2 form-group row col-6" >
               
                   <div class="form-label col-sm-6 col-form-label p-t-0 pb-1 mb-2"><strong>만족도 설문 </strong></div>
                   
                   <div class="m-0 row" style="height:35px;">
                       <div class="col-12 row border rounded pt-1 pb-2 m-0 open-modal ">
                           <div class="col-auto" >
                           </div>
                           
                           <input type="text" selectsearchcondition="srvyid" id="srvyid" name="srvyid" style="position:absolute;width:0px;margin:0px;padding:0px;visibility:hidden;">
						   <select class="select2-hidden-accessible" name="selectSrvyid" id="selectSrvyid" tabindex="-1" aria-hidden="true"></select>
						   
                       </div>
                   </div>
                   
               </div>
               
        
       </div>
       <div class="card-block-small">
          <button type="button" class="btn btn-disabled m-r-5" onclick="gridHelper1.toggleContent()">목록</button>
          
          <th:block sec:authorize-url="/mng/cnsltng/updateCnsltng.do">
          <button type="button" class="btn btn-primary m-r-5"  onclick="updateCnsltng()" >저장</button>
          </th:block>
          
       </div>
   </div>
   </form>
  <!--신청 정보 탭  -->
  
  <!--팝업-->
  <div class="modal fade" id="cnslngModal" aria-hidden="true" data-bs-backdrop="static"></div>
  <!--팝업-->
  
  <script th:inline="javascript">

  /*<![CDATA[*/ 
    var srvyList = /*[[${srvyList}]]*/null;
    var cnsltngid   = /*[[${cnsltngVo.cnsltngid}]]*/null;
	var cnsltngInfo = /*[[${cnsltngVo}]]*/null;
  /*]]>*/
  
    var selectSrvyData = [
	   {id:' ', text:'- 선택 -', value: '',option:"selected"},
	];

    $(document).ready(function(){

    	srvyList.forEach(function(item){
    		selectSrvyData.push(
    	     {id:item.srvyid, text: item.srvyNm+"("+item.qestnrNm+")", value : item.srvyid}
    	    )
        })
        
	    $('#selectSrvyid').select2({
		      language: {
		          noResults: function () {
		              return '검색결과가 없습니다.';
		          }
		      },
		      data: selectSrvyData,
		      templateSelection: function (item) {
		          document.getElementById('srvyid').value = item.value;
		          return item.text;
		      }
	    });

    	if(cnsltngInfo.srvyid != null && cnsltngInfo.srvyid != 0){
	        $('#selectSrvyid').val(cnsltngInfo.srvyid).trigger('change');
        }else{
	        $('#selectSrvyid').val(' ').trigger('change');
        }
        
    });
 
    //담당자 삭제 
    var deleteCnstnt = (id) =>{
        $("#cnstnt_list_"+id).remove();
    }
    
    var cnstntSearchModal;
    var url = "/mng/cnsltng/cnsltngManagerPopup.html?cnsltngid="+cnsltngid;
    
    //회원 검색 모달 오픈   
    var fn_openInstManagerSearchModal =()=> {
        $("#cnslngModal").load(url, function(response, status, xhr) {
            if (status == "success") {
            	cnstntSearchModal = new bootstrap.Modal($('#cnslngModal'));
            	cnstntSearchModal.show();
            }
        });
    }

    var validator= $("#cnsntngInfoFrm").validate({
        onsubmit: false,
        rules: {
        	cnstntids   : { required: true  }
            ,srvyid     : { required: true }
        },
        messages: {
        	cnstntids   : { required: "담당자를 선택해주십시오." }  
            ,srvyid     : { required: "설문을 선택 해주십시오." }
        }
    });
    
    function updateCnsltng(){
        
        let idArr=[];
        
        if($("[name=cnstntids]").length <= 0){
            alert("담당자를 지정해주십시오.")
            showErrorMark(".btn-cnstnt");
            return;
        }else{
            let cntids = "";
        	$("[name=cnstntids]").each(function(){
        		idArr.push(this.value);
            })

        }
    	if(!($("#cnsntngInfoFrm").valid())) return;
        
        if(!confirm("저장 하시겠습니까?")){ return; }
        
        var params ={
                cnsltngid:cnsltngid,
                cnstntids : idArr.join(","),
                srvyid: $("#srvyid").val(),
                sttsCd : "131102"
        }
        
        if(displayWorkProgress()){
            
            $.ajax({
                url: "/mng/cnsltng/updateCnsltng.do",
                cache: false,
                dataType: 'json',
                data: params,
                success: function(data){
                    alert(data.msg);
                    gridHelper1.resetListContent();
                    closeWorkProgress();
                }
            });
        }
        
    }

        
</script>    
