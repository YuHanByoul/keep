<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security" 
	xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout" 
	layout:decorator="layout/mng/mainLayout" 
>
<body>
<div layout:fragment="content">
  <div class="page-body">
      <div class="row">
          <div class="col-12">
          <form name="searchFrm" id="searchFrm" action="" onsubmit="return false;" class="card">
             <!-- 필터 부분 -->
                 <div class="card-block-small">
                     <!-- 키워드 filter -->
                     <div class="row">
                     
                        <div class="col-lg-3 mb-3">
                             <div class="mb-0 form-group row">
                                 <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="searchPrgrmNm"><strong>프로그램명</strong></label>
                                 <div class="col-12">
                                     <input type="text" class="form-control form-control-sm" name="searchPrgrmNm" id="searchPrgrmNm" />
                                 </div>
                             </div>
                        </div>
                        <div class="col-lg-3 mb-3">
                             <div class="mb-0 form-group row">
                                 <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="SearchInstNm"><strong>기관명</strong></label>
                                 <div class="col-12">
                                     <input type="text" class="form-control form-control-sm" name="searchInstNm" id="searchInstNm" />
                                 </div>
                             </div>
                         </div>
                         <div class="col-lg-3 mb-3">
                               <div class="mb-0 form-group row">
                                   <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="filterSearchStartRequestDate"><strong>신청일</strong></label>
                                   <div class="col-sm-12">
                                       <input class="form-control form-control-sm" type="text" name="filterSearchSelectDate1" id="filterSearchSelectDate1"/>
                                       <input  type="hidden" name="searchRegStrtDt" id="searchRegStrtDt"/>
                                       <input  type="hidden" name="searchRegEndDt"  id="searchRegEndDt"/>
                                   </div>
                               </div>
                         </div>
                         <div class="col-lg-3 mb-3">
                               <div class="mb-0 form-group row">
                                   <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" ><strong>현장 방문일</strong></label>
                                   <div class="col-sm-12">
                                       <input class="form-control form-control-sm" name="filterSearchSelectDate2" id="filterSearchSelectDate2" type="text"/>
                                       <input type="hidden" name="searchHopeStrtDt" id="searchHopeStrtDt" />
                                       <input type="hidden" name="searchHopeEndDt"  id="searchHopeEndDt" />
                                   </div>
                               </div>
                         </div>
                         
                     </div>
                     
                     <div class="row">
                         <div class="col-lg-3 mb-3">
                             <div class="mb-0 form-group row">
                                 <span class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>유형</strong></span>
                                 <div class="col-sm-12">
                                 <span kattr:select_code="searchCsltngKndCd" grpCd="130" isAdmin="true" firstOptTxt="- 전체 - "></span>
                                 </div>
                             </div>
                         </div>
                         <div class="col-lg-3 mb-3">
                             <div class="mb-0 form-group row">
                                 <span class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>진행상태</strong></span>
                                 <div class="col-sm-12">
                                 <span kattr:select_code="searchSttsCd" grpCd="131" isAdmin="true" firstOptTxt="- 전체 - "></span>
                                 </div>
                             </div>
                         </div>
                     </div>
                     <!-- //키워드 filter -->
                     <!-- 키워드 filter-btn -->
                     <div class="mt-1 p-t-20 text-center border-top">
                         <button class="btn btn-disabled m-r-5" onclick="fn_init()" >초기화</button>
                         <button class="btn btn-primary" onclick="fn_searchForm()" >검색</button>
                     </div>
                 </div>
           </form>
          </div>
           
          <!-- //필터 부분 -->
          <div class="col-12">
           <div class="card">
                <div class="row p-20 p-b-0">
                    <div class="col-12 col-md-6 mb-2 mb-md-0">
                        <h5><strong>컨설팅 검색 결과</strong></h5>
                    </div>
                    <div class="col-12 col-md-6 text-right">
	                    <th:block sec:authorize-url="/mng/cnsltng/downloadCnsltngExcelList.do">
	                        <button type="button" class="btn btn-primary waves-effect waves-light" onclick ="cnsltngExcelDownload()" >엑셀다운로드</button>
	                    </th:block>                        
                    </div>
                </div>
                
                <div class="card-block-small">
                    <div class="dt-responsive table-responsive">
                        <div id="order-table_wrapper" class="dataTables_wrapper dt-bootstrap4">
                                <table id="jsGrid" class="table-responsive"></table>
                                <div id="listPager" class="text-center"></div>
                       </div>
                    </div>
                </div>
            </div>
          </div>
            
          <!-- Content Area -->
          <div class="col-12">
          <div id="contentPanel" class="card"></div>
          </div>
      </div>
  </div>
  
  <script type="text/javascript" src="/files/bower_components/handlebars/handlebars.min.js" charset="utf-8" ></script>
  <link rel="stylesheet" type="text/css" href="/files/bower_components/bootstrap-daterangepicker/daterangepicker.css">
  <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
  <script type="text/javascript" src="/files/bower_components/bootstrap-daterangepicker/daterangepicker.js"></script>
  <script th:inline="javascript">
    var Pop = "";
    var gridHelper1 ;
    var menuModal;
    
    $(function(){
       gridHelper1 = new GridHelper('jsGrid','contentPanel');
       initDateRangePicker("filterSearchSelectDate1","searchRegStrtDt","searchRegEndDt");
       initDateRangePicker("filterSearchSelectDate2","searchHopeStrtDt","searchHopeEndDt");
       writeJsGridData();
    });
    function writeJsGridData(){
        
        $("#jsGrid").jsGrid({
            height: "auto",
            width: "100%",
            autoload: true,
            sorting: false,
            paging: true,
            pagerContainer: "#listPager",
            pagerFormat: "{first} {prev} {pages} {next} {last}",
            pagePrevText: "이전",
            pageNextText: "다음",
            pageFirstText: "< 처음ㅣ",
            pageLastText: "ㅣ 마지막 >",
            pageSize: 10,
            pageButtonCount: 10,
            pageLoading: true,
            pageIndex: 1,
            noDataContent: "데이터가 없습니다.",
            controller: {
                loadData: function (filter) {
                    var data = $.Deferred();
                    var formData = $('#searchFrm').serializeArray();
                    var params = [
                            {name: "pageNumber", value: filter.pageIndex},
                            {name: "rowPerPage", value: filter.pageSize},
                            {name: "orderField", value: "mdfcn_dt"},
                            {name: "orderDirection", value: "desc"}
                    ]
                    
                    formData = formData.concat(params);
                    
                    $.ajax({
                      type: "GET",
                      contentType: "application/json; charset=utf-8",
                      url: "/mng/cnsltng/selectCnsltngList.do",
                      data: formData,
                      dataType: "json"
                    }).done(function(response){
                        var da = {
                                data: escapeGridData(response.list),
                                itemsCount: response.totalCount
                            };
                      data.resolve(da);
                    });
                    return data.promise();
                },
            },
            fields: [ 
                { title:'No.'        ,name: 'rowNumber'      , type: "number" , width: "80", align:"center", sorting: false },
                { title:'프로그램명'    ,name: 'prgrmNm'        , type: "text"   , width: "200" ,align:"center"},
                { title:'기관명'       ,name: 'instNm'         , type: "text"   , width: "150" ,align:"center"},
                { title:'컨설팅 유형'   ,name: 'cnsltngKndCdNm' , type: "text"   , width: "100" ,align:"center"}, 
                { title:'전문가명'     ,name: 'cnstntNm'        , type: "text"  , width: "200",align:"center"},
                { title:'진행상태'     ,name: 'sttsCdNm'        , type: "text"  , width: "100" ,align:"center"},
                { title:'신청일'       ,name: 'regDt'          , type: "text"   , width: "150" ,align:"center"
                	,itemTemplate: function(value, item){return value.substring(0,10)}
                },
                { title:'현장 방문 기간'       ,name: 'regDt'   , type: "text"  ,width:"150" ,align:"center"
                	,itemTemplate: function(value, item){
                		if(item.vstDe != null && item.vstDe != "")return item.vstDe +"&nbsp;&nbsp;&nbsp;&nbsp;"+item.vstBgngDt.substring(11,16) +" ~ "+ item.vstEndDt.substring(11,16);
                	    else return "-";
                    }
                },
            ]
            /*[# sec:authorize-url="/mng/cnsltng/cnsltngDetailForm.html"]*/
            ,rowClick: function(args) {
                if(args.event.originalEvent.target.cellIndex == 0 || isNaN(args.event.originalEvent.target.cellIndex)) return;
                gridHelper1.loadContent("/mng/cnsltng/cnsltngDetailForm.html?cnsltngid="+args.item.cnsltngid); 
                gridHelper1.rowClick(args);
            },
            /*[/]*/
        });
    }
    function fn_init() {
        $("#searchInstNm").val('');
        $("#searchPrgrmNm").val('');
        $("#searchCsltngKndCd").val('');
        $("#searchSttsCd").val('');
        $("#searchRegStrtDt").val('');
        $("#searchRegEndDt").val('');
        $("#searchHopeStrtDt").val('');
        $("#searchHopeEndDt").val('');
        $("#filterSearchSelectDate1").val('');
        $("#filterSearchSelectDate2").val('');
    }
    function fn_searchForm(){

        var SearchRegStrtDt  = $("#searchRegStrtDt").val();
        var SearchRegEndDt   = $("#searchRegEndDt").val();
        var SearchHopeStrtDt = $("#searchHopeStrtDt").val();
        var SearchHopeEndDt  = $("#searchHopeEndDt").val();
        
        if(SearchRegStrtDt != null && SearchRegStrtDt !="" && SearchRegEndDt != null && SearchRegEndDt !=""){
            if(SearchRegStrtDt > SearchRegEndDt ) {alert("신청일 검색 종료일은 시작일 이후여야 합니다."); return;}
        }
        if(SearchHopeStrtDt != null && SearchHopeStrtDt !="" && SearchHopeEndDt != null && SearchHopeEndDt !=""){
            if(SearchHopeStrtDt > SearchHopeEndDt ) {alert("현장방문 검색 종료일은 시작일 이후여야 합니다."); return;}
        }
    	gridHelper1.resetListContent();
    }
    cnsltngExcelDownload =()=>{
	  var f = document.searchFrm;
	  f.action ="/mng/cnsltng/downloadCnsltngExcelList.do";
	  f.submit();
    }
</script>
</div>	
</body>