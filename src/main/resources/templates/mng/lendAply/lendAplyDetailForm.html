<form id="modifyFrm" action="" onsubmit="return false;">
  <div class="card-header p-b-0">
      <h3 class="sub-title"><strong>신청자 정보</strong></h3>
  </div>
  <div class="card-block-small p-t-0">
      <div class="row">
          <div class="col-lg-3 mb-3">
              <div class="mb-0 form-group ">
                  <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>신청상태</strong></div>
                   <th:block kattr:select_code="searchSttsCd" grpCd="231" upprCd="0" th:attr="selectedCd=${lendAplyInfo.sttsCd}" disabled onchange="" firstOptTxt="- 전체 -" addClass="form-select form-select-sm form-control-sm" isAdmin="true"></th:block>
              </div>
          </div>
          <div class="col-lg-9 mb-3">
              <div class="mb-0 form-group ">
                  <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>대여불가 사유</strong></label>
                  <div class="col-12">
                      <input type="text" class="form-control form-control-sm" name="" id=""  th:value="${lendAplyInfo.rejectRsn}" readonly/>
                  </div>
              </div>
          </div>
      </div>
      <div class="row">
          <div class="col-lg-6 mb-3">
              <div class="mb-0 form-group">
                  <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>신청자</strong></label>
                  <div class="col-12">
                      <input type="text" class="form-control form-control-sm" name="" id="" th:value="${lendAplyInfo.aplcntNm}" readonly/>
                  </div>
              </div>
          </div>
          <div class="col-sm-6 col-lg-3 mb-3">
              <div class="mb-0 form-group required">
                  <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>전화번호</strong></label>
                  <div class="col-12">
                      <input type="text" class="form-control form-control-sm" name="telno" id="telno"  th:value="${lendAplyInfo.telno}"/>
                  </div>
              </div>
          </div>
          <div class="col-sm-6 col-lg-3 mb-3">
              <div class="mb-0 form-group required">
                  <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>이메일</strong></label>
                  <div class="col-12">
                      <input type="text" class="form-control form-control-sm" name="eml" id="eml" th:value="${lendAplyInfo.eml}"/>
                  </div>
              </div>
          </div>
      </div>
      <div class="row">
          <div class="col-sm-6 col-lg-3 mb-3">
              <div class="mb-0 form-group required">
                  <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>단체명</strong></label>
                  <div class="col-12">
                      <input type="text" class="form-control form-control-sm" name="grpNm" id="grpNm" placeholder="단체명" th:value="${lendAplyInfo.grpNm}"/>
                  </div>
              </div>
          </div>
          <div class="col-sm-6 col-lg-3 mb-3">
              <div class="mb-0 form-group required">
                  <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>교육횟수</strong></label>
                  <div class="col-12">
                      <input type="text" class="form-control form-control-sm" name="eduCnt" id="eduCnt" placeholder="교육횟수" th:value="${lendAplyInfo.eduCnt}"/>
                  </div>
              </div>
          </div>
          <div class="col-sm-6 col-lg-3 mb-3">
              <div class="mb-0 form-group required">
                  <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>교육인원수</strong></label>
                  <div class="col-12">
                      <input type="text" class="form-control form-control-sm" name="eduNope" id="eduNope" placeholder="교육 인원수 " th:value="${lendAplyInfo.eduNope}"/>
                  </div>
              </div>
          </div>
      </div>
      <div class="row">
          <div class="col-sm-6 col-lg-3 mb-3">
              <div class="mb-0 form-group required">
                  <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>수령인</strong></label>
                  <div class="col-12">
                      <input type="text" class="form-control form-control-sm" name="recptr" id="recptr" placeholder="수령인" th:value="${lendAplyInfo.recptr}"/>
                  </div>
              </div>
          </div>
          <div class="col-sm-6 col-lg-3 mb-3">
              <div class="mb-0 form-group required">
                  <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>수령인 전화번호</strong></label>
                  <div class="col-12">
                      <input type="text" class="form-control form-control-sm" name="recptrTelno" id="recptrTelno" placeholder="수령인 전화번호" th:value="${lendAplyInfo.recptrTelno}"/>
                  </div>
              </div>
          </div>
          <div class="col-sm-6 col-lg-3 mb-3">
              <div class="mb-0 form-group required">
                  <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>수령인 이메일</strong></label>
                  <div class="col-12">
                      <input type="text" class="form-control form-control-sm" name="recptrEml" id="recptrEml" placeholder="수령인 전화번호" th:value="${lendAplyInfo.recptrEml}"/>
                  </div>
              </div>
          </div>
      </div>
      <div class="row">
          <div class="col-md-3 col-lg-2 mb-3">
              <div class="mb-0 form-group">
                  <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>배송지 우편번호</strong></label>
                  <div class="col-12">
                      <input type="text" class="form-control form-control-sm" name="dlvyZip" id="dlvyZip" placeholder="배송지 우편번호" th:value="${lendAplyInfo.dlvyZip}" readonly onclick="daumPostCode()"/>
                  </div>
              </div>
          </div>
          <div class="col-md-9 col-lg-4 mb-3">
              <div class="mb-0 form-group required">
                  <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>배송지 주소</strong></label>
                  <div class="col-12">
                      <input type="text" class="form-control form-control-sm" name="dlvyAddr" id="dlvyAddr" placeholder="배송지 주소" th:value="${lendAplyInfo.dlvyAddr}" readonly onclick="daumPostCode()"/>
                  </div>
              </div>
          </div>
          <div class=" col-lg-6 mb-3">
              <div class="mb-0 form-group required">
                  <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>배송지 주소 상세</strong></label>
                  <div class="col-12">
                      <input type="text" class="form-control form-control-sm" name="dlvyAddrDtl" id="dlvyAddrDtl" placeholder="배송지 주소 상세" th:value="${lendAplyInfo.dlvyAddrDtl}" />
                  </div>
              </div>
          </div>
      </div>
  </div>

  <div class="card-header p-t-0 p-b-0">
      <h3 class="sub-title"><strong>꾸러미 정보</strong></h3>
  </div>
  <div class="card-block-small p-t-0">
      <div class="row">
          <div class="col-lg-6 mb-3">
              <div class="mb-0 form-group">
                  <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>배송상태</strong></label>
                  <div class="align-items-end row">
                      <div class="col-sm-6">
                          <th:block kattr:select_code="dlvySttsCd" grpCd="230" upprCd="0" th:attr="selectedCd=${lendAplyInfo.dlvySttsCd}" disabled  firstOptTxt="없음" addClass="form-select form-select-sm form-control-sm" isAdmin="true"></th:block>
                      </div>
                      <div class="col-sm-6 mt-1 mt-sm-0">
                      
                          <span class="label label-inverse" th:each="item:${aplyDlivyList}" >
                              [[${item.indvdno}]] 
                          </span>
                          
                      </div>
                  </div>
              </div>
          </div>
          <div class="col-lg-3 mb-3">
              <div class="mb-0 form-group">
                  <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>송장정보</strong></label>
                  <div class="col-12">
                      <input type="text" class="form-control form-control-sm" name="" id="" placeholder="송장정보" th:value="${lendAplyInfo.invcnoDlivy}" readonly>
                  </div>
              </div>
          </div>
      </div>
      <div class="row">
          <div class="col-lg-6 mb-3">
              <div class="mb-0 form-group">
                  <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>대여모집</strong></div>
                  <div class="col-12">
                      <input type="text" class="form-control form-control-sm" name="" id="" th:value="${lendInfo.rcritNm}" readonly>
                  </div>
              </div>
          </div>
          <div class="col-sm-6 col-lg-3 mb-3">
              <div class="mb-0 form-group">
                  <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>신청수량</strong></label>
                  <div class="col-12">
                      <input type="text" class="form-control form-control-sm" name="" id="" placeholder="Text Input Validation" th:value="${lendAplyInfo.qnty}" readonly>
                  </div>
              </div>
          </div>
          <div class="col-sm-6 col-lg-3 mb-3">
              <div class="mb-0 form-group">
                  <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>대여기간</strong></label>
                  <div class="col-12">
                      <input type="text" name="daterange" class="form-control form-control-sm" th:value="${lendAplyInfo.lendBgngDe+' ~ ' + lendAplyInfo.lendEndDe}" id="" readonly>
                  </div>
              </div>
          </div>
      </div>
      <div class="row">
          <div class="col-lg-3 mb-3">
              <div class="mb-0 form-group">
                  <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>꾸러미명</strong></label>
                  <div class="col-12">
                      <input type="text" class="form-control form-control-sm" name="" id=""  th:value="${lendInfo.packageNm}" readonly>
                  </div>
              </div>
          </div>
          <div class="col-lg-9 mb-3">
              <div class="mb-0 form-group">
                  <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>꾸러미 정보</strong></label>
                  <div class="col-12">
                      <input type="text" class="form-control form-control-sm" name="" id="" placeholder="꾸러미 정보"
                         th:value="'*유형 : '+${lendInfo.typeCdNm} + '   *교육주제 : '+ ${lendInfo.eduSbjctCdNm} + '   *교육대상 :' + ${lendInfo.eduTrgtCdNm} 
                                     +'   *모둠구성 : '+ ${lendInfo.teamCmpstnCdNm} +'   *교육유형 : '+ ${lendInfo.eduTypeCdNm}"  
                        readonly>
                  </div>
              </div>
          </div>
      </div>
  </div>

  <div class="card-block-small">
      <button type="button" class="btn btn-disabled m-r-5" onclick="javascript:gridHelper1.removeHighlight(); gridHelper1.toggleContent();">취소</button>
      
      <th:block th:if="${lendAplyInfo.dlvySttsCd != '230102'}" >
      <th:block sec:authorize-url="/mng/lendAply/updateLendAply.do" >
      <button type="button" class="btn btn-primary" onclick="save()">저장</button>
      </th:block>
      </th:block>
      
  </div>
  
  <input type="hidden" id="aplyid"   name="aplyid"    th:value="${lendAplyInfo.aplyid}" />
  <input type="hidden" id="ctprvnCd" name="ctprvnCd"  th:value="${lendAplyInfo.ctprvnCd}"/>
</form>

<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script type="text/javascript" src="/files/assets/pages/advance-elements/select2-custom.js"></script>
<script th:inline="javascript">

    $(function(){
        //to_do     
    })
    
    function  daumPostCode() {
      new daum.Postcode({
          oncomplete: function (data) {
              let addr = '';
              if (data.userSelectedType === 'R') {
                  addr = data.roadAddress;
              } else {
                  addr = data.jibunAddress;
              }
              
              $('#dlvyZip').val(data.zonecode);
              $('#dlvyAddr').val(addr);
              $('#dlvyAddrDtl').focus();
              if(data.sigunguCode!=null){
                  $('#ctprvnCd').val((data.sigunguCode).substring(0,2));
              }
          }
      }).open();
    }
    
    var validator= $("#modifyFrm").validate({
		      onsubmit: false,
	          rules: {
	        	        telno        :   { required: true , maxlength: 40 }
		        	    ,eml         :   { required: true }
		        	    ,grpNm       :   { required: true }
		        	    ,eduCnt      :   { required: true }
		        	    ,eduNope     :   { required: true }
		        	    ,recptr      :   { required: true ,maxlength: 100}
		        	    ,recptrTelno :   { required: true ,maxlength: 40}
		        	    ,recptrEml   :   { required: true ,maxlength: 200}
		        	    ,dlvyZip     :   { required: true }
		        	    ,dlvyAddr    :   { required: true }
		        	    ,dlvyAddrDtl :   { required: true }
	            },
	            messages: {
                        telno        :   { required: "전화번호를 입력해주십시오." ,maxlength: "자를 넘을수 없습니다." }
		                ,eml         :   { required: "이메일를 입력해주십시오." }
		                ,grpNm       :   { required: "그룹명을 입력해주십시오." }
		                ,eduCnt      :   { required: "교육 횟수를 입력해주십시오." }
		                ,eduNope     :   { required: "교육인원을 입력해주십시오." }
		                ,recptr      :   { required: "수령인를 입력해주십시오." ,maxlength:"자를 넘을수 없습니다."}
		                ,recptrTelno :   { required: "수령인 전화번호를 입력해주십시오." ,maxlength:"자를 넘을수 없습니다."}
		                ,recptrEml   :   { required: "수령인 이메일을 입력해주십시오." ,maxlength:"자를 넘을수 없습니다."}
		                ,dlvyZip     :   { required: "배송지 우편번호를 입력해주십시오." }
		                ,dlvyAddr    :   { required: "배송지 주소를 입력해주십시오." }
		                ,dlvyAddrDtl :   { required: "배송지 상세주소를 입력해주십시오." }
		            
	            }
	})
	
 	function save(){
     	
	 	if(!($("#modifyFrm").valid())) return;
	 	
        if(!confirm("저장하시겠습니까?"))return;
        
	    if(displayWorkProgress()){
			$.ajax({
				url : "/mng/lendAply/updateLendAply.do",
				type: 'POST',
				cache : false,
				dataType: 'json',
				data : $("#modifyFrm").serialize(),
				success : function (data){
					if(data.result=="success"){
						alert(data.msg);
						gridHelper1.resetListContent();
					}else{
						alert(data.msg);
					}
					closeWorkProgress();
				}
			});
		}
	}
    
</script>