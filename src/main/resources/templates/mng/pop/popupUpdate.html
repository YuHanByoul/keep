
 <form class=" form-inline form-horizontal row-border" id="updatePopupForm">  
         <!-- insert 부분 -->
         <div class="card">
             <div class="card-header p-b-0">
                 <h3 class="sub-title"><strong>기본정보</strong></h3>
             </div>
             <div class="card-block-small p-t-0">
                 <div class="mb-2 row">
                     <div class="col-lg-6">
                         <div class="mb-0 form-group required">
                             <span class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>사이트</strong></span>
                             <div class="col-sm-12">
                                  <th:block kattr:select_site="siteid" sysSeCd=""  firstOptTxt="- 선택 -"  th:attr="selectedId=${paramVO.siteid}" firstOptVal=""></th:block>
                             </div>
                         </div>
                     </div>
                 </div>
                 <div class="mb-2 row">
                     <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                         <div class="mb-0 form-group required">
                             <span class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>노출위치</strong></span>
                             <div class="col-12 mt-1">
                                 <div class="form-radio">
                                     <div class="radio radio-inline">
                                         <label class="mb-0 ">
                                             <input type="radio" name="expsrLcCd" value="M" th:checked = "${paramVO.expsrLcCd} == 'M'">
                                             <i class="helper"></i>메인
                                         </label>
                                     </div>
                                     <div class="radio radio-inline">
                                         <label class="mb-0 ">
                                             <input type="radio" name="expsrLcCd" value="S" th:checked = "${paramVO.expsrLcCd} == 'S'">
                                             <i class="helper"></i>메뉴
                                         </label>
                                     </div>
                                 </div>
                             </div>
                         </div>
                     </div>
                     <div class="col-12 col-lg-6">
                         <div class="mb-0 form-group">
                             <span class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>메뉴 선택</strong></span>
                             <div class="col-12">
                                 <div class="input-group input-group-sm input-group-dropdown mb-0" >
                                 
                                     <button type="button" id="menuBtn" class="input-group-text btn btn-primary waves-effect" onclick="fn_openMenuModal('menu')">메뉴선택</button>
                                     
                                     <input type="text" class="form-control" id="menuNm" name="menuNm" readonly th:value="${paramVO.menuNm}" 
                                     aria-label="Text input with dropdown button">
                                     <input type="hidden" id="menuid" name="menuid" class="form-control input-sm" th:value="${paramVO.menuid}" readOnly  disabled/>
                                     
                                 </div>
                             </div>
                         </div>
                     </div>
                 </div>
                 <div class="mb-2 row">
                     <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                         <div class="mb-0 form-group required">
                             <span class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>공지대상</strong></span>
                             <div class="col-12 mt-1">
                                 <div class="form-radio">
                                     <div class="radio radio-inline">
                                         <label class="mb-0 ">
                                             <input type="radio" name="ntcTrgtCd" id="ntcTrgtCd1" value="T"  th:checked="${paramVO.ntcTrgtCd =='T'}">
                                             <i class="helper"></i>전체
                                         </label>
                                     </div>
                                     <div class="radio radio-inline">
                                         <label class="mb-0 ">
                                             <input type="radio" name="ntcTrgtCd" id="ntcTrgtCd2" value="R" th:checked="${paramVO.ntcTrgtCd =='R'}">
                                             <i class="helper"></i>역할
                                         </label>
                                     </div>
                                 </div>
                             </div>
                         </div>
                     </div>
                     <div class="col-12 col-lg-6">
                         <div class="mb-0 form-group required">
                             <span class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>선택 역할</strong></span>
                             <div class="col-sm-12">
                                 <select id="ntcTrgtRoleid" name="ntcTrgtRoleid" class="form-select form-select-sm form-control-sm">
                                     <option value=""> -  선택 -</option>
                                     <option th:each="item : ${roleList}" th:value="${item.roleid}" th:text="${item.nm} " th:selected ="${paramVO.ntcTrgtRoleid } == ${item.roleid}"></option>
                                 </select>
                                 
                             </div>
                         </div>
                     </div>
                 </div>
                 <div class="mb-2 row">
                     <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                         <div class="row">
                             <div class="col-6">
                                 <div class="mb-0 form-group row required">
                                     <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="strtDt"><strong>팝업 시작일</strong></label>
                                     <div class="col-sm-12">
                                         <input class="form-control form-control-sm" type="date" name="strtDt" id="strtDt" th:value="${#strings.substring(paramVO.strtDt,0,10)}"/>
                                     </div>
                                 </div>
                             </div>
                             <div class="col-6">
                                 <div class="mb-0 form-group row required">
                                     <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="endDt"><strong>팝업 종료일</strong></label>
                                     <div class="col-sm-12">
                                         <input class="form-control form-control-sm" type="date" name="endDt" id="endDt" th:value="${#strings.substring(paramVO.endDt,0,10)}" />
                                     </div>
                                 </div>
                             </div>
                         </div>
                     </div>
                     <div class="col-12 col-lg-6">
                         <div class="mb-0 form-group required">
                             <span class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>로그인 필요여부</strong></span>
                             <div class="col-12 mt-1">
                             
                                 <div class="form-radio">
                                     <div class="radio radio-inline">
                                         <label class="mb-0 ">
                                             <input type="radio" name="loginNeedYn" id="loginNeedYn1" value="Y" th:checked="${paramVO.loginNeedYn =='Y'}"/>
                                             <i class="helper"></i>필요
                                         </label>
                                     </div>
                                     <div class="radio radio-inline">
                                         <label class="mb-0 ">
                                             <input type="radio" name="loginNeedYn" id="loginNeedYn2" value="N" th:checked="${paramVO.loginNeedYn =='N'}"/>
                                             <i class="helper"></i>필요없음
                                         </label>
                                     </div>
                                 </div>
                                 
                             </div>
                         </div>
                     </div>
                 </div>
                 <div class="mb-2 row">
                     <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                         <div class="row">
                             <div class="col-6">
                                 <div class="mb-0 form-group required">
                                     <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="popupRowSize"><strong>팝업 가로 px</strong></label>
                                     <div class="col-sm-12">
                                         <input type="text" class="form-control form-control-sm" name="widthSize" id="widthSize" th:value="${paramVO.widthSize}" placeholder="팝업 가로 px">
                                     </div>
                                 </div>
                             </div>
                             <div class="col-6">
                                 <div class="mb-0 form-group required">
                                     <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="popupColumnSize"><strong>팝업 세로 px</strong></label>
                                     <div class="col-sm-12">
                                         <input type="text" class="form-control form-control-sm" name="vrticlSize" id="vrticlSize" th:value="${paramVO.vrticlSize}" placeholder="팝업 세로 px">
                                     </div>
                                 </div>
                             </div>
                         </div>
                     </div>
                     <div class="col-12 col-lg-6">
                         <div class="row">
                             <div class="col-6">
                                 <div class="mb-0 form-group required">
                                     <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="topLc"><strong>팝업 위치 - Top</strong></label>
                                     <div class="col-sm-12">
                                         <input type="text" class="form-control form-control-sm" name="topLc" id="topLc" th:value="${paramVO.topLc}" placeholder="팝업 위치 - Top">
                                     </div>
                                 </div>
                             </div>
                             <div class="col-6">
                                 <div class="mb-0 form-group required">
                                     <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="leftLc"><strong>팝업 위치 - Left</strong></label>
                                     <div class="col-sm-12">
                                         <input type="text" class="form-control form-control-sm" name="leftLc" id="leftLc" th:value="${paramVO.leftLc}" placeholder="팝업 위치 - Left">
                                     </div>
                                 </div>
                             </div>
                         </div>
                     </div>
                 </div>
                 <div class="mb-2 row">
                     <div class="col-12 col-lg-6">
                         <div class="mb-0 form-group required">
                             <span class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>팝업창 유형</strong></span>
                             <div class="col-12 mt-1">
                                 <div class="form-radio">
                                     <div class="radio radio-inline">
                                         <label class="mb-0 ">
                                             <input type="radio" name="popupTypeCd" value="M"  th:checked="${paramVO.popupTypeCd =='M'}"/>
                                             <i class="helper"></i>모달
                                         </label>
                                     </div>
                                     <div class="radio radio-inline">
                                         <label class="mb-0 ">
                                             <input type="radio" name="popupTypeCd" value="L" th:checked="${paramVO.popupTypeCd =='L'}"/>
                                             <i class="helper"></i>레이어
                                         </label>
                                     </div>
                                     <div class="radio radio-inline">
                                         <label class="mb-0 ">
                                             <input type="radio" name="popupTypeCd" value="P" th:checked="${paramVO.popupTypeCd =='P'}"/>
                                             <i class="helper"></i>팝업
                                         </label>
                                     </div>
                                 </div>
                             </div>
                         </div>
                     </div>
                 </div>
                 <div class="mb-2 form-group row required">
                     <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="title"><strong>제목</strong></label>
                     <div class="col-sm-12">
                         <input type="text" class="form-control form-control-sm" name="title" id="title" th:value="${paramVO.title}" placeholder="제목"/>
                     </div>
                 </div>
                 <div class="form-group row m-b-0 required">
                     <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="cntnts"><strong>내용</strong></label>
                     <div class="col-sm-12">
                         <textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="" id="cntnts" name="cntnts">
                           <th:block th:text="${paramVO.cntnts}"/>
                         </textarea>
                     </div>
                 </div>
             </div>
             <div class="card-block-small">
             
                 <button type="button" class="btn btn-disabled m-r-5" onclick="resetListContent()" >취소</button>
                 <th:block sec:authorize-url="/mng/pop/updatePopUpNtc.do">
                     <button type="button" class="btn btn-primary" id="insertPst" onclick="savePn()">저장</button>
                 </th:block>
                 
             </div>
         </div>
       <!-- //insert 부분 -->
       
 <input type="hidden" id="popupntcid" name="popupntcid"  th:value="${paramVO.popupntcid}"/>
 <input type="hidden" id="sid" th:value="${paramVO.siteid}"/>
 </form>
 
 <script th:inline="javascript">
    
    var updatePopupFormNtUrl = "/mng/pop/updatePopupFormNtc.do";
    var updatePopUpNtUrl = "/mng/pop/updatePopUpNtc.do";
    var deletePopUpNtUrl = "/mng/pop/deletePopUpNtc.do";
    var editor = null;
    
    $(function(){

        editor = CKEDITOR.replace('cntnts');
        validate();
        $("input:radio[name=expsrLcCd]").click(function(){
            fn_disableEexpsrLcCd();
        })
        $("input:radio[name=ntcTrgtCd]").click(function(){
            fn_disableTargetCd();
        })
        fn_disableEexpsrLcCd();
        fn_disableTargetCd() 
    });
    
    function fn_disableEexpsrLcCd(){
        var chkCd = $("input:radio[name=expsrLcCd]:checked").val();
        if(chkCd=="M"){
            $("#menuid").val("");
            $("#menuNm").val("");
            $("#menuBtn").attr("disabled",true);
            $("#menuid").attr("disabled",true);
            $("#menuNm").attr("disabled",true);
        }else{
            $("#menuBtn").attr("disabled",false);
            $("#menuid").attr("disabled",false);
            $("#menuNm").attr("disabled",false);
        }
    }
    
    function fn_disableTargetCd(){
        var chkCd = $("input:radio[name=ntcTrgtCd]:checked").val();
        if(chkCd=="T"){
            $("#ntcTrgtRoleid").val("");
            $("#ntcTrgtRoleid").attr("disabled",true);
        }else{
            $("#ntcTrgtRoleid").attr("disabled",false);
        }
    }

    // 유효성검증기
    function validate(){
        $("#updatePopupForm").validate({
            ignore: [], // 에디터 사용시 추가해야한다.
            rules: {
                siteid : {required: true }
                ,loginNeedYn : {required: true }
                ,menuNm: {required: true }
                ,ntcTrgtRoleid: {required: true }
                ,strtDt: {required: true }
                ,endDt: {required: true }
                ,widthSize: {required: true , digits:true, maxlength: 4 }
                ,vrticlSize: {required: true , digits:true, maxlength: 4 }
                ,topLc: {required: true , digits:true, maxlength: 4}
                ,leftLc: {required: true , digits:true, maxlength: 4}
                ,title : {required: true, maxlength: 200 }
                ,cntnts: {required: true ,maxlength: 4000}
            },
            messages: { 
                siteid : {required: "사이트를 선택해 주십시오." }
                ,loginNeedYn: {required: "노출위치를 선택해 주십시오."}
                ,menuNm: {required: "메뉴를 선택해 주십시오." }
                ,ntcTrgtRoleid: {required: "역할을 선택해 주십시오." }
                ,strtDt : {required: "팝업시작일자를 입력해 주십시오." }
                ,endDt  : {required: "팝업종료일자를 입력해 주십시오." }
                ,widthSize: {required: "팝업 가로 사이즈를 입력해 주십시오."  }
                ,vrticlSize: {required: "팝업 세로 사이즈를 입력해 주십시오." }
                ,topLc : {required: "팝업  top 위치를 입력해 주십시오."  }
                ,leftLc: {required: "팝업 left 위치를 입력해 주십시오." }
                ,widthSize: {maxlength: "값이 너무 큽니다."  }
                ,vrticlSize: {maxlength: "값이 너무 큽니다." }
                ,topLc : {maxlength: "값이 너무 큽니다."  }
                ,leftLc: {maxlength: "값이 너무 큽니다." }
                ,title  :  {required: "팝업제목을 입력해 주십시오." , maxlength: "팝업제목은 200자를 넘을 수 없습니다."   }
                ,cntnts : {required: "팝업내용을 입력해 주십시오." , maxlength: "팝업 내용은 4000자를 넘을 수 없습니다." }
            }
        });
    }
    
    function savePn(){
        
        $('#cntnts').val(editor.getData());
        if(!$('#updatePopupForm').valid()) return;
        if(displayWorkProgress()){
            $.ajax({
                url: updatePopUpNtUrl,
                cache: false,
                dataType: 'json',
                data: $("#updatePopupForm").serialize(),
                success: function(data){
                    if(data.result='success'){
	                    alert(data.msg);
	                    gridHelper1.resetListContent();
                    }else{
	                    alert(data.msg);
                    }
                    closeWorkProgress();
                }
            });
        }
    }

    function deletePop(){

        if(!confirm("정말로 삭제 하시겠습니까?"))return;
        
        if(displayWorkProgress()){
            $.ajax({
                url: deletePopUpNtUrl,
                cache: false,
                dataType: 'json',
                data: { popupntcid: $("#popupntcid").val() },
                success: function(data){
                    if(data.result='success'){
                        alert(data.msg);
                        gridHelper1.resetListContent();
                    }else{
                        alert(data.msg);
                    }
                    closeWorkProgress();
                }
            });
        }
    }
    
</script>    
