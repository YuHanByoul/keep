<!-- [팝업] 컨설팅 대상 -->
<form id="cnsltngTrgtPopupFrm">
    <input type="hidden" id="aplyid" name="aplyid" th:value="${aplyInfo.aplyid}">

    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content type_2">
            <div class="modal-header">
                <h4 class="modal-title">컨설팅 대상</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true"></span>
                </button>
            </div>
            <div class="modal-body">
                <div class="card m-b-10">
                    <div class="card-block-small">
                        <div class="mb-0 form-group row required">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="popInput00"><strong>내용</strong></label>
                            <div class="col-12">
                                <textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="컨설팅 대상 내용" id="cnsltngTrgtCn" name="cnsltngTrgtCn" >[[${aplyInfo.cnsltngTrgtCn}]]</textarea>
                            </div>
                        </div>

                        <div class="mb-0 form-group row required">
                            <label class="form-label col-sm-12 col-form-label p-t-10 pb-1" for="popInput00"><strong>컨설턴트 배정</strong></label>
                            <div class="col-12">

                                <div class="col-sm-12 btn-group-sm">
                                    <button type="button" class="btn btn-inverse" onclick="fn_opencnsltngPicModal();">담당자 검색</button>
                                </div>

                                <div class="m-0 row">
                                    <div class="col-12 row border rounded p-t-10 p-b-10 m-0 mt-2">
                                        <div class="col-auto">
                                            <div class="col-auto" id="mng_list_area">
                                                <th:block th:each="item : ${cnstntList}">
                                                    <span class="label label-inverse mb-2" th:id="'mng_list_'+${item.userid}">
                                                    <th:block th:text="${item.nm}+' '"></th:block> (
                                                    <th:block th:text="${item.acnt}"></th:block>) |
                                                    <th:block th:text="${item.eml}"></th:block> |
                                                    <th:block th:text="${item.moblphon}+' '"></th:block> &nbsp;&nbsp;&nbsp;
                                                    <a th:href="'javascript:deleteMng('+${item.userid}+')'" class="text-white delete-manager">X</a>
                                                    <input type="hidden" th:id="'cnstnt'+${item.userid}"
                                                        name="cnstntIds" th:value="${item.userid}">
                                                    </span>
                                                </th:block>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary waves-effect waves-light" onclick="cnsltngTrgtPop.saveFrm();">저장</button>
            </div>
        </div>
    </div>
</form>

<!-- 컨설팅담당자 팝업 -->
<div class="modal fade" id="cnsltngPicPopup" aria-hidden="true" data-bs-backdrop="static"/>
<!-- //[팝업] 컨설팅 대상 -->
<div class="modal fade" id="cnslngModal" aria-hidden="true" data-bs-backdrop="static"></div>

<script th:inline="javascript">

var validator= $("#cnsltngTrgtPopupFrm").validate({
    rules: {
    	cnsltngTrgtCn : { required: true, maxlength:500 }
    },
    messages: {
    	cnsltngTrgtCn : { required:"내용을 입력해주십시오", maxlength:"내용은 500자 이하여야 합니다."}
    }
});

//컨설팅담당자 팝업
var cnsltngPicUrl = "/mng/bizAply/bizRpt/cnsltngPicPopup.html";
var cnsltngPicModal;
var fn_opencnsltngPicModal =()=> {

    var keyid = $("#reportid").val();
    var url = cnsltngPicUrl + "?instid="+$("#instid").val();    //회원검색

    $("#cnsltngPicPopup").load(url, function(response, status, xhr) {
        if (status == "success") {
            cnsltngPicModal = new bootstrap.Modal($('#cnsltngPicPopup'));
            cnsltngPicModal.show();
        }
    });
}

var cnstntSearchModal;
var cnsltngid="";
var url = "/mng/cnsltng/cnsltngManagerPopup.html?cnsltngid="+cnsltngid;

//회원 검색 모달 오픈
var fn_openInstManagerSearchModal =()=> {

    $("#cnslngModal").load(url, function(response, status, xhr) {
        if (status == "success") {
            cnstntSearchModal = new bootstrap.Modal($('#cnslngModal'));
            cnstntSearchModal.show();
        }
    });
}

var cnsltngTrgtPop = {

    insertUrl: "/mng/bizAply/bizRpt/insertCnsltngTrgt.do",

    init:function(){

    },
    saveFrm : function(){


        if(!($("#cnsltngTrgtPopupFrm").valid())) return;
        if($("[name^=cnstntIds]").length == 0 ){
        	alert("담당자를 입력해 주세요");
        	return;
        }

        if(!confirm("저장하시겠습니까?")) return;

        var data =  $("#cnsltngTrgtPopupFrm").serialize();

        if(displayWorkProgress()){
            $.ajax({
                url : cnsltngTrgtPop.insertUrl,
                type: 'POST',
                cache : false,
                dataType: 'json',
                data : data,
                success : function (data){
                    debugger;
                    if(data.result=="success"){
                        alert(data.msg);
                        cnsltngTrgtModal.hide();
                        mdlRptSbmsnGridHelper1.resetListContent();

                    }else{
                        alert(data.msg);
                    }
                    closeWorkProgress();
                }
            });
        }
    }
};

//담당자 삭제
var deleteMng = (id) =>{
    $("#mng_list_area").find("#mng_list_"+id).remove();
}



$(function() {
	cnsltngTrgtPop.init();
});


</script>