<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
    xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
    layout:decorator="layout/mng/mainLayout">

<body>
    <div layout:fragment="content">
    <style>
        .hide
        {
           display:none;
        }
        </style>
    <!-- Date-range picker css  -->
    <link rel="stylesheet" type="text/css" href="/files/bower_components/bootstrap-daterangepicker/daterangepicker.css">
        <div class="page-body">
            <div class="row">
                <div class="col-12">

                    <form name="searchFrm" id="searchFrm" action="" onsubmit="return false;" class="card">
                        <input type="hidden" id="searchBgngDt" name="searchBgngDt" value="">
                        <input type="hidden" id="searchEndDt"  name="searchEndDt"  value="">

                        <div class="card-block-small">
                            <div class="row">
                                <div class="col-lg-3 col-md-6 mb-3">
                                    <div class="mb-0 form-group row">
                                        <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>사업분야</strong></div>
                                        <div class="col-12">
                                            <th:block kattr:select_code="searchFldCd" grpCd="173" upprCd="0" selectedCd="" onchange="" firstOptTxt="- 전체 -" addClass="form-select form-select-sm form-control-sm" isAdmin="true"></th:block>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6 mb-3">
                                    <div class="mb-0 form-group row">
                                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="searchPcntstNm"><strong>공모명</strong></label>
                                        <div class="col-12">
                                            <input type="text" class="form-control form-control-sm" name="searchPcntstNm" id="searchPcntstNm"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6 mb-3">
                                    <div class="mb-0 form-group row">
                                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="filterSearchSelectDate"><strong>중간보고제출기간</strong></label>
                                        <div class="col-sm-12">
                                            <input type="text" name="filterSearchSelectDate" id="filterSearchSelectDate" class="form-control form-control-sm" value=""/>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6 mb-3">
                                    <div class="mb-0 form-group row">
                                        <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>진행상태</strong></div>
                                        <div class="col-sm-12">
                                            <th:block kattr:select_code="searchPrgrsSttsCd" grpCd="200" upprCd="0" selectedCd="" onchange="" firstOptTxt="- 전체 -" addClass="form-select form-select-sm form-control-sm" isAdmin="true"></th:block>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-1 p-t-20 text-center border-top">
                                <button type="button" class="btn btn-disabled m-r-5" onclick="mdlRptMng.initSearch();">초기화</button>
                                <button type="submit" class="btn btn-primary" onclick="mdlRptMng.onSearch();">검색</button>
                            </div>
                        </div>
                    </form>
                </div>
                <!--임시그리드-->
                <div class="col-12">
                    <div class="card">
                        <div class="row p-20 p-b-0">
                            <div class="col-12 col-md-8 mb-2 mb-md-0">
                                <h5><strong>중간보고관리 검색결과</strong></h5>
                            </div>
                            <div class="col-12 col-md-4 text-right">
                                <button type="button" class="btn btn-primary" onclick="mdlRptMng.downGridExcel();">엑셀다운로드</button>
                            </div>
                        </div>
                        <div class="card-block-small">
                            <table id="mdlRptMngGrid" class="table-responsive"></table>
                            <div id="mdlRptMngPager" class="text-center"></div>
                        </div>
                    </div>
                </div>
                <!-- 상세 -->
                <div class="col-12">
                    <div id="contentPanel" class="" style="display: none;"></div>
                </div>
                <!-- 상세 -->
            </div>
        </div>

            <!-- Date-range picker js -->
        <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
        <script type="text/javascript" src="/files/bower_components/bootstrap-daterangepicker/daterangepicker.js"></script>
        <script th:inline="javascript">
            var mdlRptMngGridHelper1;

            var mdlRptMng = {
                listUrl  : "/mng/bizAply/bizRpt/selectMdlRptMngList.do"
              , excelUrl : "/mng/bizAply/bizRpt/selectMdlRptMngListExcel.do"
              , dtlUrl   : "/mng/bizAply/bizRpt/mdlRptMngDetailForm.html"
              , init :
            	  function() {
            	      //$("#searchFrm").prop("onsubmit","return false;")
                      mdlRptMngGridHelper1 = new GridHelper('mdlRptMngGrid','contentPanel');

                      this.initSearch();
                      this.setGrid();
                  }
              , initSearch :
            	  function() {
            	  $("#searchFldCd, #searchPcntstNm, #searchPrgrsSttsCd ,#filterSearchSelectDate, #searchBgngDt, #searchEndDt").val('');

                    $("#filterSearchSelectDate").daterangepicker({
                        autoUpdateInput: false,
                        locale: {
                            format: "YYYY-MM-DD",
                        },
                    });

                    $("#filterSearchSelectDate").on('apply.daterangepicker', function(ev, picker) {
                        $("#searchBgngDt").val(picker.startDate.format('YYYY-MM-DD'));
                        $("#searchEndDt").val(picker.endDate.format('YYYY-MM-DD'));
                        $(this).val(picker.startDate.format('YYYY-MM-DD') + ' - ' + picker.endDate.format('YYYY-MM-DD'));
                    });

                  }
              , onSearch :
            	  function() {

                      mdlRptMngGridHelper1.resetListContent();
            	  }
              , setGrid :
                  function() {

            	      $("#mdlRptMngGrid").jsGrid({
            	    	  height: "auto"
            	    	 , width: "100%"
                         , autoload: true
                         , sorting: false
                         , paging: true
                         , pagerContainer: "#mdlRptMngPager"
                         , pagerFormat: "{first} {prev} {pages} {next} {last}"
                         , pagePrevText: "이전"
                         , pageNextText: "다음"
                         , pageFirstText: "< 처음 ㅣ"
                         , pageLastText: "ㅣ 마지막 >"
                         , noDataContent: "데이터가 없습니다."
                         , pageSize: 10
                         , pageButtonCount: 10
                         , pageLoading: true
                         , pageIndex: 1
                         , controller: {
                               loadData: function(filter) {
                            	   var data = $.Deferred();
                                   var formData = $('#searchFrm').serializeArray();
                                   var params = [
                                	   {name:"pageNumber", value:filter.pageIndex}
                                     , {name:"rowPerPage", value:filter.pageSize}
                                     , {name:"orderField", value:"REG_DT"}
                                     , {name:"orderDirection", value:"desc"} ]
                                   formData = formData.concat(params);

                                   $.ajax({
                                     type: "GET"
                                   , contentType: "application/json; charset=utf-8"
                                   , url      : mdlRptMng.listUrl
                                   , data     : formData
                                   , dataType : "json"
                                   }).done(function(response) {
                                       var da = {
                                           data       : escapeGridData(response.list)
                                         , itemsCount : response.totalCount
                                       };
                                       data.resolve(da);
                                   });
                                   return data.promise();
                               }
                           },
                           fields: [
                                {name: "pcntstid"          , css: 'hide'}
                              , {title: "No."              , name: "rowNumber"      , type: "number", width: "80"     , align: "center", sorting: false}
                              , {title: "사업분야"         , name: "fldCdNm"        , type: "text"  , align: "left"   , width: "100"}
                              , {title: "공모명"           , name: "pcntstNm"       , type: "text"  , align: "left"   , width: "200"}
                              , {title: "진행상태"         , name: "prgrsSttsCdNm"  , type: "text"  , align: "center" , width: "80" }
                              , {title: "중간보고제출기간" , name: "mdlReportPrd"   , type: "text"  , align: "center" , width: "200"}
                              , {title: "선정사업"         , name: "slctnBizCnt"    , type: "text"  , align: "center" , width: "80" }
                              , {title: "제출"             , name: "sbmsnCnt"       , type: "text"  , align: "center" , width: "80" }
                              , {title: "컨설팅 대상"      , name: "acnt"           , type: "text"  , align: "center" , width: "80" }
                           ]
                           , rowClick: function(args) {
                               if(args.event.originalEvent.target.cellIndex == 0 || isNaN(args.event.originalEvent.target.cellIndex)) return;

                               if(args.event.originalEvent.target.cellIndex == 3 ){

                                   var detailUrl = mdlRptMng.dtlUrl + "?pcntstid=" +args.item.pcntstid;
//                                    location.href= detailUrl;
                                   mdlRptMngGridHelper1.loadContent(detailUrl);
                                   mdlRptMngGridHelper1.rowClick(args);
                               }
                           }
                           , resetGrid: function() {
                               mdlRptMng.resetListContent();
                           }
            	      });
                  }
              , downGridExcel :
            	   function () {
            	       var f = document.searchFrm;
            	       f.action = mdlRptMng.excelUrl;
            	       f.submit();
				   }
        }

        $(function() {
            mdlRptMng.init();
        });
        </script>
    </div>
</body>
</html>