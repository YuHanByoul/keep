<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
    xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
    layout:decorator="layout/mng/mainLayout">

<body>
    <div layout:fragment="content">
    <style>
        .hide
        {
           display:none;
        }
        </style>
        <!-- Date-range picker css  -->
        <link rel="stylesheet" type="text/css" href="/files/bower_components/bootstrap-daterangepicker/daterangepicker.css">
        <div class="page-body">
            <div class="row">
                <div class="col-12">

                    <form name="searchFrm" id="searchFrm" action="" onsubmit="return false;" class="card">
                        <div class="card-block-small">
                            <div class="row">
                                <div class="col-lg-3 col-md-6 mb-3">
                                    <div class="mb-0 form-group row">
                                        <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>사업분야</strong></div>
                                        <div class="col-12">
                                            <th:block kattr:select_code="searchFldCd" grpCd="173" upprCd="0" selectedCd="" onchange="" firstOptTxt="- 전체 -" addClass="form-select form-select-sm form-control-sm" isAdmin="true"></th:block>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6 mb-3">
                                    <div class="mb-0 form-group row">
                                        <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>키워드</strong></div>
                                        <div class="input-group input-group-sm input-group-dropdown mb-0">
                                            <select id="searchType" name="searchType" class="form-select form-control">
                                                <option value="prgrmNm">프로그램명</option>
                                                <option value="pcntstNm">공모명</option>
                                                <option value="instNm">기관명</option>
                                            </select>
                                            <input type="text" class="form-control" aria-label="Text input with dropdown button" id="searchKeyword" name="searchKeyword" />
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6 mb-3">
                                    <div class="mb-0 form-group row">
                                        <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>상태</strong></div>
                                        <div class="col-12">
                                            <th:block kattr:select_code="searchSttsCd" grpCd="220" upprCd="0" selectedCd="" onchange="" firstOptTxt="- 전체 -" addClass="form-select form-select-sm form-control-sm" isAdmin="true" ></th:block>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-1 p-t-20 text-center border-top">
                                <button type="button" class="btn btn-disabled m-r-5" onclick="bizAbndMng.initSearch();">초기화</button>
                                <button type="submit" class="btn btn-primary" onclick="bizAbndMng.onSearch();">검색</button>
                            </div>
                        </div>
                    </form>
                </div>

                <!--임시그리드-->
                <div class="col-12">
                    <div class="card">
                        <div class="row p-20 p-b-0">
                            <div class="col-12 col-md mb-2 mb-md-0">
                                <h5><strong>사업포기관리 검색결과</strong></h5>
                            </div>
                            <div class="col-12 col-md-auto text-right">
                                <button type="button" class="btn btn-primary" onclick="openExcelDownRsnPopup('dwnldDsctnPopup', 'searchFrm', bizAbndMng.excelUrl);">엑셀다운로드</button>
                            </div>
                        </div>
                        <div class="card-block-small">
                            <table id="bizAbndMngGrid" class="table-responsive"></table>
                            <div id="bizAbndMngPager" class="text-center"></div>
                        </div>
                    </div>
                </div>
                <!-- 상세 -->
                <div class="col-12">
                    <div id="contentPanel" class="card" style="display: none;"></div>
                </div>
                <!-- 상세 -->
            </div>
        </div>
        <div class="modal fade" id="dwnldDsctnPopup" aria-hidden="true" data-bs-backdrop="static"></div>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
        <script type="text/javascript" src="/files/bower_components/bootstrap-daterangepicker/daterangepicker.js"></script>
        <script th:inline="javascript">
            var bizAbndMngGridHelper;

            var bizAbndMng = {
                listUrl  : "/mng/bizAply/bizRpt/selectBizAbndMngList.do",
                excelUrl : "/mng/bizAply/bizRpt/selectBizAbndMngExcelList.do",
                dtlUrl : "/mng/bizAply/bizRpt/bizAbndMngDetailForm.html",

                init : function() {
                    bizAbndMngGridHelper = new GridHelper('bizAbndMngGrid','contentPanel');
                    this.initSearch();
                    this.setGrid();
                },

                initSearch : function() {
                    $("#searchFldCd, #searchKeyword, #searchPrgrsSttsCd ,#searchSttsCd").val('');
                },

                setGrid : function() {
                    $("#bizAbndMngGrid").jsGrid({
                        height: "auto"
                       , width: "100%"
                       , autoload: true
                       , sorting: false
                       , paging: true
                       , pagerContainer: "#bizAbndMngPager"
                       , pagerFormat: "{first} {prev} {pages} {next} {last}"
                       , pagePrevText: "이전"
                       , pageNextText: "다음"
                       , pageFirstText: "< 처음 ㅣ"
                       , pageLastText: "ㅣ 마지막 >"
                       , noDataContent: "데이터가 없습니다."
                       , pageSize: 10
                       , pageButtonCount: 10
                       , pageLoading: true
                       , pageIndex: 1
                       , controller: {
                             loadData: function(filter) {
                                 var data = $.Deferred();
                                 var formData = $('#searchFrm').serializeArray();
                                 var params = [
                                     {name:"pageNumber", value:filter.pageIndex}
                                   , {name:"rowPerPage", value:filter.pageSize}
                                   , {name:"orderField", value:"REG_DT"}
                                   , {name:"orderDirection", value:"desc"} ]
                                 formData = formData.concat(params);

                                 $.ajax({
                                   type: "GET"
                                 , contentType: "application/json; charset=utf-8"
                                 , url      : bizAbndMng.listUrl
                                 , data     : formData
                                 , dataType : "json"
                                 }).done(function(response) {
                                     var da = {
                                         data       : escapeGridData(response.list)
                                       , itemsCount : response.totalCount
                                     };
                                     data.resolve(da);
                                 });
                                 return data.promise();
                             }
                         },
                         fields: [
                              {name: "aplyid"       , css: 'hide'}
                            , {name: "dmndid"       , css: 'hide'}
                            , {title: "No."         , name: "rowNumber"    , type: "number", width: "80"     , align: "center", sorting: false}
                            , {title: "사업분야"    , name: "fldCdNm"      , type: "number", align: "left"   , width: "100"}
                            , {title: "공모명"      , name: "pcntstNm"     , type: "text"  , align: "left"   , width: "200"}
                            , {title: "프로그램명"  , name: "prgrmNm"      , type: "text"  , align: "left"   , width: "200"}
                            , {title: "상태"        , name: "dmndSttsCdNm" , type: "text"  , align: "center" , width: "80"}
                            , {title: "신청일"      , name: "cnclDt"       , type: "text"  , align: "center" , width: "80"}
                            , {title: "기관명"      , name: "instNm"       , type: "text"  , align: "left"   , width: "100" }
                            , {title: "사용자"      , name: "userNmAcnt"   , type: "text"  , align: "left"   , width: "100" }
                         ]
                         , rowClick: function(args) {

                             if(args.event.originalEvent.target.cellIndex == 0 || isNaN(args.event.originalEvent.target.cellIndex)) return;

                                 var detailUrl = bizAbndMng.dtlUrl + "?aplyid=" +args.item.aplyid+"&dmndid="+args.item.dmndid;

                                 bizAbndMngGridHelper.loadContent(detailUrl);
                                 bizAbndMngGridHelper.rowClick(args);
                             if(args.event.originalEvent.target.cellIndex == 4 ){
                             }
                         }
                         , resetGrid: function() {
                             bizAbndMng.resetListContent();
                         }
                    });
                },

                onSearch : function() {
                    bizAbndMngGridHelper.resetListContent();
                },

                downGridExcel : function() {
                	var f = document.searchFrm;
                    f.action = bizAbndMng.excelUrl;
                    f.submit();
                }
            }

            $(function() {
                bizAbndMng.init();
            });
        </script>
    </div>
</body>
</html>