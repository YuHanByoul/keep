<form id="insertForm">
    <input type="hidden" name="pcntstid" id="pcntstid" th:value="${reqUserVo.pcntstid}" />
    <input type="hidden" name="aplyid" id="aplyid" th:value="${reqUserVo.aplyid}" />
    <input type="hidden" name="instid" id="instid" th:value="${reqUserVo.instid}" />
    <input type="hidden" name="fldCd" id="fldCd" th:value="${fldCd}" />
    <!-- [탭] 신청정보 -->
    <div class="tab-pane active" id="tab_01" role="tabpanel">
        <!-- 신청정보 -->
        <div class="card">
            <div class="card-header p-b-0">
                <h3 class="sub-title"><strong>신청정보</strong></h3>
            </div>
            <div class="card-block-small p-t-0">
                <div class="row">
                    <div class="col-12 col-md-6 col-lg-3 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>접수번호</strong></label>
                            <div class="col-sm-12">
                                <input type="text" class="form-control form-control-sm" name="" id="" th:value="${reqUserVo.aplyno}" readonly>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-6 col-lg-3 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>기관명</strong></label>
                            <div class="col-sm-12">
                                <input type="text" class="form-control form-control-sm" name="" id="" th:value="${reqUserVo.instNm}" readonly>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>프로그램명</strong></label>
                            <div class="col-12">
                                <input type="text" class="form-control form-control-sm" name="prgrmNm" id="prgrmNm" th:value="${reqUserVo.prgrmNm}" maxlength="100">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-md-6 col-lg-3 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>대표자명</strong></label>
                            <div class="col-sm-12">
                                <input type="text" class="form-control form-control-sm" name="" id="" th:value="${reqUserVo.rprsvNm}" readonly>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-6 col-lg-3 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>기관 연락처</strong></label>
                            <div class="col-sm-12">
                                <input type="text" class="form-control form-control-sm" name="" id="" th:value="${reqUserVo.aplyInstTelno}" readonly>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group required">
                            <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>기관유형</strong></div>
                            <div class="row">
                                <div class="col-6">
                                    <select id="instTypeCd" name="instTypeCd" class="form-select form-select-sm form-control-sm">
		                                <option value="">- 전체 -</option>
		                                <option th:value="${item.CD}" th:each="item:${typeCdList}" th:selected="${item.CD == reqUserVo.instTypeCd}"><th:block th:text="${item.CD_NM}"/></option>
		                            </select>
<!--                                     <span kattr:select_code="instTypeCd" grpCd="108" th:attr="selectedCd=${reqUserVo.instTypeCd}" firstOptTxt="- 선택 -" addClass="input-sm" isAdmin="true"> -->
                                </div>
                                <div class="col-6">
                                    <input type="text" class="form-control form-control-sm" name="etcCn" id="etcCn" placeholder="기타 선택 시 입력" th:value="${reqUserVo.etcCn}" readonly="">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-md-6 col-lg-3 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>기관 이메일</strong></label>
                            <div class="col-sm-12">
                                <input type="text" class="form-control form-control-sm" name="" id="" placeholder="" th:value="${reqUserVo.pcntstid}" readonly>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-6 col-lg-3 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>기관 홈페이지</strong></label>
                            <div class="col-sm-12">
                                <input type="text" class="form-control form-control-sm" name="" id="" placeholder="" th:value="${reqUserVo.hmpg}" readonly>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group">
                            <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>사업자등록번호 / 등록일</strong></div>
                            <div class="row">
                                <div class="col-6">
                                    <input type="text" class="form-control form-control-sm" name="" id="" aria-label="사업자등록번호" th:value="${reqUserVo.regNo}" readonly>
                                </div>
                                <div class="col-6">
                                    <input type="date" class="form-control form-control-sm" name="regDe" id="regDe" aria-label="등록일" th:value="${reqUserVo.regDe}">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-md-6 col-lg-3 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>신청자</strong></label>
                            <div class="row">
                                <div class="col">
                                    <input type="text" class="form-control form-control-sm" name="userNm" id="userNm" th:value="${reqUserVo.userNm}" readonly>
                                </div>
                                <div class="col-auto ps-0">
                                    <input type="hidden" name="userid" id="userid" th:value="${reqUserVo.userid}" />
                                    <input type="hidden" name="aplcntNm" id="aplcntNm" th:value="${reqUserVo.aplcntNm}" />
                                    <button type="button" class="btn btn-inverse btn-sm" onclick="openChgAltmntModal();">담당자 변경</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-6 col-lg-3 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>신청자 연락처</strong></label>
                            <div class="col-sm-12">
                                <input type="text" class="form-control form-control-sm" name="aplcntTelno" id="aplcntTelno" th:value="${reqUserVo.aplcntTelno}" readonly>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-6 col-lg-3 mb-3">
                        <div class="mb-0 form-group">
                            <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>신청자 이메일</strong></div>
                            <div class="col-12">
                                <input type="text" class="form-control form-control-sm" name="aplcntEml" id="aplcntEml" th:value="${reqUserVo.aplcntEml}" readonly>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-md-6 col-lg-3 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>권역</strong></label>
                            <div class="col-sm-12">
                                <span kattr:select_code="instSareaCd" grpCd="195" th:attr="selectedCd=${reqUserVo.instSareaCd}" firstOptTxt="- 선택 -" addClass="input-sm" isAdmin="true">
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-6 col-lg-3 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>지역</strong></label>
                            <div class="col-sm-12">
                                <select title="지역" name="rgnCd" id="rgnCd" class="form-select form-select-sm form-control-sm">
                                    <option value="">- 선택 -</option>
                                    <option th:each="list, i: ${sidoList}" th:value="${list.CTPRVN_CD}" th:text="${list.CTPRVN_NM}" th:selected="${reqUserVo.rgnCd == list.CTPRVN_CD}"></option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div th:if="${fldCd == '173102'}" class="col-12 col-md-6 col-lg-3 mb-3">
                        <div class="mb-0 form-group">
                            <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>종단</strong></div>
                            <div class="col-12">
                                <span kattr:select_code="relgnCd" grpCd="194" th:attr="selectedCd=${reqUserVo.relgnCd}" firstOptTxt="- 선택 -" addClass="input-sm" isAdmin="true">
                            </div>
                        </div>
                    </div>                        
                </div>
                <div class="row">
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>기관주소</strong></label>
                            <div class="col-sm-12">
                                <input type="text" class="form-control form-control-sm" name="" id="" th:value="${reqUserVo.addr}" readonly>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>상세주소</strong></label>
                            <div class="col-sm-12">
                                <input type="text" class="form-control form-control-sm" name="" id="" th:value="${reqUserVo.instAddrDtl}" readonly>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group mb-3">
                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>증빙서류 1(지정신청서, 개인정보 수집이용 동의서, 사업자등록증)</strong></label>
                    <div class="col-sm-12">
                        <input id="multiFileInput1" type="file" name="files" multipleaccept="image/jpeg,image/gif,image/png,application/pdf" class="form-control form-control-sm" />
                        <input type="hidden" id="filegrpid1" name="filegrpid1" th:value="${(reqUserVo.filegrpid1 == '' or reqUserVo.filegrpid1 == null) ? 0 : reqUserVo.filegrpid1}"/>
                    </div>
                    <div class="mt-2 row">
                        <div class="col-auto">
                            <th:block th:if="${fileList1 != null}">
                                <div class="row">
                                    <th:block th:if="${fileList1 != null}">
                                        <div th:each="item : ${fileList1}" th:id="${item.fileid}"
                                            class="col-auto">
                                            <th:block th:if="${item.orginlFileNm != null}">
                                                <span th:fileid='${item.fileid}'
                                                    th:fileIdntfcKey="${item.fileIdntfcKey}"
                                                    th:onclick="downloadFileByFileid(this.getAttribute('fileid'),this.getAttribute('fileIdntfcKey'))"
                                                    href="javascript:void(0)" class='label label-inverse'>
                                                    <th:block th:text="${item.orginlFileNm}" /> <a
                                                    th:name="${item.fileid}"
                                                    th:attr="data-idntfc-key=${item.fileIdntfcKey}"
                                                    th:onclick="fn_deleteFileList(this.name, this.dataset.idntfcKey)"
                                                    class='text-white'> <th:block th:text="X"></th:block></a>
                                                </span>
                                            </th:block>
                                        </div>
                                    </th:block>
                                </div>
                            </th:block>
                            <div id="multipleFileUploadError1"></div>
                            <div id="multipleFileUploadSuccess1"></div>
                        </div>
                    </div>
                </div>
                <div class="form-group mb-3">
                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>증빙서류 2(운영계획서 및 증빙서류)</strong></label>
                    <div class="col-sm-12">
                        <input id="multiFileInput2" type="file" name="files" multipleaccept="image/jpeg,image/gif,image/png,application/pdf" class="form-control form-control-sm" />
                        <input type="hidden" id="filegrpid2" name="filegrpid2" th:value="${(reqUserVo.filegrpid2 == '' or reqUserVo.filegrpid2 == null) ? 0 : reqUserVo.filegrpid2}"/>
                    </div>
                    <div class="mt-2 row">
                        <div class="col-auto">
                            <th:block th:if="${fileList2 != null}">
                                <div class="row">
                                    <th:block th:if="${fileList2 != null}">
                                        <div th:each="item : ${fileList2}" th:id="${item.fileid}"
                                            class="col-auto">
                                            <th:block th:if="${item.orginlFileNm != null}">
                                                <span th:fileid='${item.fileid}'
                                                    th:fileIdntfcKey="${item.fileIdntfcKey}"
                                                    th:onclick="downloadFileByFileid(this.getAttribute('fileid'),this.getAttribute('fileIdntfcKey'))"
                                                    href="javascript:void(0)" class='label label-inverse'>
                                                    <th:block th:text="${item.orginlFileNm}" /> <a
                                                    th:name="${item.fileid}"
                                                    th:attr="data-idntfc-key=${item.fileIdntfcKey}"
                                                    th:onclick="fn_deleteFileList(this.name, this.dataset.idntfcKey)"
                                                    class='text-white'> <th:block th:text="X"></th:block></a>
                                                </span>
                                            </th:block>
                                        </div>
                                    </th:block>
                                </div>
                            </th:block>
                            <div id="multipleFileUploadError2"></div>
                            <div id="multipleFileUploadSuccess2"></div>
                        </div>
                    </div>
                </div>
                <div class="form-group mb-3">
                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>증빙서류 3(관인파일)</strong></label>
                    <div class="col-sm-12">
                        <input id="multiFileInput3" type="file" name="files" multipleaccept="image/jpeg,image/gif,image/png,application/pdf" class="form-control form-control-sm" />
                        <input type="hidden" id="filegrpid3" name="filegrpid3" th:value="${(reqUserVo.filegrpid3 == '' or reqUserVo.filegrpid3 == null) ? 0 : reqUserVo.filegrpid3}"/>
                    </div>
                    <div class="mt-2">
                        <div class="col-auto">
                            <th:block th:if="${fileList3 != null}">
                                <div class="row">
                                    <th:block th:if="${fileList3 != null}">
                                        <div th:each="item : ${fileList3}" th:id="${item.fileid}"
                                            class="col-auto">
                                            <th:block th:if="${item.orginlFileNm != null}">
                                                <span th:fileid='${item.fileid}'
                                                    th:fileIdntfcKey="${item.fileIdntfcKey}"
                                                    th:onclick="downloadFileByFileid(this.getAttribute('fileid'),this.getAttribute('fileIdntfcKey'))"
                                                    href="javascript:void(0)" class='label label-inverse'>
                                                    <th:block th:text="${item.orginlFileNm}" /> <a
                                                    th:name="${item.fileid}"
                                                    th:attr="data-idntfc-key=${item.fileIdntfcKey}"
                                                    th:onclick="fn_deleteFileList(this.name, this.dataset.idntfcKey)"
                                                    class='text-white'> <th:block th:text="X"></th:block></a>
                                                </span>
                                            </th:block>
                                        </div>
                                    </th:block>
                                </div>
                            </th:block>
                            <div id="multipleFileUploadError3"></div>
                            <div id="multipleFileUploadSuccess3"></div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-md-6 col-lg-3 mb-3">
                        <div class="mb-0 form-group">
                            <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>진행상태</strong></div>
                            <div class="col-sm-12">
                                <span kattr:select_code="aplySttsCd" grpCd="192" th:attr="selectedCd=${reqUserVo.aplySttsCd}" firstOptTxt="- 선택 -" addClass="input-sm" isAdmin="true" disabled></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-block-small">
                <button class="btn btn-disabled m-r-5" onclick="gridHelper3.toggleContent(); return false;">취소</button>
                <button class="btn btn-primary" onclick="fn_save(); return false;">저장</button>
            </div>
        </div>

        <!-- 보완요청 -->
        <div class="card" th:if="${popupYn != 'Y'}">
            <div class="row p-20 p-b-0">
                <div class="col-12 col-md-8 mb-2 mb-md-0">
                    <h5><strong>보완요청</strong></h5>
                </div>
                <div class="col-12 col-md-4 text-right">
                    <button type="button" class="btn btn-primary" onclick="openSuppModal('201101', 0);">보완요청</button>
                </div>
            </div>
            <div class="card-block-small">
                <div class="dt-responsive table-responsive">
                    <div id="order-table_wrapper" class="dataTables_wrapper dt-bootstrap4">
                        <table id="suppJsGrid" class="table-responsive"></table>
                        <div id="suppListPager" class="text-center"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- // -->
        <div class="col-12">
            <div id="suppContentPanel" class=""></div>
        </div>
    </div>
</form>
<form name="suppSearchFrm" id="suppSearchFrm" action="" onsubmit="return false;">
    <input type="hidden" name="aplyid" id="aplyidSupp" th:value="${reqUserVo.aplyid}" />
</form>

<!-- 담당자변경 회원검색 팝업 -->
<div class="modal fade" id="chgAltmntPopup" aria-hidden="true" data-bs-backdrop="static"></div>

<!--보완요청 팝업-->
<div class="modal fade" id="suppPopup" aria-hidden="true" data-bs-backdrop="static"></div>

<script th:inline="javascript">    
	/*<![CDATA[*/
	var popupYn = /*[[${popupYn}]]*/null;
	var aplyid = /*[[${reqUserVo.aplyid}]]*/null;
	/*]]>*/
    var gridHelper2;
    var listUrl = "/mng/bizAply/req/selectSuppList.do";
    var updateUrl = "/mng/bizAply/req/updateReqInfo.do";
    var atchfileCnt = 5;
    var uploadFileCnt = 0;

    $(function(){
    	if (popupYn == "Y") {
            $("input, select, textarea").prop("disabled", true);
            $("button").hide();
        }
    	gridHelper2 = new GridHelper('suppJsGrid','suppContentPanel');
        var validator = $("#insertForm").validate({
            rules: {
            	prgrmNm : { maxlength: 100 }
            	, regDe    : { required: true }
            },
            messages: {
            	prgrmNm : { maxlength: "프로그램명은 100자를 넘을 수 없습니다." }
                , regDe    :   { required: "등록일을 선택해주십시오." }  
            }
        });
        
        if ($("#instTypeCd").val() == "108105") {
        	$("#etcCn").prop("readonly", false);
        }
        
        $("#suppJsGrid").jsGrid({
            height: "auto",
            width: "100%",
            autoload: true,
            sorting: false,
            paging: true,
            pagerContainer: "#suppListPager",
            pagerFormat: "{first} {prev} {pages} {next} {last}",
            pagePrevText: "이전",
            pageNextText: "다음",
            pageFirstText: "< 처음ㅣ",
            pageLastText: "ㅣ 마지막 >",
            pageSize: 10,
            pageButtonCount: 10,
            pageLoading: true,
            pageIndex: 1,
            noDataContent: "데이터가 없습니다.",
            
            controller: {
                loadData: function (filter) {
                    var data = $.Deferred();
                    var formData = $('#suppSearchFrm').serializeArray();
                    var params = [
                        {name: "pageNumber", value: filter.pageIndex},
                        {name: "rowPerPage", value: filter.pageSize},
                    ]

                    if(filter.sortField != undefined) {
                        params.push({name: "orderField", value: filter.sortField});
                        params.push({name: "orderDirection", value: filter.sortOrder});
                    } else {
                        params.push({name: "orderField", value: 'reg_dt'});

                    }
                    formData = formData.concat(params);
                    
                    $.ajax({
                        type: "GET",
                        contentType: "application/json; charset=utf-8",
                        url: listUrl,
                        dataType: "json",
                        data: formData
                    }).done(function(response){
                        var da = {
                            data : escapeGridData(response.list)
                            , itemsCount : response.totalCount
                        };
                        data.resolve(da);
                    });
                    
                    return data.promise();
                }
            },
            fields: [ 
                { name : 'splmntid', css : 'hide' }
                , { title: 'No.'      ,name: 'rowNumber' ,type: "number", width: "80" , align:"center", sorting :false }
                , { title: '상태' ,name: 'ansSttsNm'     ,type: "text"  , width: "100" , align:"center"}
                , { title: '요청내용' ,name: 'dmndCn'     ,type: "text"  , width: "350" , align:"left"}
                , { title: '요청일'   ,name: 'dmndDt'        ,type: "text"  , width: "100", align:"center"}
                , { title: '완료처리일'   ,name: 'ansDt'   ,type: "text"  , width: "100" , align:"center"}
            ],
            /*[# sec:authorize-url="/mng/bizAply/req/insertSplmnt.do"]*/
            rowClick: function (args) {
                if(args.event.originalEvent.target.cellIndex == 0 || isNaN(args.event.originalEvent.target.cellIndex)) return;
                openSuppModal('201102', args.item.splmntid);
            },
            /*[/]*/
        });
    });
    
    $("#instTypeCd").on("change", function(event){
    	if ($(this).val() == "108105") {
	    	$("#etcCn").prop("readonly", false);
    	} else {
    		$("#etcCn").prop("readonly", true);
    		$("#etcCn").val("");
    	}
    });

    // 파일업로드
    $('#multiFileInput1, #multiFileInput2, #multiFileInput3').on("change", function(event) {
        var fileOjbId = $(this).prop("id");
        var objFile = document.querySelector('#'+fileOjbId);
        var formData = new FormData();
        var content = "";

        for( i = 0 ; i < objFile.files.length ; i++) {
            if(uploadFileCnt >= atchfileCnt){
                alert("첨부파일은  "+atchfileCnt+ " 개 까지 가능합니다." ); break;
            } else {
                formData.append("files", objFile.files[i]);
                uploadFileCnt++;
            }
        }

        var regex = /[^0-9]/g;
        var fileNum = fileOjbId.replace(regex, "");
        
        formData.append("filegrpid", $("#filegrpid"+fileNum).val());
        formData.append("filegrpNm", "aply_file_"+fileNum);

        if(uploadFileCnt > 0){
            $.ajax({
                url : '/uploadMultipleFiles.do',
                processData : false,
                contentType : false,
                data : formData,
                type : 'POST',
                success : function(response) {
                    if(response.result == 'fail'){
                        alert(response.msg);
                    }else{
                        if($("#filegrpid"+fileNum).val()=='0' || $("#filegrpid"+fileNum).val()==''  || $("#filegrpid"+fileNum).val()==null){
                            $("#filegrpid"+fileNum).val( response[0].filegrpid );
                        }

                        for(i = 0 ;i < response.length; i++ ){
                            content =  "<span id='"+response[i].fileid+"' class='label label-inverse' href=javascript:downloadFileByFileid('"+response[i].fileid+"','"+response[i].fileIdntfcKey+"')>"+response[i].orginlFileNm
                            content += "&nbsp;&nbsp;<a href='javascript:void(0)' onclick =uploadFileCnt--;fn_deleteFileList('"+response[i].fileid+"','"+response[i].fileIdntfcKey+"') class='text-white'>X</a></span>"
                            $('#multipleFileUploadSuccess'+fileNum).append(content);
                        }
                    }
                }
            });
        }
    });

    // 파일삭제
    function fn_deleteFileList(fileid, fileIdntfcKey){
        if(!confirm("파일을 삭제하시겠습니까?")){return;}
        fn_deleteFile(fileid, fileIdntfcKey);
        $("#"+fileid).remove();
//            $("#sftyMngMnlFile").val("");
    }

    // 파일삭제
    function fn_deleteFile(fileid, fileIdntfcKey){
        var deleteFileUrl="/deleteFile.do?fileid="+fileid+"&file_idntfc_key=" + fileIdntfcKey;
          $.ajax({
            url : deleteFileUrl,
            type: 'GET',
            cache : false,
            dataType: 'json',
            success : function (data){
                console.log(data);
                if(data.result=="success"){
                    $("#"+fileid).remove();
                    alert("파일삭제가 완료 되었습니다.");
                }else{
                    alert("파일삭제중 에러가 발생하였습니다. 관리자에게 문의 부탁드립니다.");
                }
            },
            error : function (error){
            }
         })
    };
    
    //담당자 변경 팝업
    var chgAltmntModal;
    var openChgAltmntModal = () => {
        var url = "/mng/bizAply/req/userSrchPopup.html?instid="+$("#instid").val();    //회원검색

        $("#chgAltmntPopup").load(url, function(response, status, xhr) {
            if (status == "success") {
                chgAltmntModal = new bootstrap.Modal($('#chgAltmntPopup'));
                chgAltmntModal.show();
            }
        });

    }
    
    //보완요청 팝업
    var suppModal;
    var openSuppModal = (sttsCd, splmntid) => {
    	var url = "/mng/bizAply/req/suppPopup.html?splmntid=" + splmntid + "&aplyid="+aplyid + '&ansSttsCd=' + sttsCd;
        $("#suppPopup").load(url, function(response, status, xhr) {
            if (status == "success") {
            	suppModal = new bootstrap.Modal($('#suppPopup'));
            	suppModal.show();
            }
        });
    }
    
    // 저장
    function fn_save(){
        if(!($("#insertForm").valid())) return;
        
        if(!confirm("저장하시겠습니까?")) return;
        
        var data =  $("#insertForm").serialize();
        
        if(displayWorkProgress()){
            $.ajax({
                url : updateUrl,
                type: 'POST',
                cache : false,
                dataType: 'json',
                data : data,
                success : function (data){
                    if(data.result=="success"){
                        alert(data.msg);
//                         var uri = "/mng/bizAply/req/detailReqUserInfoTabForm.html?aplyid=" + $("#aplyid").val() + '&pcntstid=' + $("#pcntstid").val();
                        gridHelper2.resetListContent();
                    }else{
                        alert(data.msg);
                    }
                    closeWorkProgress();
                }
            });
        }
    }

</script>