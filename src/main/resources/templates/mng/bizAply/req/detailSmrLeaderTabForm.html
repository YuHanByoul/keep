<form id="insertForm">
    <input type="hidden" name="aplyid" id="aplyid" th:value="${detail.aplyid}" />
    <!-- [탭] 전문강사 확보 -->
    <div class="tab-pane" id="tab_05" role="tabpanel">
        <div class="card">
            <!-- 전문인력 보유현황 및 운영계획 -->
            <div class="card-header p-b-0">
                <h3 class="sub-title"><strong>전문인력 보유현황 및 운영계획</strong></h3>
            </div>
            <div class="card-block-small p-t-0">
                <div class="col-12 table-responsive">
                    <table class="table table-framed">
                        <thead>
                        <tr>
                            <th class="text-center">구분</th>
                            <th class="text-center">성명</th>
                            <th class="text-center">업무내용</th>
                            <th class="text-center" style="width:121px;">설정</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:if="${#lists.size(jobList) > 0}" th:each="list, i: ${jobList}">
                            <td class="v-middle text-center">
                                <input type="text" class="form-control form-control-sm" name="se" id="se" th:value="${list.se}" maxlength="50">
                            </td>
                            <td class="v-middle text-center">
                                <input type="text" class="form-control form-control-sm" name="ldrnm" id="ldrnm" th:value="${list.nm}" maxlength="50">
                            </td>
                            <td class="v-middle text-center">
                                <input type="text" class="form-control form-control-sm" name="taskCn" id="taskCn" th:value="${list.taskCn}" maxlength="100">
                            </td>
                            <td class="v-middle">
                                <button onclick="addRow(this);" type="button" class="btn btn-primary btn-sm" th:if="${i.last}">추가</button>
                                <button onclick="removeRow(this);" type="button" class="btn btn-inverse btn-sm">삭제</button>
                            </td>
                        </tr>
                        <tr th:unless="${#lists.size(jobList) > 0}">
                            <td class="v-middle text-center">
                                <input type="text" class="form-control form-control-sm" name="se" id="se"  maxlength="50">
                            </td>
                            <td class="v-middle text-center">
                                <input type="text" class="form-control form-control-sm" name="ldrnm" id="ldrnm" maxlength="50">
                            </td>
                            <td class="v-middle text-center">
                                <input type="text" class="form-control form-control-sm" name="taskCn" id="taskCn" maxlength="100">
                            </td>
                            <td class="v-middle">
                                <button onclick="addRow(this);" type="button" class="btn btn-primary btn-sm">추가</button>
                                <button onclick="removeRow(this);" type="button" class="btn btn-inverse btn-sm">삭제</button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 지도자 관리방안 -->
            <div class="card-header p-t-0 p-b-0">
                <h3 class="sub-title"><strong>지도자 관리방안</strong></h3>
            </div>
            <div class="card-block-small p-t-0">
                <div class="row">
                    <div class="col-12 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>지도자 관리방안</strong></label>
                            <div class="col-sm-12">
                                <input type="text" class="form-control form-control-sm" maxlength="200" id="ldrMngMthd" name="ldrMngMthd" placeholder="" th:value="${detail.ldrMngMthd}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 총괄 운영 담당자 지도자 자격 -->
            <div class="card-header p-t-0 p-b-0">
                <h3 class="sub-title"><strong>총괄 운영 담당자 지도자 자격</strong></h3>
            </div>
            <div class="card-block-small p-t-0">
                <div class="row">
                    <div class="col-12 col-md-6 col-lg-3 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>성명</strong></label>
                            <div class="col-sm-12">
                                <input type="text" class="form-control form-control-sm" id="nm" name="nm" placeholder="" th:value="${detail.nm}" maxlength="50">
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-6 col-lg-3 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>생년월일</strong></label>
                            <div class="col-sm-12">
                                <input type="text" class="form-control form-control-sm" id="brdt" name="brdt" placeholder="" th:value="${detail.brdt}" maxlength="10">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 환경교육관련 학력사항 -->
            <div class="card-header p-t-0 p-b-0">
                <h3 class="sub-title"><strong>환경교육관련 학력사항</strong></h3>
            </div>
            <div class="card-block-small p-t-0">
                <div class="col-12 table-responsive">
                    <table class="table table-framed">
                        <thead>
                        <tr>
                            <th class="text-center">기간</th>
                            <th class="text-center">학교명</th>
                            <th class="text-center">전공</th>
                            <th class="text-center">학위</th>
                            <th class="text-center" style="width:121px;">설정</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:if="${#lists.size(acbgList) > 0}" th:each="list, i: ${acbgList}">
                            <td class="v-middle text-center">
                                <input type="text" class="form-control form-control-sm" name="eduDe" th:value="${list.eduDe}">
                            </td>
                            <td class="v-middle text-center">
                                <input type="text" class="form-control form-control-sm" name="schlNm" id="schlNm" th:value="${list.schlNm}" maxlength="50">
                            </td>
                            <td class="v-middle text-center">
                                <input type="text" class="form-control form-control-sm" name="mjr" id="mjr" th:value="${list.mjr}" maxlength="50">
                            </td>
                            <td class="v-middle text-center">
                                <input type="text" class="form-control form-control-sm" name="dgr" id="dgr" th:value="${list.dgr}" maxlength="50">
                            </td>
                            <td class="v-middle">
                                <button onclick="addRow(this);" type="button" id="table_2" class="btn btn-primary btn-sm" th:if="${i.last}">추가</button>
                                <button onclick="removeRow(this);" type="button" class="btn btn-inverse btn-sm">삭제</button>
                            </td>
                        </tr>
                        <tr th:unless="${#lists.size(acbgList) > 0}">
                            <td class="v-middle text-center">
                                <input type="text" class="form-control form-control-sm" name="eduDe">
                            </td>
                            <td class="v-middle text-center">
                                <input type="text" class="form-control form-control-sm" name="schlNm" id="schlNm" maxlength="50">
                            </td>
                            <td class="v-middle text-center">
                                <input type="text" class="form-control form-control-sm" name="mjr" id="mjr" maxlength="50">
                            </td>
                            <td class="v-middle text-center">
                                <input type="text" class="form-control form-control-sm" name="dgr" id="dgr" maxlength="50">
                            </td>
                            <td class="v-middle">
                                <button onclick="addRow(this);" type="button" id="table_2" class="btn btn-primary btn-sm">추가</button>
                                <button onclick="removeRow(this);" type="button" class="btn btn-inverse btn-sm">삭제</button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 환경교육관련 자격사항 -->
            <div class="card-header p-t-0 p-b-0">
                <h3 class="sub-title"><strong>환경교육관련 자격사항</strong></h3>
            </div>
            <div class="card-block-small p-t-0">
                <div class="col-12 table-responsive">
                    <table class="table table-framed">
                        <thead>
                        <tr>
                            <th class="text-center">자격/변호</th>
                            <th class="text-center">급수</th>
                            <th class="text-center">취득연월</th>
                            <th class="text-center">발령청</th>
                            <th class="text-center" style="width:121px;">설정</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:if="${#lists.size(licList) > 0}" th:each="list, i: ${licList}">
                            <td class="v-middle text-center">
                                <input type="text" class="form-control form-control-sm" name="qlfcNm" id="qlfcNm" th:value="${list.qlfcNm}" maxlength="100">
                            </td>
                            <td class="v-middle text-center">
                                <input type="text" class="form-control form-control-sm" name="grd" id="grd" th:value="${list.grd}" maxlength="50">
                            </td>
                            <td class="v-middle text-center">
                                <input type="date" class="form-control form-control-sm" name="acqsDe" id="acqsDe" th:value="${list.acqsDe}" maxlength="10">
                            </td>
                            <td class="v-middle text-center">
                                <input type="text" class="form-control form-control-sm" name="wrkplc" id="wrkplc" th:value="${list.wrkplc}" maxlength="50">
                            </td>
                            <td class="v-middle">
                                <button onclick="addRow(this);" type="button" class="btn btn-primary btn-sm" th:if="${i.last}">추가</button>
                                <button onclick="removeRow(this);" type="button" class="btn btn-inverse btn-sm">삭제</button>
                            </td>
                        </tr>
                        <tr th:unless="${#lists.size(licList) > 0}">
                            <td class="v-middle text-center">
                                <input type="text" class="form-control form-control-sm" name="qlfcNm" id="qlfcNm" maxlength="100">
                            </td>
                            <td class="v-middle text-center">
                                <input type="text" class="form-control form-control-sm" name="grd" id="grd" maxlength="50">
                            </td>
                            <td class="v-middle text-center">
                                <input type="date" class="form-control form-control-sm" name="acqsDe" id="acqsDe" maxlength="10">
                            </td>
                            <td class="v-middle text-center">
                                <input type="text" class="form-control form-control-sm" name="wrkplc" id="wrkplc" maxlength="50">
                            </td>
                            <td class="v-middle">
                                <button onclick="addRow(this);" type="button" class="btn btn-primary btn-sm">추가</button>
                                <button onclick="removeRow(this);" type="button" class="btn btn-inverse btn-sm">삭제</button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- 환경교육 경력사항 -->
            <div class="card-header p-t-0 p-b-0">
                <h3 class="sub-title"><strong>환경교육 경력사항</strong></h3>
            </div>
            <div class="card-block-small p-t-0">
                <div class="col-12 table-responsive">
                    <table class="table table-framed">
                        <thead>
                        <tr>
                            <th class="text-center">기간</th>
                            <th class="text-center">활동(기관)명</th>
                            <th class="text-center">활동유형</th>
                            <th class="text-center" style="width:121px;">설정</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:if="${#lists.size(carrList) > 0}" th:each="list, i: ${carrList}">
                            <td class="v-middle text-center">
                                <input type="text" class="form-control form-control-sm" name="prd" id="prd" th:value="${list.prd}" maxlength="100">
                            </td>
                            <td class="v-middle text-center">
                                <input type="text" class="form-control form-control-sm" name="actvtNm" id="actvtNm" th:value="${list.actvtNm}" maxlength="50">
                            </td>
                            <td class="v-middle text-center">
                                <input type="text" class="form-control form-control-sm" name="actvtType" id="actvtType" th:value="${list.actvtType}" maxlength="50">
                            </td>
                            <td class="v-middle">
                                <button onclick="addRow(this);" type="button" id="table_4" class="btn btn-primary btn-sm" th:if="${i.last}">추가</button>
                                <button onclick="removeRow(this);" type="button" class="btn btn-inverse btn-sm">삭제</button>
                            </td>
                        </tr>
                        <tr th:unless="${#lists.size(carrList) > 0}">
                            <td class="v-middle text-center">
                                <input type="text" class="form-control form-control-sm" name="prd" id="prd" maxlength="100">
                            </td>
                            <td class="v-middle text-center">
                                <input type="text" class="form-control form-control-sm" name="actvtNm" id="actvtNm" maxlength="50">
                            </td>
                            <td class="v-middle text-center">
                                <input type="text" class="form-control form-control-sm" name="actvtType" id="actvtType" maxlength="50">
                            </td>
                            <td class="v-middle">
                                <button onclick="addRow(this);" type="button" id="table_4" class="btn btn-primary btn-sm">추가</button>
                                <button onclick="removeRow(this);" type="button" class="btn btn-inverse btn-sm">삭제</button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- // -->
            <div class="card-block-small">
                <button class="btn btn-disabled m-r-5" onclick="gridHelper3.toggleContent(); return false;">취소</button>
                <button class="btn btn-primary" onclick="fn_save(); return false;">저장</button>
            </div>
        </div>
    </div>
</form>

<!-- Date-range picker css  -->
<link rel="stylesheet" type="text/css" href="/files/bower_components/bootstrap-daterangepicker/daterangepicker.css">

<!-- Date-range picker js -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script type="text/javascript" src="/files/bower_components/bootstrap-daterangepicker/daterangepicker.js"></script>
<script th:inline="javascript">    
	/*<![CDATA[*/
	var popupYn = /*[[${popupYn}]]*/null;
	/*]]>*/
//     var listUrl = "/mng/bizAply/req/selectSuppList.do";
    var updateUrl = "/mng/bizAply/req/updateSmrLeader.do";
    
    $(function(){
    	if (popupYn == "Y") {
            $("input, select, textarea").prop("disabled", true);
            $("button").hide();
        }
    	// 사업기간 설정 daterangepicker
        $("input[name='eduDe'],input[name='prd']").daterangepicker({
            autoUpdateInput: false,
            locale: {
                format: "YYYY-MM-DD",
            },
        });
        
        // 사업기간 설정시 사업 시작일과 종료일을 각각 저장해준다.
        $("input[name='eduDe'],input[name='prd']").on('apply.daterangepicker', function(ev, picker) {
//             $("#bsnsBgngDe").val(picker.startDate.format('YYYY-MM-DD'));
//             $("#bsnsEndDe").val(picker.endDate.format('YYYY-MM-DD'));
            $(this).val(picker.startDate.format('YYYY-MM-DD') + ' ~ ' + picker.endDate.format('YYYY-MM-DD'));
        });
        
        var validator = $("#insertForm").validate({
            rules: {
            	ldrMngMthd: { maxlength: 200 }
            },
            messages: {
            	ldrMngMthd: { maxlength: "지도자 관리방안은 200자를 넘을 수 없습니다." }
            }
        });
    });

    // 테이블 로우 추가
    function addRow(obj) {
        var tableId = $(obj).prop("id");
        var html = '<button id="'+tableId+'" onclick="addRow(this);" type="button" class="btn btn-primary btn-sm">추가</button>';
        html += '<button onclick="removeRow(this);" type="button" class="btn btn-inverse btn-sm">삭제</button>';
        var clickedRow = $(obj).parent().parent();
        $(obj).remove();
        var newrow = clickedRow.clone();
        newrow.find("td > input").val("");
        newrow.find("td:last").html(html);
        newrow.insertAfter(clickedRow.parent().parent().find("tr:last"));
        if (tableId == "table_2" || tableId == "table_4") {         
            $(document).find("input[name=eduDe],input[name='prd']").removeClass('hasDaterangepicker').daterangepicker({
                autoUpdateInput: false,
                locale: {
                    format: "YYYY-MM-DD",
                },
            });
            $(document).find("input[name=eduDe],input[name='prd']").on('apply.daterangepicker', function(ev, picker) {
                $(this).val(picker.startDate.format('YYYY-MM-DD') + ' ~ ' + picker.endDate.format('YYYY-MM-DD'));
            });
        }
    }

    // 테이블 로우 삭제
    function removeRow(obj) {
        var html = '<button onclick="addRow(this);" type="button" class="btn btn-primary btn-sm">추가</button>';
        html += '<button onclick="removeRow(this);" type="button" class="btn btn-inverse btn-sm">삭제</button>';
        var tableObj = $(obj).parent().parent().parent();
        $(obj).parent().parent().remove();
        tableObj.find("tr:last").find("td:last").html(html);
    }
    
    // 저장
    function fn_save(){
        if(!($("#insertForm").valid())) return;
        
        if(!confirm("저장하시겠습니까?")) return;
        
        var data =  $("#insertForm").serialize();        
        
        if(displayWorkProgress()){
            $.ajax({
                url : updateUrl,
                type: 'POST',
                cache : false,
                dataType: 'json',
                data : data,
                success : function (data){
                    if(data.result=="success"){
                        alert(data.msg);
                        gridHelper2.resetListContent();
//                         gridHelper1.loadContent(uri);
                    }else{
                        alert(data.msg);
                    }
                    closeWorkProgress();
                }
            });
        }
    }

</script>