<form id="insertForm">
    <input type="hidden" name="aplyid" id="aplyid" th:value="${detail.aplyid}" />
    <!-- [탭] 사업수행계획 -->
    <div class="tab-pane" id="tab_03" role="tabpanel">
        <div class="card">
            <!-- 사업비 구성표(항목별 산출내역) -->
            <div class="card-header p-b-0">
                <h3 class="sub-title"><strong>사업비 구성표(항목별 산출내역)</strong></h3>
            </div>
            <div class="card-block-small p-t-0">
                <div class="row">
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>인건비 소계(110)</strong></label>
                            <div class="col-sm-12">
                                <input type="text" class="form-control form-control-sm" id="lbcstSum" name="lbcstSum" placeholder="" th:value="${#numbers.formatInteger(detail.lbcstSum, 0, 'COMMA')}" maxlength="15">
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>운영비 소계(210)</strong></label>
                            <div class="col-sm-12">
                                <input type="text" class="form-control form-control-sm" id="orpnsSum" name="orpnsSum" placeholder="" th:value="${#numbers.formatInteger(detail.orpnsSum, 0, 'COMMA')}" maxlength="15">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>여비 소계(220)</strong></label>
                            <div class="col-sm-12">
                                <input type="text" class="form-control form-control-sm" id="trvctSum" name="trvctSum" placeholder="" th:value="${#numbers.formatInteger(detail.trvctSum, 0, 'COMMA')}" maxlength="15">
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>직무수행경비 소계(250)</strong></label>
                            <div class="col-sm-12">
                                <input type="text" class="form-control form-control-sm" id="expensSum" name="expensSum" placeholder="" th:value="${#numbers.formatInteger(detail.expensSum, 0, 'COMMA')}" maxlength="15">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>반환금 등 소계(710)</strong></label>
                            <div class="col-sm-12">
                                <input type="text" class="form-control form-control-sm" id="refundSum" name="refundSum" placeholder="" th:value="${#numbers.formatInteger(detail.refundSum, 0, 'COMMA')}" maxlength="15">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-6 pe-0">
                        <div class="p-2 text-center" style="background-color:#e5e5e5;"><strong>총계</strong></div>
                    </div>
                    <div class="col-6 ps-0">
                        <div class="p-2 text-center" style="background-color:#e5e5e5;"><strong id="totalSum"><th:block th:text="${#numbers.formatInteger(detail.totalSum, 0, 'COMMA')}"/></strong></div>
                    </div>
                </div>
            </div>

            <!-- 홍보 및 참여방안 -->
            <div class="card-header p-t-0 p-b-0">
                <h3 class="sub-title"><strong>홍보 및 참여방안</strong></h3>
            </div>
            <div class="card-block-small p-t-0 mb-3">
                <div class="col-12 table-responsive">
                    <table class="table table-framed table-bordered">
                        <thead>
                        <tr class="border-bottom-inverse">
                            <th colspan="2" class="text-center">구분
                            </th>
                            <th class="text-center"
                                style="width:150px;">시기
                            </th>
                            <th class="text-center">홍보방법</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td rowspan="3"
                                class="table-active v-middle text-center"
                                style="width: 120px;">
                                홍보
                            </td>
                            <td class="v-middle text-center"
                                style="width: 100px;">운영전
                            </td>
                            <td>
                                <input type="text" class="form-control form-control-sm" placeholder="" id="operBfrPrmtnSess" name="operBfrPrmtnSess" th:value="${detail.operBfrPrmtnSess}" maxlength="100">
                            </td>
                            <td>
                                <input type="text" class="form-control form-control-sm" placeholder="" id="operBfrPrmtnMthd" name="operBfrPrmtnMthd" th:value="${detail.operBfrPrmtnMthd}" maxlength="200">
                            </td>
                        </tr>
                        <tr>
                            <td class="v-middle text-center">운영중
                            </td>
                            <td>
                                <input type="text" class="form-control form-control-sm" placeholder="" id="operMdlPrmtnSess" name="operMdlPrmtnSess" th:value="${detail.operMdlPrmtnSess}" maxlength="100">
                            </td>
                            <td>
                                <input type="text" class="form-control form-control-sm" placeholder="" id="operMdlPrmtnMthd" name="operMdlPrmtnMthd" th:value="${detail.operMdlPrmtnMthd}" maxlength="200">
                            </td>
                        </tr>
                        <tr>
                            <td class="v-middle text-center">운영후
                            </td>
                            <td>
                                <input type="text" class="form-control form-control-sm" placeholder="" id="operAftrPrmtnSess" name="operAftrPrmtnSess" th:value="${detail.operAftrPrmtnSess}" maxlength="100">
                            </td>
                            <td>
                                <input type="text" class="form-control form-control-sm" placeholder="" id="operAftrPrmtnMthd" name="operAftrPrmtnMthd" th:value="${detail.operAftrPrmtnMthd}" maxlength="100">
                            </td>
                        </tr>
                        <tr>
                            <td class="table-active v-middle text-center">
                                참가접수방법
                            </td>
                            <td colspan="3" class="v-middle">
                                <div class="col-12 row mx-0 align-items-center">
                                    <div class="col-12 col-lg-auto">
                                        <div class="border-checkbox-section">
                                            <div class="border-checkbox-group border-checkbox-group-inverse">
                                                <input class="border-checkbox" type="checkbox" name="telRcptYn" id="telRcptYn" th:checked="${detail.telRcptYn == 'Y' ? true : false}">
                                                <label class="form-label form-label-sm border-checkbox-label mb-0" for="telRcptYn">
                                                    전화접수
                                                </label>
                                            </div>
                                            <div class="border-checkbox-group border-checkbox-group-inverse">
                                                <input class="border-checkbox" type="checkbox" name="aplyRcptYn" id="aplyRcptYn" th:checked="${detail.aplyRcptYn == 'Y' ? true : false}">
                                                <label class="form-label form-label-sm border-checkbox-label mb-0" for="aplyRcptYn">
                                                    신청서접수
                                                </label>
                                            </div>
                                            <div class="border-checkbox-group border-checkbox-group-inverse">
                                                <input class="border-checkbox" type="checkbox" name="onlnRcptYn" id="onlnRcptYn" th:checked="${detail.onlnRcptYn == 'Y' ? true : false}">
                                                <label class="form-label form-label-sm border-checkbox-label mb-0" for="onlnRcptYn">
                                                    온라인신청
                                                </label>
                                            </div>
                                            <div class="border-checkbox-group border-checkbox-group-inverse">
                                                <input class="border-checkbox" type="checkbox" name="etcYn" id="etcYn" th:checked="${detail.etcYn == 'Y' ? true : false}">
                                                <label class="form-label form-label-sm border-checkbox-label mb-0" for="etcYn">
                                                    기타
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-12 col-lg mt-2 mt-lg-0 pe-0">
                                        <input type="text" class="form-control form-control-sm" aria-label="참가접수방법 기타" id="etcCn" name="etcCn" th:value="${detail.etcCn}" th:readonly="${detail.etcYn == 'Y' ? false : true}" maxlength="100"/>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- // -->

            <div class="card-block-small">
                <button class="btn btn-disabled m-r-5" onclick="gridHelper3.toggleContent(); return false;">취소</button>
                <button class="btn btn-primary" onclick="fn_save(); return false;">저장</button>
            </div>
        </div>
    </div>
</form>

<script th:inline="javascript">    
//     var listUrl = "/mng/bizAply/req/selectSuppList.do";
    var updateUrl = "/mng/bizAply/req/updatePlan.do";
    /*<![CDATA[*/
    var telRcptYn = /*[[${detail.telRcptYn}]]*/null;
    var aplyRcptYn = /*[[${detail.aplyRcptYn}]]*/null;
    var onlnRcptYn = /*[[${detail.onlnRcptYn}]]*/null;
    var etcYn = /*[[${detail.etcYn}]]*/null;
    var popupYn = /*[[${popupYn}]]*/null;
    /*]]>*/
    
    $(function(){
//     	if (telRcptYn == "Y") {
//     		$("#telRcptYn").prop("checked", true);
//     	}
//     	if (aplyRcptYn == "Y") {
//     		$("#aplyRcptYn").prop("checked", true);
//     	}
//     	if (onlnRcptYn == "Y") {
//     		$("#onlnRcptYn").prop("checked", true);
//     	}
//     	if (etcYn == "Y") {
//     		$("#etcYn").prop("checked", true);
//     	}
        if (popupYn == "Y") {
            $("input, select, textarea").prop("disabled", true);
            $("button").hide();
        }
    	$("#etcYn").click(function(){
            if ($(this).is(":checked")) {
                $("#etcCn").prop("readonly", false);                
            } else {
                $("#etcCn").prop("readonly", true);
                $("#etcCn").val("");
            }
        });
    	
    	$("#lbcstSum,#orpnsSum,#trvctSum,#expensSum,#refundSum").on("keyup", function(){
            $(this).val($(this).val().replace(/[^0-9]/g, '').replace(/(\d)(?=(?:\d{3})+(?!\d))/g, '$1,'));
            totalSum();
        });
    	
    	var validator = $("#insertForm").validate({
            rules: {
            	lbcstSum: { maxlength:15 }
                , orpnsSum: { maxlength:15 }
            	, trvctSum: { maxlength:15 }
            	, lbcstSum: { maxlength:15 }
            	, refundSum: { maxlength:15 }
            	, operBfrPrmtnSess: { maxlength: 100 }
            	, operBfrPrmtnMthd: { maxlength: 200 }
            	, operMdlPrmtnSess: { maxlength: 100 }
            	, operMdlPrmtnMthd: { maxlength: 200 }
            	, operAftrPrmtnSess: { maxlength: 100 }
            	, operAftrPrmtnMthd: { maxlength: 100 }
            },
            messages: {
            	lbcstSum: { maxlength: "인건비 소계는 15자를 넘을 수 없습니다." }
	            , orpnsSum: { maxlength: "운영비 소계는 15자를 넘을 수 없습니다." }
	            , trvctSum: { maxlength: "여비 소계는 15자를 넘을 수 없습니다." }
	            , lbcstSum: { maxlength: "직무수행경비 소계는 15자를 넘을 수 없습니다." }
	            , refundSum: { maxlength: "반환금 등 소계는 15자를 넘을 수 없습니다." }
	            , operBfrPrmtnSess: { maxlength: "홍보 운영전 시기는 100자를 넘을 수 없습니다." }
	            , operBfrPrmtnMthd: { maxlength: "홍보 운영전 홍보방법은 200자를 넘을 수 없습니다." }
	            , operMdlPrmtnSess: { maxlength: "홍보 운영중 시기는 100자를 넘을 수 없습니다." }
	            , operMdlPrmtnMthd: { maxlength: "홍보 운영중 홍보방법은 200자를 넘을 수 없습니다." }
	            , operAftrPrmtnSess: { maxlength: "홍보 운영후 시기는 100자를 넘을 수 없습니다." }
	            , operAftrPrmtnMthd: { maxlength: "홍보 운영후 홍보방법은 100자를 넘을 수 없습니다." }
            }
        });
    });

    function totalSum() {
        var lbcstSum = Number(removeComma($("#lbcstSum").val()));
        var orpnsSum = Number(removeComma($("#orpnsSum").val()));
        var trvctSum = Number(removeComma($("#trvctSum").val()));
        var expensSum = Number(removeComma($("#expensSum").val()));
        var refundSum = Number(removeComma($("#refundSum").val()));
        var total = lbcstSum+orpnsSum+trvctSum+expensSum+refundSum;
        $("#totalSum").text(String(total).replace(/(\d)(?=(?:\d{3})+(?!\d))/g, '$1,'));
    }
    
    // 저장
    function fn_save(){
        if(!($("#insertForm").valid())) return;
        
        if(!confirm("저장하시겠습니까?")) return;
        
        $("#lbcstSum").val(removeComma($("#lbcstSum").val()));
        $("#orpnsSum").val(removeComma($("#orpnsSum").val()));
        $("#trvctSum").val(removeComma($("#trvctSum").val()));
        $("#expensSum").val(removeComma($("#expensSum").val()));
        $("#refundSum").val(removeComma($("#refundSum").val()));
        
        if ($("#telRcptYn").is(":checked"))	{
        	$("#telRcptYn").val("Y");
        } else {
        	$("#telRcptYn").val("N");
        }
        if ($("#aplyRcptYn").is(":checked")) {
        	$("#aplyRcptYn").val("Y");
        } else {
        	$("#aplyRcptYn").val("N");
        }
        if ($("#onlnRcptYn").is(":checked")) {
        	$("#onlnRcptYn").val("Y");
        } else {
        	$("#onlnRcptYn").val("N");
        }
        if ($("#etcYn").is(":checked")) {
        	$("#etcYn").val("Y");
        } else {
        	$("#etcYn").val("N");
        }
        
        var data =  $("#insertForm").serialize();        
        
        if(displayWorkProgress()){
            $.ajax({
                url : updateUrl,
                type: 'POST',
                cache : false,
                dataType: 'json',
                data : data,
                success : function (data){
                    if(data.result=="success"){
                        alert(data.msg);
                        gridHelper2.resetListContent();
                    }else{
                        alert(data.msg);
                    }
                    closeWorkProgress();
                }
            });
        }
    }
    
    //콤마 제거
    function removeComma(value){
        if (value == "" || value == null) {
            return 0;               
        }
        value = value.replace(/[^\d]+/g, "");
        return value; 
    }

</script>