<form id="prgrmOperMngFrm">
<input type="hidden" id="prgrmid" name="prgrmid" th:value="${prgrmOperMngInfo.prgrmid}">
<input type="hidden" id="operMngPrgrmid" name="operMngPrgrmid" th:value="${prgrmOperMngInfo.operMngPrgrmid}">

	<div class="card-header p-t-0 p-b-0">
	    <h3 class="sub-title"><strong>예산구성</strong></h3>
	</div>
	<div class="card-block-small p-t-0">
	    <div class="col-12 table-border-style">
	        <div class="col-12 table-responsive">
	            <table class="table table-framed table-bordered">
	                <thead>
	                <tr class="border-bottom-inverse">
	                    <th class="text-center">참가비 수입<i class="mark-required">*</i></th>
	                    <th class="text-center">기타 (후원)<i class="mark-required">*</i></th>
	                    <th class="text-center">자부담<i class="mark-required">*</i></th>
	                </tr>
	                </thead>
	                <tbody>
	                    <tr>
	                        <td>
	                            <div class="col-12 row m-0 align-items-center justify-content-center">
	                                <div class="col-11 p-l-0 p-r-0">
	                                    <input type="Number" class="form-control form-control-sm" maxlength="3" name="etrfeeIncm" id="etrfeeIncm" placeholder="" th:value="${prgrmOperMngInfo.etrfeeIncm}" onchange="btgSum()">
	                                </div>
									<div class="col-auto p-l-5 p-r-0">%</div>
								</div>
	                        </td>
	                        <td>
	                            <div class="col-12 row m-0 align-items-center justify-content-center">
	                                <div class="col-11 p-l-0 p-r-0">
	                                    <input type="Number" class="form-control form-control-sm" maxlength="3" name="etcIncm" id="etcIncm" placeholder="" th:value="${prgrmOperMngInfo.etcIncm}" onchange="btgSum()">
	                                </div>
									<div class="col-auto p-l-5 p-r-0">%</div>
								</div>
	                        </td>
	                        <td>
	                            <div class="col-12 row m-0 align-items-center justify-content-center">
	                                <div class="col-11 p-l-0 p-r-0">
	                                    <input type="text" class="form-control form-control-sm" maxlength="3" name="slfpy" id="slfpy" placeholder="" th:value="${prgrmOperMngInfo.slfpy}" onchange="btgSum()">
	                                </div>
									<div class="col-auto p-l-5 p-r-0">%</div>
								</div>
	                        </td>
	                    </tr>
	                    <tr>
	                        <th class="table-active text-center">총계</th>
	                        <th colspan="2" class="table-active text-center" id="btgSum"><th:block th:text="${prgrmOperMngInfo.btgSum} + '%'"></th:block></th>
	                    </tr>
	                </tbody>
	            </table>
	        </div>
	    </div>
	</div>


	<div class="card-block-small p-t-0">
	    <div class="col-12 table-border-style">
	        <div class="col-12 table-responsive">
	            <table class="table table-framed">
	                <thead>
	                <tr>
	                    <th class="text-center">지출항목<i class="mark-required">*</i></th>
	                    <th class="text-center">금액<i class="mark-required">*</i></th>
	                    <th class="text-center" style="width: 117px;">설정</th>
	                </tr>
	                </thead>
	                <tbody>

    	                <tr th:unless="${#lists.isEmpty(expndArtclList)}" th:each="item ,i: ${expndArtclList}" th:id="${'expndTr' + i.count}">
    	                    <td>
                                <input type="text" class="form-control form-control-sm" maxlength="60" name="expndArtcl" th:id="${ 'expndArtcl' + i.count }" placeholder="지출 항목" th:value="${item.expndArtcl}"/>
    	                    </td>
    	                    <td>
    	                        <div class="col-12 row m-0 align-items-center justify-content-center">
    	                            <div class="col-11 p-l-0 p-r-0">
<!--                                         <input type="text" class="form-control form-control-sm" name="amtStr" th:id="${ 'amtStr' + i.count }" placeholder="금액" th:value="${#numbers.formatInteger(item.amt, 0,'COMMA')}"/> -->
                                        <input type="number" title='금액은 12자를 넘을 수 없습니다.' maxlength='12' class="form-control form-control-sm" name="amt" th:id="${ 'amtStr' + i.count }" placeholder="금액" th:value="${item.amt}"/>
    	                            </div>
                                        <div class="col-auto p-l-5 p-r-0">원</div>
                                </div>
    	                    </td>
    	                    <td>
    	                        <div class="btn-group-sm">
                                    <button type="button" class="btn btn-primary m-r-5" th:id="${ 'addBtnExpnd' + i.count }" th:idx="${i.count}"
                                        th:onclick="addExpnd( this.getAttribute('idx') )" >추가</button>
                                    <button type="button" class="btn btn-inverse"       th:id="${ 'delBtnExpnd' + i.count }" th:idx="${i.count}"
                                        th:onclick="deleteExpnd( this.getAttribute('idx') )" th:if="${i.index > 0}" >삭제</button>
    	                        </div>
    	                    </td>
    	                </tr>

    	                <tr id="expndSumAmtTr">
    	                    <th class="table-active text-center">총 예산액</th>
    	                    <th colspan="2" class="table-active text-center">
                                <th:bolck th:unless="${#lists.isEmpty(expndArtclList[0].sumAmt)}" th:text="|${#numbers.formatInteger(expndArtclList[0].sumAmt, 0,'COMMA')}원|"></th:bolck>
                            </th>
    	                </tr>

	                </tbody>
	            </table>
	        </div>
	    </div>
	</div>
	<div class="card-header p-t-0 p-b-0">
	    <h3 class="sub-title"><strong>교구 및 시설</strong></h3>
	</div>
	<div class="card-block-small p-t-0">
	    <div class="col-12 table-border-style">
	        <div class="col-12 table-responsive">
	            <table class="table table-framed" id="fcltTb">
	                <thead>
	                <tr>
	                    <th class="text-center">세부 프로그램명</th>
	                    <th class="text-center">교육장소</th>
	                    <th class="text-center">교구 및 매체 등</th>
	                    <th class="text-center">수량 (개) 또는 분량 (장)</th>
	                    <th class="text-center" style="width: 117px;">설정</th>
	                </tr>
	                </thead>
	                <tbody>

	                <tr th:each="tchaidFcltList ,i: ${tchaidFcltList}" th:id ="${'fcltTr' + i.count}">
	                    <td>
	                        <input type="text" class="form-control form-control-sm" maxlength='60' th:name="${'dtlPrgrmNm'+i.count}" th:id="${'dtlPrgrmNm'+i.count}" placeholder="세부 프로그램명" th:value="${tchaidFcltList.dtlPrgrmNm}">
	                    </td>
	                    <td>
	                        <input type="text" class="form-control form-control-sm" maxlength='60' th:name="${'eduPlc'+i.count}" th:id="${'eduPlc'+i.count}" placeholder="교육장소" th:value="${tchaidFcltList.eduPlc}">
	                    </td>
	                    <td>
	                        <input type="text" class="form-control form-control-sm" maxlength='60' th:name="${'tchaid'+i.count}" th:id="${'tchaid'+i.count}" placeholder="교구 및 매체 등" th:value="${tchaidFcltList.tchaid}">
	                    </td>
	                    <td>
	                        <div class="col-12 row m-0 align-items-center justify-content-center">
	                            <div class="col-11 p-l-0 p-r-0">
	                                <input type="number" class="form-control form-control-sm" title='수량은 10자를 넘을 수 없습니다.' maxlength='10' th:name="${'qnty'+i.count}" th:id="${'qnty'+i.count}" placeholder="수량 (개) 또는 분량 (장)" th:value="${tchaidFcltList.qnty}">
	                            </div>
	                            <div class="col-auto p-l-5 p-r-0">
	                                개/장
	                            </div>
	                        </div>
	                    </td>
	                    <td>
	                        <div class="btn-group-sm">
                                <button type="button" class="btn btn-primary m-r-5" th:id="${ 'addBtnFclt' + i.count }" th:idx="${i.count}" th:onclick="addFclt(this.getAttribute('idx'))" >추가</button>
                                <button type="button" class="btn btn-inverse"       th:id="${ 'delBtnFclt' + i.count }" th:idx="${i.count}" th:onclick="deleteFclt( this.getAttribute('idx'))" th:if="${i.index > 0}" >삭제</button>
	                        </div>
	                    </td>
	                </tr>

	                </tbody>
	            </table>
	        </div>
	    </div>
	</div>
	<div class="card-header p-t-0 p-b-0">
	    <h3 class="sub-title"><strong>홍보 및 참가접수</strong></h3>
	</div>
	<div class="card-block-small p-t-0">
	    <div class="col-12 table-border-style">
	        <div class="col-12 table-responsive">
	            <table class="table table-framed table-bordered">
	                <thead>
	                <tr class="border-bottom-inverse">
	                    <th colspan="2" class="text-center">구분</th>
	                    <th class="text-center" style="width:150px;">시기</th>
	                    <th class="text-center">홍보방법</th>
	                </tr>
	                </thead>
	                <tbody>
	                <tr>
	                    <td rowspan="3" class="table-active v-middle text-center" style="width: 120px;">홍보</td>
	                    <td class="v-middle text-center" style="width: 100px;">운영전</td>
	                    <td>
	                        <input type="text" class="form-control form-control-sm" name="operBfrPrmtnSess" id="operBfrPrmtnSess" placeholder="" th:value="${prgrmOperMngInfo.operBfrPrmtnSess}">
	                 </td>
	                 <td>
	                    <input type="text" class="form-control form-control-sm" name="operBfrPrmtnMthd" id="operBfrPrmtnMthd" placeholder="" th:value="${prgrmOperMngInfo.operBfrPrmtnMthd}">
	                 </td>
	                </tr>
                    <tr>
	                    <td class="v-middle text-center">운영중</td>
	                    <td>
	                        <input type="text" class="form-control form-control-sm" name="operMdlPrmtnSess" id="operMdlPrmtnSess" placeholder="" th:value="${prgrmOperMngInfo.operMdlPrmtnSess}">
	                    </td>
	                    <td>
	                        <input type="text" class="form-control form-control-sm" name="operMdlPrmtnMthd" id="operMdlPrmtnMthd" placeholder="" th:value="${prgrmOperMngInfo.operMdlPrmtnMthd}">
	                    </td>
	                </tr>
	                <tr>
	                    <td class="v-middle text-center">운영후</td>
	                    <td>
	                        <input type="text" class="form-control form-control-sm" name="operAftrPrmtnSess" id="operAftrPrmtnSess" placeholder="" th:value="${prgrmOperMngInfo.operAftrPrmtnSess}">
	                    </td>
	                    <td>
	                        <input type="text" class="form-control form-control-sm" name="operAftrPrmtnMthd" id="operAftrPrmtnMthd" placeholder="" th:value="${prgrmOperMngInfo.operAftrPrmtnMthd}">
	                    </td>
	                </tr>
	                <tr>
	                    <td class="table-active v-middle text-center">참가접수방법2</td>
	                    <td colspan="2" class="v-middle">
	                        <div class="border-checkbox-section">
	                            <div class="border-checkbox-group border-checkbox-group-inverse">
	                                <input class="border-checkbox" type="checkbox" name="telRcptYn" id="telRcptYn"
	                                   th:checked ="${prgrmOperMngInfo.telRcptYn=='Y'}">
	                                <label class="form-label form-label-sm border-checkbox-label mb-0" for="telRcptYn">전화접수</label>
	                            </div>
	                            <div class="border-checkbox-group border-checkbox-group-inverse">
	                                <input class="border-checkbox" type="checkbox" name="aplfrmRcptYn" id="aplfrmRcptYn" th:checked="${prgrmOperMngInfo.aplfrmRcptYn=='Y'}">
	                                <label class="form-label form-label-sm border-checkbox-label mb-0" for="aplfrmRcptYn">신청서접수</label>
	                            </div>
	                            <div class="border-checkbox-group border-checkbox-group-inverse">
	                                <input class="border-checkbox" type="checkbox" name="onlnAplyYn" id="onlnAplyYn" th:checked="${prgrmOperMngInfo.onlnAplyYn=='Y'}">
	                                <label class="form-label form-label-sm border-checkbox-label mb-0" for="onlnAplyYn">온라인신청</label>
	                            </div>
	                            <div class="border-checkbox-group border-checkbox-group-inverse">
	                                <input class="border-checkbox" type="checkbox" name="etcYn" id="etcYn" th:checked="${prgrmOperMngInfo.etcYn=='Y'}">
	                                <label class="form-label form-label-sm border-checkbox-label mb-0" for="etcYn">기타</label>
	                            </div>
	                        </div>
	                    </td>
	                    <td>
	                        <input type="text" class="form-control form-control-sm" name="etcCn" id="etcCn" placeholder="" th:value="${prgrmOperMngInfo.etcCn}"/>
	                    </td>
	                </tr>
	                </tbody>
	            </table>
	        </div>
	    </div>
	</div>
	<div class="card-block-small">
	    <button type="button" class="btn btn-inverse m-r-5" onclick="gridHelper1.toggleContent()">목록</button>
        <button type="button" class="btn btn-primary m-r-5" onclick="fn_savePrgrmOperBtn()">저장</button>
        <button type="button" class="btn btn-primary"       onclick="fn_savePrgrmOperBtn('next')">다음</button>
<!--         <button type="button" class="btn btn-primary"       onclick="fn_prgrmOperNextbtn()">다음</button> -->
	</div>

	</div>
</form>

<script th:inline="javascript">

    var vTchaidFcltList = /*[[${tchaidFcltList}]]*/null;
    var vIdx = vTchaidFcltList.length;

    function btgSum(){

    	var  vEtrfeeIncm = 0;
    	var  vEtcIncm    = 0;
    	var  vSlfpy      = 0;
    	var  vBtgSum     = 0;
    	vEtrfeeIncm = isNaN($("#etrfeeIncm").val()) ? 0 : $("#etrfeeIncm").val();
    	vEtcIncm    = isNaN($("#etcIncm").val()   ) ? 0 : $("#etcIncm").val()   ;
    	vSlfpy      = isNaN($("#slfpy").val()     ) ? 0 : $("#slfpy").val()     ;

    	vEtrfeeIncm = vEtrfeeIncm > 100 ? 100: vEtrfeeIncm;
        vEtcIncm    = vEtcIncm    > 100 ? 100: vEtcIncm   ;
        vSlfpy      = vSlfpy      > 100 ? 100: vSlfpy     ;

        $("#etrfeeIncm").val(vEtrfeeIncm);
        $("#etcIncm").val(vEtcIncm);
        $("#slfpy").val(vSlfpy);

    	vBtgSum = Number(vEtrfeeIncm) + Number(vEtcIncm) + Number(vSlfpy);

    	$("#btgSum")[0].textContent = vBtgSum +"%"
    }

    function addExpnd(btnId){

    	var trIdx = $("[id^=expndTr]").length + 1;

    	var vHtml = "";
        vHtml += "<tr id='expndTr"+trIdx+"'>";
        vHtml += "    <td>"
        vHtml += "        <input type='text' class='form-control form-control-sm' maxlength='60' name='expndArtcl' id='expndArtcl"+trIdx+"' placeholder='지출 항목' value=''/>";
        vHtml += "    </td>";
        vHtml += "    <td>";
        vHtml += "        <div class='col-12 row m-0 align-items-center justify-content-center'>";
        vHtml += "            <div class='col-11 p-l-0 p-r-0'>";
        vHtml += "                <input type='text' class='form-control form-control-sm' name='amt' id='amt"+trIdx+"' placeholder='금액' value=''/>";
        vHtml += "            </div>";
        vHtml += "                <div class='col-auto p-l-5 p-r-0'>원</div>";
        vHtml += "        </div>";
        vHtml += "    </td>";
        vHtml += "    <td>";
        vHtml += "        <div class='btn-group-sm'>";
        vHtml += "            <button type='button' class='btn btn-primary m-r-5' id='addBtnExpnd"+trIdx+"' idx='"+trIdx+"' onclick = 'addExpnd("+trIdx+")'    >추가</button>";
        vHtml += "            <button type='button' class='btn btn-inverse'       id='delBtnExpnd"+trIdx+"' idx='"+trIdx+"' onclick = 'deleteExpnd("+trIdx+")' >삭제</button>";
        vHtml += "        </div>";
        vHtml += "    </td>";
        vHtml += "</tr>";

    	$("#expndSumAmtTr").before(vHtml);
    }

    //교구및 시설 추가
    function addFclt(btnId){
    	var trIdx = $("[id^=fcltTr]").length + 1;
    	var vHtml ="";
    	vHtml += "<tr id ='fcltTr"+trIdx+"'>                                                                                                                                           ";
    	vHtml += "    <td>                                                                                                                                                             ";
    	vHtml += "        <input type='text' class='form-control form-control-sm' maxlength='60' name='${'dtlPrgrmNm"+trIdx+"' id='${'dtlPrgrmNm"+trIdx+"' placeholder='세부 프로그램명' value=''>    ";
    	vHtml += "    </td>                                                                                                                                                            ";
    	vHtml += "    <td>                                                                                                                                                             ";
    	vHtml += "        <input type='text' class='form-control form-control-sm' maxlength='60' name='${'eduPlc"+trIdx+"' id='${'eduPlc"+trIdx+"' placeholder='교육 장소' value=''>                  ";
    	vHtml += "    </td>                                                                                                                                                            ";
    	vHtml += "    <td>                                                                                                                                                             ";
    	vHtml += "        <input type='text' class='form-control form-control-sm' maxlength='60' name='${'tchaid"+trIdx+"' id='${'tchaid"+trIdx+"' placeholder='교구 및 매체 등' value=''>            ";
    	vHtml += "    </td>                                                                                                                                                            ";
    	vHtml += "    <td>                                                                                                                                                             ";
    	vHtml += "        <div class='col-12 row m-0 align-items-center justify-content-center'>                                                                                       ";
    	vHtml += "            <div class='col-11 p-l-0 p-r-0'>                                                                                                                         ";
    	vHtml += "                <input type='number' class='form-control form-control-sm' maxlength='10' name='${'qnty"+trIdx+"' id='${'qnty"+trIdx+"' placeholder='수량(개) 또는 분량 (장)' value=''>";
    	vHtml += "            </div>                                                                                                                                                   ";
    	vHtml += "            <div class='col-auto p-l-5 p-r-0'>                                                                                                                       ";
    	vHtml += "                개/장                                                                                                                                                ";
    	vHtml += "            </div>                                                                                                                                                   ";
    	vHtml += "        </div>                                                                                                                                                       ";
    	vHtml += "    </td>                                                                                                                                                            ";
    	vHtml += "    <td>                                                                                                                                                             ";
    	vHtml += "        <div class='btn-group-sm'>                                                                                                                                   ";
    	vHtml += "             <button type='button' class='btn btn-primary m-r-5' id='${ 'addBtnFclt"+trIdx+"' idx="+trIdx+"' onclick='addFclt("+trIdx+")' >추가</button>             ";
    	vHtml += "             <button type='button' class='btn btn-inverse'       id='${ 'delBtnFclt"+trIdx+"' idx="+trIdx+"' onclick='deleteFclt("+trIdx+")' >삭제</button>          ";
    	vHtml += "        </div>                                                                                                                                                       ";
    	vHtml += "    </td>                                                                                                                                                            ";
    	vHtml += "</tr>                                                                                                                                                                ";
    	$("#fcltTb").append(vHtml);
    }

    //지출항목 삭제
    function deleteExpnd(btnIdx){
        $("#expndTr" + btnIdx).remove();
    }

    //교구 및 시설 삭제
    function deleteFclt(btnIdx){
        $("#fcltTr" + btnIdx).remove();
    }

    function fn_savePrgrmOperBtn(call){
debugger;
    	var param = {};
        var operMngKey = $("#operMngPrgrmid").val();
        var vUrl = "/mng/asgsysSrng/";

        if(!$("#prgrmOperMngFrm").valid()) return false;

        if(!confirm("저장 하시겠습니까?")){return;}

        if(operMngKey != null && operMngKey != 0 && operMngKey != ""){
        	vUrl  += "updatePrgrmOperMng.do"
        }else{
        	vUrl  += "insertPrgrmOperMng.do"
        }

        $("#prgrmOperMngFrm input").each(function(index, item) {
            if("checkbox" == item.type) {
            	param[item.id] = $(item).prop('checked') ? "Y" : "N";
            }
            else{
                param[item.id] = item.value;
            }
        });

        //지출항목 목록
        //$("[id^=fcltTr]"    ).each(function(index, item) { param["expndArtclLst[" + index + "].prgrmid"]    = prgrmid; });      //프로그램 id (key)
        $("[id^=expndArtcl]").each(function(index, item) { param["expndArtclLst[" + index + "].expndArtcl"] = item.value; });   //지출 항목
        $("[id^=amt]"       ).each(function(index, item) { param["expndArtclLst[" + index + "].amt"]        = item.value.replaceAll(",",""); });   //지출 항목

        //교구 및 시설
        //$("[id^=expndTr]"   ).each(function(index, item) { param["tchaidFcltLst[" + index + "].prgrmid"]    = prgrmid;    });   //프로그램 id (key)
        $("[id^=dtlPrgrmNm]").each(function(index, item) { param["tchaidFcltLst[" + index + "].dtlPrgrmNm"] = item.value; });   //세부 프로그램 이름
        $("[id^=eduPlc]"    ).each(function(index, item) { param["tchaidFcltLst[" + index + "].eduPlc"]     = item.value; });   //교육 장소
        $("[id^=tchaid]"    ).each(function(index, item) { param["tchaidFcltLst[" + index + "].tchaid"]     = item.value; });   //교구
        $("[id^=qnty]"      ).each(function(index, item) { param["tchaidFcltLst[" + index + "].qnty"]       = item.value; });   //수량

        $.ajax({
            url : vUrl ,
            type: 'POST',
            cache : false,
            dataType: 'json',
            data : param,
            success : function (data){
                if(data.result=="success"){
                    alert(data.msg);
                    var url = "";
                    var prgrmid = $("#prgrmid").val();

                    if(call=='next'){

                    	$('[id^=jdsgTab]').removeClass('active')
                        $("#jdsgTab3Link").addClass("active");

                        url = "/mng/asgsysSrng/prgrmEvl.html?prgrmid="+prgrmid;
                    }else{
                    	url = "/mng/asgsysSrng/prgrmOperMngForm.html?prgrmid="+prgrmid;
                    }
                	dsgnAply.loadJdsgTabContent(url);

                }else{
                    alert("수정중 에러가 발생하였습니다. 관리자에게 문의 부탁드립니다.");
                }
            },
            error : function (error){
            }
        });
    }


    function initPrgrmOperMng(){

    }


    $(function() {
    	initPrgrmOperMng();

    	var validator = $('#prgrmOperMngFrm').validate({
            rules: {
                  etrfeeIncm        : {required: true, maxlength: 12}
                , etcIncm           : {required: true, maxlength: 12}
                , slfpy             : {required: true, maxlength: 12}
                , operBfrPrmtnSess  : {maxlength: 60}
                , operBfrPrmtnMthd  : {maxlength: 100}
                , operMdlPrmtnSess  : {maxlength: 60}
                , operMdlPrmtnMthd  : {maxlength: 100}
                , operAftrPrmtnSess : {maxlength: 60}
                , operAftrPrmtnMthd : {maxlength: 100}
                , etcCn             : {maxlength: 100}

            },
            messages: {
                  etrfeeIncm        : {required: "참가비 수입을 입력해 주십시오.", maxlength: "12"}
                , etcIncm           : {required: "기타(후원)을 입력해 주십시오.", maxlength: "12"}
                , slfpy             : {required: "자부담을 입력해 주십시오.", maxlength: "12"}
                , operBfrPrmtnSess  : {maxlength: "운영전 홍보시기는 60자 이하 여야 합니다."}
                , operBfrPrmtnMthd  : {maxlength: "운영전 홍보방법는 100자 이하 여야 합니다."}
                , operMdlPrmtnSess  : {maxlength: "운영중 홍보시기는 60자 이하 여야 합니다."}
                , operMdlPrmtnMthd  : {maxlength: "운영중 홍보방법는 100자 이하 여야 합니다."}
                , operAftrPrmtnSess : {maxlength: "운영후 홍보시기는 60자 이하 여야 합니다."}
                , operAftrPrmtnMthd : {maxlength: "운영후 홍보방법는 100자 이하 여야 합니다."}
                , etcCn             : {maxlength: "기타내용은 100자 이하 여야 합니다."}
            }
        });

	   $("input:checkbox").on('click', function() {

	        if ( $(this).prop('checked') ) {
	          $(this).parent().addClass("selected");
	        } else {
	          $(this).parent().removeClass("selected");
	        }
	   });
    });

</script>