<form id="sftyMngFrm">
<input type="hidden" id="prgrmid" name="prgrmid" th:value="${sftyMngInfo.prgrmid}">


	<div class="card-header p-t-0 p-b-0">
	    <h3 class="sub-title"><strong>안전관리 메뉴얼</strong></h3>
	</div>
	<div class="card-block-small p-t-0">
	    <div class="mb-0 form-group row">
	        <div class="mb-0 form-group">
	            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>첨부파일</strong></label>
				<div class="col-sm-12">
<!-- 					<input id="sftyMngMnlFile" type="file" class="form-control form-control-sm"/> -->
					<input id="sftyMngMnlFile" type="file" name="files" multiple accept="image/jpeg,image/gif,image/png,application/pdf" class="form-control form-control-sm" style="display:none"/>
				</div>

				<div class="mt-2 row">
	                <div class="col-auto">
						<div class="upload-response" >
	                        <div>
                                <span class="label label-inverse"> sampleFile.pptx <a href="javascript:void(0)" class="text-white">X</a></span>
	                        </div>
	                        <div id="multipleFileUploadError"></div>
	                        <div id="multipleFileUploadSuccess"></div>
	                    </div>
<!-- 	                    <input type="hidden"  id = "filegrpid" name = "filegrpid" value='0'/> -->

					</div>
	            </div>
	        </div>
	    </div>
	</div>
	<div class="card-header p-t-0 p-b-0">
	    <h3 class="sub-title"><strong>프로그램 지도자 대상 교육</strong>
	    </h3>
	</div>
	<div class="card-block-small p-t-0">
	    <div class="mb-2 row">
	        <div class="col-12 col-lg-6 mb-2 mb-lg-0">
	            <div class="mb-0 form-group row">
	                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"
	                       for="sftyMngProgramLeaderEduDate"><strong>교육시기</strong></label>
					<div class="col-12">
						<input type="text" class="form-control form-control-sm" name="ldrEduSess" id="ldrEduSess" placeholder="Text Input Validation"  th:value="${sftyMngInfo.ldrEduSess}" emode="mod" readonly/>
					</div>
				</div>
	        </div>
	        <div class="col-12 col-lg-6">
	            <div class="mb-0 form-group row">
	                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"
	                       for="sftyMngProgramLeaderEduManager"><strong>담당자</strong></label>
					<div class="col-12">
						<input type="text" class="form-control form-control-sm" name="ldrEduPic" id="ldrEduPic" placeholder="Text Input Validation" th:value="${sftyMngInfo.ldrEduPic}" emode="mod" readonly/>
					</div>
				</div>
	        </div>
	    </div>
	    <div class="mb-0 form-group row">
			<label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="sftyMngProgramLeaderEduContents"><strong>교육내용 개요</strong></label>
			<div class="col-12">
				<textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="Default textarea" id="prtcpntEduCn" name="prtcpntEduCn" emode="mod" readonly><th:block th:text="${sftyMngInfo.prtcpntEduCn}"></th:block></textarea>
			</div>
	    </div>
	</div>
	<div class="card-header p-t-0 p-b-0">
	    <h3 class="sub-title"><strong>프로그램 참가자 대상 교육</strong></h3>
	</div>
	<div class="card-block-small p-t-0">
	    <div class="mb-2 row">
	        <div class="col-12 col-lg-6 mb-2 mb-lg-0">
	            <div class="mb-0 form-group row">
	                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"
	                       for="sftyMngProgramApplicantEduDate"><strong>교육시기</strong></label>
	                <div class="col-12">
						<input type="text" class="form-control form-control-sm" name="prtcpntEduSess" id="prtcpntEduSess" placeholder="Text Input Validation" th:value="${sftyMngInfo.prtcpntEduSess}" emode="mod" readonly/>
					</div>
	            </div>
	        </div>
	        <div class="col-12 col-lg-6">
	            <div class="mb-0 form-group row">
	                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"
	                       for="sftyMngProgramApplicantEduManager"><strong>담당자</strong></label>
					<div class="col-12">
						<input type="text" class="form-control form-control-sm" name="prtcpntEduPic" id="prtcpntEduPic" placeholder="Text Input Validation" th:value="${sftyMngInfo.prtcpntEduPic}" emode="mod" readonly/>
					</div>
				</div>
	        </div>
	    </div>
	    <div class="mb-0 form-group row">
			<label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="sftyMngProgramApplicantEduContents"><strong>교육내용 개요</strong></label>
			<div class="col-12">
				<textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="Default textarea" id="ldrEduCn" name="ldrEduCn" emode="mod" readonly><th:block th:text="${sftyMngInfo.ldrEduCn}"></th:block></textarea>
			</div>
	    </div>
	</div>
	<div class="card-header p-t-0 p-b-0">
	    <h3 class="sub-title"><strong>안전관리 사전인증</strong></h3>
	</div>
	<div class="card-block-small p-t-0">
	    <div class="mb-2 form-group row">
	        <div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
	            <strong>인증여부</strong></div>
	        <div class="col-12">
            <div class="form-radio">
	           <div class="radio radio-inline" >
	               <span kattr:radio_yn="bfrCertYn" label1="예" label2="아니오" th:attr="defaultVal=${sftyMngInfo.bfrCertYn == null ? 'N':sftyMngInfo.bfrCertYn}" addStyle="margin-top:4px" addClass="col-sm-3" readonly/>
	           </div>
	       </div>
	    </div>
	    <div class="mb-0 form-group row">
	        <div class="mb-0 form-group">
	            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>첨부파일</strong></label>
	            <div class="col-sm-12">
					<input type="file" class="form-control form-control-sm" style="display:none"/>
				</div>
	            <div class="mt-2 row">
	                <div class="col-auto">
						<span class="label label-inverse"> sampleFile.pptx <a href="javascript:void(0)" class="text-white">X</a></span>
					</div>
	            </div>
	        </div>
	    </div>
	</div>
	<div class="card-block-small">
	    <button class="btn btn-inverse m-r-5">목록</button>
	    <button type="button" id="sftyMngModBtn" class="btn btn-primary m-r-5" onclick="fn_modSftyMngFrm()">수정</button>
	    <button type="button" id="sftyMngSaveBtn" class="btn btn-primary m-r-5" onclick="fn_saveSftyMngFrm()">저장</button>
	    <button class="btn btn-primary">다음</button>
	</div>

	<input type="hidden" id="filegrpid" name="filegrpid" value="0"/>
</form>
<script th:inline="javascript">

function fn_sftyMngFrmInit(){

	$("#sftyMngSaveBtn").hide();

}

function fn_modSftyMngFrm(){

	$("#ldrEduSess").focus();
	$("#sftyMngModBtn").hide();
debugger;
    $("textarea[emode='mod'], input[emode='mod']").removeAttr("readonly");

	$("#sftyMngSaveBtn").show();
	$("#sftyMngMnlFile").show();

}

function fn_saveSftyMngFrm(){



	if(!confirm("저장 하시겠습니까?")){return;}

    var data =  $("#sftyMngFrm").serialize() ;
debugger;
    $.ajax({
        url : "/mng/asgsysSrng/updateSftyMng.do",
        type: 'POST',
        cache : false,
        dataType: 'json',
        data : data,
        success : function (data){
            if(data.result=="success"){
                alert("수정이 완료 되었습니다.");
                loadJdsgTabContent("/mng/asgsysSrng/sftyMngForm.html?prgrmid=" + prgrmid);
            }else{
                alert("수정중 에러가 발생하였습니다. 관리자에게 문의 부탁드립니다.");
            }
        },
        error : function (error){
        }
    });
}

//안전관리 메뉴얼 첨부파일
var atchfileCnt = 2 ;
var uploadFileCnt = 0 ;

$('#sftyMngMnlFile').on("change", function(event) {
debugger;
        var objFile = document.querySelector('#sftyMngMnlFile');
        var formData = new FormData();
        var content = "";

        for( i = 0 ; i < objFile.files.length ; i++) {

               if(uploadFileCnt >= atchfileCnt){
                   alert("첨부파일은  "+atchfileCnt+ " 개 까지 가능합니다." ); break;
               }else{
                   formData.append("files", objFile.files[i]);
                   uploadFileCnt++;
               }
        }

        formData.append("filegrpid", $("#filegrpid").val());
        formData.append("filegrpNm", "asgsysSrng_file");

        if(uploadFileCnt >0 ){
            $.ajax({
            	url : '/uploadMultipleFiles.do',
                processData : false,
                contentType : false,
                data : formData,
                type : 'POST',
                success : function(response) {
                	debugger;

                    if($("#filegrpid").val()=='0' || $("#filegrpid").val()==''  || $("#filegrpid").val()==null){
                        $("#filegrpid").val( response[0].filegrpid );
                    }

                    for(i = 0 ;i < response.length; i++ ){
                    	debugger;
//                         content = "<div class ='' id='inputFiles"+response[i].fileid+"'><a href=javascript:downloadFileByFileid('"+response[i].fileid+"','"+response[i].fileIdntfcKey+"')>"+response[i].orginlFileNm +"</a>";
//                         content +="&nbsp;&nbsp;<input type='button'  class = 'btn btn-xs btn-danger' onclick =uploadFileCnt--;fn_deleteFileList('inputFiles"+response[i].fileid+"','"+response[i].fileIdntfcKey+"') value='X'/></div>";
                        content =  "<span id='inputFiles"+response[i].fileid+"' class='label label-inverse' href=javascript:downloadFileByFileid('"+response[i].fileid+"','"+response[i].fileIdntfcKey+"')>"+response[i].orginlFileNm
                        content += "&nbsp;&nbsp;<a href='javascript:void(0)' onclick =uploadFileCnt--;fn_deleteFileList('inputFiles"+response[i].fileid+"','"+response[i].fileIdntfcKey+"') class='text-white'>X</a></span>"
//                         content += "<a type='button'  class = 'text-white' onclick =uploadFileCnt--;fn_deleteFileList('inputFiles"+response[i].fileid+"','"+response[i].fileIdntfcKey+"') value='X'/></a></span>"


                        $('#multipleFileUploadSuccess').append(content);
                    }

                }
            });
           $("#sftyMngMnlFile").val("");
        }
});

function fn_deleteFileList(fileid, fileIdntfcKey){
    if(!confirm("파일을 삭제하시겠습니까?")){return;}
    fn_deleteFile(fileid, fileIdntfcKey);
    $("#"+fileid).remove();
}

function fn_deleteFile(fileid, fileIdntfcKey){
debugger;
    var deleteFileUrl="/deleteFile.do?fileid="+fileid+"&file_idntfc_key=" + fileIdntfcKey;
      $.ajax({
        url : deleteFileUrl,
        type: 'GET',
        cache : false,
        dataType: 'json',
        success : function (data){
            console.log(data);
            if(data.result=="success"){
                $("#"+fileid).remove();
                alert("파일삭제가 완료 되었습니다.");
            }else{
                alert("파일삭제중 에러가 발생하였습니다. 관리자에게 문의 부탁드립니다.");
            }
        },
        error : function (error){
        }
     })
};


fn_sftyMngFrmInit();
</script>