<style>
.hide
{
   display:none;
}
.select-calendar-color
{
  background-color: #0ac282 !important;
}
/* 일요일_빨간색 */
.fc-sun .fc-day-number {
  color: red;
  text-decoration: none;
}
/* 토요일_파란색 */
.fc-sat .fc-day-number {
  color: blue;
  text-decoration: none;
}
.fc-unthemed td.fc-today {
  background-color : #fcf8e3 !important;
}
.fc-content .fc-title {
    padding: 0 1px;
    white-space: normal;
}
</style>

<form id="sprtgrpCalenderFrm">
   <div class="modal-dialog modal-lg" role="document">
       <div class="modal-content type_2">
           <div class="modal-header">
               <h4 class="modal-title">지원단 캘린더</h4>
               <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                   <span aria-hidden="true"></span>
               </button>
           </div>
           <div class="modal-body">
               <div class="card m-b-10">
                   <div class="card-block-small">
                       <div class="col-12">
<!--                            <div id="calendar"></div> -->
                           <div class="calendar-body" id="calendar">

                       </div>
                   </div>
               </div>
           </div>
           <div class="modal-footer">
               <button type="button" class="btn btn-primary waves-effect waves-light ">저장</button>
           </div>
       </div>
   </div>
</form>

<!-- Calender css -->
<link rel="stylesheet" type="text/css" href="/files/bower_components/fullcalendar/dist/fullcalendar.css">
<link rel="stylesheet" type="text/css" href="/files/bower_components/fullcalendar/dist/fullcalendar.print.css" media="print">
<!-- calender js -->
<script type="text/javascript" src="/files/bower_components/moment/min/moment.min.js"></script>
<script type="text/javascript" src="/files/bower_components/fullcalendar/dist/fullcalendar.min.js"></script>

<script th:inline="javascript">

var limitDt ;
var today = moment();
var today = today.format('YYYYMMDD')
var checkDays =[];
var sttsArr=[];

$(function(){

	$("#calendar") .on("mouseover","[name=vstSchdl]",function(e) {
		var trgtId = e.currentTarget.id;
		$("#"+trgtId).children().last().attr("style","display:show")

    });

	$("#calendar") .on("mouseout","[name=vstSchdl]",function(e) {
        var trgtId = e.currentTarget.id;
        $("#"+trgtId).children().last().attr("style","display:none");
    });


    initFullCalendar();
    makeCalendarEvent();



});

$(".checkDay").bind("change",function(){
    checkDaysStts();
})

function initFullCalendar(){

    $('#calendar').fullCalendar({

        plugins : [ 'interaction', 'dayGrid',  'resourceTimeline' ],
        locale : 'ko',
        defaultView : 'month',
        defaultDate : moment(new Date()),
        editable : false,
        disable : false,
        droppable: false,
        eventLimit: 4,
        displayEventTime: true,
        firstDay: 0,
        fixedWeekCount :false ,
        height: "auto",
        //contentHeight    : "1500px",
        monthNames      : ["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],
        monthNamesShort : ["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],
        dayNames        : ["일요일","월요일","화요일","수요일","목요일","금요일","토요일"],
        dayNamesShort   : ["일","월","화","수","목","금","토"],
        header : {

            left   : '',
            center : 'CustomPrevButton title CustomNextButton ',
            right  : ''

        },
        eventLimitText: "건 더보기",
        views: {month: {titleFormat: 'YYYY년 M월'}},

        customButtons: {
            CustomPrevButton: {
              click: function() {
                    $('#calendar').fullCalendar("prev");
                    makeCalendarEvent();

              },
              icon:"left-single-arrow",
            },
            CustomNextButton: {
              click: function() {
                    $('#calendar').fullCalendar("next");
                    makeCalendarEvent();
              },
              icon:"right-single-arrow",
            }
        },

        dayClick: function(date, jsEvent, view) {

//             if($(jsEvent.target).attr("for")){
//                 //체크 박스 이벤트 중복 방지
//                 return false;
//             }else{
//                 var chkDay = moment(date).format("YYYY-MM-DD")
//                 if($("#rsvt_stts"+chkDay).val()=='N'){
//                     singleChoiceModal(chkDay);
//                 }
//             }
        },

        eventRender:function (event,element){
        	debugger;
        	element.popover({
                title: $('<div />', {
                  class: 'popoverTitleCalendar',
                  text: event.title
                }).css({
                  'background': "#fcf8e3",
                  'color': 'white'
                }),
                content: $('<div />', {
                    class: 'popoverInfoCalendar'
                  })//.append('<p><strong>등록자:</strong> ' + event.id + '</p>')
//                   .append('<p><strong>구분:</strong> ' + event.type + '</p>')
//                   .append('<p><strong>시간:</strong> ' + getDisplayEventDate(event) + '</p>')
                  .append('<div class="popoverDescCalendar"><b>' + event.title + '</b></div>'),
                /*delay: {
                      show: "800",
                      hide: "50"
                },*/
                trigger: 'hover',
                placement: 'top',
                html: true,
                container: 'body'
              });
          },
          eventPositioned: function(info){
                $(".fc-event-container").on('click', 'div', function (e) {
                    $('.area').css("background-color", '#FFFFFF'); //기존 이벤트제목 배경색 투명처리.
                    $(this).addClass('area');//배경색을 입힐 타겟 지정용 클래스명 삽입.
                    $(this).css("background-color", '#F3F781'); //현재 클릭된 요소의 배경색 변경처리.
                  });
           },

        eventClick: function(calEvent, jsEvent, view) {
        	 $('.select-calendar-color').each(function() {
                 $(this).removeClass("select-calendar-color");
             });
             $(this).toggleClass('select-calendar-color');
             eventClickSelectItem = calEvent.id;

        },
    });
}

function makeCalendarEvent(gotoYYYYMM){

    $("#calendar").fullCalendar('removeEvents');

    var yyyymm_string = moment($("#calendar").fullCalendar("getDate")).format("YYYY-MM")

    var lastDayOfMonth = "";

    if(gotoYYYYMM != null && gotoYYYYMM != '' && gotoYYYYMM != 'undefined'){
        lastDayOfMonth = moment(gotoYYYYMM, "YYYYMM").daysInMonth();
        yyyymm_string  = moment(gotoYYYYMM, "YYYY-MM")
    }else{
        lastDayOfMonth = moment(yyyymm_string, "YYYY-MM").daysInMonth();
    }

    var params = {
    	 searchAplyStartDt : yyyymm_string+"-01"
        ,searchAplyEndDt   : yyyymm_string+"-"+lastDayOfMonth
    }

    if(displayWorkProgress()){
        $.ajax({
            url : "/mng/asgsSrng/selectSprtgrpClndrList.do",
            type: 'POST',
            cache : false,
            dataType: 'json',
            data : params,
            success : function (data){
                let list = data.list;

                if(list.length > 0){

                    var schdul_events = { events: []};
                    var idx=1;

                    list.forEach(function(item,index){

                    	schdul_events.events.push({
                            //title: item.prgrmNm
                            title           : item.vstHr+':'+item.vstMnt+' '+item.nm
                          , start           : item.vstDe
                          , end             : item.vstDe
//                           , borderColor     :"#FC6180"
//                           , backgroundColor :"#fcf8e3"
//                           , textColor       :"#FFF"
                          , prgrmNm         :item.prgrmNm
                          , instNm          :item.instNm
                          , vstDe           :item.vstDe
                          , sprtgrpNmAcnt   :item.sprtgrpNmAcnt
                        });
/*
                    	var de = item.vstDe.replaceAll("-","");
                        var vHtml ="";

                        vHtml +='<a href="javascript:void(0);" id="vstSchdl'+item.vstDe+idx+'" name="vstSchdl" class="fc-day-grid-event fc-h-event fc-event fc-start fc-end fc-draggable" style="background-color: #FC6180; border-color: #FC6180; color: #fff">'
                        vHtml +='    <div class="fc-content">                                                                                                                        '
                        vHtml +='        <span class="fc-title">'+item.vstHr+':'+item.vstMnt+' '+item.nm+'</span>                                                                    '
                        vHtml +='    </div>                                                                                                                                          '
                        vHtml +='<div class="col-auto border p-2 bg-white pos-absolute rounded" style="display: none;">'
                        vHtml +='    <span>*'+item.prgrmNm      +' </span>'
                        vHtml +='    <span>*'+item.instNm       +' </span>'
                        vHtml +='    <span>*'+item.vstDe        +' </span>'
                        vHtml +='    <span>*'+item.sprtgrpNmAcnt+' </span>'
                        vHtml +='</div>'
                        vHtml +='</a>                                                                                                                                                '

                        $("#calendarDay"+de).append(vHtml);
                        idx++;
                    	*/
                    })


                    $("#calendar").fullCalendar('removeEventSources');
                    $("#calendar").fullCalendar('addEventSource', schdul_events);
                }

                closeWorkProgress();
            }
        });
    }

}
</script>