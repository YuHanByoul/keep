<form id="ldrQlfcFrm">
    <input type="hidden"  id="prgrmid" name="prgrmid" th:value="${snrstfdvlprHstry.prgrmid}" />
    <input type="hidden"  id="hstryid" name="hstryid" th:value="${snrstfdvlprHstry.hstryid}" />
    <div class="card-header p-t-0 p-b-0">
        <h3 class="sub-title">
            <strong>지도자 현황</strong>
        </h3>
    </div>
    <div class="card-block-small p-t-0">
        <div class="col-12 table-border-style">
            <div class="col-12 table-responsive">
                <table class="table table-framed">
                    <thead>
                        <tr>
                            <th class="text-center">구분</th>
                            <th class="text-center">성명</th>
                            <th class="text-center">대체 프로그램명</th>
                            <th class="text-center" style="width: 117px;">설정</th>
                        </tr>
                    </thead>
                    <tbody id="ldrTbody"></tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="card-header p-t-0 p-b-0">
        <h3 class="sub-title">
            <strong>책임개발자 지도자 자격(기본정보)</strong>
        </h3>
    </div>
    <div class="card-block-small p-t-0" id="hstryDiv">
        <div class="row">
            <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                <div class="mb-0 form-group row">
                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="nm"><strong>성명</strong></label>
                    <div class="col-12">
                        <input type="text" class="form-control form-control-sm" maxlength="60" name="nm" id="nm" placeholder="" th:value="${snrstfdvlprHstry.nm}"/>
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-6">
                <div class="mb-0 form-group row">
                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="brdt"><strong>생년월일</strong></label>
                    <div class="col-auto">
                        <input type="date" class="form-control form-control-sm" name="brdt" id="brdt" placeholder="" th:value="${snrstfdvlprHstry.brdt}"/>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="card-header p-t-0 p-b-0">
        <h3 class="sub-title">
            <strong>책임개발자 지도자 자격(환경교육관련 학력사항)</strong>
        </h3>
    </div>
    <div class="card-block-small p-t-0">
        <div class="col-12 table-border-style">
            <div class="col-12 table-responsive">
                <table class="table table-framed table-bordered">
                    <thead>
                        <tr class="border-bottom-inverse">
                            <th class="text-center" style="width: 60px;">No</th>
                            <th class="text-center" style="width: 130px;">시작일</th>
                            <th class="text-center" style="width: 130px;">종료일</th>
                            <th class="text-center">학교명</th>
                            <th class="text-center">전공</th>
                            <th class="text-center">학위</th>
                            <th class="text-center" style="width: 117px;">설정</th>
                        </tr>
                    </thead>
                    <tbody id="acbgTbody"></tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="card-header p-t-0 p-b-0">
        <h3 class="sub-title">
            <strong>책임개발자 지도자 자격(환경교육관련 자격사항)</strong>
        </h3>
    </div>
    <div class="card-block-small p-t-0">
        <div class="col-12 table-border-style">
            <div class="col-12 table-responsive">
                <table class="table table-framed table-bordered">
                    <thead>
                        <tr class="border-bottom-inverse">
                            <th class="text-center" style="width: 60px;">No</th>
                            <th class="text-center">자격명</th>
                            <th class="text-center">급수</th>
                            <th class="text-center" style="width: 130px;">취득일</th>
                            <th class="text-center">발령청</th>
                            <th class="text-center" style="width: 117px;">설정</th>
                        </tr>
                    </thead>
                    <tbody id="qlfcTbody"></tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="card-header p-t-0 p-b-0">
        <h3 class="sub-title">
            <strong>책임개발자 지도자 자격(환경교육관련 경력사항)</strong>
        </h3>
    </div>
    <div class="card-block-small p-t-0">
        <div class="col-12 table-border-style">
            <div class="col-12 table-responsive">
                <table class="table table-framed table-bordered">
                    <thead>
                        <tr class="border-bottom-inverse">
                            <th class="text-center" style="width: 60px;">No</th>
                            <th class="text-center" style="width: 130px;">시작일</th>
                            <th class="text-center" style="width: 130px;">종료일</th>
                            <th class="text-center">활동(기관)명</th>
                            <th class="text-center">활동유형</th>
                            <th class="text-center" style="width: 117px;">설정</th>
                        </tr>
                    </thead>
                    <tbody id="careerTbody"></tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="card-block-small">
        <button type="button" class="btn btn-inverse m-r-5" onclick="gridHelper1.toggleContent()">목록</button>
        <button type="button" class="btn btn-primary m-r-5" onclick="ldrQlfc.doSave()" >저장</button>
        <button type="button" class="btn btn-primary"       onclick="ldrQlfc.doSave('next')" >다음</button>
    </div>
</form>
<script th:inline="javascript">
    /*<![CDATA[*/
    var snrstfdvlprHstry = /*[[${snrstfdvlprHstry}]]*/null;     //책임개발자 이력 조회
    /*]]>*/
    /*<![CDATA[*/
    var ldrList = /*[[${ldrList}]]*/null;    //책임개발자 목록 조회
    /*]]>*/
    /*<![CDATA[*/
    var acbgList = /*[[${acbgList}]]*/null;    //책임개발자 학력사항 목록 조회
    /*]]>*/
    /*<![CDATA[*/
    var qlfcList = /*[[${qlfcList}]]*/null;    //책임개발자 자격사항 목록 조회
    /*]]>*/
    /*<![CDATA[*/
    var careerList = /*[[${careerList}]]*/null;    //책임개발자 경력사항 목록 조회
    /*]]>*/1

    var ldrQlfc = {

        init() {
            this.setList("ldr");
            this.setList("acbg");
            this.setList("qlfc");
            this.setList("career");

        },

        setList(listNm){
          var lst;
          switch (listNm) {
            case 'ldr':
              lst = ldrList;
                lst.forEach((row) => this.ldrAdd(row));
              break;
            case 'acbg':
              lst = acbgList;
                lst.forEach((row) => this.acbgAdd(row));
              break;
            case 'qlfc':
              lst = qlfcList;
                lst.forEach((row) => this.qlfcAdd(row));
              break;
            case 'career':
              lst = careerList;
                lst.forEach((row) => this.careerAdd(row));
              break;
            default:
              console.log('none case');
          }
        },

        ldrAdd(row){
          var se     = row?.se     ?? "";
          var nm     = row?.nm     ?? "";
          var taskCn = row?.taskCn ?? "";
          var idx = $("[id^=ldrTr]").length + 1;

          var htmlTr=`
              <tr id="ldrTr${idx}">
                  <td><input type='text' maxlength='60' class='form-control form-control-sm' name='se'     id='se'     placeholder='' value='${se}' /></td>
                  <td><input type='text' maxlength='60' class='form-control form-control-sm' name='nm'     id='nm'     placeholder='' value='${nm}' /></td>
                  <td><input type='text' maxlength='100' class='form-control form-control-sm' name='taskCn' id='taskCn' placeholder='' value='${taskCn}' /></td>
                  <td>
                      <div class='btn-group-sm'>
                          <button type='button' class='btn btn-primary m-r-5' onclick='ldrQlfc.ldrAdd()'>추가</button>
                          ${idx!=1 ? `<button type='button' class='btn btn-inverse' onclick='ldrQlfc.ldrDel(${idx})'>삭제</button>`:``}
                     </div>
                  </td>
               </tr>
               `
            $("#ldrTbody").append(htmlTr);
        },

        ldrDel(idx){
          $("#ldrTr"+idx).remove();
        },

        acbgAdd(row){
          var bgngDe = row?.bgngDe ?? "";
          var endDe  = row?.endDe  ?? "";
          var schlNm = row?.schlNm ?? "";
          var mjr    = row?.mjr    ?? "";
          var dgr    = row?.dgr    ?? "";
          var idx = $("[id^=acbgTr]").length + 1;

          var htmlTr=`
            <tr id="acbgTr${idx}">
                        <td class="v-middle text-center">${idx}</td>
                        <td><input type="date" class="form-control form-control-sm" name="bgngDe${idx}" id="bgngDe${idx}" placeholder="" value="${bgngDe}" /></td>
                        <td><input type="date" class="form-control form-control-sm" name="endDe${idx}"  id="endDe${idx}"  placeholder="" value="${endDe}" /></td>
                        <td><input type="text" maxlength='60' class="form-control form-control-sm" name="schlNm${idx}" id="schlNm${idx}" placeholder="" value="${schlNm}"/></td>
                        <td><input type="text" maxlength='10' class="form-control form-control-sm" name="mjr${idx}"    id="mjr${idx}"    placeholder="" value="${mjr}"/></td>
                        <td><input type="text" maxlength='10' class="form-control form-control-sm" name="dgr${idx}"    id="dgr${idx}"    placeholder="" value="${dgr}"/></td>
                        <td>
                            <div class="btn-group-sm">
                                <button type="button" class="btn btn-primary m-r-5"onclick='ldrQlfc.acbgAdd()'>추가</button>
                                ${idx!=1 ?`<button type='button' class='btn btn-inverse' onclick='ldrQlfc.acbgDel(${idx})'>삭제</button>`:``}
                     </div>
                  </td>
               </tr>
               `
            $("#acbgTbody").append(htmlTr);
        },

        acbgDel(idx){
          $("#acbgTr"+idx).remove();
        },

        qlfcAdd(row){
          var qlfcNm = row?.qlfcNm ?? "";
          var grd    = row?.grd    ?? "";
          var acqsDe = row?.acqsDe ?? "";
          var wrkplc = row?.wrkplc ?? "";
          var idx    = $("[id^=qlfcTr]").length + 1;

          var htmlTr=`
            <tr id="qlfcTr${idx}">
                <td class="v-middle text-center">2</td>
                <td><input type="text" maxlength='100' class="form-control form-control-sm" name="qlfcNm${idx}" id="qlfcNm${idx}" placeholder="" value="${qlfcNm}" /></td>
                <td><input type="text" maxlength='60' class="form-control form-control-sm" name="grd${idx}"    id="grd${idx}"    placeholder="" value="${grd}" /></td>
                <td><input type="date" class="form-control form-control-sm" name="acqsDe${idx}" id="acqsDe${idx}" placeholder="" value="${acqsDe}" /></td>
                <td><input type="text" maxlength='60' class="form-control form-control-sm" name="wrkplc${idx}" id="wrkplc${idx}" placeholder="" value="${wrkplc}" /></td>
                <td>
                    <div class="btn-group-sm">
                        <button type="button" class="btn btn-primary m-r-5"onclick='ldrQlfc.qlfcAdd()'>추가</button>
                        ${idx!=1 ? `<button type='button' class='btn btn-inverse' onclick='ldrQlfc.qlfcDel(${idx})'>삭제</button>`:``}
                    </div>
                </td>
           </tr>
           `
            $("#qlfcTbody").append(htmlTr);

        },

        qlfcDel(idx){
          $("#qlfcTr"+idx).remove();
        },

        careerAdd(row){
          var bgngDe    = row?.bgngDe    ?? "";
          var endDe     = row?.endDe     ?? "";
          var actvtNm   = row?.actvtNm   ?? "";
          var actvtType = row?.actvtType ?? "";
          var idx       = $("[id^=careerTr]").length + 1;

          var htmlTr=`
            <tr id="careerTr${idx}">
                  <td class="v-middle text-center">1</td>
                  <td><input type="date" class="form-control form-control-sm" name="bgngDe${idx}"    id="bgngDe${idx}"    placeholder="" value="${bgngDe}"    /></td>
                  <td><input type="date" class="form-control form-control-sm" name="endDe${idx}"     id="endDe${idx}"     placeholder="" value="${endDe}"     /></td>
                  <td><input type="text" maxlength='60' class="form-control form-control-sm" name="actvtNm${idx}"   id="actvtNm${idx}"   placeholder="" value="${actvtNm}"   /></td>
                  <td><input type="text" maxlength='60' class="form-control form-control-sm" name="actvtType${idx}" id="actvtType${idx}" placeholder="" value="${actvtType}" /></td>
                  <td>
                      <div class="btn-group-sm">
                          <button type="button" class="btn btn-primary m-r-5"onclick='ldrQlfc.careerAdd()'>추가</button>
                          ${idx!=1 ? `<button type='button' class='btn btn-inverse' onclick='ldrQlfc.careerDel(${idx})'>삭제</button>`:``}
                    </div>
                </td>
           </tr>
           `
            $("#careerTbody").append(htmlTr);
        },

        careerDel(idx){
          $("#careerTr"+idx).remove();
        },

        doSave(call){
        	var param={};

            if(!confirm("저장하시겠습니까?")) return;

            $("#ldrQlfcFrm #ldrTbody [id^=se           ]").each(function(index,item){ param["ldrLst["+index+"].se"] = item.value; });
            $("#ldrQlfcFrm #ldrTbody [id^=nm           ]").each(function(index,item){ param["ldrLst["+index+"].nm"] = item.value; });/** 이름 */
            $("#ldrQlfcFrm #ldrTbody [id^=taskCn       ]").each(function(index,item){ param["ldrLst["+index+"].taskCn"] = item.value; });/** 업무 내용 */
            $("#ldrQlfcFrm #ldrTbody [id^=snrstfdvlprYn]").each(function(index,item){ param["ldrLst["+index+"].snrstfdvlprYn"] = item.value; });/** 책임개발자 여부 */

            //학력
            $("#ldrQlfcFrm #acbgTbody [id^=acbgid]").each(function(index,item){ param["acbgLst["+index+"].acbgid"] = item.value; });/** 학력아이디 */
            $("#ldrQlfcFrm #acbgTbody [id^=bgngDe]").each(function(index,item){ param["acbgLst["+index+"].bgngDe"] = item.value; });/** 시작 일자 */
            $("#ldrQlfcFrm #acbgTbody [id^=endDe]").each(function(index,item){ param["acbgLst["+index+"].endDe"] = item.value; });/** 종료 일자 */
            $("#ldrQlfcFrm #acbgTbody [id^=schlNm]").each(function(index,item){ param["acbgLst["+index+"].schlNm"] = item.value; });/** 학교 이름 */
            $("#ldrQlfcFrm #acbgTbody [id^=mjr]").each(function(index,item){ param["acbgLst["+index+"].mjr"] = item.value; });/** 전공 */
            $("#ldrQlfcFrm #acbgTbody [id^=dgr]").each(function(index,item){ param["acbgLst["+index+"].dgr"] = item.value; });/** 학위 */

            //이력
            param["prgrmid"]= $("#ldrQlfcFrm #prgrmid").val();
            param["hstryid"]= $("#ldrQlfcFrm #hstryid").val();
            param["nm"]= $("#hstryDiv #nm").val();
            param["brdt"]= $("#hstryDiv #brdt").val();

            //자격
            $("#ldrQlfcFrm #qlfcTbody [id^=qlfcNm]").each(function(index,item){ param["qlfcLst["+index+"].qlfcNm"] = item.value; });    /** 자격 아이디 */
            $("#ldrQlfcFrm #qlfcTbody [id^=grd]   ").each(function(index,item){ param["qlfcLst["+index+"].grd"   ] = item.value; });    /** 급수 */
            $("#ldrQlfcFrm #qlfcTbody [id^=acqsDe]").each(function(index,item){ param["qlfcLst["+index+"].acqsDe"] = item.value; });    /** 취득일자 */
            $("#ldrQlfcFrm #qlfcTbody [id^=wrkplc]").each(function(index,item){ param["qlfcLst["+index+"].wrkplc"] = item.value; });    /** 발령청*/

            //경력
            $("#ldrQlfcFrm #careerTbody [id^=bgngDe   ]").each(function(index,item){ param["careerLst["+index+"].bgngDe"] = item.value; });    /** 시작일 */
            $("#ldrQlfcFrm #careerTbody [id^=endDe    ]").each(function(index,item){ param["careerLst["+index+"].endDe"] = item.value; });    /** 종료일 */
            $("#ldrQlfcFrm #careerTbody [id^=actvtNm  ]").each(function(index,item){ param["careerLst["+index+"].actvtNm"] = item.value; });    /** 활동명 */
            $("#ldrQlfcFrm #careerTbody [id^=actvtType]").each(function(index,item){ param["careerLst["+index+"].actvtType"] = item.value; });    /** 활동 유형 */

            $.ajax({
                url : "/mng/asgsysSrng/insertPrgrmLdrQlfc.do",
                type: 'POST',
                cache : false,
                dataType: 'json',
                data : param,
                success : function (data){
                    if(data.result=="success"){
                        alert(data.msg);

                        if(call=='next'){

                        	$('[id^=jdsgTab]').removeClass('active')
                            $("#jdsgTab5Link").addClass("active");
                            var prgrmid = $("#prgrmid").val();
                            var url = "/mng/asgsysSrng/sftyMngForm.html?prgrmid="+prgrmid;
                            loadJdsgTabContent(url);

                        }else{
                        	var url = "/mng/asgsysSrng/ldrQlfcForm.html?prgrmid="+prgrmid;
                            loadJdsgTabContent(url);
                        }

                    }else{
                        alert("저장중 에러가 발생하였습니다. 관리자에게 문의 부탁드립니다.");
                    }
                },
                error : function (error){

                }
            })
        }
    }

    $(function() {
      ldrQlfc.init()
    });

</script>
