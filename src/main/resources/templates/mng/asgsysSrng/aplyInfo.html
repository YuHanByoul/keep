<form id="aplyFrm">
<input type="hidden" id="prgrmid"      name="prgrmid"      th:value="${dsgnAplyInfo.prgrmid}">
<input type="hidden" id="instid"       name="instid"       th:value="${dsgnAplyInfo.instid}">
<input type="hidden" id="acnt"         name="acnt"         th:value="${dsgnAplyInfo.acnt}">
<input type="hidden" id="splmntDmndid" name="splmntDmndid" th:value="${dsgnAplyInfo.splmntDmndid}">

    <div class="tab-pane active" id="applyInfo" role="tabpanel">
        <div class="card-header p-t-0 p-b-0">
            <h3 class="sub-title"><strong>신청기관 정보</strong></h3>
        </div>
        <div class="card-block-small p-t-0 p-b-0">
            <div class="mb-2 row">
                <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="applyInfoProgramName"><strong>프로그램명</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" name="prgrmNm" id="prgrmNm" placeholder="Text Input Validation" th:value="${dsgnAplyInfo.prgrmNm}" readonly/>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-6">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="applyInfoAgencyName"><strong>기관명</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" name="applyInfoAgencyName" id="applyInfoAgencyName" placeholder="Text Input Validation" th:value="${dsgnAplyInfo.instNm}"  readonly/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-2 row">
                <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                    <div class="mb-0 form-group">
                        <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>기관유형</strong></div>
                        <div class="col-12">
                            <span kattr:select_code="instTypeCd" th:attr="grpCd=108,selectedCd=${dsgnAplyInfo.instTypeCd}" firstOptTxt="- 전체 -" addClass="form-select form-select-sm form-control-sm" isAdmin="true" isDisable/>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-6">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="applyInfoRepresentativeName"><strong>대표자명</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" name="applyInfoRepresentativeName" id="applyInfoRepresentativeName" placeholder="Text Input Validation" th:value="${dsgnAplyInfo.prgrmNm}"  readonly/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-2 row">
                <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="applyInfoApplicant"><strong>신청자</strong></label>
                        <div class="col-12 row">
                            <div class="col-8">
                                <input type="text" class="form-control form-control-sm" name="aplcntNm" id="aplcntNm" placeholder="Text Input Validation" th:value="${dsgnAplyInfo.aplcntNm}" readonly/>
                            </div>
                            <div class="col-4 btn-group-sm">
                                <button type="button" class="btn btn-inverse" onclick="openChgAltmntModal()">담당자 변경</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-6">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="applyInfoManagerPhoneNum"><strong>담당자연락처</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" name="applyInfoManagerPhoneNum" id="applyInfoManagerPhoneNum" placeholder="Text Input Validation" th:value="${dsgnAplyInfo.aplcntMoblphon}" readonly/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-2 row">
                <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="applyInfoManagerEmail"><strong>담당자 이메일</strong></label>
                        <div class="col-12">
                            <input type="text" class="form-control form-control-sm" name="applyInfoManagerEmail" id="applyInfoManagerEmail" placeholder="Text Input Validation" th:value="${dsgnAplyInfo.aplcntEml}" readonly/>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-6">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="applyInfoBusinessNum"><strong>사업자등록번호</strong></label>
                        <div class="col-12">
                            <input type="text" class="form-control form-control-sm" name="brno" id="brno" placeholder="Text Input Validation" th:value="${dsgnAplyInfo.brno}" readonly/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-2 row">
                <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="applyInfoAgencyEmail"><strong>기관 이메일</strong></label>
                        <div class="col-12">
                            <input type="text" class="form-control form-control-sm" name="applyInfoAgencyEmail" id="applyInfoAgencyEmail" placeholder="Text Input Validation" th:value="${dsgnAplyInfo.instEml}" readonly/>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-6">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="applyInfoAgencyPhoneNum"><strong>기관 연락처</strong></label>
                        <div class="col-12">
                            <input type="text" class="form-control form-control-sm" name="applyInfoAgencyPhoneNum" id="applyInfoAgencyPhoneNum" placeholder="Text Input Validation" th:value="${dsgnAplyInfo.instCntct}" readonly/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-2 row">
                <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                    <div class="mb-0 form-group">
                        <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>지역</strong></div>
                        <div class="col-12">
                            <span kattr:select_code="rgnCd" th:attr="grpCd=125,selectedCd=${dsgnAplyInfo.rgnCd}" firstOptTxt="- 전체 -" addClass="form-select form-select-sm form-control-sm" isAdmin="true" isDisable>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-6">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="applyInfoAgencyHomePage"><strong>기관 홈페이지</strong></label>
                        <div class="col-12">
                            <input type="text" class="form-control form-control-sm" name="applyInfoAgencyHomePage" id="applyInfoAgencyHomePage" placeholder="Text Input Validation" th:value="${dsgnAplyInfo.instHmpg}" readonly/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-2 row">
                <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="agencyAddress"><strong>기관주소</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" name="agencyAddress" id="agencyAddress" placeholder="Text Input Validation" th:value="${dsgnAplyInfo.instAddr}" readonly/>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-6">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="agencyDetailAddress"><strong>상세주소</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" name="agencyDetailAddress" id="agencyDetailAddress" placeholder="Text Input Validation" th:value="${dsgnAplyInfo.instDtladdr}" readonly/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-2 row">
                <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                    <div class="mb-0 form-group">
                        <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>증빙서류</strong></div>

                        <div class="mb-2 col-12">
                            <input type="file" multiple id="evdncDcmntFile" name="evdncDcmntFile" class="form-control form-control-sm"/>
                        </div>

                        <div class="row">

                            <div class="col-auto" id="fileListArea">
                                <!-- 파일 명 및 삭제 버튼 영역-->
                                <th:block th:if = "${fileList} != null" >
                                    <th:block th:each="item:${fileList}" th:if = "${item.fileid} > 0">
                                        <span class ='label label-inverse ' th:id="'file_'+${item.fileid}">
                                            <th:block th:text="${item.orginlFileNm}"></th:block>&nbsp;&nbsp;
                                            <a  class = 'text-white' href = "javascript:void(0)" th:name="${item.fileid}" th:attr="data-idntfc-key=${item.fileIdntfcKey}" th:onclick="fn_deleteFile(this.name, this.dataset.idntfcKey)">X</a>
                                        </span>
                                    </th:block>
                                </th:block>
                            </div>


                        </div>
                    </div>

                </div>
            </div>


            <div class="col-12 col-lg-6">
                <div class="mb-0 form-group">
                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>진행상태</strong></div>
                    <div class="col-12">
                        <span kattr:select_code="sttsCd" th:attr="grpCd=111,selectedCd=${dsgnAplyInfo.sttsCd}" firstOptTxt="- 전체 -" addClass="form-select form-select-sm form-control-sm" isAdmin="true">
                    </div>
                </div>
            </div>
        </div>

        <div class="card-block-small">
            <button type="button" class="btn btn-primary m-r-5" onclick="fn_updateSttsReqsRvw()"  >요건검토중 상태변경</button>
            <button type="button" class="btn btn-primary m-r-5" id="dcmntDmnd" onclick="fn_reqSplmntDmndBtn(this.id)"   >서류요청</button>
            <button type="button" class="btn btn-primary m-r-5" onclick="fn_jdgsSrngDmnd()"       >심사위원심사 요청</button>
            <button type="button" class="btn btn-primary"       onclick="fn_sprtgrpSrngDmnd()"    >지원단심사 요청</button>
        </div>
        <div class="card-header p-t-0 p-b-0">
            <h3 class="sub-title"><strong>심사위원 배정 정보</strong></h3>
        </div>
        <div class="card-block-small p-t-0">
            <div class="mb-0 form-group row">
                <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>담당자 배정</strong></div>
                <div class="col-sm-12 btn-group-sm">
                    <button type="button" class="btn btn-inverse" onclick="openPicChgModal()">담당자 검색</button>
                </div>

                <div class="m-0 row">
                    <div class="col-12 row border rounded p-t-10 p-b-10 m-0 mt-2">
                        <div id="jdgsPicList" class="col-auto"></div>
                    </div>
                </div>

            </div>
        </div>
        <div class="card-header p-t-0 p-b-0">
            <h3 class="sub-title"><strong>지원단 배정 정보</strong></h3>
        </div>
        <div class="card-block-small p-t-0">
            <div class="mb-0 form-group row">
                <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>담당자 배정</strong></div>
                <div class="col-sm-12 btn-group-sm">
                    <button type="button" class="btn btn-inverse" onclick="openPicChgModal('Y')">담당자 검색</button>
                </div>

                <div class="m-0 row">
                    <div class="col-12 row border rounded p-t-10 p-b-10 m-0 mt-2">
                        <div id="sprtgrpPicList" class="col-auto"></div>
                    </div>
                </div>

            </div>
        </div>

    </div>
</form>

<div class="card-header p-b-10">
    <ul class="nav nav-tabs tabs" role="tablist"><!-- [230125] nav-pills flex-column flex-lg-row -> nav-tabs tabs 탭 변경 (첫번째 탭 활성화) -->
        <th:block sec:authorize-url="/mng/asgsysSrng/prgrmDstnctn.html">
            <li class="nav-item flex-lg-fill text-center"><a class="nav-link" data-bs-toggle="tab" id="jdsgTab1Link" href="#jdsgTab1" role="tab" ><strong>프로그램 우수성</strong></a></li>
        </th:block>
        <th:block sec:authorize-url="/mng/asgsysSrng/prgrmOperMngForm.html">
            <li class="nav-item flex-lg-fill text-center"><a class="nav-link" data-bs-toggle="tab" id="jdsgTab2Link" href="#jdsgTab2" role="tab"><strong>프로그램 운영관리</strong></a></li>
        </th:block>
        <th:block sec:authorize-url="/mng/asgsysSrng/prgrmEvl.html">
            <li class="nav-item flex-lg-fill text-center"><a class="nav-link" data-bs-toggle="tab" id="jdsgTab3Link" href="#jdsgTab3" role="tab"><strong>프로그램 평가</strong></a></li>
        </th:block>
        <th:block sec:authorize-url="/mng/asgsysSrng/sftyMngForm.html">
            <li class="nav-item flex-lg-fill text-center"><a class="nav-link" data-bs-toggle="tab" id="jdsgTab5Link" href="#jdsgTab5" role="tab"><strong>안전관리</strong></a></li>
        </th:block>
        <th:block sec:authorize-url="/mng/asgsysSrng/assChklst.html">
            <li class="nav-item flex-lg-fill text-center"><a class="nav-link" data-bs-toggle="tab" id="jdsgTab6Link" href="#jdsgTab6" role="tab"><strong>체크리스트</strong></a></li>
        </th:block>
    </ul>
</div>


<!-- TAB CONTTENT -->
<div id="jdgsSprtgrpAltmntTabContent" class="tab-content tabs p-t-20"></div>

<!-- 담당자변경 회원검색 팝업 -->
<div class="modal fade" id="chgAltmntPopup" aria-hidden="true" data-bs-backdrop="static"></div>

<!-- 담당자변경 회원검색 팝업 -->
<div class="modal fade" id="picAltmntPopup" aria-hidden="true" data-bs-backdrop="static"></div>

<!--서류요청(보완요청)팝업-->
<div class="modal fade" id="splmntDmndPopup" aria-hidden="true" data-bs-backdrop="static"></div>

<input type="hidden" id="filegrpid" name="filegrpid" th:value="${dsgnAplyInfo.filegrpid == null or dsgnAplyInfo.filegrpid == ''}? 0: ${dsgnAplyInfo.filegrpid}"/>


<script th:inline="javascript">

var flieList= /*[[${fileList}]]*/null;
var dsgnAplyInfo= /*[[${dsgnAplyInfo}]]*/null;

//tabEvent
$('.nav-item a').on('show.bs.tab', function(event) {
    var tabId = event.currentTarget.attributes.id.value;
    console.log("############## tabId : " + tabId);

    selectJdsgTab(tabId);

});

//init
function initAplyInfoForm(){

    prgrmid = $("#prgrmid").val();

    $('#applyInfo').focus();
    $("#instTypeCd").attr("disabled", true);
    $("#rgnCd").attr("disabled", true);
    $("#sttsCd").attr("disabled", true);

    $("#aplcntNm").val($("#aplcntNm").val()+"("+$("#acnt").val()+ ")");

    initJdsgTab();
    setPic();

}

function selectJdsgTab(tabId) {

    if(tabId == "jdsgTab1Link") {
        loadJdsgTabContent("/mng/asgsysSrng/prgrmDstnctn.html?prgrmid=" + prgrmid);
    } else if(tabId == "jdsgTab2Link") {
        loadJdsgTabContent("/mng/asgsysSrng/prgrmOperMngForm.html?prgrmid=" + prgrmid);
    } else if(tabId == "jdsgTab3Link") {
        loadJdsgTabContent("/mng/asgsysSrng/prgrmEvl.html?prgrmid=" + prgrmid);
    } else if(tabId == "jdsgTab4Link") {
        loadJdsgTabContent("/mng/asgsysSrng/prgrmLdr.html?prgrmid=" + prgrmid);
    } else if(tabId == "jdsgTab5Link") {
        loadJdsgTabContent("/mng/asgsysSrng/sftyMngForm.html?prgrmid=" + prgrmid);
    } else if(tabId == "jdsgTab6Link") {
        loadJdsgTabContent("/mng/asgsysSrng/assChklst.html?prgrmid=" + prgrmid);
    }

    $("#" + tabId).parent().addClass("active");
}

function loadJdsgTabContent(uri) {

    $.ajax({
        cache   : false
      , url     : uri
      , type    : 'GET'
      , async   : 'false'
      , dataType: 'html'
      , success : function(result){ //요청이 성공했을때 실행되는 콜백 함수
                      $('#jdgsSprtgrpAltmntTabContent').html(result);

                      //scrollIntoView('jdgsSprtgrpAltmntTabContent');
                  }
    });
    ;
    showContent();
}

function initJdsgTab() {

    console.log("dsgnAplyDetailForm start");

    var tabFlag = false;

    if(tabFlag == false) {
        selectJdsgTab("jdsgTab1Link");
        tabFlag = true;
    }

    if(tabFlag == false) {
        selectJdsgTab("jdsgTab2Link");
        tabFlag = true;
    }

    if(tabFlag == false) {
        selectJdsgTab("jdsgTab3Link");
        tabFlag = true;
    }

    if(tabFlag == false) {
        selectJdsgTab("jdsgTab4Link");
        tabFlag = true;
    }

    if(tabFlag == false) {
        selectJdsgTab("jdsgTab5Link");
        tabFlag = true;
    }

    if(tabFlag == false) {
        selectJdsgTab("jdsgTab6Link");
        tabFlag = true;
    }
}

//보완요청 그리드
function writeSplmntDmndGridData(){

    $("#splmntDmndGrid").jsGrid({
        height       : "220px",
        width        : "100%",
        autoload     : true,
        sorting      : true,
        paging       : false,
        pageLoading  : true,
        pageIndex    : 1,
        noDataContent: "데이터가 없습니다.",
        controller: {
            loadData: function (filter) {
                var data = $.Deferred();

                var formData = $('#searchFrm').serializeArray();
                var params = [
                        {name: "pageNumber", value: filter.pageIndex},
                        {name: "rowPerPage", value: filter.pageSize},
                        {name: "prgrmid"   , value: prgrmid},
                ]

                params.push({name: "orderField", value: 'reg_dt'});

                formData = formData.concat(params);

                $.ajax({
                  type: "GET",
                  contentType: "application/json; charset=utf-8",
                  url: "/mng/asgsysSrng/selectSplmntDmndList.do",
                  dataType: "json",
                  data: formData
                }).done(function(response){

                    var da = {
                            data : escapeGridData(response.splmntDmndList)
                            ,itemsCount : response.totalCount
                        };
                  data.resolve(da);
                });
                return data.promise();
            },
        },
        fields: [
            { name : 'splmntDmndid', css:'hide'}
          , { name : 'prgrmid',      css:'hide'}
          , { title: 'No.'           ,name: 'rowNumber',   type: "number", width : "80", align:"center",  sorting :false }
          , { title: '등록 진행상태' ,name: 'sttsCd',      type: "text"  , width: "100", align:"center"}
          , { title: '요청내용'      ,name: 'opnnCn',      type: "text"  , width: "100", align:"left"}
          , { title: '요청일'        ,name: 'regDt',       type: "text"  , width: "100", align:"center" }
          , { title: '완료처리일'    ,name: 'cmptnPrcsDe', type: "text"  , align:"center" }
        ],

        rowClick: function(args) {

            if(args.event.originalEvent.target.cellIndex == 0 || isNaN(args.event.originalEvent.target.cellIndex)) return;

            if(args.event.originalEvent.target.cellIndex == 4) {

                var key = args.item.splmntdmndid;
                var cd  = args.item.sttsCd;
                openSplmntDmndModal(key, cd);

            }
        }
    });
}


//요건검토중 상태변경
//“요건검토중 상태변경”으로 변경되며, 사용자 페이지에서 신청자가 신청정보를 수정 불가하다.(제출취소 및 신청정보 수정 불가)
function fn_updateSttsReqsRvw(){

    if(!confirm("진행상태가 요건검토중로 변경됩니다. 변경 하시겠습니까?")){return;}

    var data = {
            "sttsCd"  : '111103'    // 요건검토중
          , "prgrmid" : prgrmid
    }

    $.ajax({
        url :"/mng/asgsysSrng/updateSttsCd.do",
        type: 'POST',
        cache : false,
        dataType: 'json',
        data : data,
        success : function (data){

            if(data.result=="success"){

                alert("진행상태가 변경 되었습니다.");
                gridHelper1.resetPageContent();

            }else{
                alert("진행상태변경중 에러가 발생하였습니다. 관리자에게 문의 부탁드립니다.");
            }
            closeWorkProgress();
        },
        error : function (error){
        }
    })
}


//담당자 변경
var chgAltmntModal;
var openChgAltmntModal = () => {

    var vInstid = $("#instid").val();

    var url = "/mng/asgsysSrng/mbrSrchPopup.html?prgrmid="+prgrmid+"&instid="+vInstid;    //회원검색

    $("#chgAltmntPopup").load(url, function(response, status, xhr) {
        if (status == "success") {
            chgAltmntModal = new bootstrap.Modal($('#chgAltmntPopup'));
            chgAltmntModal.show();
        }
    });

}
//담당자배정
var picAltmntModal;
var openPicChgModal = (modeYn) => {
    var mode = modeYn
    var url = "/mng/asgsysSrng/picAltmntPopup.html?mode="+mode;

    $("#picAltmntPopup").load(url, function(response, status, xhr) {
        if (status == "success") {
            picAltmntModal = new bootstrap.Modal($('#picAltmntPopup'));
            picAltmntModal.show();
        }
    });
}

//담당자 set
function setPic(){

    var idGrp       = null == dsgnAplyInfo.useridGrp       ? "" : dsgnAplyInfo.useridGrp.split(",");
    var emlGrp      = null == dsgnAplyInfo.userEmlGrp      ? "" : dsgnAplyInfo.userEmlGrp.split(",");
    var moblphonGrp = null == dsgnAplyInfo.userMoblphonGrp ? "" : dsgnAplyInfo.userMoblphonGrp.split(",");
    var nmGrp       = null == dsgnAplyInfo.userNmGrp       ? "" : dsgnAplyInfo.userNmGrp.split(",");
    var acntGrp     = null == dsgnAplyInfo.userAcntGrp     ? "" : dsgnAplyInfo.userAcntGrp.split(",");


    if(0 < idGrp.length){
        for(var i=0; i < idGrp.length; i++) {
            var content = "<span class='label label-inverse' id='picId-" + idGrp[i]
            content    += "' name='picInfo' id='"+idGrp[i]+"'>" + nmGrp[i] + "("+ acntGrp[i]+ ") | " + emlGrp[i] +" | " +moblphonGrp[i]
            content    += "&nbsp; <a href='javascript:void(0)' onclick='removePicInfo(" + idGrp[i]+ ")' class='text-white'>X</a> </span>";
            $("#jdgsPicList").append(content);    //심사위원
        }
    }

    if(dsgnAplyInfo.sprtgrpid != 0 && dsgnAplyInfo.sprtgrpid != "" && dsgnAplyInfo.sprtgrpid != null){
        var content = "<span class='label label-inverse' id='picId-" + dsgnAplyInfo.sprtgrpid
        content    += "' name='picInfo' id='"+dsgnAplyInfo.sprtgrpid+"'>" + dsgnAplyInfo.sprtgrpNm + "("+ dsgnAplyInfo.sprtgrpAcnt + ") | " + dsgnAplyInfo.sprtgrpEml +" | " + dsgnAplyInfo.sprtgrpMoblphon
        content    += "&nbsp; <a href='javascript:void(0)' onclick='removePicInfo(" + dsgnAplyInfo.sprtgrpid+ ")' class='text-white'>X</a> </span>";
        $("#sprtgrpPicList").append(content);    //지원단
    }
}

//담당자 삭제
function removePicInfo(userid){

    var data={};
    var picSe = $("#picId-"+userid).parent().prop("id");

    if("jdgsPicList"    == picSe ) data={ "prgrmid":prgrmid, "mode":"jdgs"    , "jdgsid"   :userid };
    if("sprtgrpPicList" == picSe ) data={ "prgrmid":prgrmid, "mode":"sprtgrp" , "sprtgrpid":userid };

    $.ajax({
        url :"/mng/asgsysSrng/deletePicInfo.do",
        type: 'POST',
        cache : false,
        dataType: 'json',
        data : data,
        success : function (data){

            if(data.result=="success"){


            	if("jdgsPicList"    == picSe ) alert("담당자(심사위원)가 삭제 되었습니다.");
            	if("sprtgrpPicList" == picSe ) alert("담당자(지원단)가 삭제 되었습니다.");

            	$("#picId-"+userid).remove();


            }else{
                //alert("진행상태변경중 에러가 발생하였습니다. 관리자에게 문의 부탁드립니다.");
            }
            closeWorkProgress();
        },
        error : function (error){
        }
    })

}


function fn_reqSplmntDmndBtn(id){

    var key = $("#splmntDmndid").val();
    var cd;
    var mode;

    //서류요청
    if("dcmntDmnd"==id){
        cd = "111104"
        mode = "splmntDmnd"
    }

    openSplmntDmndModal(key, cd, mode)

};

//보완요청 팝업 호출
var splmntDmndAddModal;
var openSplmntDmndModal = ( key, cd, mode) => {

    var vSttsCd = cd;
    var vMode = mode;
    var vKey1 = prgrmid;
    var vKey2 = key;

    debugger;
    if(vSttsCd == null || vSttsCd == "undefined" || vSttsCd == "") vSttsCd = '';

    var url = "/mng/asgsysSrng/splmntDmndPopup.html?prgrmid="+ vKey1+"&splmntDmndid=" + vKey2+ "&sttsCd="+vSttsCd+"&mode="+vMode;

    $("#splmntDmndPopup").load(url, function(response, status, xhr) {

        if (status == "success") {

            splmntDmndAddModal = new bootstrap.Modal($('#splmntDmndPopup'));
            splmntDmndAddModal.show();

        }
    });
}

//심사위원심사 요청
//“심사위원심사”로 변경되며, 심사위원 심사를 진행할 수 있다.
function fn_jdgsSrngDmnd(){

    //- 심사위원 배정이 안 되어 있을 경우
    if(1==2){
        alert("심사위원 배정이 되어 있지 않습니다. 심사위원 배정 후 심사위원심사 요청이 가능합니다.");
        return;
    }

    if(!confirm("진행상태가 심사위원심사로 변경됩니다. 변경 하시겠습니까?")){return;}

    var data = {
            "sttsCd"  : '111106'    //심사위원심사
          , "prgrmid" : prgrmid
    }

    $.ajax({
        url :"/mng/asgsysSrng/updateSttsCd.do",
        type: 'POST',
        cache : false,
        dataType: 'json',
        data : data,
        success : function (data){

            if(data.result=="success"){

                alert("진행상태가 변경 되었습니다.");
                gridHelper1.resetPageContent();


            }else{
                alert("진행상태변경중 에러가 발생하였습니다. 관리자에게 문의 부탁드립니다.");
            }
            closeWorkProgress();
        },
        error : function (error){
        }
    })

}

//지원단심사요청
//진행상태 항목값이 “지원단심사”로 변경되며, 지원단 심사를 진행할 수 있다.
function fn_sprtgrpSrngDmnd(){

    //- 지원단 배정이 안 되어 있을 경우
    if(1==2){
        alert("지원단 배정이 되어 있지 않습니다. 지원단 배정 후 지원단심사 요청이 가능합니다.");
        return;
    }

    if(!confirm("진행상태가 지원단심사로 변경됩니다. 변경 하시겠습니까?")){return;}

    var data = {
            "sttsCd"  : '111107'    //지원단심사
          , "prgrmid" : prgrmid
    }

    $.ajax({
        url :"/mng/asgsysSrng/updateSttsCd.do",
        type: 'POST',
        cache : false,
        dataType: 'json',
        data : data,
        success : function (data){

            if(data.result=="success"){

                alert("진행상태가 변경 되었습니다.");
                gridHelper1.resetPageContent();

            }else{
                alert("진행상태변경중 에러가 발생하였습니다. 관리자에게 문의 부탁드립니다.");
            }
            closeWorkProgress();
        },
        error : function (error){
        }
    })
}

//파일 첨부 (멀티 파일)
$('#evdncDcmntFile').on("change", function(event) {

   var objFile = document.querySelector('#evdncDcmntFile');
   var formData = new FormData();
   var content = "";
   var uploadFileCnt = 0;

   for( i = 0 ; i < objFile.files.length ; i++) {
       formData.append("files", objFile.files[i]);
       uploadFileCnt++;
   }

   var filegrpid = $("#filegrpid").val();

   formData.append("filegrpid", $("#filegrpid").val());
   formData.append("filegrpNm", "asgsysSrng_file");

       $.ajax({
           url : '/uploadMultipleFiles.do',
           processData : false,
           contentType : false,
           data : formData,
           type : 'POST',
           success : function(response) {

               if($("#filegrpid").val()=='0' || $("#filegrpid").val()==''  || $("#filegrpid").val()==null){
                   $("#filegrpid").val( response[0].filegrpid );
               }

               for(i = 0 ;i < response.length; i++ ){
                   content = "<span class ='label label-inverse mb-2' id='file_"+response[i].fileid+"'>"+response[i].orginlFileNm ;
                   content +="&nbsp;&nbsp;  <a  class = 'text-white' href = javascript:fn_deleteFile('"+response[i].fileid+"','"+response[i].fileIdntfcKey+"')>X</a></span>&nbsp;&nbsp;";
                   $('#fileListArea').append(content);
               }
           }
       })

      if (detectBrowser() == "other") {
          $("#evdncDcmntFile").val("");
      } else {
         $("#evdncDcmntFile").replaceWith( $("#evdncDcmntFile").clone(true))
      }
});

function fn_deleteFile(fileid, fileIdntfcKey){
    if(!confirm("파일을 삭제 하시겠습니까?")){return;}

    var deleteFileUrl="/deleteFile.do?fileid="+fileid+"&file_idntfc_key=" + fileIdntfcKey;

    $.ajax({
      url : deleteFileUrl,
      type: 'GET',
      cache : false,
      dataType: 'json',
      success : function (data){
          $("#file_"+fileid).remove();
      },
      error : function (error){
      }
   })
};

initAplyInfoForm();

</script>