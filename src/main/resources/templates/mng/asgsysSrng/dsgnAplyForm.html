<div class="col-12">
    <div class="card">
        <div class="tab-content tabs p-t-20">
            <div class="tab-pane active" id="applyInfo" role="tabpanel">
                <div class="card-header p-t-0 p-b-0">
                    <h3 class="sub-title">
                        <strong>신청기관 정보</strong>
                    </h3>
                </div>

                <form id='instFrm' name='instFrm'>
                    <input type="hidden" id="instid" name="instid" th:value="${instInfo.instid}" />
                    <input type="hidden" id="userid" name="userid" th:value="${instInfo.userid}" />

                    <input type="hidden" id="aplcntid"       name="aplcntid"       value="" />
                    <input type="hidden" id="aplcntNm"       name="aplcntNm"       value="" />
                    <input type="hidden" id="aplcntEml"      name="aplcntEml"      value="" />
                    <input type="hidden" id="aplcntMoblphon" name="aplcntMoblphon" value="" />


                <div class="card-block-small p-t-0 p-b-0">
                    <div class="mb-3 row">
                        <div class="col-12 col-lg-6 mb-3 mb-lg-0">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="instNm"><strong>기관명</strong></label>
                                <div class="col-sm-12">
                                    <input type="text" class="form-control form-control-sm" name="instNm" id="instNm" placeholder="기관명" th:value="${instInfo.instNm}" readonly="">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6">
                            <div class="mb-0 form-group">
                                <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>기관유형</strong></div>
                                <div class="col-sm-12">
                                    <select id="instTypeCd" name="instTypeCd" class="form-select form-select-sm form-control-sm" disabled>
                                        <option value="">- 전체 -</option>
                                        <option th:value="${item.CD}" th:each="item:${typeCdList}" th:selected='${item.CD==instInfo.instTypeCd ? selected : ""}' ><th:block th:text="${item.CD_NM}"/></option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <div class="col-12 col-lg-6 mb-3 mb-lg-0">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="rprsvNm"><strong>대표자명</strong></label>
                                <div class="col-sm-12">
                                    <input type="text" class="form-control form-control-sm" name="rprsvNm" id="rprsvNm" placeholder="대표자명" th:value="${instInfo.rprsvNm}" readonly="">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6">
                            <div class="mb-0 form-group required">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="nm"><strong>신청자</strong></label>
                                <div class="col-12 row">
                                    <div class="col-8">
                                        <input type="text" class="form-control form-control-sm" name="nm" id="nm" placeholder="신청자" th:value="${instInfo.nm}" readonly="">
                                    </div>
                                    <div class="col-4 btn-group-sm">
                                        <button type="button" class="btn btn-inverse" onclick="dsgnAply.openMbrPopup();" >담당자 변경</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <div class="col-12 col-lg-6 mb-3 mb-lg-0">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="telno"><strong>담당자연락처</strong></label>
                                <div class="col-sm-12">
                                    <input type="text" class="form-control form-control-sm" name="telno" id="telno" placeholder="담당자연락처" th:value="${instInfo.telno}" readonly="">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6">
                            <div class="mb-0 form-group required">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="eml"><strong>담당자 이메일</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" name="eml" id="eml" placeholder="담당자이메일" th:value="${instInfo.eml}" readonly="">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <div class="col-12 col-lg-6 mb-3 mb-lg-0">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="brno"><strong>사업자등록번호</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" name="brno" id="brno" placeholder="사업자등록번호" th:value="${instInfo.brno}" readonly="">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="instEml"><strong>기관 이메일</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" name="instEml" id="instEml" placeholder="기관 이메일" th:value="${instInfo.instEml}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <div class="col-12 col-lg-6 mb-3 mb-lg-0">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="instTelno"><strong>기관 연락처</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" name="instTelno" id="instTelno" placeholder="기관 연락처" th:value="${instInfo.instTelno}" readonly="">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6">
                            <div class="mb-0 form-group">
                                <div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
                                    <strong>지역</strong>[[${instInfo.ctprvnCd}]]
                                </div>
                                <div class="col-12">
                                    <select id="" name="applyInfoRegionSelect" class="form-select form-select-sm form-control-sm" disabled="">
                                        <option value="">- 전체 -</option>
                                        <th:block th:each="code : ${sidoList}">
                                            <option th:value="${code.CTPRVN_CD}" th:selected=" ${code.CTPRVN_CD}==${#strings.toString(instInfo.ctprvnCd)} ? 'selected':'' ">[[${code.CTPRVN_NM}]]</option>
                                        </th:block>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <div class="col-12 col-lg-6 mb-3 mb-lg-0">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="instHmpg"><strong>기관 홈페이지</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" name="instHmpg" id="instHmpg" placeholder="기관 연락처" th:value="${instInfo.instHmpg}" readonly="">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6">
                            <div class="mb-0 form-group">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <div class="col-12 col-lg-6 mb-3 mb-lg-0">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="addr"><strong>기관주소</strong></label>
                                <div class="col-sm-12">
                                    <input type="text" class="form-control form-control-sm" name="addr" id="addr" placeholder="기관주소" th:value="${instInfo.addr}" readonly="">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="addrDtl"><strong>상세주소</strong></label>
                                <div class="col-sm-12">
                                    <input type="text" class="form-control form-control-sm" name="addrDtl" id="addrDtl" placeholder="상세주소" th:value="${instInfo.addrDtl}" readonly="">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <div class="col-12 col-lg-6 mb-3 mb-lg-0">
                            <div class="mb-0 form-group required">
                                <div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
                                    <strong>증빙자료</strong>
                                </div>
                                <div class="mb-2 col-12">
                                    <input type="file" multiple id="evdncDcmntFile" name="evdncDcmntFile" class="form-control form-control-sm"/>
                                    <input type="hidden" id="filegrpid" name="filegrpid" value=0 />
                                </div>
                                <div class="row">
                                    <div class="col-auto">
                                        <div id="multipleFileUploadError"></div>
                                        <div id="multipleFileUploadSuccess"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </form>

                <div class="card-header p-b-10">
                    <ul class="nav nav-tabs tabs" role="tablist">
                        <!-- [230125] nav-pills flex-column flex-lg-row -> nav-tabs tabs 탭 변경 (첫번째 탭 활성화) -->
                        <th:block sec:authorize-url="/mng/asgsysSrng/prgrmDstnctnForm.html">
                            <li class="nav-item flex-lg-fill text-center"><a class="nav-link active" data-bs-toggle="tab" id="jdsgTab1Link" href="#jdsgTab1" role="tab" ><strong>프로그램 우수성</strong></a></li>
                        </th:block>
                        <th:block sec:authorize-url="/mng/asgsysSrng/prgrmOperMngForm.html">
                            <li class="nav-item flex-lg-fill text-center"><a class="nav-link" data-bs-toggle="tab" id="jdsgTab2Link" href="#jdsgTab2" role="tab"><strong>프로그램 운영관리</strong></a></li>
                        </th:block>
                        <th:block sec:authorize-url="/mng/asgsysSrng/prgrmEvl.html">
                            <li class="nav-item flex-lg-fill text-center"><a class="nav-link" data-bs-toggle="tab" id="jdsgTab3Link" href="#jdsgTab3" role="tab"><strong>프로그램 평가</strong></a></li>
                        </th:block>
                        <th:block sec:authorize-url="/mng/asgsysSrng/ldrQlfcForm.html">
                            <li class="nav-item flex-lg-fill text-center"><a class="nav-link" data-bs-toggle="tab" id="jdsgTab4Link" href="#jdsgTab3" role="tab"><strong>지도자의 자격 및 배치</strong></a></li>
                        </th:block>
                        <th:block sec:authorize-url="/mng/asgsysSrng/sftyMngForm.html">
                            <li class="nav-item flex-lg-fill text-center"><a class="nav-link" data-bs-toggle="tab" id="jdsgTab5Link" href="#jdsgTab5" role="tab"><strong>안전관리</strong></a></li>
                        </th:block>
                        <th:block sec:authorize-url="/mng/asgsysSrng/assChklstForm.html">
                            <li class="nav-item flex-lg-fill text-center"><a class="nav-link" data-bs-toggle="tab" id="jdsgTab6Link" href="#jdsgTab6" role="tab"><strong>체크리스트</strong></a></li>
                        </th:block>
                    </ul>
                </div>
                <!-- TAB CONTTENT -->
                <div id="jdgsSprtgrpAltmntTabContent" class="tab-content tabs p-t-20"></div>
            </div>
        </div>
    </div>
</div>



<!-- 담당자정보 회원검색 팝업 Start -->
<div class="modal fade" id="managerInsertPopup" aria-hidden="true" data-bs-backdrop="static"></div>
<script th:inline="javascript">

    var instManagerSearchModal;
    var dsgnAply = {

    	popupUrl: "/mng/asgsysSrng/mbrSrchPopup.html",

    	init(){

    		dsgnAply.initJdsgTab();
    	},
    	setValid(){
    		var validator= $("#instFrm").validate({
                rules: {
                	aplcntNm : { required: true },
                	instEml : { required: true },
                	$('[id^=file_]').id : { required: true }
                },
                messages: {
                	aplcntNm : { required:"신청자를 선택해주십시오" },
                	instEml : { required:"제목을 입력해주십시오" },
                    bannerFile : { required:"이미지 첨부해주십시오" }
                }
            })
    	},

    	openMbrPopup(){

    		$("#managerInsertPopup").load(dsgnAply.popupUrl, function(response, status, xhr) {
                if (status == "success") {
                	instManagerSearchModal = new bootstrap.Modal($('#managerInsertPopup'));
                	instManagerSearchModal.show();
                }
            });
    	},

    	selectJdsgTab(tabId){

    	    if(tabId == "jdsgTab1Link") {
    	    	dsgnAply.loadJdsgTabContent("/mng/asgsysSrng/prgrmDstnctnForm.html");
    	    } else if(tabId == "jdsgTab2Link") {
    	    	dsgnAply.loadJdsgTabContent("/mng/asgsysSrng/prgrmOperMngForm.html");
    	    } else if(tabId == "jdsgTab3Link") {
    	    	dsgnAply.loadJdsgTabContent("/mng/asgsysSrng/prgrmEvl.html");
    	    } else if(tabId == "jdsgTab4Link") {
    	    	dsgnAply.loadJdsgTabContent("/mng/asgsysSrng/ldrQlfcForm.html");
    	    } else if(tabId == "jdsgTab5Link") {
    	    	dsgnAply.loadJdsgTabContent("/mng/asgsysSrng/sftyMngForm.html");
    	    } else if(tabId == "jdsgTab6Link") {
    	    	dsgnAply.loadJdsgTabContent("/mng/asgsysSrng/assChklstForm.html");
    	    }

    	    $("#" + tabId).parent().addClass("active");
    	},

    	loadJdsgTabContent(uri) {

    	    $.ajax({
    	        cache   : false
    	      , url     : uri
    	      , type    : 'GET'
    	      , async   : 'false'
    	      , dataType: 'html'
    	      , success : function(result){ //요청이 성공했을때 실행되는 콜백 함수
    	                      $('#jdgsSprtgrpAltmntTabContent').html(result);
    	                  }
    	    });
    	    showContent();
    	},

    	initJdsgTab() {

    	    var tabFlag = false;

    	    if(tabFlag == false) {
    	        dsgnAply.selectJdsgTab("jdsgTab1Link");
    	        tabFlag = true;
    	    }

//     	    if(tabFlag == false) {
//     	        dsgnAply.selectJdsgTab("jdsgTab2Link");
//     	        tabFlag = true;
//     	    }

//     	    if(tabFlag == false) {
//     	        dsgnAply.selectJdsgTab("jdsgTab3Link");
//     	        tabFlag = true;
//     	    }

//     	    if(tabFlag == false) {
//     	        dsgnAply.selectJdsgTab("jdsgTab4Link");
//     	        tabFlag = true;
//     	    }

//     	    if(tabFlag == false) {
//     	        dsgnAply.selectJdsgTab("jdsgTab5Link");
//     	        tabFlag = true;
//     	    }

//     	    if(tabFlag == false) {
//     	        dsgnAply.selectJdsgTab("jdsgTab6Link");
//     	        tabFlag = true;
//     	    }
    	}
    }

    $(function() {
        dsgnAply.init();
    });

    //tabEvent
    $('.nav-item a').on('show.bs.tab', function(event) {
        var tabId = event.currentTarget.attributes.id.value;
        dsgnAply.selectJdsgTab(tabId);

    });

    //파일 첨부 (멀티 파일)
    $('#evdncDcmntFile').on("change", function(event) {

       var objFile = document.querySelector('#evdncDcmntFile');
       var formData = new FormData();
       var content = "";
       var uploadFileCnt = 0;

       for( i = 0 ; i < objFile.files.length ; i++) {
           formData.append("files", objFile.files[i]);
           uploadFileCnt++;
       }

       var filegrpid = $("#filegrpid").val();

       formData.append("filegrpid", $("#filegrpid").val());
       formData.append("filegrpNm", "asgsysSrng_file");

           $.ajax({
               url : '/uploadMultipleFiles.do',
               processData : false,
               contentType : false,
               data : formData,
               type : 'POST',
               success : function(response) {

                   if($("#filegrpid").val()=='0' || $("#filegrpid").val()==''  || $("#filegrpid").val()==null){
                       $("#filegrpid").val( response[0].filegrpid );
                   }

                   for(i = 0 ;i < response.length; i++ ){
                       content = "<span class ='label label-inverse mb-2' id='file_"+response[i].fileid+"'>"+response[i].orginlFileNm ;
                       content +="&nbsp;&nbsp;  <a  class = 'text-white' href = javascript:fn_deleteFile('"+response[i].fileid+"','"+response[i].fileIdntfcKey+"')>X</a></span>&nbsp;&nbsp;";
                       $('#multipleFileUploadSuccess').append(content);
                   }
               }
           })

          if (detectBrowser() == "other") {
              $("#evdncDcmntFile").val("");
          } else {
             $("#evdncDcmntFile").replaceWith( $("#evdncDcmntFile").clone(true))
          }
    });

    function fn_deleteFile(fileid, fileIdntfcKey){
        if(!confirm("파일을 삭제 하시겠습니까?")){return;}

        var deleteFileUrl="/deleteFile.do?fileid="+fileid+"&file_idntfc_key=" + fileIdntfcKey;

        $.ajax({
          url : deleteFileUrl,
          type: 'GET',
          cache : false,
          dataType: 'json',
          success : function (data){
              $("#file_"+fileid).remove();
          },
          error : function (error){
          }
       })
    };


</script>