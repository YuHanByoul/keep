<div class="col-12">
    <div class="card">
        <div class="tab-content tabs p-t-20">
            <div class="tab-pane active" id="applyInfo" role="tabpanel">
                <div class="card-header p-t-0 p-b-0">
                    <h3 class="sub-title">
                        <strong>신청기관 정보</strong>
                    </h3>
                </div>

                <form id='instFrm' name='instFrm'>
                    <input type="hidden" id="instid"    name="instid" value="" />
                    <input type="hidden" id="userid"    name="userid" value="" />
                    <input type="hidden" id="aplcntid"  name="aplcntid" value="" />
                    <input type="hidden" id="instRgnCd" name="instRgnCd" value="" />
                    <input type="hidden" id="instZip" name="instZip" value="" />

                    <div class="card-block-small p-t-0 p-b-0">
                        <div class="mb-3 row">
                            <div class="col-12 col-lg-6 mb-3 mb-lg-0">
                                <div class="mb-0 form-group">
                                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="instNm"><strong>기관명</strong></label>
                                    <div class="col-sm-12">
                                        <input type="text" class="form-control form-control-sm" name="instNm" id="instNm" placeholder="기관명" value="" readonly="">
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-lg-6">
                                <div class="mb-0 form-group">
                                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>기관유형</strong></div>
                                    <div class="col-sm-12">
                                        <select id="instTypeCd" name="instTypeCd" class="form-select form-select-sm form-control-sm" disabled>
                                            <option value="">- 전체 -</option>
                                            <option th:value="${item.CD}" th:each="item:${typeCdList}" ><th:block th:text="${item.CD_NM}"/></option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3 row">
                            <div class="col-12 col-lg-6 mb-3 mb-lg-0">
                                <div class="mb-0 form-group">
                                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="rprsvNm"><strong>대표자명</strong></label>
                                    <div class="col-sm-12">
                                        <input type="text" class="form-control form-control-sm" name="rprsvNm" id="rprsvNm" placeholder="대표자명" value="" readonly="">
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-lg-6">
                                <div class="mb-0 form-group required">
                                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="aplcntNm"><strong>신청자</strong></label>
                                    <div class="col-12 row">
                                        <div class="col-8">
                                            <input type="text" class="form-control form-control-sm" name="aplcntNm" id="aplcntNm" placeholder="신청자" value="" readonly="">
                                        </div>
                                        <div class="col-4 btn-group-sm">
                                            <button type="button" class="btn btn-inverse" id="mbrPopBtn" onclick="dsgnAply.openMbrPopup();" >담당자 변경</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3 row">
                            <div class="col-12 col-lg-6 mb-3 mb-lg-0">
                                <div class="mb-0 form-group">
                                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="aplcntMoblphon"><strong>담당자연락처</strong></label>
                                    <div class="col-sm-12">
                                        <input type="text" class="form-control form-control-sm" name="aplcntMoblphon" id="aplcntMoblphon" placeholder="담당자연락처" value="" readonly="">
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-lg-6">
                                <div class="mb-0 form-group">
                                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="aplcntEml"><strong>담당자 이메일</strong></label>
                                    <div class="col-12">
                                        <input type="text" class="form-control form-control-sm" name="aplcntEml" id="aplcntEml" placeholder="담당자이메일" value="" readonly="">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3 row">
                            <div class="col-12 col-lg-6 mb-3 mb-lg-0">
                                <div class="mb-0 form-group">
                                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="brno"><strong>사업자등록번호</strong></label>
                                    <div class="col-12">
                                        <input type="text" class="form-control form-control-sm" name="brno" id="brno" placeholder="사업자등록번호" value="" readonly="">
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-lg-6">
                                <div class="mb-0 form-group required">
                                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="instEml"><strong>기관 이메일</strong></label>
                                    <div class="col-12">
                                        <input type="text" class="form-control form-control-sm" name="instEml" id="instEml" placeholder="기관 이메일" value="">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3 row">
                            <div class="col-12 col-lg-6 mb-3 mb-lg-0">
                                <div class="mb-0 form-group">
                                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="instCntct"><strong>기관 연락처</strong></label>
                                    <div class="col-12">
                                        <input type="text" class="form-control form-control-sm" name="instCntct" id="instCntct" placeholder="기관 연락처" value="" readonly="">
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-lg-6">
                                <div class="mb-0 form-group">
                                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
                                        <strong>지역</strong>
                                    </div>
                                    <div class="col-12">
                                        <select id="ctprvnCd" name="ctprvnCd" class="form-select form-select-sm form-control-sm" disabled="">
                                            <option value="">- 전체 -</option>
                                            <th:block th:each="code : ${sidoList}">
                                                <option th:value="${code.CTPRVN_CD}">[[${code.CTPRVN_NM}]]</option>
                                            </th:block>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3 row">
                            <div class="col-12 col-lg-6 mb-3 mb-lg-0">
                                <div class="mb-0 form-group">
                                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="instHmpg"><strong>기관 홈페이지</strong></label>
                                    <div class="col-12">
                                        <input type="text" class="form-control form-control-sm" name="instHmpg" id="instHmpg" placeholder="기관 연락처" value="" readonly="">
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-lg-6">
                                <div class="mb-0 form-group">
                                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="instAddr"><strong>기관주소</strong></label>
                                    <div class="col-sm-12">
                                        <input type="text" class="form-control form-control-sm" name="instAddr" id="instAddr" placeholder="기관주소" value="" readonly="">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3 row">
                            <div class="col-12 col-lg-6 mb-3 mb-lg-0">
                                <div class="mb-0 form-group">
                                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="instDtladdr"><strong>상세주소</strong></label>
                                    <div class="col-sm-12">
                                        <input type="text" class="form-control form-control-sm" name="instDtladdr" id="instDtladdr" placeholder="상세주소" value="" readonly="">
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-lg-6">
                                <div class="mb-0 form-group required">
                                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
                                        <strong>증빙자료</strong>
                                    </div>
                                    <div class="mb-2 col-12">
                                        <input type="file" multiple id="evdncDcmntFile" name="evdncDcmntFile" class="form-control form-control-sm"/>
                                        <input type="hidden" id="filegrpid" name="filegrpid" value=0 />
                                    </div>
                                    <div class="row">
                                        <div class="col-auto">
                                            <div id="multipleFileUploadError"></div>
                                            <div id="multipleFileUploadSuccess"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>

                <div class="card-header p-b-10">
                    <ul class="nav nav-tabs tabs" role="tablist">
                        <!-- [230125] nav-pills flex-column flex-lg-row -> nav-tabs tabs 탭 변경 (첫번째 탭 활성화) -->
                        <th:block sec:authorize-url="/mng/asgsysSrng/prgrmDstnctnForm.html">
                            <li class="nav-item flex-lg-fill text-center"><a class="nav-link active" data-bs-toggle="tab" id="jdsgTab1Link" href="#jdsgTab1" role="tab" disabled><strong>프로그램 우수성</strong></a></li>
                        </th:block>
                        <th:block sec:authorize-url="/mng/asgsysSrng/prgrmOperMngForm.html">
                            <li class="nav-item flex-lg-fill text-center"><a class="nav-link" data-bs-toggle="tab" id="jdsgTab2Link" href="#jdsgTab2" role="tab" disabled><strong>프로그램 운영관리</strong></a></li>
                        </th:block>
                        <th:block sec:authorize-url="/mng/asgsysSrng/prgrmEvl.html">
                            <li class="nav-item flex-lg-fill text-center"><a class="nav-link" data-bs-toggle="tab" id="jdsgTab3Link" href="#jdsgTab3" role="tab" disabled><strong>프로그램 평가</strong></a></li>
                        </th:block>
                        <th:block sec:authorize-url="/mng/asgsysSrng/ldrQlfcForm.html">
                            <li class="nav-item flex-lg-fill text-center"><a class="nav-link" data-bs-toggle="tab" id="jdsgTab4Link" href="#jdsgTab3" role="tab" disabled><strong>지도자의 자격 및 배치</strong></a></li>
                        </th:block>
                        <th:block sec:authorize-url="/mng/asgsysSrng/sftyMngForm.html">
                            <li class="nav-item flex-lg-fill text-center"><a class="nav-link" data-bs-toggle="tab" id="jdsgTab5Link" href="#jdsgTab5" role="tab" disabled><strong>안전관리</strong></a></li>
                        </th:block>
                        <th:block sec:authorize-url="/mng/asgsysSrng/assChklstForm.html">
                            <li class="nav-item flex-lg-fill text-center"><a class="nav-link" data-bs-toggle="tab" id="jdsgTab6Link" href="#jdsgTab6" role="tab" disabled><strong>체크리스트</strong></a></li>
                        </th:block>
                    </ul>
                </div>
                <!-- TAB CONTTENT -->
                <div id="jdgsSprtgrpAltmntTabContent" class="tab-content tabs p-t-20"></div>
            </div>
        </div>
    </div>
</div>

<!-- 담당자정보 회원검색 팝업 Start -->
<div class="modal fade" id="managerInsertPopup" aria-hidden="true" data-bs-backdrop="static"></div>
<script th:inline="javascript">

    var instManagerSearchModal;

    var dsgnAply = {

    	prgrmDstnctnUrl: "/mng/asgsysSrng/prgrmDstnctnForm.html",
    	popupUrl: "/mng/asgsysSrng/mbrSrchPopup.html",
    	selectInstUrl: "/mng/asgsysSrng/selectInstInfo.do",

    	init(){
    		loadJdsgTabContent(dsgnAply.prgrmDstnctnUrl);
    		dsgnAply.setValid();
    	},

    	setValid(){
    		var validator= $("#instFrm").validate({
                rules: {
                	aplcntNm : { required: true },
                	instEml  : { required: true , isBlank : true, maxlength: 50 }
                },
                messages: {
                	aplcntNm : { required:"신청자를 선택해주십시오" },
                	instEml  : { required:"기관이메일을 입력해주십시오", isBlank : "입력값에 공백이 있습니다.", maxlength: "이메일은 50자 이하여야 합니다." }
                }
            })
    	},

    	chkAplyFrm(){

    		if(!($("#instFrm").valid())){
    			return false;
    		}

    		if($('#multipleFileUploadSuccess span').length < 1){
    			alert("증빙서류는 첨부해주십시오.");
    			$("#instFrm #evdncDcmntFile").focus();
    			return false;
    		}
    	},

    	openMbrPopup(){

    		$("#managerInsertPopup").load(dsgnAply.popupUrl, function(response, status, xhr) {
                if (status == "success") {
                	instManagerSearchModal = new bootstrap.Modal($('#managerInsertPopup'));
                	instManagerSearchModal.show();
                }
            });
    	},
    	selectInstInfo(){

    		if (displayWorkProgress(true)) {
                $.ajax({
                    url: dsgnAply.selectInstUrl,
                    cache: false,
                    dataType: 'json',
                    data: formData = $('#instFrm').serializeArray(),
                    type: 'GET',
                    success: function (data) {
                    	var instInfo = data.instInfo;

                    	$("#instFrm input, select").each(function(idx,item){

                    		if(item.id != 'filegrpid') {
                    			$(this).val(instInfo[item.id]!=null ? instInfo[item.id]:'');
                    		}
                    	});
                    	var csltngList = escapeGridData(data.csltngList)
                    	if(csltngList!=null && csltngList.length > 0);{
                    	    dsgnAply.setCsltngList(csltngList);
                    	}

                        closeWorkProgress();
                    }
                });
            }
    	},
    	//우수성컨설팅목록 set
    	setCsltngList(list){
    		var html =``;

            for(idx in list){

                html+=`<option value='${list[idx].cnsltngid}'>${list[idx].prgrmNm}</option>`;
            }

            $('#cnsltngid').append(html);

    	},
    }

    function loadJdsgTabContent(uri) {

        $.ajax({
            cache   : false
          , url     : uri
          , type    : 'GET'
          , async   : 'false'
          , dataType: 'html'
          , success : function(result){ //요청이 성공했을때 실행되는 콜백 함수
                          $('#jdgsSprtgrpAltmntTabContent').html(result);
                      }
        });
        showContent();
    }

    $(function() {
        dsgnAply.init();

        //tabEvent
        $('.nav-item a').on('show.bs.tab', function(event) {
        	debugger;
            var tabId = event.currentTarget.attributes.id.value;
            dsgnAply.selectJdsgTab(tabId);

        });

        //파일 첨부 (멀티 파일)
        $('#evdncDcmntFile').on("change", function(event) {

             var objFile = document.querySelector('#evdncDcmntFile');
             var formData = new FormData();
             var content = "";
             var uploadFileCnt = 0;

             for( i = 0 ; i < objFile.files.length ; i++) {
                 formData.append("files", objFile.files[i]);
                 uploadFileCnt++;
             }


             var filegrpid = $("#filegrpid").val()==null || $("#filegrpid").val()==''? 0 : $("#filegrpid").val();

             formData.append("filegrpid", filegrpid);
             formData.append("filegrpNm", "asgsysSrng_file");

             $.ajax({
                 url : '/uploadMultipleFiles.do',
                 processData : false,
                 contentType : false,
                 data : formData,
                 type : 'POST',
                 success : function(response) {
              	   if(response.result == 'fail'){
                         alert(response.msg);
              	   }else{

                         if($("#filegrpid").val()=='0' || $("#filegrpid").val()==''  || $("#filegrpid").val()==null){
                             $("#filegrpid").val( response[0].filegrpid );
                         }

                         for(i = 0 ;i < response.length; i++ ){
                             content = "<span class ='label label-inverse mb-2' id='file_"+response[i].fileid+"'>"+response[i].orginlFileNm ;
                             content +="&nbsp;&nbsp;  <a  class = 'text-white' href = javascript:fn_deleteFile('"+response[i].fileid+"','"+response[i].fileIdntfcKey+"')>X</a></span>&nbsp;&nbsp;";
                             $('#multipleFileUploadSuccess').append(content);
                         }
              	   }

                 }
             })

             if (detectBrowser() == "other") {
                 $("#evdncDcmntFile").val("");
             } else {
                $("#evdncDcmntFile").replaceWith( $("#evdncDcmntFile").clone(true))
             }
        });
    });


    function fn_deleteFile(fileid, fileIdntfcKey){
        if(!confirm("파일을 삭제 하시겠습니까?")){return;}

        var deleteFileUrl="/deleteFile.do?fileid="+fileid+"&file_idntfc_key=" + fileIdntfcKey;

        $.ajax({
          url : deleteFileUrl,
          type: 'GET',
          cache : false,
          dataType: 'json',
          success : function (data){
              $("#file_"+fileid).remove();
          },
          error : function (error){
          }
       })
    };


</script>