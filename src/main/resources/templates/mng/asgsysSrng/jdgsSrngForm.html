<form id="jdgsSrngInfoFrm" >
    <input type="hidden" id="prgrmid" name="prgrmid" th:value="${jdgsSrngInfo.prgrmid}"><!-- 프로그램id -->
    <input type="hidden" id="rsltid" name="rsltid" th:value="${jdgsSrngInfo.rsltid}"><!-- 결과id -->
    <input type="hidden" id="jdgsid" name="jdgsid" th:value="${jdgsSrngInfo.jdgsid}"><!-- 심사위원id -->
    <input type="hidden" id="formid" name="formid" th:value="${jdgsSrngInfo.formid}"><!-- 심사양식id -->
    <input type="hidden" id="sbmsnid" name="sbmsnid" th:value="${jdgsSrngInfo.sbmsnid}"><!-- 제출id-->
    	<div class="row">
    		<div class="card">
    			<div class="card-header p-b-0">
    				<h3 class="sub-title"><strong>신청 정보</strong></h3>
    			</div>
    			<div class="card-block-small p-t-0">
    				<div class="mb-2 row">
    					<div class="col-12 col-lg-6 mb-2 mb-lg-0">
    						<div class="mb-0 form-group">
    							<label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="judgeJudgingProgramName"><strong>프로그램명</strong></label>
    							<div class="col-sm-12">
    								<input type="text" class="form-control form-control-sm" name="prgrmNm" id="prgrmNm" placeholder="Text Input Validation" th:value="${jdgsSrngInfo.prgrmNm}" readonly="">
    							</div>
    						</div>
    					</div>
    					<div class="col-12 col-lg-6">
    						<div class="mb-0 form-group">
    							<label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="judgeJudgingAgencyName"><strong>기관명</strong></label>
    							<div class="col-sm-12">
    								<input type="text" class="form-control form-control-sm" name="instNm" id="instNm" placeholder="Text Input Validation" th:value=${jdgsSrngInfo.instNm} readonly="">
    							</div>
    						</div>
    					</div>
    				</div>
    				<div class="mb-2 row">
    				<div class="col-12 col-lg-6 mb-2 mb-lg-0">
    					<div class="mb-0 form-group">
    						<div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
    							<strong>숙박여부</strong>
    						</div>
    						<div class="col-12 row align-items-center">
    							<div class="col-12 col-lg-auto mb-2 mb-lg-0">
                                    <span kattr:radio_yn="styYn" label1="숙박" label2="비숙박" addStyle="margin-top:4px" addClass="col-sm-3" isAdmin="true" th:attr="defaultVal=${jdgsSrngInfo.styYn == null ? 'N':jdgsSrngInfo.styYn}"/>
    							</div>
    							<div class="col-12 col-lg-auto row align-items-center">
    								<div class="col-auto">
    									<input type="text" class="form-control form-control-sm" name="styNight" id="styNight" placeholder="Text Input Validation" th:value=${jdgsSrngInfo.styNight} style="width: 40px;" readonly>
    								</div>
    								<div class="col-auto p-l-0">박</div>
    								<div class="col-auto">
    									<input type="text" class="form-control form-control-sm" name="styDaytm" id="styDaytm" placeholder="Text Input Validation" th:value=${jdgsSrngInfo.styDaytm} style="width: 40px;" readonly>
    								</div>
    								<div class="col-auto p-l-0">일</div>
    							</div>
    						</div>
    					</div>
    				</div>

    				<div class="col-12 col-lg-6">
    					<div class="mb-0 form-group">
    						<div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
    							<strong>운영형태</strong>
    						</div>
    						<div class="col-12">
    							<div class="form-radio bg-form"><!-- [230125] class bg-form 추가 -->
    								<div class="radio radio-inline">
                                        <span id="operFrmCd" kattr:radio_code="operFrmCd" th:attr="grpCd=120, selectedCd=${jdgsSrngInfo.operFrmCd}" addStyle="margin-top:4px" addClass="col-sm-3" isAdmin="true" >
    				                 </div>
    						    </div>
    					   </div>
    				    </div>
    	            </div>
    				<div class="mb-2 row">
    					<div class="col-12 col-lg-6 mb-2 mb-lg-0">
    						<div class="mb-0 form-group">
    							<div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
    								<strong>안전관리 사전인증여부</strong>
    							</div>
    							<div class="col-12">
    								<div class="form-radio">
    									<div class="radio radio-inline">
    									    <span kattr:radio_yn="sftyMngYn" label1="예" label2="아니오" th:attr="selectedCd=${jdgsSrngInfo.sftyMngYn}" addStyle="margin-top:4px" addClass="col-sm-3" onchange="changeSftyMngYn()" isAdmin="true" readonly></span>
    									</div>
    								</div>
    							</div>
    						</div>
    					</div>
    					<div class="col-12 col-lg-6">
    						<div class="mb-0 form-group">
    							<div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
    								<strong>첨부파일</strong>
    							</div>
    							<div class="row">
    								<div class="col-auto">
    									<span class="label label-inverse"> sampleFile.pptx <a href="javascript:void(0)" class="text-white">X</a>
    									</span>
    								</div>
    							</div>
    						</div>
    					</div>
    				</div>
    				<div class="mb-2 row">
    					<div class="col-12 col-lg-6 mb-2 mb-lg-0">
    						<div class="mb-0 form-group">
    							<div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
    								<strong>증빙서류</strong>
    							</div>
    							<div class="row">
    								<div class="col-auto">
    									<span class="label label-inverse"> sampleFile.pptx <a href="javascript:void(0)" class="text-white">X</a>
    									</span>
    								</div>
    							</div>
    						</div>
    					</div>
    					<div class="col-12 col-lg-6">
    						<div class="mb-0 form-group">
    							<div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
    								<strong>진행상태</strong>
    							</div>
    							<div class="col-12">
    				                <span kattr:select_code="srngSttsCd" th:attr="grpCd=119,selectedCd=${jdgsSrngInfo.srngSttsCd}" firstOptTxt="- 전체 -" addClass="form-select form-select-sm form-control-sm" isAdmin="true" disabled>
    							</div>
    						</div>
    					</div>
    				</div>
    				<div class="mb-2 row">
    					<div class="col-12 btn-group-sm">
    						<button type="button" class="col-auto btn btn-primary">심사세부기준표 다운로드</button>
    					</div>
    				</div>

                    <div class="col-12 table-border-style">
                        <div class="col-12 table-responsive">


                            <th:block th:if="${!#lists.isEmpty(dsgnSrgnFormList)}">

                                <table class="table table-border-style table-columned">
                                    <thead>
                                        <tr>
                                            <th colspan="5" class="table-active">심사점수</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="border-bottom-inverse">
                                            <td class="text-center v-middle" style="width: 60px;"><strong>No</strong></td>
                                            <td class="text-center v-middle"><strong>지정기준</strong></td>
                                            <td class="text-center v-middle"><strong>확인사항</strong></td>
                                            <td class="text-center v-middle" style="width: 100px;"><strong>배점</strong></td>
                                            <td class="text-center v-middle" style="width: 130px;"><strong>심사점수</strong></td>
                                        </tr>
                                        <th:block th:each="item , i : ${dsgnSrgnFormList}">
                                            <tr class="border-bottom">
                                                <td class="text-center v-middle"><th:block th:text="${i.count}"></th:block></td>

                                                <td th:if="${item.rnk == 1}" th:rowspan="${item.rowspan}" class="text-center v-middle"><th:block th:text="${item.dsgncrtrCdNm}"></td>
                                                <td class="text-center v-middle"><th:block th:text="${item.idntyMttr}"></td>
                                                <td class="text-center v-middle" th:id="${'altm' + i.count}"><th:block th:text="${item.altm}"></td></td>
                                                <td class="text-center v-middle">
                                                    <input type="text" class="form-control form-control-sm" th:name="${'scr'+ i.count}" th:id="${'scr'+ i.count}" placeholder="0" th:value="${item.scr}" />
                                                </td>
                                                <input type="hidden"
                                                    th:id="${'ansData' + i.count}"
                                                    th:data-qitemid    = "${item.qitemid   }"
                                                    th:data-dsgncrtrCd = "${item.dsgncrtrCd}"
                                                    th:data-idntyMttr  = "${item.idntyMttr }"
                                                    th:data-chklstSeCd = "${item.chklstSeCd}"
                                                    th:data-scr        = "${item.scr       }"
                                                    th:data-ordr       = "${item.ordr      }" >
                                            </tr>
                                        </th:block>
                                    </tbody>
                                    <tfoot>
                                        <tr class="border-bottom">
                                            <td colspan="3" class="table-active" style="text-align:center;"><strong>총 점</strong></td>

                                            <td class="text-center v-middle"><th:block th:text="${dsgnSrgnFormList[0].allaltm}"></th:block></td>
                                            <td class="text-center v-middle" id="sumScr"><th:block th:text="${dsgnSrgnFormList[0].allscr}"></th:block></td>
                                        </tr>
                                    </tfoot>
                                </table>

                            </th:block>
                        </div>
                    </div>
                    <!-- 심사점수 그리드 str-->
                    <!-- 심사점수 그리드 end-->
    			</div>
    			<div class="card-header p-t-0 p-b-0">
    				<h3 class="sub-title">
    					<strong>심사의견</strong>
    				</h3>
    			</div>
    			<div class="card-block-small p-t-0">
    				<div class="mb-0 form-group row">
    					<div class="col-12">
    						<textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="Default textarea" id="srngOpnn" name="srngOpnn"><th:block th:text="${jdgsSrngInfo.srngOpnn}"></th:block></textarea>
    					</div>
    				</div>
    			</div>
    			<div class="card-block-small">
    				<button type="button" class="btn btn-inverse m-r-5" onclick="gridHelper1.toggleContent();">목록</button>
    				<button type="button" class="btn btn-primary" onclick="fn_insertJdgsSrngInfo()">저장</button>
    			</div>
    		</div>
    	</div>
    </div>
</form>
<script type="text/javascript">




function fn_jdgsSrngInfoFrmInit(){

	$("[id^=operFrmCd]").prop("disabled", true);
	$("[id^=styYn]").prop("disabled", true);
	$("[id^=sftyMngYn]").prop("disabled", true);
}

$("[id^=scr]").focusout("change",function(){

	var sumScore=0;

	$("[id^=scr]").each(function(idx,item) {

		var altm = Number($("#altm"+(idx+1)).prop("innerText"));

		if(item.value > altm){

			$("#scr"+(idx+1)).val(altm);
		}
		sumScore += Number(item.value);
	})

	$("#sumScr").prop("innerText",sumScore)

})

function fn_insertJdgsSrngInfo() {

	if(!confirm("저장하시겠습니까?")) return;


	var param={};
	 //프로그램 일정
    $("#jdgsSrngInfoFrm input").each(function(index, item) {

        if("checkbox" == item.type && "on" == item.value) {
            param[item.id] = "Y";
        }
        else{
            param[item.id] = item.value;
        }
    });


    $("[id^=ansData]").each(function(index, item) {

    	param["dsgnSrngFormLst[" + index + "].prgrmid"    ] = $("#prgrmid").val();    //프로그램 id (key)
    	param["dsgnSrngFormLst[" + index + "].sbmsnid"    ] = $("#sbmsnid").val();    //프로그램 id (key)
    	param["dsgnSrngFormLst[" + index + "].qitemid"    ] = $(item).attr("data-qitemid"    );    //프로그램 id (key)
    	param["dsgnSrngFormLst[" + index + "].dsgncrtrCd" ] = $(item).attr("data-dsgncrtrCd" );
    	param["dsgnSrngFormLst[" + index + "].idntyMttr"  ] = $(item).attr("data-idntyMttr"  );
    	param["dsgnSrngFormLst[" + index + "].chklstSeCd" ] = $(item).attr("data-chklstSeCd" );
    	param["dsgnSrngFormLst[" + index + "].scr"        ] = $(item).attr("data-scr"        );
    	param["dsgnSrngFormLst[" + index + "].ordr"       ] = $(item).attr("data-ordr"       );

    });
debugger;
	if(displayWorkProgress()){
        $.ajax({

            url : "/mng/asgsysSrng/updateJdgsSrngDetail.do",
            type: 'POST',
            cache : false,
            dataType: 'json',
            data : param,
            success : function (data){
                if(data.result=="success"){

                    alert(data.msg);
                    gridHelper1.resetPageContent();
                }else{
                    alert(data.msg);
                }
                closeWorkProgress();
            }
        });
    }

}

fn_jdgsSrngInfoFrmInit();
</script>
