<form id="jdgsSrngForm">
<input type="hidden" id="aplyFilegrpid" name="aplyFilegrpid" th:value="${aplyInfo.aplyFilegrpid == null or aplyInfo.aplyFilegrpid == ''}? 0: ${aplyInfo.aplyFilegrpid}"/>
<input type="hidden" id="bfrCertFilegrpid" name="bfrCertFilegrpid" th:value="${aplyInfo.bfrCertFilegrpid == null or aplyInfo.bfrCertFilegrpid == ''}? 0: ${aplyInfo.bfrCertFilegrpid}"/>
<input type="hidden" id="formid" name="formid" th:value="${aplyInfo.formid}"/>
    <div class="card-header p-t-0 p-b-0">
        <h3 class="sub-title">
            <strong>신청 정보</strong>
        </h3>
    </div>
    <div class="card-block-small p-t-0">
        <div class="mb-2 row">
            <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                <div class="mb-0 form-group">
                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="judgeJudgingProgramName"><strong>프로그램명</strong></label>
                    <div class="col-sm-12">
                        <input type="text" class="form-control form-control-sm" name="prgrmNm" id="prgrmNm" placeholder="프로그램명" th:value="${aplyInfo.prgrmNm}" readonly />
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-6">
                <div class="mb-0 form-group">
                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="judgeJudgingAgencyName"><strong>기관명</strong></label>
                    <div class="col-sm-12">
                        <input type="text" class="form-control form-control-sm" name="instNm" id="instNm" placeholder="기관명" th:value="${aplyInfo.instNm}" readonly />
                    </div>
                </div>
            </div>
        </div>
        <div class="mb-2 row">
            <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                <div class="mb-0 form-group">
                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
                        <strong>숙박여부</strong>
                    </div>
                    <div class="col-12 row align-items-center">
                        <div class="col-12 col-lg-auto mb-2 mb-lg-0">
                            <div class="form-radio">
                                <div class="radio radio-inline">
                                    <span kattr:radio_yn="styYn" label1="숙박" label2="비숙박" addStyle="margin-top:4px" addClass="col-sm-3" isAdmin="true" th:attr="defaultVal=${aplyInfo.styYn == null ? 'N':aplyInfo.styYn}" />
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-auto row align-items-center">
                            <div class="col-auto">
                                <input type="text" class="form-control form-control-sm" name="styNight" id="styNight" placeholder="" th:value=${aplyInfo.styNight} style="width: 40px;" readonly>
                            </div>
                            <div class="col-auto p-l-0">박</div>
                            <div class="col-auto">
                                <input type="text" class="form-control form-control-sm" name="styDaytm" id="styDaytm" placeholder="" th:value=${aplyInfo.styDaytm} style="width: 40px;" readonly>
                            </div>
                            <div class="col-auto p-l-0">일</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-12 col-lg-6">
                <div class="mb-0 form-group">
                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
                        <strong>운영형태</strong>
                    </div>
                    <div class="form-radio bg-form" id="operFrmCdDiv"><!-- [230125] class bg-form 추가 -->
                        <span kattr:radio_code="operFrmCd" th:attr="grpCd=120, selectedCd=${aplyInfo.operFrmCd}" addStyle="margin-top:4px" addClass="col-sm-3" isAdmin="true" >
                    </div>
                </div>
            </div>
        </div>
        <div class="mb-2 row">
            <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                <div class="mb-0 form-group">
                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
                        <strong>안전관리 사전인증여부</strong>
                    </div>
                    <div class="col-12">
                        <div class="form-radio">
                            <span kattr:radio_yn="sftyMngYn" label1="예" label2="아니오" th:attr="selectedCd=${aplyInfo.sftyMngYn}" addStyle="margin-top:4px" addClass="col-sm-3" onchange="changeSftyMngYn()" isAdmin="true" readonly></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-6">
                <div class="mb-0 form-group">
                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
                        <strong>첨부파일</strong>
                    </div>
                    <div class="mb-2 col-12">

                        <span th:unless="${!#lists.isEmpty(bfrCertFileList) && bfrCertFileList[0].fileid!=0 && bfrCertFileList[0].fileid!=null}">선택된 파일 없음.</span>
                    </div>
                    <!-- 안전관리 첨부파일 -->
                    <div class="row">
                        <div class="col-auto" id="sftyFileListDiv">
                            <th:block th:unless="${#lists.isEmpty(bfrCertFileList)}" th:each="item, i : ${bfrCertFileList}" th:if = "${item.fileid} > 0">
                            <span class ='label label-inverse ' th:id="'bfrCertFile_'+${item.fileid}">
                            <span class='text-white' href="javascript:void(0)" th:name="${item.fileid}" th:onclick="downloadFileByFileid([[${item.fileid}]],[[${item.fileIdntfcKey}]])"><th:block th:text="${item.orginlFileNm}"></th:block>&nbsp;&nbsp;</a></span>
                            </span>
                        </div>
                    </div>
                    <!-- 안전관리 첨부파일 -->

                </div>
            </div>
        </div>
        <div class="mb-2 row">
            <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                <div class="mb-0 form-group">
                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
                        <strong>증빙서류</strong>
                    </div>
                    <div class="mb-2 col-12">
                        <span th:unless="${!#lists.isEmpty(aplyFileList) && aplyFileList[0].fileid!=0 && aplyFileList[0].fileid!=null}">선택된 파일 없음.</span>
                    </div>

                    <div class="row">
                        <div class="col-auto" id="aplyFileListDiv">
                            <th:block th:unless="${#lists.isEmpty(aplyFileList)}" th:each="item, i : ${aplyFileList}" th:if = "${item.fileid} > 0">
                            <span class ='label label-inverse ' th:id="'aplyFile_'+${item.fileid}">
                                <span class='text-white' href="javascript:void(0)" th:name="${item.fileid}" th:onclick="downloadFileByFileid([[${item.fileid}]],[[${item.fileIdntfcKey}]])"><th:block th:text="${item.orginlFileNm}"></th:block>&nbsp;&nbsp;</a></span>
                            </span>
                        </div>
                    </div>

                </div>
            </div>
            <div class="col-12 col-lg-6">
                <div class="mb-0 form-group">
                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
                        <strong>진행상태</strong>
                    </div>
                    <div class="col-12">
                        <span kattr:select_code="sttsCd" th:attr="grpCd=111,selectedCd=${aplyInfo.sttsCd}" firstOptTxt="- 전체 -" addClass="form-select form-select-sm form-control-sm" isAdmin="true" disabled>
                    </div>
                </div>
            </div>
        </div>
        <div class="mb-2 row">
            <div class="col-12 btn-group-sm">
                <!-- 파일 확정후 수정 필요 -->
                <a type="button" href="/cmmFile/aplyInfoFormFile/tempFile.xlsx" class="col-auto btn btn-primary" download="심사세부기준표.xlsx" >심사세부기준표 다운로드</a>
            </div>
        </div>

        <div class="mb-3 col-12 table-border-style">
            <div class="col-12 table-responsive">
<th:block th:unless="${#lists.isEmpty(srngScrList)}" th:if="${scrHeader != null}" >
<th:block th:unless="${#lists.isEmpty(srngFormList)}" >
                <table class="table table-border-style table-columned">
                    <thead>
                        <tr>
                            <th colspan="10" class="table-active">심사점수</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-bottom-inverse">
                            <td colspan="3" class="table-active text-center v-middle"><strong>합계평균</strong></td>
<th:block th:each="form, a : ${srngFormList}">
                            <td class="table-active text-center v-middle" th:id="'scrSumAvg' + ${a.count}" ><strong>0</strong></td>
</th:block>
                            <td class="table-active text-center v-middle" id="sumAvg"><strong class="text-info"><th:block th:text="${srngScrList[0].sumAvg == null ? 0 : srngScrList[0].sumAvg }"></strong></td>
                        </tr>
                        <tr class="border-bottom-inverse">
                            <td class="text-center v-middle" style="width: 60px;"><strong>No</strong></td>
                            <td class="text-center v-middle" style="width: 150px;"><strong>심사위원</strong></td>
                            <td class="text-center v-middle" style="width: 100px;"><strong>등록일</strong></td>
<th:block th:each="form, a : ${srngFormList}">
                            <td class="text-center v-middle"><strong><th:block th:text="${form.cdNm}" /><br /><th:block th:text="${'(' +form.sumAltm +'점)'}"></strong></td>
</th:block>

                            <td class="text-center v-middle"><strong>합계</strong></td>
                        </tr>

                        <th:block th:each="item, k : ${srngScrList}">
                            <tr class="border-bottom">
                                <td class="text-center v-middle"><th:block th:text="${k.count}"></th:block></td>
                                <td class="text-center v-middle"><th:block th:text="${item.jdgsNm}"></th:block>
                                    <div class="d-inline-block btn-group-sm">
                                        <button type="button" class="col-auto btn btn-primary" th:id="${'btnEvlDtl'+item.jdgsid}" onclick="jdgsEvlDtlPopup(this.id)">심사보기</button>
                                    </div>
                                </td>
                                <td class="text-center v-middle" th:id="'sbmsnDt'+ ${k.count}" ><th:block th:text="item.sbmsnDt == null ? '' : ${#dates.format(item.sbmsnDt, 'yyyy-MM-dd HH:mm:ss')}"></th:block></td>
                                <td class="text-center v-middle" th:if="${scrHeader.colVal1  != null }" th:name="${'scr1Col' + k.count}" th:id="${'scr1Col' + k.count}" th:value="${item.colVal1}"><th:block th:text="${item.colVal1  == null ? 0 : item.colVal1 }"></th:block></td>
                                <td class="text-center v-middle" th:if="${scrHeader.colVal2  != null }" th:name="${'scr2Col' + k.count}" th:id="${'scr2Col' + k.count}" th:value="${item.colVal2}"><th:block th:text="${item.colVal2  == null ? 0 : item.colVal2 }"></th:block></td>
                                <td class="text-center v-middle" th:if="${scrHeader.colVal3  != null }" th:name="${'scr3Col' + k.count}" th:id="${'scr3Col' + k.count}" th:value="${item.colVal3}"><th:block th:text="${item.colVal3  == null ? 0 : item.colVal3 }"></th:block></td>
                                <td class="text-center v-middle" th:if="${scrHeader.colVal4  != null }" th:name="${'scr4Col' + k.count}" th:id="${'scr4Col' + k.count}" th:value="${item.colVal4}"><th:block th:text="${item.colVal4  == null ? 0 : item.colVal4 }"></th:block></td>
                                <td class="text-center v-middle" th:if="${scrHeader.colVal5  != null }" th:name="${'scr5Col' + k.count}" th:id="${'scr5Col' + k.count}" th:value="${item.colVal5}"><th:block th:text="${item.colVal5  == null ? 0 : item.colVal5 }"></th:block></td>
                                <td class="text-center v-middle" th:if="${scrHeader.colVal6  != null }" th:name="${'scr6Col' + k.count}" th:id="${'scr6Col' + k.count}" th:value="${item.colVal6}"><th:block th:text="${item.colVal6  == null ? 0 : item.colVal6 }"></th:block></td>
                                <td class="text-center v-middle" th:if="${scrHeader.colVal7  != null }" th:name="${'scr7Col' + k.count}" th:id="${'scr7Col' + k.count}" th:value="${item.colVal7}"><th:block th:text="${item.colVal7  == null ? 0 : item.colVal7 }"></th:block></td>
                                <td class="text-center v-middle"><th:block th:text="${item.sumScr == null ? 0 : item.sumScr }"></th:block></td>
                            </tr>
                        </th:block>
                    </tbody>
                </table>
</th:block>
</th:block>

            </div>
        </div>
        </th:if>
    </div>
    <div class="card-header p-t-0 p-b-0">
        <h3 class="sub-title">
            <strong>심사의견</strong>
        </h3>
    </div>

    <div class="card-block-small p-t-0">
        <th:block th:each="item, k : ${srngScrList}">
            <div class="mb-2 form-group row">
                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="judgeJudgingJudgeComment1">
                    <strong><th:block th:text="${item.JdgsNm !=null && item.JdgsNm !='' ?'심사점수 '+ k.count + '(' + item.JdgsNm +')' : '심사점수'+ k.count + '(-)'}"></th:block></strong>
                </label>
                <div class="col-12">
                    <textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="심사 의견" th:id="${'srngOpnn' + k.count}" name="srngOpnn"><th:block th:text="${item.srngOpnn}"></th:block></textarea>
                </div>
            </div>
        </th:block>
    </div>
    <div class="card-block-small">
        <button type="button" class="btn btn-inverse" onclick="gridHelper1.resetListContent()">목록</button>
    </div>
</form>

<script th:inline="javascript">

initJdgsSrngForm();


function setFormScr(){

	var sumScr = 0 ;
	var usrCnt = 0 ;
	var avg = 0.00;
	var sumAvg = 0;

	$("[id^=sbmsnDt]").each(function(idx,item) {
		if($("#"+item.id)[0].innerText !="") usrCnt++;
	});

	if(usrCnt > 0){

    	$("[id^=scrSumAvg]").each(function(idx,item) {

    		sumScr=0;

    		$("[id^=scr"+(idx+1)+"Col]").each(function(idx,item) {
    			sumScr = sumScr + Number($("#"+item.id)[0].innerText);
    		});


    		avg = parseFloat(sumScr/usrCnt);
    		sumAvg = parseFloat(sumAvg) + parseFloat(avg);
    		$("#"+item.id)[0].innerHTML = '<strong>'+avg+'</strong>';
    	});

        $("#sumAvg")[0].innerHTML = "<strong class=\"text-info\">"+sumAvg.toFixed(2)+"</strong>"

	}
}

function initJdgsSrngForm(){
	$("#jdgsSrngForm [id^=operFrmCd]").prop("disabled", true);
    $("#jdgsSrngForm [id^=styYn]").prop("disabled", true);
    $("#jdgsSrngForm [id^=sftyMngYn]").prop("disabled", true);
	setFormScr();
}


function jdgsEvlDtlPopup(btnId){

	alert("미정" );
}
function btnSrngDtlCrtrChart(){
	alert("미정");
}

</script>