
              
              <!--html load area start  -->
              <div class="con-pane" id="useStatusSelectAll1">
                  <div class="card-header p-b-0">
                      <h3 class="sub-title"><strong>예약일 설정</strong></h3>
                  </div>
                  
               <!-- 예약일 설정 -->
                  <div class="card-block-small p-t-0">
                      <div class="mb-0 row">
                          <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                              <div class="col-12">
                                  <div class="row">
                                      <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                                          <div class="mb-0 form-group required">
                                              <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="rsvtStrtDt"><strong>예약 시작일</strong></label>
                                              <div class="col-12">
                                                  <input type="date" class="form-control form-control-sm" name="rsvtStrtDt" id="rsvtStrtDt" placeholder="Text Input Validation">
                                              </div>
                                          </div>
                                      </div>
                                      <div class="col-12 col-lg-6">
                                          <div class="mb-0 form-group required">
                                              <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="rsvtEndtDt"><strong>예약 종료일</strong></label>
                                              <div class="col-12">
                                                  <input type="date" class="form-control form-control-sm" name="rsvtEndtDt" id="rsvtEndtDt" placeholder="Text Input Validation">
                                              </div>
                                          </div>
                                      </div>
                                  </div>
                              </div>
                          </div>
                          <div class="col-12 col-lg-6">
                              <div class="mb-0 form-group required">
                              
                                  <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>제외 요일선택</strong></div>
                                  
                                  <div class="border-checkbox-section">
                                      <div class="border-checkbox-group border-checkbox-group-inverse d-inline-block">
                                          <input class="border-checkbox limit-day" type="checkbox" name="exceptDay1" id="exceptDay1" value="1">
                                          <label class="form-label form-label-sm border-checkbox-label" for="exceptDay1">
                                              월
                                          </label>
                                      </div>
                                      <div class="border-checkbox-group border-checkbox-group-inverse d-inline-block">
                                          <input class="border-checkbox limit-day" type="checkbox" name="exceptDay2" id="exceptDay2" value="2">
                                          <label class="form-label form-label-sm border-checkbox-label" for="exceptDay2">
                                              화
                                          </label>
                                      </div>
                                      <div class="border-checkbox-group border-checkbox-group-inverse d-inline-block">
                                          <input class="border-checkbox limit-day" type="checkbox" name="exceptDay3" id="exceptDay3" value="3">
                                          <label class="form-label form-label-sm border-checkbox-label" for="exceptDay3">
                                              수
                                          </label>
                                      </div>
                                      <div class="border-checkbox-group border-checkbox-group-inverse d-inline-block">
                                          <input class="border-checkbox limit-day" type="checkbox" name="exceptDay4" id="exceptDay4" value="4">
                                          <label class="form-label form-label-sm border-checkbox-label" for="exceptDay4">
                                              목
                                          </label>
                                      </div>
                                      <div class="border-checkbox-group border-checkbox-group-inverse d-inline-block">
                                          <input class="border-checkbox limit-day" type="checkbox" name="exceptDay5" id="exceptDay5" value="5">
                                          <label class="form-label form-label-sm border-checkbox-label" for="exceptDay5">
                                              금
                                          </label>
                                      </div>
                                      <div class="border-checkbox-group border-checkbox-group-inverse d-inline-block">
                                          <input class="border-checkbox limit-day" type="checkbox" name="exceptDay6" id="exceptDay6" value="6">
                                          <label class="form-label form-label-sm border-checkbox-label" for="exceptDay6">
                                              토
                                          </label>
                                      </div>
                                      <div class="border-checkbox-group border-checkbox-group-inverse d-inline-block">
                                          <input class="border-checkbox limit-day" type="checkbox" name="exceptDay0" id="exceptDay0" value="0">
                                          <label class="form-label form-label-sm border-checkbox-label" for="exceptDay0">
                                              일
                                          </label>
                                      </div>
                                  </div>
                                  
                              </div>
                          </div>
                      </div>
                  </div>
                  
                  <div class="card-header p-b-0">
                      <h3 class="sub-title"><strong>금액 설정</strong></h3>
                  </div>
                  
                  <div class="card-block-small p-t-0" id="insertFormListArea">
                  
                     <form class="insert-form" id="insertFrm1" >
                      <div class="row align-items-center insert-form">
                          <div class="col-10 row">
                              <div class="col-12 col-lg-7 mb-3">
                                  <div class="mb-0 form-group required">
                                      <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>요일선택</strong></div>
                                      <div class="border-checkbox-section">
                                          <div class="border-checkbox-group border-checkbox-group-inverse d-inline-block">
                                              <input class="border-checkbox check-day" type="checkbox" name="1day1" id="1day1" value="1">
                                              <label class="form-label form-label-sm border-checkbox-label" for="1day1">
                                                  월
                                              </label>
                                          </div>
                                          <div class="border-checkbox-group border-checkbox-group-inverse d-inline-block">
                                              <input class="border-checkbox check-day" type="checkbox" name="1day2" id="1day2" value="2">
                                              <label class="form-label form-label-sm border-checkbox-label" for="2day2">
                                                  화
                                              </label>
                                          </div>
                                          <div class="border-checkbox-group border-checkbox-group-inverse d-inline-block">
                                              <input class="border-checkbox check-day" type="checkbox" name="1day3" id="1day3" value="3">
                                              <label class="form-label form-label-sm border-checkbox-label" for="3day3">
                                                  수
                                              </label>
                                          </div>
                                          <div class="border-checkbox-group border-checkbox-group-inverse d-inline-block">
                                              <input class="border-checkbox check-day" type="checkbox" name="1day4" id="1day4" value="4">
                                              <label class="form-label form-label-sm border-checkbox-label" for="1day4">
                                                  목
                                              </label>
                                          </div>
                                          <div class="border-checkbox-group border-checkbox-group-inverse d-inline-block">
                                              <input class="border-checkbox check-day" type="checkbox" name="1day5" id="1day5" value="5">
                                              <label class="form-label form-label-sm border-checkbox-label" for="1day5">
                                                  금
                                              </label>
                                          </div>
                                          <div class="border-checkbox-group border-checkbox-group-inverse d-inline-block">
                                              <input class="border-checkbox check-day" type="checkbox" name="1day6" id="1day6" value="6">
                                              <label class="form-label form-label-sm border-checkbox-label" for="1day6">
                                                  토
                                              </label>
                                          </div>
                                          <div class="border-checkbox-group border-checkbox-group-inverse d-inline-block">
                                              <input class="border-checkbox check-day" type="checkbox" name="1day0" id="1day0" value="0">
                                              <label class="form-label form-label-sm border-checkbox-label" for="1day0">
                                                  일
                                              </label>
                                          </div>
                                      </div>
                                  </div>
                              </div>
                              <div class="col-12 col-lg-5 mb-3">
                                  <div class="mb-0 form-group required">
                                      <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="payment1"><strong>금액설정(1박 기준)</strong></label>
                                      <div class="col-12 row align-items-center">
                                          <div class="col-auto">
                                              <input type="text" class="col-lg-auto form-control form-control-sm" name="payment1" id="payment1" >
                                          </div>
                                          <div class="col-auto p-l-0 p-r-0">
                                              원
                                          </div>
                                          <div class="col-auto">
                                              <div class="border-checkbox-section">
                                                  <div class="border-checkbox-group border-checkbox-group-inverse">
                                                      <input class="border-checkbox" type="checkbox" name="payFree1" id="payFree1" onclick="paymentFree()">
                                                      <label class="form-label form-label-sm border-checkbox-label mb-0" for="payFree1">
                                                          무료
                                                      </label>
                                                  </div>
                                              </div>
                                          </div>
                                      </div>
                                  </div>
                              </div>
                          </div>
                          <div class="col-2">
                              <div class="input-group-text btn btn-primary" onclick="addInsertFrm()">+</div>
                          </div>
                      </div>
                      </form>
                      
                      
                  </div>
              </div>
           <!--html load area end  -->

  <!--ㅡmodal body end  -->
  <div class="modal-footer">
      <button type="button" class="btn btn-primary waves-effect waves-light" onclick="save()">저장</button>
  </div>
  
        
    
  <script type="text/javascript" src="/files/assets/pages/advance-elements/swithces.js"></script>
  <script type="text/javascript" src="/files/assets/pages/advance-elements/select2-custom.js"></script>
  
  <script  id="insertForm" type="text/x-handlebars-template">

   <form class="insert-form" id="insertFrm{{insertFrmNum}}" >
   <div class="row align-items-center insert-form">
       <div class="col-10 row">
           <div class="col-12 col-lg-7 mb-3">
               <div class="mb-0 form-group required">
                   <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>요일선택</strong></div>
                   <div class="border-checkbox-section">
                       <div class="border-checkbox-group border-checkbox-group-inverse d-inline-block">
                           <input class="border-checkbox check-day" type="checkbox" name="{{insertFrmNum}}day1" id="{{insertFrmNum}}day1" value="1">
                           <label class="form-label form-label-sm border-checkbox-label" for="{{insertFrmNum}}day1">
                               월
                           </label>
                       </div>
                       <div class="border-checkbox-group border-checkbox-group-inverse d-inline-block">
                           <input class="border-checkbox check-day" type="checkbox" name="{{insertFrmNum}}day2" id="{{insertFrmNum}}day2" value="2">
                           <label class="form-label form-label-sm border-checkbox-label" for="{{insertFrmNum}}day2">
                               화
                           </label>
                       </div>
                       <div class="border-checkbox-group border-checkbox-group-inverse d-inline-block">
                           <input class="border-checkbox check-day" type="checkbox" name="{{insertFrmNum}}day3" id="{{insertFrmNum}}day3" value="3">
                           <label class="form-label form-label-sm border-checkbox-label" for="{{insertFrmNum}}day3">
                               수
                           </label>
                       </div>
                       <div class="border-checkbox-group border-checkbox-group-inverse d-inline-block">
                           <input class="border-checkbox check-day" type="checkbox" name="{{insertFrmNum}}day4" id="{{insertFrmNum}}day4" value="4">
                           <label class="form-label form-label-sm border-checkbox-label" for="{{insertFrmNum}}day4">
                               목
                           </label>
                       </div>
                       <div class="border-checkbox-group border-checkbox-group-inverse d-inline-block">
                           <input class="border-checkbox check-day" type="checkbox" name="{{insertFrmNum}}day5" id="{{insertFrmNum}}day5" value="5">
                           <label class="form-label form-label-sm border-checkbox-label" for="{{insertFrmNum}}day5">
                               금
                           </label>
                       </div>
                       <div class="border-checkbox-group border-checkbox-group-inverse d-inline-block">
                           <input class="border-checkbox check-day" type="checkbox" name="{{insertFrmNum}}day6" id="{{insertFrmNum}}day6" value="6">
                           <label class="form-label form-label-sm border-checkbox-label" for="{{insertFrmNum}}day6">
                               토
                           </label>
                       </div>
                       <div class="border-checkbox-group border-checkbox-group-inverse d-inline-block">
                           <input class="border-checkbox check-day" type="checkbox" name="{{insertFrmNum}}day0" id="{{insertFrmNum}}day0" value="0">
                           <label class="form-label form-label-sm border-checkbox-label" for="{{insertFrmNum}}day0">
                               일
                           </label>
                       </div>
                   </div>
               </div>
           </div>
           <div class="col-12 col-lg-5 mb-3">
               <div class="mb-0 form-group required">
                   <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="payment1"><strong>금액설정(1박 기준)</strong></label>
                   <div class="col-12 row align-items-center">
                       <div class="col-auto">
                           <input type="text" class="col-lg-auto form-control form-control-sm" name="payment{{insertFrmNum}}" id="payment{{insertFrmNum}}" onclick="paymentFree('{{insertFrmNum}}')" >
                       </div>
                       <div class="col-auto p-l-0 p-r-0">
                           원
                       </div>
                       <div class="col-auto">
                           <div class="border-checkbox-section">
                               <div class="border-checkbox-group border-checkbox-group-inverse">
                                   <input class="border-checkbox" type="checkbox" name="payFree{{insertFrmNum}}" id="payFree{{insertFrmNum}}">
                                   <label class="form-label form-label-sm border-checkbox-label mb-0" for="payFree{{insertFrmNum}}">
                                       무료
                                   </label>
                               </div>
                           </div>
                       </div>
                   </div>
               </div>
           </div>
       </div>
       <div class="col-2">

           <div class="input-group-text btn btn-primary" onclick="removeInsertFrm('{{insertFrmNum}}')">-</div>

           <div class="input-group-text btn btn-primary" onclick="addInsertFrm()">+</div>

       </div>
   </div>
   </form>
  </script>
  
  <script th:inline="javascript">

    var insertFrmNum = 1 ;
    var insertFrmArr = [1] ;
    var limitDayArr = [] ;
     
    $(document).ready(function () {

    })
    
    $(".limit-day").bind("click",function(){
    	reCheckDayLimit();
    })
    
    
    reCheckDayLimit=()=>{
        
    	limitDayArr=[];
        $(".limit-day").each(function(){
            if($(this).is(":checked")){
                limitDayArr.push($(this).val())
            }
        })
        
        $(".check-day").each(function(){
            $(this).prop("disabled",false);
        })
        
        limitDayArr.forEach(function(dayNum){
            insertFrmArr.forEach(function(item){
                $("#"+item+"day"+dayNum).prop("checked",false);
                $("#"+item+"day"+dayNum).prop("disabled",true);
            })
        })
    }
    
    removeInsertFrm =(removeNum)=>{
    	$("#insertFrm"+removeNum).remove();

        var filterArr = insertFrmArr.filter(function(data) {
        	  return data != removeNum;
        	});
        insertFrmArr=filterArr;

        console.log(insertFrmArr);
        
    }
    
    addInsertFrm =()=>{
    	if(insertFrmArr.length >= 7) { alert("입력폼은 7개 까지 가능 합니다."); return;}
    	insertFrmNum++;
        let source = $("#insertForm").html(); 
        let template = Handlebars.compile(source); 
        let data = {insertFrmNum:insertFrmNum }; 
        let html = template(data);
        
        $("#insertFormListArea").append(html);
        
        insertFrmArr.push(insertFrmNum);

        reCheckDayLimit();
    }


    save =()=>{
        
    	var rsvtStrtDt = $("#rsvtStrtDt").val();
    	var rsvtEndtDt = $("#rsvtEndtDt").val();

    	if(rsvtStrtDt == null || rsvtStrtDt == ""){
        	alert("예약시작일을 입력해주십시오")
        	showErrorMark("#rsvtStrtDt")
        	return;
        }
    	if(rsvtEndtDt == null || rsvtEndtDt == "" ){
            alert("예약종료일을 입력해주십시오")
            showErrorMark("#rsvtEndtDt")
            return;
        }
        
        let today = moment().format('YYYYMMDD');
        
    	if(rsvtStrtDt.replaceAll("-","") < today ){
            alert("예약시작일은 금일보다 이후여야 합니다.")
            showErrorMark("#rsvtStrtDt")
            return;
        }
        
    	if(rsvtEndtDt.replaceAll("-","") < today ){
            alert("예약종료일은 금일보다 이후여야 합니다.")
            showErrorMark("#rsvtEndtDt")
            return;
        }
        
    	if( rsvtStrtDt.replaceAll("-","") > rsvtEndtDt.replaceAll("-","")){
    		alert("예약종료일은 예약시작일 이후여야 합니다.")
            showErrorMark("#rsvtEndtDt")
            return;
	    }
	    
    	let start = moment(rsvtStrtDt)//.format('YYYY-MM-DD');
    	let end = moment(rsvtEndtDt)//.format('YYYY-MM-DD');
    	
    	let days = moment.duration(end.diff(start)).asDays();

    	let daysArr =[];
    	
    	for(let i=0; i<days+1 ;i++){
    		daysArr.push(start.add(i,'day').format('YYYY-MM-DD'))
        }
        
        let dayNums =[];

        $(".check-day").each(function(){
            if($(this).is(":checked")){
            	dayNums.push($(this).val())
            }
        })

        let dupYn = false;
        for(let i = 0; i < dayNums.length; i++) {
        	  let currElem = dayNums[i];
        	  for(let j = i+1; j < dayNums.length; j++) {
        	    if(currElem === dayNums[j]) {
        	      dupYn = true;
        	      break;
        	    }
        	  }
        }

        if(dupYn){
            alert("중복되는 요일이 있습니다. 확인해주십시오.");
            return;
        }
















        
    }
















    




    
    
    
    var selectedItems = [];
    var gridHelper1;         
    $(function(){
        //gridHelper1 = new GridHelper('subJsGrid','contentPanel');
        
        writeManagerModalGridData();
    });

    searchManagerList = () =>{
        $("#instManagerModalGrid").jsGrid("reset");
    }
    
    initSearchManager = () =>{
    	$("#searchManagerModalFrm #searchType").val("");
    	$("#searchManagerModalFrm  #searchKeyword").val("");
    }
    
    function writeManagerModalGridData(){
        
        $("#instManagerModalGrid").jsGrid({
            height: "auto",
            width: "100%",
            autoload: true,
            sorting: true,
            paging: true,
            pagerContainer: "#listPager3",
            pagerFormat: "{first} {prev} {pages} {next} {last}",
            pagePrevText: "이전",
            pageNextText: "다음",
            pageFirstText: " < 처음 ㅣ",
            pageLastText: " | 마지막 >",
            pageSize: 10,
            pageButtonCount: 10,
            pageLoading: true,
            pageIndex: 1,
            noDataContent: "데이터가 없습니다.",
            
            controller: {
                loadData: function (filter) {
                    var data = $.Deferred();
                                            
                    var formData = $('#searchManagerModalFrm').serializeArray();
                    var params = [
                            {name: "pageNumber", value: filter.pageIndex},
                            {name: "rowPerPage", value: filter.pageSize},
                    ]
                    
                    if(filter.sortField != undefined){
                        params.push({name: "orderField", value: filter.sortField});
                        params.push({name: "orderDirection", value: filter.sortOrder});
                    }else{
                        params.push({name: "orderField", value: 'reg_dt'});
                    }

                    var paramid = {
                    		name:"instid" ,value: $("#searchManagerFrm #instid").val()
                    }

                    formData = formData.concat(params);
                    formData = formData.concat(paramid);

                    $.ajax({
                      type: "GET",
                      contentType: "application/json; charset=utf-8",
                      url: "/mng/inst/selectInstUser.do",
                      dataType: "json",
                      data: formData,
                    }).done(function(response){
                        var da = {
                                data : escapeGridData(response.list)
                                ,itemsCount : response.totalCount
                            };
                      data.resolve(da);
                    });
                    return data.promise();
                },
            },
            fields: [
                 {
                     itemTemplate: function(_, item) {
                         return $("<input>").attr("type", "radio").attr("class", "singleCheckbox3").attr("name","memchk")
                                .attr("value",item.userid).attr("id","memchk_"+item.userid)
                     },
                     align: "center",
                     width: "30",
                     sorting: false
                 }   
                ,{ name: 'userid', css: 'hide' }
                ,{ name: 'nm', css: 'hide' }
                ,{ title: '사용자'   ,name: 'nm'    ,type: "text" , width: "200" 
                    ,itemTemplate:function(value,item){return item.nm +" ( "+item.eml+" )"                        }
                    }
                ,{ title: '핸드폰'  ,name: 'moblphon',type: "text" , width: "150" ,align:"center"}
                ,{ title: '메일'   ,name: 'eml'     ,type: "text" , width: "200" }
            ],
            rowClick: function(args) {
                $("#memchk_"+args.item.userid).prop("checked",true);
                
            }
        });
    }

  var applyInstManager = () =>{
	  
      if($('input[name=memchk]:checked').length <= 0){
          alert("담당자를 선택해주세요");
          return;
      }

      if(!confirm("담당자로 등록 하시겠습니까?"))return; 
      
	  let chekcedUsrid = $('input[name=memchk]:checked').val();

	  var params = {
			  instid : $("#searchManagerFrm #instid").val(),
			  userid : chekcedUsrid 	  
	  }
	  
      if(displayWorkProgress()){
          $.ajax({
              url : "/mng/inst/updateInstUser.do",
              type: 'POST',
              cache : false,
              dataType: 'json',
              data : params,
              success : function (data){
                  alert(data.msg);
			      //담당자 그리드 목록 리셋
				  $("#instMemGrid").jsGrid("reset");
				  instManagerSearchModal.hide();
                  closeWorkProgress();
              }
          });
      }
  }
  
</script>
</body>
</html>