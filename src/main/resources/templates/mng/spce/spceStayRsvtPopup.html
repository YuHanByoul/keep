    <!-- 숙박 -->
    <div class="con-pane" id="useStatusSelect1">
        <div class="card-block-small">
            <div class="col-12 table-border-style">
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                        <tr>
                            <th class="v-middle" style="width: 70px;">선택 예약일</th>
                            <th class="v-middle" style="width:200px;">금액 설정</th>
                        </tr>
                        </thead>
                        <tbody id="frmListArea">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
<!--    <div class="modal-footer">
      <button type="button" class="btn btn-primary waves-effect waves-light" onclick="save()">저장</button>
   </div> -->
   
  <script type="text/javascript" src="/files/assets/pages/advance-elements/swithces.js"></script>
  
  <script  id="insertFrm" type="text/x-handlebars-template">
      <form id="insertForm{{frmNum}}"> 
      <input type="hidden" id="de{{frmNum}}" name="de{{frmNum}}"  value="{{de}}">
       <tr>
          <td class="v-middle">{{date}}</td>
          <td class="v-middle">
               <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="amt{{frmNum}}"><strong>금액설정(1박 기준)</strong></label>
               <div class="col-12 row align-items-center m-0">
                   <div class="col-auto p-l-0">
                       <input type="number" class="col-lg-auto form-control form-control-sm text-right" name="amt{{frmNum}}" id="amt{{frmNum}}"  value="{{amt}}" style="width:88px;">
                   </div>
                   <div class="col-auto p-l-0 p-r-0">
                       원
                   </div>
                   <div class="col-auto p-r-0">
                       <div class="border-checkbox-section">
                           <div class="border-checkbox-group border-checkbox-group-inverse">
                               <input class="border-checkbox payment-check-box" type="checkbox" name="paymentCheck" id="paymentCheck{{frmNum}}" value="{{frmNum}}">
                               <label class="form-label form-label-sm border-checkbox-label m-0" for="paymentCheck{{frmNum}}" {{#if amt}} checked{{/if}}>
                                   무료
                               </label>
                           </div>
                       </div>
                   </div>
               </div>
           </td>
       </tr>
  </script>
  
  <script th:inline="javascript">

    var insertFrmNum = 0 ;
    var insertFrmArr = [] ;
    var limitDayArr = [] ;
    var checkedDateArray =[];

    /*<![CDATA[*/ 
    var rsvtList = /*[[${rsvtList}]]*/null;
    /*]]>*/
     
    $(document).ready(function () {

        if(singleChoiceDt!=null && singleChoiceDt != ""){
            checkedDateArray=[singleChoiceDt];
        }else{
            $(".checkDay").each(function(){
                if($(this).is(":checked")){
                    checkedDateArray.push($(this).val());
                }
            })
        }

        var dayStr ="";
        var htmlStr ="";
        
        if(mode=='MS' && rsvtList.length > 0){
            
        	rsvtList.forEach(function(item){
                insertFrmNum++;
                var dd = moment(item.de,"YYYY-MM-DD").day();
                
                switch (dd){
                    case 0 : dayStr = '(일)'; break; 
                    case 1 : dayStr = '(월)'; break; 
                    case 2 : dayStr = '(화)'; break; 
                    case 3 : dayStr = '(수)'; break; 
                    case 4 : dayStr = '(목)'; break; 
                    case 5 : dayStr = '(금)'; break; 
                    case 6 : dayStr = '(토)'; break; 
                }
                
                var source = $("#insertFrm").html();
                var template = Handlebars.compile(source);
                var data = {
                         'date'    : item.de+" "+dayStr
                         ,'de'     : item.de
                         ,'frmNum' : insertFrmNum
                         ,'amt'    : item.amt
                         
                };
                htmlStr += template(data);
                insertFrmArr.push(insertFrmNum);
            })
        	
        }else{
            
	        checkedDateArray.forEach(function(date){
	            insertFrmNum++;
	            var dd = moment(date,"YYYY-MM-DD").day();
	            
	            switch (dd){
	                case 0 : dayStr = '(일)'; break; 
	                case 1 : dayStr = '(월)'; break; 
	                case 2 : dayStr = '(화)'; break; 
	                case 3 : dayStr = '(수)'; break; 
	                case 4 : dayStr = '(목)'; break; 
	                case 5 : dayStr = '(금)'; break; 
	                case 6 : dayStr = '(토)'; break; 
	            }
	            
	            var source = $("#insertFrm").html();
	            var template = Handlebars.compile(source);
	            var data = {
	                     'date' :   date+" "+dayStr
	                     ,'de' :   date
	                     ,'frmNum' :   insertFrmNum
	            };
	             htmlStr += template(data);
	            insertFrmArr.push(insertFrmNum);
	        })
            
        }
        
        
        $("#frmListArea").html(htmlStr);

        $("input[name=paymentCheck]").bind("change",function(){
            
	                if($(this).is(":checked")){
	                    $("#amt"+$(this).val()).val("0").attr("readonly",true)
	                }else{
	                    $("#amt"+$(this).val()).val("").attr("readonly",false)
		            }
	        })
    })


	    $("input[name=fixedPaymentCheck]").bind("change",function(){
			
			var isChecked = $("input[name=fixedPaymentCheck]").is(":checked");

			if(isChecked){
				insertFrmArr.forEach(function(frmNo){
					$("#fixedPayment"     ).val("0").attr("readonly",true)
					$("#amt"+frmNo     ).val("0").attr("readonly",true)
					$("#paymentCheck"+frmNo).prop("checked",true).attr("onclick",'return false;') 
					
				})
			}else{
				
				insertFrmArr.forEach(function(frmNo){
					$("#fixedPayment"     ).val("").attr("readonly",false)
					$("#amt"+frmNo     ).val("").attr("readonly",false)
					$("#paymentCheck"+frmNo).removeAttr("onclick").prop("checked",false) 
				})
			} 
		})
		
		$("#fixedPayment").keyup(function(){
			
			var inputValue = $("#fixedPayment").val();
			
			if(inputValue !=null && inputValue !=""){
				
			    insertFrmArr.forEach(function(frmNo){
                    $("#amt"+frmNo     ).val(inputValue).attr("readonly",true)
                    $("#paymentCheck"+frmNo).prop("checked",false).attr("onclick",'return false;')
                })
                
			}else{
				
			    insertFrmArr.forEach(function(frmNo){
                    $("#amt"+frmNo     ).val("").attr("readonly",false)
                    $("#paymentCheck"+frmNo).removeAttr("onclick").prop("checked",false)
                })
			}
		})

	    var save =()=>{
		    
            var payValidation = true;
            var payValidationMsg = "";
	    	insertFrmArr.forEach(function(frmNo){
                var userAmt = $("#amt"+frmNo).val();

                if(userAmt == null || userAmt == ""){
                    payValidation = false;
                    payValidationMsg = "금액을 입력해주십시오"
                }
                if(userAmt==0 && !$("#paymentCheck"+frmNo).is(":checked")){
                	payValidation = false;
                	payValidationMsg = "금액은 0 이상이어야 합니다. "
                }
            })
            
            if(!payValidation){
                alert(payValidationMsg);
                return;
            }

	    	if(!confirm("등록 하시겠습니까?"))return;

            let chkinHr = (spceVo.chkinHr!=null && spceVo.chkinHr!='')?spceVo.chkinHr:"";
            let chcktHr = (spceVo.chcktHr!=null && spceVo.chcktHr!='')?spceVo.chcktHr:"";

            //parameter  설정
            var rsvtdeList=[];
            var rsvtStrtDt = "";
            insertFrmArr.forEach(function(frmNo){
                if(rsvtStrtDt ==""){
                    rsvtStrtDt = $("#de"+frmNo).val();
                }                
            	rsvtdeList.push(
            			{ 'amt': $("#amt"+frmNo).val()
                            ,'de' : $("#de"+frmNo).val()
                            ,'alldayYn' :'Y'
                            ,'spceid' : spceVo.spceid
                            ,'utztnSeCd' : '169101'
                            ,'bgngDt'   :$("#de"+frmNo).val() +" "+chkinHr 
                            ,'endDt'    :(moment($("#de"+frmNo).val()).add(1,'d')).format('YYYY-MM-DD')+" "+chcktHr
                            ,'rsvtPsbltyYn' :'Y'  
                          }
                )
            })
            
           var params={
	            'rsvtdeList' : rsvtdeList
	            ,'spceid' : spceVo.spceid   
           }

           let reqUrl = (mode=='R')?"/mng/spce/InsertSpceTotalStayInfo.do":"/mng/spce/modifyRentRsvt.do";
           
           if(displayWorkProgress()){
                $.ajax({
                    url : reqUrl,
                    type: 'POST',
                    cache : false,
                    traditional : true, //필수
                    contentType: "application/json; charset=utf-8",
                    dataType: 'json',
                    data :JSON.stringify(params),
                    success : function (data){
                        if(data.result=='success'){
                            //$('#calendar').fullCalendar('gotoDate', moment(rsvtStrtDt).format('YYYY-MM-DD'));
                            setTimeout(function(){makeCalendarEvent();},100)
                            $(".checkDay").each(function(){$(this).prop("checked",false);})
                            alert(data.msg);
                            spceModal.hide();
                        }else{
                            alert(data.msg);
                        }
                        closeWorkProgress();
                    }
                });
            }
            
		}
		

  
</script>
</body>
</html>