<div class="modal-dialog modal-lg" role="document" xmlns:kattr="http://www.w3.org/1999/xhtml">
    <div class="modal-content type_2">
        <div class="modal-header">
            <h4 class="modal-title">심사문항 검색</h4>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                <span aria-hidden="true"></span>
            </button>
        </div>
        <div class="modal-body">
            <div class="card">
                <div class="card-block-small">
                    <div class="row">
                        <div class="col-12 col-lg-6">
                            <div class="mb-0 form-group">
                                <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>지정기준</strong></div>
                                <div class="col-12">
                                    <span kattr:select_code="searchDsgncrtrCd" grpCd="149" firstOptTxt="- 전체 -"  addClass="form-select form-select-sm form-control-sm" ></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="m-t-20 text-center">
                        <button type="button" class="btn btn-disabled m-r-5" onclick="srngQitemPopup.initSearch();">초기화</button>
                        <button type="submit" class="btn btn-primary" onclick="srngQitemPopup.onSearch();">검색</button>
                    </div>
                </div>
            </div>
            <div class="card m-b-10" id="qitemListBody">
                <div class="card-block-small">
                    <div class="dt-responsive table-responsive">
                        <div id="order-table_wrapper" class="dataTables_wrapper dt-bootstrap4">
                            <table id="qitemGrid" class="table-responsive"></table>
                            <div id="qitemPager" class="text-center"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary waves-effect waves-light" onclick="srngFormQitem.addQitem();">선택</button>
        </div>
    </div>
</div>

<script th:inline="javascript">
    var qitemArr = /*[[${qitemArr}]]*/null;
    var srngQitemPopup = {
        listUrl : "/mng/srng/selectSrngQitemList.do",

        init: function() {
            qitemGrid = new GridHelper("qitemGrid");
            this.setGrid();
        },

        initSearch: function() {
            $('#searchDsgncrtrCd').val('');
        },

        onSearch: function() {
            qitemGrid.resetListContent();
        },

        allSelectItem: function(isChecked) {
            if(isChecked) {
                $('.singleCheckbox').each(function() {
                    this.checked = true;
                });
            } else {
                $('.singleCheckbox').each(function() {
                    this.checked = false;
                });
            }
        },

        setGrid: function() {
            $("#qitemGrid").jsGrid({
                height: "300px",
                width: "100%",
                autoload: true,
                sorting: true,
                paging: false,
                pagerContainer: "#qitemPager",
                pagerFormat: "{first} {prev} {pages} {next} {last}",
                pagePrevText: "이전",
                pageNextText: "다음",
                pageFirstText: " < 처음 ㅣ",
                pageLastText: " | 마지막 >",
                pageSize: 20000,
                pageButtonCount: 10,
                pageLoading: true,
                pageIndex: 1,
                noDataContent: "데이터가 없습니다.",
                controller: {
                    loadData: function(filter) {
                        var data = $.Deferred();
                        var params = [
                            {name: "searchDsgncrtrCd", value: $('#searchDsgncrtrCd').val()},
                            {name: "pageNumber", value: filter.pageIndex},
                            {name: "rowPerPage", value: filter.pageSize},
                            {name: "orderField", value: "REG_DT"},
                            {name: "orderDirection", value: "asc"},
                        ];
                        if(qitemArr !== null){
                            for (const qitemId of qitemArr) {
                                params.push({name: "qitemArr", value: qitemId})
                            }
                        }

                        $.ajax({
                            type: "GET",
                            contentType: "application/json; charset=utf-8",
                            url: srngQitemPopup.listUrl,
                            data: params,
                            dataType: "json"
                        }).done(function(response) {
                            var da = {
                                data : escapeGridData(response.list),
                                itemsCount : response.totalCount
                            };
                            data.resolve(da);
                        });

                        return data.promise();
                    }
                },
                fields: [
                    {
                        headerTemplate: function() {
                            return $("<input>").attr("type", "checkbox").attr("id", "selectAllCheckbox").on("change", function() {
                                srngQitemPopup.allSelectItem($(this).is(":checked"));
                            });
                        },
                        itemTemplate: function(_, item) {
                            return $("<input>").attr("type", "checkbox").attr("class", "singleCheckbox")
                                .data({"dsgncrtrCd":item.dsgncrtrCd, "qitemid": item.qitemid, "idntyMttr":item.idntyMttr})
                        },
                        align: "center",
                        width: "30",
                        sorting: false
                    },
                    {title: "지정기준", name: "dsgncrtrCdNm", type: "number", width: "180", align: "left"},
                    {title: "확인사항", name: "idntyMttr", type: "text", width: "300", align: "left"}
                ]
            });
        },
    };

    $(function() {
        srngQitemPopup.init();
    });
</script>