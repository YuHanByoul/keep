<!-- 게시글 품질관리 체크리스트 -->
<div class="modal-dialog modal-xl" role="document">
    <div class="modal-content type_2">
        <div class="modal-header">
            <h4 class="modal-title">게시글 품질관리 체크리스트</h4>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                <span aria-hidden="true"></span>
            </button>
        </div>
        <div class="modal-body">
            <div class="card m-b-10">
                <div class="card-block-small">
                    <form id ="cmmCntntsQlityForm">
                    <input type="hidden" name="trgtCd" th:value="${trgtCd}" />
                    <input type="hidden" name="evntCd" th:value="${evntCd}" />
                    <input type="hidden" name="cntntsid" th:value="${cntntsid}" />
                    <th:block th:if="${cmmCntnts != null}">
                        <input type="hidden" name="checkid" th:value="${cmmCntnts.checkid}" />
                    </th:block>
	                    <table class="table table-framed table-bordered td-wrap">
	                        <thead>
	                            <tr class="border-bottom-inverse">
	                                <th class="text-center v-middle">검수분야</th>
	                                <th class="text-center v-middle">검수사항</th>
	                                <th class="text-center v-middle">준수여부 </th>
	                            </tr>
	                        </thead>
	                        <tbody id="chklistTbody"></tbody>
	                        <tfoot>
	                            <tr>
	                                <td class="text-center v-middle" colspan="2"><strong>콘텐츠 품질관리 검수사항을 모두 확인하였음</strong></td>
	                                <td class="text-center v-middle">
	                                    <div class="border-checkbox-section">
	                                        <div class="border-checkbox-group">
	                                            <input class="border-checkbox" type="checkbox" name="chkAll" id="chkAll">
	                                            <label class="form-label form-label-sm border-checkbox-label" for="chkAll">
	                                                전체 확인 
	                                            </label>
	                                        </div>
	                                    </div>
	                                </td>
	                            </tr>
	                        </tfoot>
	                    </table>
                    </form>                    
                    <div>
                        <button type="button" class="btn btn-link px-0">[한국형 웹콘텐츠 접근성 지침 다운로드]</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary waves-effect waves-light" onclick="cmmCntntsQlity.insertCmmCntntsQlity();">확인</button>
        </div>
    </div>
</div>
<!-- //게시글 품질관리 체크리스트 -->
<script th:inline="javascript">
	$(function () {
		cmmCntntsQlity.selectCmmCntntsQlityChklstList();
	    $('#chkAll').on('click', function(e) {
	        if(e.target.checked) {
	        	$(".border-checkbox").prop("checked", true);
	        } else {
	        	$(".border-checkbox").prop("checked", false);
	        }
	    });
	    validForm();
	})
	var cmmCntntsQlity = {
		listUrl: '/mng/cmmCntnts/selectCmmCntntsQlityChklstList.do',			
		insertUrl: '/mng/cmmCntnts/insertCmmCntntsQlity.do',			
		updateUrl: '/mng/cmmCntnts/updateCmmCntntsQlity.do',			
		selectCmmCntntsQlityChklstList() {
            if (displayWorkProgress(true)) {
                var formData = $('#cmmCntntsQlityForm').serializeArray();
                $.ajax({
                    url: cmmCntntsQlity.listUrl,
                    cache: false,
                    dataType: 'json',
                    data: formData,
                    type: 'GET',
                    success: function (data) {
                        cmmCntntsQlity.makeListHtml(data);
                        closeWorkProgress();
                    }
                });
            }
        },			
		makeListHtml(data) {
            var listHtml = "";
            if (data.chklist == null || data.chklist.length <= 0) {
                //listHtml += `<p><span class="icon icon-notice bg-black9"></span>등록된 체크리스트가 없습니다.</p>`;
                //$('#chklistTbody').html(listHtml);
                
            } else {
                data.chklist.forEach(function(item, index) {
                    listHtml += `
		                    <tr>`;
		            if(item.ordr == '1'){
		            	listHtml += `<th class="text-center v-middle" rowspan="`;
		            	listHtml += item.colspan;
		            	listHtml += `">${item.fldNm}</th>`;		            	
		            }
		            listHtml += `		            
		                        <td>${item.cn}</td>
		                        <td class="text-center v-middle">
		                            <div class="border-checkbox-section">
		                                <div class="border-checkbox-group">
		                                    <input class="border-checkbox" type="checkbox" id="chklstYn`;
		                                    	listHtml += index;
                    if(item.chkYn == 'Y'){
                    	listHtml += `" checked>`;  	
                    }else{
                    	listHtml += `">`;  		                                    	
                    }
                    listHtml += `           <label class="form-label form-label-sm border-checkbox-label" for="chklstYn`;
                                                listHtml += index;		                                    
                                                listHtml += `">
		                                        확인
		                                    </label>
		                                </div>
		                            </div>
		                        </td>
		                    </tr>`;                       
                });
                $('#chklistTbody').html(listHtml);
            }
		},
	    insertCmmCntntsQlity() {
			if($(".border-checkbox").length != $(".border-checkbox:checked").length){
				alert('검수사항 준수여부 미확인 항목이 있으니 다시 확인해주세요.');
				return;
			}
	        /*if(!$('#cntntsYn1').is(':checked') || !$('#cntntsYn2').is(':checked') || !$('#cntntsYn3').is(':checked') || !$('#cntntsYn4').is(':checked')
	        		 || !$('#webAcsbtYn1').is(':checked') || !$('#webAcsbtYn2').is(':checked') || !$('#webAcsbtYn3').is(':checked')
	        		 || !$('#cprghtYn1').is(':checked') || !$('#cprghtYn2').is(':checked') || !$('#cprghtYn3').is(':checked')
	        		 || !$('#prvcYn').is(':checked') || !$('#rghtOfPrtrtYn').is(':checked') || !$('#etcYn').is(':checked')) {
	            alert('검수사항 준수여부 미확인 항목이 있으니 다시 확인해주세요.');
	            return ;
	        } */
	        var url = $("[name=evntCd]").val() == '247001' ? insertUrl : updateUrl;
	        
	        if(!confirm("검수사항 준수여부를 모두 확인하였으며, 향후 조치사항 발생 시 대응할 것에 동의합니다.")) return;
	        var data =  $("#cmmCntntsQlityForm").serialize();
	        if(displayWorkProgress()){
	            $.ajax({
	                url : url,
	                type: 'POST',
	                cache : false,
	                dataType: 'json',
	                data : data,
	                success : function (data){
	                    if(data.result=="success"){
	                        alert(data.msg);
	                    }else{
	                        alert(data.msg);
	                    }
	                    closeWorkProgress();
	                }
	            });
	        }	        
	        cmmCntntsQlityModal.hide();
	    },
	    validForm() {
	        $("#cmmCntntsQlityForm").validate({
	            onsubmit: false,
	            rules: {
	            	trgtCd: {required: true},
	            	evntCd: {required: true}
	            },
	            messages: {
	            	trgtCd: {required: "대상 코드가 없습니다."},
	            	evntCd: {required: "이벤트 코드가 없습니다."}
	            }
	        });	   
	    }
	}
</script>