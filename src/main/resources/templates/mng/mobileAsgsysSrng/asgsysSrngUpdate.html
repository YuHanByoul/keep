<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="layout/mng/mobileSubLayout"
>
<body>
<div layout:fragment="content">
    <form id ="asgsysSrngUpdate">
    
    <div class="page-body">
        <input type="hidden" id="prgrmid" name="prgrmid" th:value="${mobileAsgsysSrngInfo.prgrmid}"><!-- 프로그램id -->
        <input type="hidden" id="checkVstDt" name="checkVstDt" th:value="${mobileAsgsysSrngInfo.vstDt}"><!-- 프로그램id -->   
        
        <div class="card">
			<div class="card-block">
				<div class="row justify-content-center">
					<div class="col col-lg-6">
						<!-- Bootstrap slider card start -->
						<div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
							<ol class="carousel-indicators">
								<th:block th:each="item, itemStat : ${mobileAsgsysSrngInfo.eduPhotoFileInfo}">
									<th:block th:if="${itemStat.index == 0}">							
										<li data-bs-target="#carouselExampleIndicators" th:data-bs-slide-to="${itemStat.index}" class="active"></li>
									</th:block>
									<th:block th:unless="${itemStat.index == 0}">
										<li data-bs-target="#carouselExampleIndicators" th:data-bs-slide-to="${itemStat.index}"></li>
									</th:block>									
								</th:block>
							</ol>
							<div class="carousel-inner" role="listbox">
								<th:block th:each="item, itemStat : ${mobileAsgsysSrngInfo.eduPhotoFileInfo}">
									<th:block th:if="${itemStat.index == 0}">
										<div class="carousel-item active">
											<img class="d-block img-fluid w-100" th:src="'/downloadFileByFileid.do?fileid='+${item.fileid}+'&file_idntfc_key='+${item.fileIdntfcKey}" alt="">
										</div>								
									</th:block>
									<th:block th:unless="${itemStat.index == 0}">
										<div class="carousel-item">
											<img class="d-block img-fluid w-100" th:src="'/downloadFileByFileid.do?fileid='+${item.fileid}+'&file_idntfc_key='+${item.fileIdntfcKey}" alt="">
										</div>								
									</th:block>
								</th:block>
							</div>
							<a class="carousel-control-prev" data-bs-target="#carouselExampleIndicators" role="button" data-bs-slide="prev">
								<span class="carousel-control-prev-icon" aria-hidden="true"></span>
								<span class="visually-hidden">Previous</span>
							</a>
							<a class="carousel-control-next" data-bs-target="#carouselExampleIndicators" role="button" data-bs-slide="next">
								<span class="carousel-control-next-icon" aria-hidden="true"></span>
								<span class="visually-hidden">Next</span>
							</a>
						</div>
						<!-- Bootstrap slider card end -->
					</div>
				</div>
			</div>

            <div class="card-block">
                <div class="form-group mb-3">
                    <div class="row align-items-end mb-2 justify-content-between">
                        <div class="col-auto">
                            <div class="form-label col-sm-12 col-form-label p-t-0 pb-0"><strong th:text="${mobileAsgsysSrngInfo.instNm}"></strong></div>
                            <strong class="f-16" th:text="${mobileAsgsysSrngInfo.prgrmNm}"></strong>
                        </div>
                        <div class="col-auto" style="margin-left:auto;">
                            <button type="button" class="btn btn-primary btn-sm" onclick="moveCheckList()">심사진행</button>
                        </div>
                    </div>
                    <div class="responsive">
                        <table class="table table-framed table-bordered td-wrap mb-0" style="table-layout:fixed;">
                            <tbody>
                            <tr>
                                <th class="text-center v-middle table-light">숙박여부</th>
                                <th class="text-center v-middle table-light">운영형태</th>
                            </tr>
                            <tr>
                                <td class="text-center v-middle" th:text="${mobileAsgsysSrngInfo.styYn}"></td>
                                <td class="text-center v-middle" th:text="${mobileAsgsysSrngInfo.operFrm}"></td>

                            </tr>
                            <tr>
                                <th class="text-center v-middle table-light">안전관리 사전인증</th>
                                <th class="text-center v-middle table-light">방문일시<i class="mark-required">*</i></th>
                            </tr>
                            <tr>
                                <td class="text-center v-middle" th:text="${mobileAsgsysSrngInfo.bfrCertYn}"></td>
                                <td class="text-center v-middle">
                                    <input type="datetime-local" name="vstDt" id="vstDt" class="form-control form-control-sm" th:value="${mobileAsgsysSrngInfo.vstDt}">
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
				<div class="form-group mb-3">
					<div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>첨부파일</strong></div>
					<div class="border rounded py-2 px-4">
						<div class="col-auto">
							<th:block th:each="item, itemStat : ${mobileAsgsysSrngInfo.fileInfo}">
								<span class="label label-inverse">
									<a class='text-white' href="javascript:void(0)" th:onclick="downloadFileByFileid([[${item.fileid}]],[[${item.fileIdntfcKey}]])"><th:block th:text="${item.orginlFileNm}"></th:block>&nbsp;&nbsp;</a>
								</span>
							</th:block>
						</div>
					</div>
				</div>
				<div class="form-group mb-3">
					<div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>증빙서류</strong></div>
					<div class="border rounded py-2 px-4">
						<div class="col-auto">
							<th:block th:each="item, itemStat : ${mobileAsgsysSrngInfo.bfrCertFilegrpInfo}">
								<span class="label label-inverse">
									<a class='text-white' href="javascript:void(0)" th:onclick="downloadFileByFileid([[${item.fileid}]],[[${item.fileIdntfcKey}]])"><th:block th:text="${item.orginlFileNm}"></th:block>&nbsp;&nbsp;</a>
								</span>
							</th:block>
						</div>
					</div>
				</div>				
            </div>

            <div class="card-block row justify-content-between">
                <div class="col-auto">
                    <button type="button" class="btn btn-disabled" onclick="moveAsgsysSrngList();">목록</button>
                </div>
                <div class="col-auto">
                    <button type="button" class="btn btn-primary" onclick="save();">저장</button>
                </div>
            </div>
        </div>
    </div>
    
    </form>
    
    <link rel="stylesheet" type="text/css" href="/files/bower_components/bootstrap-daterangepicker/daterangepicker.css">
    <script th:inline="javascript">
/* 	var validator = $("#asgsysSrngUpdate").validate({
	    rules: {
	    	vstDt		:	{ required: true }
	    },
	    messages: {
	    	vstDt		:   { required: "방문일시를 입력해주십시오." }
	    }
	}); */
	
    function moveCheckList() {
		if($("#checkVstDt").val() == "" || $("#checkVstDt").val() == null || $("#checkVstDt").val() == "undefined") {
			alert("방문일시를 저장후 진행해주십시오.");
			return false;
		}
    	location.href = "/mng/mobileAsgsysSrng/asgsysSrngCheckList.html?prgrmid="+$("#prgrmid").val();
    }
    
    function moveAsgsysSrngList() {
    	location.href = "/mng/mobileAsgsysSrng/asgsysSrngList.html"
    }
    
    function save() {
   	 	if(!($("#asgsysSrngUpdate").valid())) return;

     	if(!confirm("저장하시겠습니까?")) return;
     	 	    
   	    var data =  $("#asgsysSrngUpdate").serialize();
   	    
   	    if(displayWorkProgress()){
   			$.ajax({
   				url : "/mng/mobileAsgsysSrng/updateAsgsysSrng.do",
   				type: 'POST',
   				cache : false,
   				dataType: 'json',
   				data : data,
   				success : function (data){
   					if(data.result=="success"){
   						alert(data.msg);
   						location.reload();
   					}else{
   						alert(data.msg);
   					}
   					closeWorkProgress();
   				}
   			});
   		}
    }
    
    $(function(){
    	$("#mobile-btn-back").html("<a class='btn-back' href='/mng/mobileAsgsysSrng/asgsysSrngList.html'><i class='fa fa-angle-left'></i></a>");
    });
    </script>
</div>W
</body>
</html>