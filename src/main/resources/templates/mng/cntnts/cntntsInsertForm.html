<form id ="cntntsInsertForm">
		<!-- INSERT -->
		<div class="card-header p-b-0">
        	<h3 class="sub-title"><strong>기본정보</strong></h3>
        </div>

		<!-- Tab Container Start -->
        <div class="card-block-small p-t-0">
            <div class="row">
	            <div class="col-md-6 mb-3">
	                <div class="mb-0 form-group required">
	                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-0"><strong>교육주제</strong></div>
                       <div id="sbjctArea" >
                       
                       <div class="row mb-3 mb-md-2 subject-form" id="subject1">
                           <div class="col-md-10 mt-1 mt-md-0">
                               <select id="subjectSelect1" name="eduSbjctCds" class="form-select form-select-sm" onchange="duplCheck('1')">
                                   <option value="" >-선택-</option>
                                   <option th:each="item : ${sbjctCdLsit}"   th:value="${item.CD}"> <th:block th:text="${item.CD_NM}" /> </option>
                               </select>
                           </div>
                           <div class="col-md-auto">
                               <button type="button" class="input-group-text btn btn-primary btn-sm"  onclick="plusSubjectForm()" >+</button>
                               <button type="button" class="input-group-text btn btn-primary btn-sm"  onclick="removeSubjectForm('1')"disabled>-</button>
                           </div>
                       </div>
                       
                       </div>
	                </div>
	            </div>
                <div class="col-md-6 col-lg-3 mb-3">
                    <div class="mb-0 form-group required">
                        <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>콘텐츠 유형(대분류)</strong></div>
                        <select name="mainTypeCd" id="typeCd_1" class="form-select form-select-sm" onchange="setInsertFormSelectBox.setNextDepth(164,this.value,'typeCd_2')">
                            <option value="">- 선택 -</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3 mb-3">
                    <div class="mb-0 form-group required">
                        <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>콘텐츠 유형(중분류)</strong></div>
                        <select name="typeCd" id="typeCd_2" class="form-select form-select-sm">
                            <option value="">- 선택 -</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-6 mb-3">
                    <div class="mb-0 form-group required">
                        <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>교육대상</strong></div>
                    	<span kattr:check_code="eduTrgt" grpCd="185"  isAdmin="true"></span>
                    </div>
                </div>
                <div class="col-lg-6 mb-3">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="origin"><strong>출처</strong></label>
                        <div class="col-12">
                            <input type="text" class="form-control form-control-sm" name="origin" id="origin" placeholder="출처"/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row" id="palyTime">
                <div class="col-lg-6 mb-3">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="mnfctYy"><strong>제작년도</strong></label>
                        <div class="d-flex align-items-center">
                            <div class="col">
                                <input type="text" class="form-control form-control-sm" name="mnfctYy" id="mnfctYy" placeholder="제작년도"/>
                            </div>
                            <span class="ms-3">년</span>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 mb-3">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="plySecnd"><strong>재생시간</strong></label>
                        <div class="d-flex align-items-center">
                        	<div class="col">
                                <input type="text" class="form-control form-control-sm" name="plyHour" id="plyHour" placeholder="시간"/>
                            </div>
                            <span class="p-l-5 me-3">시간</span>
                            <div class="col">
                                <input type="text" class="form-control form-control-sm" name="plyMinute" id="plyMinute" placeholder="분"/>
                            </div>
                            <span class="p-l-5 me-3">분</span>
                            <div class="col">
                                <input type="text" class="form-control form-control-sm" name="plySecnd" id="plySecnd" placeholder="초"/>
                            </div>
                            <span class="p-l-5">초</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-6 mb-3">
                    <div class="mb-0 form-group required">
                        <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>저작권</strong></div>
                        <span kattr:select_code="cpyrhtCd" grpCd="241" firstOptTxt="- 선택 -" isAdmin="true"></span>
                    </div>
                </div>
            </div>                        
            <div class="row">
                <div class="col-12 mb-3">
                    <div class="mb-0 form-group required">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="ttl"><strong>제목</strong></label>
                        <div class="col-12">
                            <input type="text" class="form-control form-control-sm" name="ttl" id="ttl" placeholder="제목">
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12 mb-3">
                    <div class="mb-0 form-group required">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="cn"><strong>내용</strong></label>
                        <div class="col-12">
                            <textarea class="form-control form-control-sm" name="cn" id="cn"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
		        <div class="col-12 col-lg-6 mb-3">
		            <div class="mb-0 form-group required">
	                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="rentalRecruitmentMainImage"><strong>대표 이미지 (권장 사이즈 : 000x000)</strong></label>
						<div class="col-sm-12">
						    <input type="file" class="form-control form-control-sm" id="rprsImgFile" name="rprsImgFile"/>
						    <input type="hidden" name="rprsImgFilegrpid" id="rprsImgFilegrpid">
						    <input type="hidden" name="rprsImgFileid" id="rprsImgFileid">		                    
						</div>
						<div class="mt-2 row">
						    <div class="col-auto">
						    	<div id="fileUploadSuccess">
						    	</div>
						    </div>
						</div>
		            </div>
		        </div>
                <div class="col-12 col-lg-6 mb-3">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="rentalRecruitmentDetailFile"><strong>첨부파일</strong></label>
						<div class="col-sm-12">
						    <input type="file" multiple class="form-control form-control-sm" id="atchFile" name="atchFile"/>
						    <input type="hidden" name="atchFilegrpid" id="atchFilegrpid" value="0">                    
						</div>
						<div class="mt-2 row">
							<div class="col-12 col-lg-12">
							    <div class="mb-0 form-group row">
							        <div class="col-auto">
							            <div id="multiFileUploadSuccess">
							            </div>
							        </div>
							    </div>
							</div>
						</div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12 col-lg-6 mb-3">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="registDate"><strong>등록일</strong></label>
                        <div class="col-12">
                            <input type="text" class="form-control form-control-sm" name="regDt" id="regDt" th:value="${regDate}" readonly/>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-6 mb-3">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="writer"><strong>작성자ID(이름)</strong></label>
                        <div class="col-12">
                            <input type="text" class="form-control form-control-sm" name="rgtridNm" id="rgtridNm" th:value="${useridNm}" readonly/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-light rounded p-20">
                <p class="mb-1">* 첨부 가능 확장자 : JPG, JPEG, PNG, GIF, HWP, DOC, DOCX, XLS, XLSX, PDF, TXT</p>
                <p class="mb-1">* 첨부 가능 총 용량 : 100Mbyte</p>
                <p class="mb-0">* 첨부 가능 개별 용량 : 10Mbyte</p>
            </div>
        </div>
	    <div class="card-block-small">
	        <button type="button" class="btn btn-disabled m-r-5" id="cancelInsertRgnEnveduCntr" onclick="gridHelper1.toggleContent()">취소</button>
	        <th:block sec:authorize-url="/mng/cntnts/insertCntnts.do">
	        	<button type="button" class="btn btn-primary" id="fn_insertCntnts" onclick="fn_insertCntntsForm()">저장</button>
	        </th:block>
	    </div>
		<!-- Tab Container End -->
</form>

<script  id="subjectFrm" type="text/x-handlebars-template">
    <div class="row mb-3 mb-md-2 subject-form" id="subject{{frmNum}}">
         <div class="col-md-10 mt-1 mt-md-0">
             <select id="subjectSelect{{frmNum}}" name="eduSbjctCds" class="form-select form-select-sm" onchange="duplCheck('{{frmNum}}')">
                 <option value="" >-선택-</option>
                 {{#each list}}
                 <option value="{{CD}}">{{CD_NM}}</option>
                 {{/each}}
             </select>
         </div>
         <div class="col-md-auto">
         	<button type="button" class="input-group-text btn btn-primary btn-sm"  onclick="plusSubjectForm()" >+</button>
         	<button type="button" class="input-group-text btn btn-primary btn-sm"  onclick="removeSubjectForm('{{frmNum}}')">-</button>
         </div>
     </div>
</script>
<script th:inline="javascript">
	$("#palyTime").hide();
	
	setInsertFormSelectBox.fn_getNextDepthList(164 , 0, 'typeCd_1');	
	
	var editor;
	
    /*<![CDATA[*/ 
	var sbjctCdLsit = /*[[${sbjctCdLsit}]]*/null; 
    /*]]>*/
    
    var subjectLength = 0; 
    var subjectNum = [1];
	
	$(function () {
	    editor = CKEDITOR.replace('cn');
  	 	editor.setData();
  	 	
    	if(sbjctCdLsit!= null && sbjctCdLsit.length > 0 ){
	    	subjectLength = sbjctCdLsit.length 
        }
	});
	
	var validator= $("#cntntsInsertForm").validate({
	    rules: {
	    	mainTypeCd 	 :  { required: true }  
	     	,typeCd   	 	 : 	{ required: true }
	     	,eduTrgt	   	 : 	{ required: true }
	     	,mnfctYy   		 : 	{ number: true, maxlength: 4 }
	     	,plyHour 	  	 : 	{ number: true }
	     	,plyMinute   	 : 	{ number: true, maxlength: 2 }
	     	,plySecnd   	 : 	{ number: true, maxlength: 2 }
	     	,ttl   			 : 	{ required: true }
	     	,cn   			 : 	{ required: true }
	     	,rprsImgFile   	 : 	{ required: true }
	    },
	    messages: {
	    	mainTypeCd		 :  { required: "콘텐츠 유형(대분류)를 선택해주십시오." }
		    ,typeCd   	 	 :  { required: "콘텐츠 유형(중분류)를 선택해주십시오." }
		    ,eduTrgt	   	 :  { required: "교육대상을 선택해주십시오." }
		    ,mnfctYy   		 : 	{ number: "제작년도는 숫자만 입력해주십시오.", maxlength: "제작년도는 4자리까지 입력가능합니다." }
		    ,plyHour   		 : 	{ number: "재생시간(시간)은 숫자만 입력해주십시오." }
		    ,plyMinute   	 : 	{ number: "재생시간(분)은 숫자만 입력해주십시오.", maxlength: "재생시간(분)는 2자리까지 입력가능합니다." }
		    ,plySecnd   	 : 	{ number: "재생시간(초)은 숫자만 입력해주십시오.", maxlength: "재생시간(초)는 2자리까지 입력가능합니다." }
		    ,ttl   	 		 : 	{ required: "제목을 입력해주십시오." }
		    ,cn   			 : 	{ required: "내용을 입력해주십시오." }
		    ,rprsImgFile   	 : 	{ required: "대표 이미지를 첨부해주십시오." }
	    }
	})
	
	$('#typeCd_1').change(function() {
		if($("#typeCd_1 option:checked").text() == '영상자료' || $("#typeCd_1 option:checked").val() == '164102') {
			$("#palyTime").show();
		}else {
			$("#palyTime").hide();
		}
	})	
	
	$('#rprsImgFile').change(function(event) {
	    var formData = new FormData();
	    var objFile = event.target;
	    var content = "";
	
	    formData.append("file", objFile.files[0]);
	    formData.append("filegrpNm", "cntnts_rprs_img_file");
	    if($('#rprsImgFilegrpid').val() != '')
	        formData.append("filegrpid", $('#rprsImgFilegrpid').val());
	
	    if(displayWorkProgress()){
		    $.ajax({
		        url : '/uploadFile.do',
		        processData : false,
		        contentType : false,
		        data : formData,
		        type : 'POST',
		        success : function(response) {
		            if(response.result == 'fail'){
				        alert(response.msg);
				    }else if(response.filegrpid != undefined && response.filegrpid != ''){
				        $("#rprsImgFilegrpid").val(response.filegrpid);
				        $("#rprsImgFileid").val(response.fileid);
				        content = "<div class ='label label-inverse text-white' id='"+response.fileid+"'><a href=javascript:downloadFileByFileid('"+response.fileid+"','"+response.fileIdntfcKey+"') class='text-white'>"+response.orginlFileNm+"&nbsp;&nbsp;</a>";
	                    content +="<a href=javascript:fn_deleteFileList('"+response.fileid+"','"+response.fileIdntfcKey+"') class='text-white'>X</a></div>";
	                    $('#fileUploadSuccess').html(content);
				    }
				    closeWorkProgress();
		        }
		    });
		}
	    event.preventDefault();
	});
	
	$('#atchFile').change(function(event) {
        var objFile = document.querySelector('#atchFile');
        var formData = new FormData();
        var content = "";
        var uploadFileCnt = 0;
        for( i = 0 ; i < objFile.files.length ; i++) {
        	formData.append("files", objFile.files[i]);
            uploadFileCnt++;
        }
        formData.append("filegrpid", $("#atchFilegrpid").val());
        formData.append("filegrpNm", "cntnts_atch_file");
        
		$.ajax({
			url : '/uploadMultipleFiles.do',
			processData : false,
			contentType : false,
			data : formData,
			type : 'POST',
			success : function(response) {
				if(response.result == 'fail'){
					alert(response.msg);
				}else{
					if($("#atchFilegrpid").val()=='0' || $("#atchFilegrpid").val()==''  || $("#atchFilegrpid").val()==null){
						$("#atchFilegrpid").val( response[0].filegrpid );
					}
				
					for(i = 0 ;i < response.length; i++ ){
						content = "<div class='label label-inverse text-white' id='"+response[i].fileid+"'><a href=javascript:downloadFileByFileid('"+response[i].fileid+"','"+response[i].fileIdntfcKey+"') class='text-white'>"+response[i].orginlFileNm+"&nbsp;&nbsp;</a>";
	                    content +="<a href=javascript:fn_deleteFileList('"+response[i].fileid+"','"+response[i].fileIdntfcKey+"') class='text-white'>X</a></div>";
						$('#multiFileUploadSuccess').append(content);
					}
				}
			}
		})
        
		if (detectBrowser() == "other") { 
			$("#atchFile").val("");
		} else {   
			$("#atchFile").replaceWith( $("#atchFile").clone(true)) 
		}
    });
	
	function fn_deleteFileList(fileid, fileIdntfcKey){
	    if(!confirm("파일을 삭제하시겠습니까?")){return;}
	    fn_deleteFile(fileid, fileIdntfcKey);
	    $("#"+fileid).remove();
	    $('#rprsImgFile').val('');
	} 

	function fn_deleteFile(fileid, fileIdntfcKey){
	               
	    var deleteFileUrl="/deleteFile.do?fileid="+fileid+"&file_idntfc_key=" + fileIdntfcKey; 
	      $.ajax({
	        url : deleteFileUrl,
	        type: 'GET',
	        cache : false,
	        dataType: 'json',
	        success : function (data){
	            if(data.result=="success"){
	                $("#"+fileid).remove();
	                $('#rprsImgFileid').val(0);
	                $('#rprsImgFilegrpid').val(0);
	                $('#rprsImgFile').val('');
	                alert("파일삭제가 완료 되었습니다.");
	            }else{
	                alert("파일삭제중 에러가 발생하였습니다. 관리자에게 문의 부탁드립니다.");
	            }
	        },
	        error : function (error){
	        } 
	     })
	};
	
 	function fn_insertCntntsForm(){
 	 	if(!($("#cntntsInsertForm").valid())) return;
		
  	 	if(subjectNum.length<=0){
  	  	 	alert("교육 주제를 선택해주십시오.")
  	  	 	return;
  	  	}
 	 	
  	 	if(!confirm("저장하시겠습니까?")) return;
  	 	
  	 	var editorData = editor.getData();
        $("#cn").val(editorData);
  	 	
	    var data =  $("#cntntsInsertForm").serialize();
	    if(displayWorkProgress()){
			$.ajax({
				url : "/mng/cntnts/insertCntnts.do",
				type: 'POST',
				cache : false,
				dataType: 'json',
				data : data,
				success : function (data){
					if(data.result=="success"){
						alert(data.msg);
						gridHelper1.resetListContent();
					}else{
						alert(data.msg);
					}
					closeWorkProgress();
				}
			});
		}
	}
 	
    duplCheck=(frmNum)=>{
        var isDupl = false;
    	var selectCd = $("#subjectSelect"+frmNum).val();
    	if(selectCd==""){return;}

    	$(".subject-form").each(function(){
    		var itemId = ($(this).attr("id")).replace("subject","")
        	if( itemId != frmNum  &&  $("#subjectSelect"+itemId).val() == selectCd){
        		isDupl = true;
            }
        })
        if(isDupl){
        	$("#subjectSelect"+frmNum).val("");
            alert("교육주제는 중복 선택 할 수 없습니다."); 
            return; 
        }
    }
    
    plusSubjectForm =()=>{

    	var subjectFormCnt = 0 ; 
    	$(".subject-form").each(function(){	subjectFormCnt++ })
    	
    	if(subjectFormCnt >= subjectLength){
        	alert("더이상 생성 할수 없습니다.");
        	return;
        }
    	var maxValue = Math.max.apply(null, subjectNum);
    	subjectNum.push(maxValue+1);
        
	    var source = $("#subjectFrm").html();
        var template = Handlebars.compile(source);
        var data = {
                    'frmNum' : maxValue+1
                    ,'list':sbjctCdLsit 
                   };
        $("#sbjctArea").append(template(data));
    }

    removeSubjectForm=(frmNum)=>{
    	$("#subject"+frmNum).remove();
    	var filterArr = subjectNum.filter(function(data) {return data != frmNum;});
    	subjectNum = filterArr;
    }
</script>