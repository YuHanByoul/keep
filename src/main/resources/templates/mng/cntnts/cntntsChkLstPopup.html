<!DOCTYPE html>
<html
        xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
        xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
        
<div layout:fragment="content">
	
	<form id="QlityChkForm">
		
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content type_2">
            <div class="modal-header">
                <h4 class="modal-title">게시글 품질관리 체크리스트</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true"></span>
                </button>
            </div>
            <div class="modal-body">
                
                <div class="card m-b-10">
                    <div class="card-block-small">
                        <table class="table table-framed table-bordered td-wrap">
                            <thead>
                                <tr class="border-bottom-inverse">
                                    <th class="text-center v-middle">검수분야</th>
                                    <th class="text-center v-middle">검수사항</th>
                                    <th class="text-center v-middle">준수여부 </th>
                                </tr>
                            </thead>
                            <tbody>
                            	<th:block th:each="item, stat: ${chkList}">
	                            	<th:block th:if="${item.fldCd} == 244001">
			                                <tr>
			                                    <th class="text-center v-middle" th:if="${item.ordr} == 1" th:rowspan="${item.count}" th:text="${item.fldCdNm}"></th>
			                                    <td th:text="${item.cn}"></td>
			                                    <td class="text-center v-middle">
			                                        <div class="border-checkbox-section">
			                                            <div class="border-checkbox-group">
			                                                <input class="border-checkbox" type="checkbox" name="chklstid" th:id="'checkbox'+${stat.count}" th:value="${item.chklstid}">
			                                                <label class="form-label form-label-sm border-checkbox-label" th:for="'checkbox'+${stat.count}">
			                                                    확인
			                                                </label>
			                                            </div>
			                                        </div>
			                                    </td>
			                                </tr>
	                            	</th:block>
	                            	<th:block th:if="${item.fldCd} == 244002">
			                                <tr>
			                                    <th class="text-center v-middle" th:if="${item.ordr} == 1" th:rowspan="${item.count}" th:text="${item.fldCdNm}"></th>
			                                    <td th:text="${item.cn}"></td>
			                                    <td class="text-center v-middle">
			                                        <div class="border-checkbox-section">
			                                            <div class="border-checkbox-group">
			                                                <input class="border-checkbox" type="checkbox" name="chklstid" th:id="'checkbox'+${stat.count}" th:value="${item.chklstid}">
			                                                <label class="form-label form-label-sm border-checkbox-label" th:for="'checkbox'+${stat.count}">
			                                                    확인
			                                                </label>
			                                            </div>
			                                        </div>
			                                    </td>
			                                </tr>
	                            	</th:block>
	                            	<th:block th:if="${item.fldCd} == 244003">
			                                <tr>
			                                    <th class="text-center v-middle" th:if="${item.ordr} == 1" th:rowspan="${item.count}" th:text="${item.fldCdNm}"></th>
			                                    <td th:text="${item.cn}"></td>
			                                    <td class="text-center v-middle">
			                                        <div class="border-checkbox-section">
			                                            <div class="border-checkbox-group">
			                                                <input class="border-checkbox" type="checkbox" name="chklstid" th:id="'checkbox'+${stat.count}" th:value="${item.chklstid}">
			                                                <label class="form-label form-label-sm border-checkbox-label" th:for="'checkbox'+${stat.count}">
			                                                    확인
			                                                </label>
			                                            </div>
			                                        </div>
			                                    </td>
			                                </tr>
	                            	</th:block>
	                            	<th:block th:if="${item.fldCd} == 244004">
			                                <tr>
			                                    <th class="text-center v-middle" th:if="${item.ordr} == 1" th:rowspan="${item.count}" th:text="${item.fldCdNm}"></th>
			                                    <td th:text="${item.cn}"></td>
			                                    <td class="text-center v-middle">
			                                        <div class="border-checkbox-section">
			                                            <div class="border-checkbox-group">
			                                                <input class="border-checkbox" type="checkbox" name="chklstid" th:id="'checkbox'+${stat.count}" th:value="${item.chklstid}">
			                                                <label class="form-label form-label-sm border-checkbox-label" th:for="'checkbox'+${stat.count}">
			                                                    확인
			                                                </label>
			                                            </div>
			                                        </div>
			                                    </td>
			                                </tr>
	                            	</th:block>
	                            	<th:block th:if="${item.fldCd} == 244005">
			                                <tr>
			                                    <th class="text-center v-middle" th:if="${item.ordr} == 1" th:rowspan="${item.count}" th:text="${item.fldCdNm}"></th>
			                                    <td th:text="${item.cn}"></td>
			                                    <td class="text-center v-middle">
			                                        <div class="border-checkbox-section">
			                                            <div class="border-checkbox-group">
			                                                <input class="border-checkbox" type="checkbox" name="chklstid" th:id="'checkbox'+${stat.count}" th:value="${item.chklstid}">
			                                                <label class="form-label form-label-sm border-checkbox-label" th:for="'checkbox'+${stat.count}">
			                                                    확인
			                                                </label>
			                                            </div>
			                                        </div>
			                                    </td>
			                                </tr>
	                            	</th:block>
	                            	<th:block th:if="${item.fldCd} == 244006">
			                                <tr>
			                                    <th class="text-center v-middle" th:if="${item.ordr} == 1" th:rowspan="${item.count}" th:text="${item.fldCdNm}"></th>
			                                    <td th:text="${item.cn}"></td>
			                                    <td class="text-center v-middle">
			                                        <div class="border-checkbox-section">
			                                            <div class="border-checkbox-group">
			                                                <input class="border-checkbox" type="checkbox" name="chklstid" th:id="'checkbox'+${stat.count}" th:value="${item.chklstid}">
			                                                <label class="form-label form-label-sm border-checkbox-label" th:for="'checkbox'+${stat.count}">
			                                                    확인
			                                                </label>
			                                            </div>
			                                        </div>
			                                    </td>
			                                </tr>
	                            	</th:block>	                            		                            		                            		                            		                            	
                            	</th:block>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td class="text-center v-middle" colspan="2"><strong>콘텐츠 품질관리 검수사항을 모두 확인하였음</strong></td>
                                    <td class="text-center v-middle">
                                        <div class="border-checkbox-section">
                                            <div class="border-checkbox-group">
                                                <input class="border-checkbox" type="checkbox" id="checkAll">
                                                <label class="form-label form-label-sm border-checkbox-label" for="checkAll">
                                                    전체 확인 
                                                </label>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                        <div>
                            <button type="button" class="btn btn-link px-0" onclick="downloadFile();">[한국형 웹 콘텐츠 접근성 지침 다운로드]</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
            	<button type="button" class="btn btn-primary waves-effect waves-light" onclick="fn_checkListForm();">확인</button>
            </div>
        </div>
    </div>
    
    <input type="hidden" name="type" id="type" th:value="${type}">
	<input type="hidden" name="trgtCd" th:value="${trgtCd}">
    </form>
    
	<script th:inline="javascript">
	var checkboxes = document.getElementsByName("chklstid");
	$('#checkAll').change(function() {
		if ($(this).is(':checked')) {
			for (var i = 0; i < checkboxes.length; i++) {
				checkboxes[i].checked = true;
			}
		} else {
			for (var i = 0; i < checkboxes.length; i++) {
				checkboxes[i].checked = false;
			}
		}
	});
	
	var isChecked = true;
	$('input[type="checkbox"][name="chklstid"]').change(function() {
		if(this.id != 'checkAll') {
			$('#checkAll').prop('checked',false);
			
			for (var i = 0; i < checkboxes.length; i++) {
				if(!checkboxes[i].checked) {
					isChecked = false;
					break;
				}else{
					isChecked = true;
				}
			}
			
			if(isChecked) {
				$('#checkAll').prop('checked',true);
			}
		}
	});
	
	function downloadFile() {
		var fileUrl = "/cmmFile/webCntntsGuide/한국형_웹_콘텐츠_접근성_지침_2.1.pdf";
		
		var xhr = new XMLHttpRequest();
	
		xhr.open('GET', fileUrl, true);
		xhr.responseType = 'blob';
		 
		xhr.onload = function() {
			if (this.status === 200) {
		        var downloadLink = document.createElement('a');
		        downloadLink.href = window.URL.createObjectURL(this.response);
		        downloadLink.download = "한국형_웹_콘텐츠_접근성_지침_2.1.pdf";
		      
		        document.body.appendChild(downloadLink);
		        downloadLink.click();
		        document.body.removeChild(downloadLink);
			}
		};
		  
		xhr.send();
	}	
	
	function fn_checkListForm(){
		if(!$('#checkAll').is(":checked")){
			alert("검수사항 준수여부 미확인 항목이 있으니 다시 확인해주세요.");
			return false;
		}
		
 		if(!confirm("검수사항 준수여부를 모두 확인하였으며, 향후 조치사항 발생 시 대응할 것에 동의합니다.")) return;
 		
 		var chklstData = $("#QlityChkForm").serialize();
 		
 		console.log(1);
  	    if(displayWorkProgress(true)){
			$.ajax({
				url : "/mng/cntnts/insertQlityChkList.do",
				type: 'POST',
				cache : false,
				dataType: 'json',
				data : chklstData,
				success : function (data){
					if(data.result=="success"){
						checkListAddModal.hide();
						if($("#type").val() == "insert"){
							insertForm(data.ceckid);	
						}else {
							updateForm();
						}
						
					}else{
						alert(data.msg);
					}
					closeWorkProgress();
				}
			});
		}
	}
	</script>
	
</div>