<form id ="jntpurchsUpdateForm">
    <input type="hidden" name="jntpurchsid" th:value="${jntpurchsInfo.jntpurchsid}"/>
    <div class="card-header p-b-0">
        <h3 class="sub-title"><strong>기본 정보</strong></h3>
    </div>
    <div class="card-block-small p-t-0">
        <div class="row">
            <div class="col-lg-4 mb-3">
                <div class="mb-0 form-group">
                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>공동구매모집번호</strong></div>
                    <div class="col-12 p-t-5 p-b-5" th:text="${jntpurchsInfo.jntpurchsno}"></div>
                </div>
            </div>
            <div class="col-lg-4 mb-3">
                <div class="mb-0 form-group">
                    <input type="hidden" name="sttsCd" value="" />
                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>모집상태</strong></div>
                    <div class="col-12 p-t-5 p-b-5" th:text="${jntpurchsInfo.sttsCdNm}"></div>
                </div>
            </div>
            <div class="col-lg-4 mb-3">
                <div class="mb-0 form-group required">
                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="jntpurchsNm"><strong>공동구매모집명</strong></label>
                    <div class="col-12">
                        <input type="text" class="form-control form-control-sm" name="jntpurchsNm" id="jntpurchsNm" placeholder="모집명을 입력해주세요." th:value="${jntpurchsInfo.jntpurchsNm}"/>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12 mb-3">
                <div class="mb-0 form-group required">
                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>교구 불러오기</strong></div>
                    <div class="col-12">
                        <button type="button" class="btn btn-inverse btn-sm" id="tchaidLoadBtn">
                            교구 불러오기
                        </button>
                    </div>
                    <div class="m-0 row">
                        <div class="col-12 row border rounded p-t-10 p-b-10 m-0 mt-2 d-none" id="tchaidContainer">
                            <div class="col-auto">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-6 mb-3">
                <div class="mb-0 form-group required">
                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="qntyWhol"><strong>공동구매 교구 총 수량</strong></label>
                    <div class="col-12 row align-items-center">
                        <div class="col-auto">
                            <input type="text" class="col-lg-auto form-control form-control-sm text-right" name="qntyWhol" id="qntyWhol" placeholder="0" th:value="${jntpurchsInfo.qntyWhol}">
                        </div>
                        <div class="col-auto p-l-0 p-r-0">
                            개
                        </div>
                        <div class="col-auto">
                            <div class="border-checkbox-section">
                                <div class="border-checkbox-group border-checkbox-group-inverse">
                                    <input type="hidden" name="qntyWholLmtYn" id="qntyWholLmtYn" th:value="${jntpurchsInfo.qntyWholLmtYn}">
                                    <input class="border-checkbox" type="checkbox" id="qntyWholLmtCheck" th:checked="${jntpurchsInfo.qntyWholLmtYn eq 'Y'}">
                                    <label class="form-label form-label-sm border-checkbox-label mb-0" for="qntyWholLmtCheck">
                                        제한없음
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 mb-3">
                <div class="mb-0 form-group required">
                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="qntyLmt"><strong>1인당 신청 가능 수량</strong></label>
                    <div class="col-12 row align-items-center">
                        <div class="col-auto">
                            <input type="text" class="col-lg-auto form-control form-control-sm text-right" name="qntyLmt" id="qntyLmt" placeholder="0" th:value="${jntpurchsInfo.qntyLmt}">
                        </div>
                        <div class="col-auto p-l-0 p-r-0">
                            개
                        </div>
                        <div class="col-auto">
                            <div class="border-checkbox-section">
                                <div class="border-checkbox-group border-checkbox-group-inverse">
                                    <input type="hidden" name="qntyLmtYn" id="qntyLmtYn" th:value="${jntpurchsInfo.qntyLmtYn}">
                                    <input class="border-checkbox" type="checkbox" id="qntyLmtCheck" th:checked="${jntpurchsInfo.qntyLmtYn eq 'Y'}">
                                    <label class="form-label form-label-sm border-checkbox-label mb-0" for="qntyLmtCheck">
                                        제한없음
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-12 col-lg-6 mb-3">
                <div class="mb-0 form-group required">
                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="bgngDt"><strong>공동구매 접수 시작일시</strong></label>
                    <div class="col-12">
                        <input type="datetime-local" class="form-control form-control-sm" name="bgngDtStr" id="bgngDt" th:value="${jntpurchsInfo.bgngDtStr}">
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-6 mb-3">
                <div class="mb-0 form-group required">
                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="endDt"><strong>공동구매 접수 종료일시</strong></label>
                    <div class="col-12">
                        <input type="datetime-local" class="form-control form-control-sm" name="endDtStr" id="endDt" th:value="${jntpurchsInfo.endDtStr}">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="card-header p-t-0 p-b-0">
        <h3 class="sub-title"><strong>공동구매 수량별 가격 설정</strong></h3>
    </div>
    <div class="card-block-small p-t-0" id="amtContainer">
        <div class="mb-3 row align-items-center amt-row">
            <div class="col-12 col-lg-4">
                <div class="col-12 row align-items-center">
                    <div class="col-5">
                        <input type="text" class="form-control form-control-sm text-right" name="qntyBgng0" id="qntyBgng0" placeholder="0" value="">
                    </div>
                    <div class="col-auto p-l-0 p-r-0">
                        ~
                    </div>
                    <div class="col-5">
                        <input type="text" class="form-control form-control-sm text-right" name="qntyEnd0" id="qntyEnd0" placeholder="0" value="">
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-8 d-flex align-items-center mt-1 mt-lg-0">
                <div class="col-10 row align-items-center">
                    <div class="col-11">
                        <input type="text" class="form-control form-control-sm text-right" name="amt0" id="amt0" placeholder="0" value="">
                    </div>
                    <div class="col-1 p-l-0 p-r-0">
                        원
                    </div>
                    +
                </div>
                <div class="col-2 text-right amt-btn">
                    <button class="input-group-text btn btn-primary btn-sm amt-add-btn">+</button>
                    <button class="input-group-text btn btn-primary btn-sm amt-remove-btn d-none">-</button>
                </div>
            </div>
        </div>
    </div>
    <div class="card-header p-t-0 p-b-0">
        <h3 class="sub-title"><strong>이미지/안내자료 업로드</strong></h3>
    </div>
    <div class="card-block-small p-t-0">
        <div class="row">
            <div class="col-12 col-lg-6 mb-3">
                <div class="mb-0 form-group">
                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>대표 이미지</strong></label>
                    <div class="col-12">
                       <input type="file" id="jntpurchsRprsImgFile" name="jntpurchsRprsImgFile" class="form-control form-control-sm"/>
                    </div>
                    <div class="mt-2 row">
                        <div class="col-auto">
                            <input type="hidden" id="rprsImgFilegrpid" name="rprsImgFilegrpid" value="0"/>
                            <input type="hidden" id="rprsImgFileid" name="rprsImgFileid" th:value="${jntpurchsInfo.rprsImgFileid}"/>
                             <!-- 파일 명 및 삭제 버튼 영역-->
                            <span id="rprsImgFileArea">
                                <th:block th:if ="${rprsImgFileInfo !=null}">
                                    <span th:id="'jntpurchsRprsImgFile' + ${rprsImgFileInfo.fileid}" class="label label-inverse">
                                        <th:block th:text = "${rprsImgFileInfo.orginlFileNm}"></th:block>&nbsp;&nbsp;&nbsp;
                                        <a href="javascript:void(0);" onclick="jntpurchsUpdate.removeFile(this.getAttribute('spanid'), this.getAttribute('fileid'), this.getAttribute('fileIdntfcKey'));" th:spanid="'jntpurchsRprsImgFile' + ${rprsImgFileInfo.fileid}" th:fileid="${rprsImgFileInfo.fileid}" th:fileIdntfcKey="${rprsImgFileInfo.fileIdntfcKey}" class="text-white">X</a>
                                    </span>
                                </th:block>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-6 mb-3">
                <div class="mb-0 form-group">
                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>상세 이미지</strong></label>
                    <div class="col-12">
                       <input type="file" multiple id="jntpurchsDtlImgFile" name="jntpurchsDtlImgFile" class="form-control form-control-sm"/>
                    </div>
                    <div class="mt-2 row">
                        <div class="col-auto">
                            <th:block th:if = "${jntpurchsInfo.dtlImgFilegrpid} != null">
                                <input type="hidden" id="dtlImgFilegrpid" name="dtlImgFilegrpid" th:value="${jntpurchsInfo.dtlImgFilegrpid}"/>
                            </th:block>
                            <th:block th:unless = "${jntpurchsInfo.dtlImgFilegrpid} != null">
                                <input type="hidden" id="dtlImgFilegrpid" name="dtlImgFilegrpid" th:value="0"/>
                            </th:block>
                            <!-- 파일 명 및 삭제 버튼 영역-->
                            <span id="dtlImgFileArea">
                                <th:block th:if = "${dtlImgFileList} != null">
                                    <th:block th:if = "${dtlImgFileList} != null">
                                        <span th:each="item: ${dtlImgFileList}" th:id="'jntpurchsDtlImgFile' + ${item.fileid}" class="label label-inverse">
                                            <th:block th:text = "${item.orginlFileNm}"></th:block>&nbsp;&nbsp;&nbsp;
                                            <a href="javascript:void(0);" onclick="jntpurchsUpdate.removeFile(this.getAttribute('spanid'), this.getAttribute('fileid'), this.getAttribute('fileIdntfcKey'));" th:spanid="'jntpurchsDtlImgFile' + ${item.fileid}" th:fileid="${item.fileid}" th:fileIdntfcKey="${item.fileIdntfcKey}" class="text-white">X</a>
                                        </span>
                                    </th:block>
                                </th:block>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-12 col-lg-6 mb-3">
                <div class="mb-0 form-group">
                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>지도안</strong></label>
                    <div class="col-12">
                       <input type="file" id="jntpurchsMapFile" name="jntpurchsMapFile" class="form-control form-control-sm"/>
                    </div>
                    <div class="mt-2 row">
                        <div class="col-auto">
                            <input type="hidden" id="mapFileid" name="mapFileid" th:value="0"/>
                            <input type="hidden" id="mapFilegrpid" name="mapFilegrpid" th:value="${jntpurchsInfo.mapFilegrpid}"/>
                             <!-- 파일 명 및 삭제 버튼 영역-->
                            <span id="mapFileArea">
                                <th:block th:if ="${mapFileInfo !=null}">
                                    <span th:id="'jntpurchsMapFile' + ${mapFileInfo.fileid}" class="label label-inverse">
                                        <th:block th:text = "${mapFileInfo.orginlFileNm}"></th:block>&nbsp;&nbsp;&nbsp;
                                        <a href="javascript:void(0);" onclick="jntpurchsUpdate.removeFile(this.getAttribute('spanid'), this.getAttribute('fileid'), this.getAttribute('fileIdntfcKey'));" th:spanid="'jntpurchsRprsImgFile' + ${mapFileInfo.fileid}" th:fileid="${mapFileInfo.fileid}" th:fileIdntfcKey="${mapFileInfo.fileIdntfcKey}" class="text-white">X</a>
                                    </span>
                                </th:block>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-6 mb-3">
                <div class="mb-0 form-group">
                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>교육사진</strong></label>
                    <div class="col-12">
                       <input type="file" multiple id="jntpurchsEduPhotoFile" name="jntpurchsEduPhotoFile" class="form-control form-control-sm"/>
                    </div>
                    <div class="mt-2 row">
                        <div class="col-auto">
                            <th:block th:if = "${jntpurchsInfo.eduPhotoFilegrpid} != null ">
                                <input type="hidden" id="eduPhotoFilegrpid" name="eduPhotoFilegrpid" th:value="${jntpurchsInfo.eduPhotoFilegrpid}"/>
                            </th:block>
                            <th:block th:unless = "${jntpurchsInfo.eduPhotoFilegrpid} != null ">
                                <input type="hidden" id="eduPhotoFilegrpid" name="eduPhotoFilegrpid" th:value="0"/>
                            </th:block>
                            <!-- 파일 명 및 삭제 버튼 영역-->
                            <span id="eduPhotoFileArea">
                                <th:block th:if = "${eduPhotoFileList} != null ">
                                    <th:block th:if = "${eduPhotoFileList} != null ">
                                        <span th:each="item: ${eduPhotoFileList}" th:id="'jntpurchsEduPhotoFile' + ${item.fileid}" class="label label-inverse">
                                            <th:block th:text = "${item.orginlFileNm}"></th:block>&nbsp;&nbsp;&nbsp;
                                            <a href="javascript:void(0);" onclick="jntpurchsUpdate.removeFile(this.getAttribute('spanid'), this.getAttribute('fileid'), this.getAttribute('fileIdntfcKey'));" th:spanid="'jntpurchsEduPhotoFile' + ${item.fileid}" th:fileid="${item.fileid}" th:fileIdntfcKey="${item.fileIdntfcKey}" class="text-white">X</a>
                                        </span>
                                    </th:block>
                                </th:block>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="card-header p-t-0 p-b-0">
        <h3 class="sub-title"><strong>상세 정보</strong></h3>
    </div>
    <div class="card-block-small p-t-0">
        <div class="mb-3 form-group row">
            <div class="col-12">
                <textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="상세 정보를 입력해주세요." id="dtlCn" name="dtlCn" th:text="${jntpurchsInfo.dtlCn}"></textarea>
            </div>
        </div>
        <div class="row">
            <div class="col-12 col-lg-6 mb-3">
                <div class="mb-0 form-group">
                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="rentalRecruitmentVideoUrl"><strong>유튜브 동영상 URL</strong>
                        <a href="javascript:void(0);" data-bs-toggle="tooltip" data-bs-html="true" data-bs-original-title="ex) https://www.youtube.com/watch?v= <span class='text-danger'>E4Qct1k3s_Q</span><br/>&#8251; Youtube 주소에서 붉은색 부분을 복사해서 넣어주세요.">
                            <i class="fa fa-question-circle-o"></i>
                            <div class="col-auto border p-2 bg-white pos-absolute rounded" style="display: none;">
                                ex) https://www.youtube.com/watch?v= <span class="text-danger">E4Qct1k3s_Q</span><br/>
                                &#8251; Youtube 주소에서 붉은색 부분을 복사해서 넣어주세요.
                            </div>
                        </a>
                    </label>
                    <div class="col-12 d-flex align-items-center text-nowrap">
                        https://www.youtube.com/watch?v=
                        <input type="text" class="col-lg-auto form-control form-control-sm" name="mvpUrl" id="mvpUrl" placeholder="" th:value="${jntpurchsInfo.mvpUrl}">
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-6 mb-3">
                <div class="mb-0 form-group">
                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
                        <strong>동영상 위치 설정</strong></div>
                    <div class="col-12">
                        <div class="form-radio">
                            <div class="radio radio-inline">
                                <label class="mb-0 form-label">
                                    <input type="radio" name="mvpPstnCd" th:checked="${jntpurchsInfo.mvpPstnCd eq 'T'}" value="T">
                                    <i class="helper"></i>상세정보 상단
                                </label>
                            </div>
                            <div class="radio radio-inline">
                                <label class="mb-0 form-label">
                                    <input type="radio" name="mvpPstnCd" th:checked="${jntpurchsInfo.mvpPstnCd eq 'B'}" value="B">
                                    <i class="helper"></i>상세정보 하단
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="card-header p-t-0 p-b-0">
        <h3 class="sub-title"><strong>유의사항</strong></h3>
    </div>
    <div class="card-block-small p-t-0">
        <div class="mb-3 form-group row">
            <div class="col-12">
                <textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="유의사항을 입력해주세요." id="atentMttr" name="atentMttr" th:text="${jntpurchsInfo.atentMttr}"></textarea>
            </div>
        </div>
    </div>
    <div class="card-block-small">
        <button type="button" class="btn btn-disabled m-r-5" onclick="jntpurchsUpdate.offUpdateJntpurchs();">취소</button>
        <th:block sec:authorize-url="/mng/jntpurchs/deleteJntpurchs.do">
            <button type="button" class="btn btn-disabled m-r-5" onclick="jntpurchsUpdate.onDeleteJntpurchs();">삭제</button>
        </th:block>
        <th:block sec:authorize-url="/mng/jntpurchs/updateJntpurchsStts.do">
            <button type="button" class="btn btn-disabled m-r-5" onclick="jntpurchsUpdate.onUpdateJntpurchsStts();">일시정지</button>
        </th:block>
        <th:block sec:authorize-url="/mng/jntpurchs/updateJntpurchs.do">
            <button type="button" class="btn btn-primary" onclick="jntpurchsUpdate.onUpdatetJntpurchs();">저장</button>
        </th:block>
    </div>
</form>

<div class="modal fade" id="tchaidListPopup" aria-hidden="true" data-bs-backdrop="static"></div>

<script th:inline="javascript">
    var jntpurchsUpdate = {
        amtTmplat: null
        , dtlCnEditor: null
        , atentMttrEditor: null
        , amtid: 0
        , goodsList: /*[[${goodsList}]]*/
        , amtList: /*[[${amtList}]]*/
        
        , init: function() {
            jntpurchs.mode = "update";
            this.amtTmplat = $(".amt-row").clone();
            this.dtlCnEditor = CKEDITOR.replace("dtlCn");
            this.atentMttrEditor = CKEDITOR.replace("atentMttr");
            $("[data-bs-toggle='tooltip']").tooltip();
            
            for(var i = 0, len = this.goodsList.length; i < len; i++) {
                var data = this.goodsList[i];
                this.addTchaid(data);
            }
            this.setValid();
            this.setAmt();
            this.registEvent();
        }
        
        , registEvent: function() {
            var _this = this;
            $("#tchaidLoadBtn").on("click", function() {
                var url = "/mng/jntpurchs/tchaidListPopup.html";
                $("#tchaidListPopup").load(url, function(response, status, xhr) {
                    if(status == "success") {
                        tchaidListModal = new bootstrap.Modal($("#tchaidListPopup"));
                        tchaidListModal.show();
                    }
                });
            });
            
            $(document).off("click", ".amt-add-btn");
            $(document).on("click", ".amt-add-btn", function(e) {
                e.preventDefault();
                _this.addAmt();
                _this.setAmtBtn();
            });
            
            $(document).off("click", ".amt-remove-btn");
            $(document).on("click", ".amt-remove-btn", function(e) {
                e.preventDefault();
                $(this).closest(".amt-row").remove();
                _this.setAmtBtn();
            });
            
            // 싱글파일
            $("#jntpurchsRprsImgFile, #jntpurchsMapFile").on("change", function(e) {
                var fileInput = e.target;
                var inputid = $(e.target).attr("id");
                var grpid = inputid == "jntpurchsRprsImgFile" ? "rprsImgFilegrpid" : "mapFileid";
                var fileid = inputid == "jntpurchsRprsImgFile" ? "rprsImgFileid" : "mapFilegrpid"; 
                var areaid = inputid == "jntpurchsRprsImgFile" ? "rprsImgFileArea" : "mapFileArea";
                var formData = new FormData();
                formData.append("file", fileInput.files[0]); 
                formData.append("filegrpNm", inputid);
                
                if($("#" + grpid).val() != "") {
                    formData.append("Filegrpid", $("#" + grpid).val());
                } 
                
                if(displayWorkProgress()) {
                    $.ajax({
                        url: '/uploadFile.do'
                        , processData: false
                        , contentType: false
                        , data: formData
                        , type: "POST"
                        , success: function(response) {
                            if(response.result == "fail") {
                                alert(response.msg);
                            } else if(response.filegrpid != undefined && response.filegrpid != "") {
                                $("#" + grpid).val(response.filegrpid);
                                $("#" + fileid).val(response.fileid);
                                var displayFile = '<span id="' + inputid + response.fileid + '" class="label label-inverse">' + response.orginlFileNm;
                                displayFile += ' &nbsp;&nbsp;&nbsp;<a href="javascript:jntpurchsUpdate.removeFile(' + "'" + inputid + response.fileid + "', "; 
                                displayFile += response.fileid + ", '" + response.fileIdntfcKey + "'" + ');" class="text-white">X</a>';
                                displayFile += '</span>';
                                $("#" + areaid).html(displayFile);
                            }
                            jntpurchsUpdate.initFileInput(inputid);
                            closeWorkProgress();
                        }
                    });
                }
            });
            
            // 멀티파일
            $("#jntpurchsDtlImgFile, #jntpurchsEduPhotoFile").on("change", function(e) {
                var fileInput = e.target;
                var inputid = $(e.target).attr("id");
                var grpid = inputid == "jntpurchsDtlImgFile" ? "dtlImgFilegrpid" : "eduPhotoFilegrpid";
                var fileid = inputid == "jntpurchsDtlImgFile" ? "dtlImgFileid" : "eduPhotoFileid";
                var areaid = inputid == "jntpurchsDtlImgFile" ? "dtlImgFileArea" : "eduPhotoFileArea";
                var formData = new FormData();
                for(var i = 0; i < fileInput.files.length; i++) {
                    formData.append("files", fileInput.files[i]);
                }
                formData.append("filegrpNm", inputid);
                formData.append("filegrpid", $("#" + grpid).val());
                if(displayWorkProgress()) {
                    $.ajax({
                        url: '/uploadMultipleFiles.do'
                        , processData: false
                        , contentType: false
                        , data: formData
                        , type: "POST"
                        , success: function(response) {
                            if(response.result == "fail") {
                                alert(response.msg);
                            } else {
                                if($("#" + grpid).val() == "0" || $("#" + grpid).val() == "" || $("#" + grpid).val() == null) {
                                    $("#" + grpid).val(response[0].filegrpid);
                                }
                                var displayFile = "";
                                for(var i = 0; i < response.length; i++) {
                                    displayFile = '<span id="' + inputid + response[i].fileid + '" class="label label-inverse">' + response[i].orginlFileNm;
                                    displayFile += ' &nbsp;&nbsp;&nbsp;<a href="javascript:jntpurchsUpdate.removeFile(' + "'" + inputid + response[i].fileid + "', "; 
                                    displayFile += response[i].fileid + ", '" + response[i].fileIdntfcKey + "'" + ');" class="text-white">X</a>';
                                    displayFile += '</span>';
                                    $("#" + areaid).append(displayFile);                                    
                                }
                            }
                            jntpurchsUpdate.initFileInput(inputid);
                            closeWorkProgress();
                        }
                    });
                }
            });
        }
        
        , initFileInput: function(inputid) {
            if(detectBrowser() == "other") {
                $("#" + inputid).val("");
            } else {
                $("#" + inputid).replaceWith($("#" + inputid).clone(true));
            }
        }
        
         , removeFile: function(inputid, fileid, fileIdntfcKey) {
            $("#" + inputid).remove();
            jntpurchsUpdate.deleteFile(fileid, fileIdntfcKey);
        }
        
        , deleteFile: function(fileid, fileIdntfcKey) {
            var path = "/deleteFile.do?fileid=" + fileid + "&file_idntfc_key=" + fileIdntfcKey;
            $.ajax({
                url: path
                , type: "GET"
                , cache: false
                , dataType: "json"
                , success: function(result) {
                }
                , error: function(error) {
                }
            });
        }
        
        , addTchaid: function(data) {
            var tchaidid = data.tchaidid;
            var tchaidNm = data.tchaidNm + " (" + data.tchaidNo + ")";
            if($("[data-tchaidid='" + tchaidid + "']").length != 0) { // 이미 추가되어 있는 교구인 경우 추가하지 않음
                return false;
            }
            $("#tchaidContainer > div").append(
                '<span class="label label-inverse" data-tchaidid="' + tchaidid + '">' + tchaidNm + '<a href="javascript:jntpurchsUpdate.removeTchaid(' + "'" + tchaidid + "'" + ');" class="text-white">X</a></span>'
            );
            $("#tchaidContainer").removeClass("d-none");
        }
        
        , removeTchaid: function(tchaidid) {
            $("[data-tchaidid='" + tchaidid + "']").remove();
            if($("[data-tchaidid]").length == 0) {
                $("#tchaidContainer").addClass("d-none");
            }
        }
        
        , setAmt: function() {
            if(this.amtList.length != 0) {
                $(".amt-row").remove();
            } else {
                $("input[name='qntyBgng0']").rules("add", {digits: true});
                $("input[name='qntyEnd0']").rules("add", {digits: true});
                $("input[name='amt0']").rules("add", {digits: true});
            }
            for(var i = 0, len = this.amtList.length; i < len; i++) {
                var data = this.amtList[i];
                this.addAmt();
                $($($(".amt-row")[i]).find("input")[0]).val(data.qntyBgng);
                $($($(".amt-row")[i]).find("input")[1]).val(data.qntyEnd);
                $($($(".amt-row")[i]).find("input")[2]).val(data.amt);
            }
            this.setAmtBtn();
        }
        
        , addAmt: function() {
            this.amtid += 1;
            var amtRow = this.amtTmplat.clone();
            $(amtRow.find("input")[0]).attr("name", "qntyBgng" + this.amtid).attr("id", "qntyBgng" + this.amtid);
            $(amtRow.find("input")[1]).attr("name", "qntyEnd" + this.amtid).attr("id", "qntyEnd" + this.amtid);
            $(amtRow.find("input")[2]).attr("name", "amt" + this.amtid).attr("id", "amt" + this.amtid);
            $("#amtContainer").append(amtRow);
            $("input[name='qntyBgng" + this.amtid + "']").rules("add", {digits: true});
            $("input[name='qntyEnd" + this.amtid + "']").rules("add", {digits: true});
            $("input[name='amt" + this.amtid + "']").rules("add", {digits: true});
        }
        
        , setAmtBtn: function() {
            var len = $(".amt-row").length;
            if(len == 1) {
                $(".amt-add-btn").removeClass("d-none");
                $(".amt-remove-btn").addClass("d-none");
                return false;
            } 
            $(".amt-row").each(function(index) {
                if(index == len - 1) {
                    $(this).find(".amt-add-btn").removeClass("d-none");
                    $(this).find(".amt-remove-btn").removeClass("d-none");
                } else {
                    $(this).find(".amt-add-btn").addClass("d-none");
                    $(this).find(".amt-remove-btn").removeClass("d-none");
                }
            });
        }
        
        , setValid: function() {
            var validator = $('#jntpurchsUpdateForm').validate({
                rules: {
                    jntpurchsNm: {required: true, maxlength: 30}
                    , sttsCd: {required: true}
                    , qntyWhol: {digits: true}
                    , qntyLmt: {digits: true}
                    , qntyBgng0: {digits: true}
                    , qntyEnd0: {digits: true}
                    , bgngDtStr: {required: true}
                    , endDtStr: {required: true}
                }
                , messages: {
                    jntpurchsNm: {required: "공동구매모집명을 입력해주세요.", maxlength: "공동구매모집명은 30자 이하여야 합니다."}
                    , sttsCd: {required: "모집상태를 선택해주세요."}
                    , bgngDtStr: {required: "공동구매 접수 시작일시를 입력해주세요."}
                    , endDtStr: {required: "공동구매 접수 종료일시를 입력해주세요."}
                }
            });
        }
        
        , onDeleteJntpurchs: function() {
            if(!confirm("공동구매모집 정보를 삭제하시겠습니까?")) {
                return false;
            }
            var param = $("#jntpurchsUpdateForm").serialize();
            $.ajax({
                url : "/mng/jntpurchs/deleteJntpurchs.do",
                type: "POST",
                cache: false,
                dataType: "json",
                data: param,
                success: function(response) {
                    if(response.result == "success") {
                        alert(response.msg);
                        jntpurchsGrid.resetPageContent();
                    } else {
                        alert(response.msg);
                    }
                    closeWorkProgress();
                }
            });
        }
        
        , onUpdateJntpurchsStts: function() {
            if(!confirm("일시정지 처리하시겠습니까?")) {
                return false;
            }
            $.ajax({
                url : "/mng/jntpurchs/updateJntpurchsStts.do",
                type: "POST",
                cache: false,
                dataType: "json",
                data: {jntpurchsid: $("input[name='jntpurchsid']").val(), sttsCd: "172104"},
                success: function(response) {
                    if(response.result == "success") {
                        alert(response.msg);
                        jntpurchsGrid.resetPageContent();
                    } else {
                        alert(response.msg);
                    }
                    closeWorkProgress();
                }
            });
        }
        
        , onUpdatetJntpurchs: function() {
            if(!($("#jntpurchsUpdateForm").valid())) return;
            $("input[name='qntyWholLmtYn']").val($("#qntyWholLmtCheck").is(":checked") ? "Y" : "N");
            $("input[name='qntyLmtYn']").val($("#qntyLmtCheck").is(":checked") ? "Y" : "N");
            $("#dtlCn").val(this.dtlCnEditor.getData());
            $("#atentMttr").val(this.atentMttrEditor.getData());
            
            if($("[data-tchaidid]").length == 0) {
                alert("교구를 1개 이상 선택해주세요.");
                return false;
            }
            if($("#qntyWholYn").val() == "N" && !$("#qntyWhol").val()) {
                alert("공동구매 교구 총 수량을 입력해주세요.");
                $("#qntyWhol").focus();
                return false;
            }
            if($("#qntyLmtYn").val() == "N" && !$("#qntyLmt").val()) {
                alert("1인당 신청 가능 수량을 입력해주세요.");
                $("#qntyLmt").focus();
                return false;
            }
            var param = $("#jntpurchsUpdateForm").serialize();
            // 교구 설정
            $("[data-tchaidid]").each(function(index, item) {
                param += "&goodsList[" + index + "].tchaidid=" + $(this).attr("data-tchaidid");
            });
            // 공동구매 수량별 가격 설정
            $(".amt-row").each(function(index, item) {
                var qntyBgng = !$($(this).find("input")[0]).val() ? 0 : $($(this).find("input")[0]).val();
                var qntyEnd = !$($(this).find("input")[1]).val() ? 0 : $($(this).find("input")[1]).val();
                var amt = !$($(this).find("input")[2]).val() ? 0 : $($(this).find("input")[2]).val();
                if(qntyBgng == 0 && qntyEnd == 0 && amt == 0) { // 금액설정 입력이 없는 로우는 제외
                } else {
                    param += "&amtList[" + index + "].qntyBgng=" + qntyBgng;
                    param += "&amtList[" + index + "].qntyEnd=" + qntyEnd;
                    param += "&amtList[" + index + "].amt=" + amt;
                }
            });
            if(displayWorkProgress()) {
                $.ajax({
                    url : "/mng/jntpurchs/updateJntpurchs.do",
                    type: "POST",
                    cache: false,
                    dataType: "json",
                    data: param,
                    success: function(response) {
                        if(response.result == "success") {
                            alert(response.msg);
                            jntpurchsGrid.resetPageContent();
                        } else {
                            alert(response.msg);
                        }
                        closeWorkProgress();
                    }
                });
            }
        }
        
        , offUpdateJntpurchs: function() {
            jntpurchsGrid.toggleContent();
        }
    };
    
    jntpurchsUpdate.init();        
</script>