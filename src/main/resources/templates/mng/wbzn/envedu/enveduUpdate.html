<form id ="enveduUpdateForm">
<input type="hidden" id="enveduid" name="enveduid" th:value="${envedu.enveduid}">
	<!-- Hidden Contents Start -->
	<div class="panel panel-default" id="hiddenCon">
		<!-- Hidden Contents Title Start -->
		<div class="panel-heading trans"><strong>기본정보</strong></div>
		<!-- Hidden Contents Title End -->

		<!-- Tab Container Start -->
		<div class="card">
		    <div class="card-block-small p-t-0">
		        <div class="mb-2 row">
		            <div class="col-12 col-lg-3 mb-2 mb-lg-0">
		                <div class="mb-0 form-group required">
		                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>환경교육구분</strong></div>
		                    <div class="col-sm-12">
		                        <select name="enveduSeCd" id="enveduSeCd" class="form-select form-select-sm form-control-sm">
		                        	<option value="">- 선택 -</option>
			                        <option value="현장" th:selected="${envedu.enveduSeCd == '현장'}">현장</option>
			                        <option value="환경시사" th:selected="${envedu.enveduSeCd == '환경시사'}">환경시사</option>
			                        <option value="전문자료" th:selected="${envedu.enveduSeCd == '전문자료'}">전문자료</option>
			                        <option value="교육자료" th:selected="${envedu.enveduSeCd == '교육자료'}">교육자료</option>
			                        <option value="환경문화" th:selected="${envedu.enveduSeCd == '환경문화'}">환경문화</option>
			                        <option value="환경소식" th:selected="${envedu.enveduSeCd == '환경소식'}">환경소식</option>
			                        <option value="행사정보" th:selected="${envedu.enveduSeCd == '행사정보'}">행사정보</option>
			                        <option value="채용공모" th:selected="${envedu.enveduSeCd == '채용공모'}">채용공모</option>
		                        </select>
		                    </div>
		                </div>
		            </div>
		            <div class="col-12 col-lg-3 mb-2 mb-lg-0">
		                <div class="mb-0 form-group required">
		                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>연도</strong></div>
		                    <div class="col-sm-12">
		                        <select name="yr" id="yr" class="form-select form-select-sm form-control-sm">
			                        <option value="">- 선택 -</option>
									<th:block th:each="year : ${years}">
									<option th:value="${year}" th:selected="${envedu.yr} == ${year}"><th:block th:text="${year}" /></option>
									</th:block>
		                        </select>
		                    </div>
		                </div>
		            </div>
		            <div class="col-12 col-lg-3">
		                <div class="mb-0 form-group required">
		                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>월</strong></div>
		                    <div class="col-sm-12">
		                        <select name="mm" id="mm" class="form-select form-select-sm form-control-sm">
			                        <option value="">- 선택 -</option>
									<th:block th:each="month : ${month}">
									<option th:value="${month}" th:selected="${envedu.mm} == ${month}"><th:block th:text="${month}" /></option>
		                        </select>
		                    </div>
		                </div>
		            </div>
		        </div>
		        <div class="mb-2 form-group row required">
		            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="environmentEduTitle"><strong>제목</strong></label>
		            <div class="col-sm-12">
		                <input type="text" class="form-control form-control-sm" name="ttl" id="ttl" placeholder="제목" th:value="${envedu.ttl}"/>
		            </div>
		        </div>
		        <div class="mb-2 form-group row">
		            <div class="mb-0 form-group">
		                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="environmentEduThumbnailImg">썸네일이미지</label>
		                <div class="mb-2 row">
		                    <div class="col-auto">
		                        <div id="fileUploadSuccess">
		                        </div>
		                    </div>
		                </div>
		                <div class="col-sm-12">
		                    <input type="file" class="form-control form-control-sm" id="thmbnFile" name="thmbnFile"/>
                            <!-- <input type="hidden" name="thmbnFilegrpid" id="thmbnFilegrpid" th:value="${envedu.thmbnFilegrpid}">
                            <input type="hidden" name="thmbnFileid" id="thmbnFileid" th:value="${envedu.thmbnFileid}"> -->		                    
		                </div>
		            </div>
		        </div>
		        <div class="mb-2 form-group row">
		            <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>유형</strong></div>
		            <div class="col-12">
		                <div class="form-radio">
		                    <div class="radio radio-inline">
		                        <label class="mb-0 form-label">
		                            <input type="radio" name="clsfCd" id="clsfCd1" value="html" th:checked="${envedu.clsfCd eq 'html'}"/>
		                            <i class="helper"></i>HTML
		                        </label>
		                    </div>
		                    <div class="radio radio-inline">
		                        <label class="mb-0 form-label">
		                            <input type="radio" name="clsfCd" id="clsfCd2" value="url" th:checked="${envedu.clsfCd eq 'url'}"/>
		                            <i class="helper"></i>URL
		                        </label>
		                    </div>
		                </div>
		            </div>
		        </div>
		        <div class="mb-2 form-group row url">
		            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="url"><strong>URL</strong></label>
		            <div class="col-12">
		                <input type="text" class="form-control form-control-sm" name="url" id="url" placeholder="URL" th:value="${envedu.url}"/>
		            </div>
		        </div>
		        <div class="mb-2 form-group row cnStyle">
		            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="cnStyle"><strong>내용 style(css)</strong></label>
		            <div class="col-sm-12">
		                <textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="내용 style(css)" name="cnStyle" id="cnStyle" th:value="${envedu.cnStyle}" th:text="${envedu.cnStyle}"></textarea>
		            </div>
		        </div>
		        <div class="mb-0 form-group row cn">
		            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="cn"><strong>내용</strong></label>
		            <div class="col-12">
		                <textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="내용" name="cn" id="cn" th:value="${envedu.cn}" th:text="${envedu.cn}"></textarea>
		            </div>
		        </div>
		    </div>
		    <div class="card-block-small">
		        <button type="button" class="btn btn-disabled m-r-5" id="cancelInsertMmnws" onclick="gridHelper1.toggleContent()">취소</button>
		        <th:block sec:authorize-url="/mng/wbzn/updateEnvedu.do"><button type="button" class="btn btn-primary" id="updateEnvedu" onclick="fn_updateEnvedu()">저장</button></th:block>
		    </div>
		</div>
		<!-- Tab Container End -->
	</div>
	<!-- Hidden Contents End -->
</form>

<script type="text/javascript">
	init();
	
	$("input[name='clsfCd']").change(function(){
		if($("input[name='clsfCd']:checked").val() == 'html') {
			$(".url").hide();
			$(".cnStyle").show();
			$(".cn").show();
		}else{
			$(".url").show();
			$(".cnStyle").hide();
			$(".cn").hide();
		}
	});
 	
	$('#thmbnFile').change(function(event) {
		console.log(1);
	    var formData = new FormData();
	    var objFile = event.target;
	    var content = "";

	    formData.append("file", objFile.files[0]);
	    formData.append("filegrpNm", "user_profile");
	    if($('#thmbnFilegrpid').val() != '')
	        formData.append("filegrpid", $('#thmbnFilegrpid').val());

	    if(displayWorkProgress()){
		    $.ajax({
		        url : '/uploadFile.do',
		        processData : false,
		        contentType : false,
		        data : formData,
		        type : 'POST',
		        success : function(response) {
		            if(response.result == 'fail'){
				        alert(response.msg);
				    }else if(response.filegrpid != undefined && response.filegrpid != ''){
				        $("#thmbnFilegrpid").val(response.filegrpid);
				        $("#thmbnFileid").val(response.fileid);
				        content = "<div class ='label label-inverse text-white' id='"+response.fileid+"'><a href=javascript:downloadFileByFileid('"+response.fileid+"','"+response.fileIdntfcKey+"') class='text-white'>"+response.orginlFileNm+"&nbsp;&nbsp;</a>";
	                    content +="<a href=javascript:fn_deleteFileList('"+response.fileid+"','"+response.fileIdntfcKey+"') class='text-white'>X</a>";
	                    $('#fileUploadSuccess').html(content);
				    }
				    closeWorkProgress();
		        }
		    });
		    $("#pfphotoFile").val("");
		}

	    event.preventDefault();

	});
	
	function fn_deleteFileList(fileid, fileIdntfcKey){
	    if(!confirm("파일을 삭제하시겠습니까?")){return;}
	    fn_deleteFile(fileid, fileIdntfcKey);
	    $("#"+fileid).remove();
	    $('#thmbnFile').val('');
	} 

	function fn_deleteFile(fileid, fileIdntfcKey){
	               
	    var deleteFileUrl="/deleteFile.do?fileid="+fileid+"&file_idntfc_key=" + fileIdntfcKey; 
	      $.ajax({
	        url : deleteFileUrl,
	        type: 'GET',
	        cache : false,
	        dataType: 'json',
	        success : function (data){
	            console.log(data);
	            if(data.result=="success"){
	                $("#"+fileid).remove();
	                $('#thmbnFile').val('');
	                alert("파일삭제가 완료 되었습니다.");
	            }else{
	                alert("파일삭제중 에러가 발생하였습니다. 관리자에게 문의 부탁드립니다.");
	            }
	        },
	        error : function (error){
	        } 
	     })
	};
	
 	function init() {
		$(".url").hide();
		$(".cnStyle").hide();
		$(".cn").hide();
		
		if($("input[name='clsfCd']").val() == 'html') {
			$(".url").hide();
			$(".cnStyle").show();
			$(".cn").show();
		}else{
			$(".url").show();
			$(".cnStyle").hide();
			$(".cn").hide();
		}
 	}
 	
 	function fn_updateEnvedu(){
	 	if(!($("#enveduUpdateForm").valid())) return;

  	 	if(!confirm("저장하시겠습니까?")) return;
  	 	    
	    var data =  $("#enveduUpdateForm").serialize();
	    if(displayWorkProgress()){
			$.ajax({
				url : "/mng/wbzn/updateEnvedu.do",
				type: 'POST',
				cache : false,
				dataType: 'json',
				data : data,
				success : function (data){
					if(data.result=="success"){
						alert(data.msg);
						gridHelper1.resetListContent();
					}else{
						alert(data.msg);
					}
					closeWorkProgress();
				}
			});
		}
	}
</script>