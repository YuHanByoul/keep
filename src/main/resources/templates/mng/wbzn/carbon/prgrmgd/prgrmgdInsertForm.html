<form id ="prgrmgdInsertForm">
<input type="hidden" id=clsfCd name="clsfCd" value="232102">
		<!-- INSERT -->
		<div class="card-header p-b-0">
        	<h3 class="sub-title"><strong>등록</strong></h3>
        </div>

		<!-- Tab Container Start -->
        <div class="card-block-small p-t-0">
        	<div class="row">
		        <div class="mb-2 row">
		            <div class="col-12 col-lg-3 mb-2 mb-lg-0">
		                <div class="mb-0 form-group required">
		                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>지역구분</strong></div>
		                    <div class="col-sm-12">
		                        <span kattr:select_code="rgnCd" name="rgnCd" id="rgnCd" grpCd="148" firstOptTxt="- 선택 -" addClass="input-sm" isAdmin="true">
		                    </div>
		                </div>
		            </div>
		            <div class="col-12 col-lg-3 mb-2 mb-lg-0">
		                <div class="mb-0 form-group required">
		                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>연도</strong></div>
		                    <div class="col-sm-12">
		                        <select name="yr" id="yr" class="form-select form-select-sm form-control-sm">
									<th:block th:each="year : ${years}">
									<option th:value="${year}"><th:block th:text="${year}" /></option>
									</th:block>
		                        </select>
		                    </div>
		                </div>
		            </div>
		            <div class="col-12 col-lg-3">
		                <div class="mb-0 form-group required">
		                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>분기</strong></div>
		                    <div class="col-sm-12">
		                        <select name="qu" id="qu" class="form-select form-select-sm form-control-sm">
			                        <option value="">- 선택 -</option>
									<option value="1">1</option>
									<option value="2">2</option>
									<option value="3">3</option>
									<option value="4">4</option>
									<option value="특별호">특별호</option>
		                        </select>
		                    </div>
		                </div>
		            </div>
		        </div>
		        <div class="mb-2 form-group row required">
		            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="environmentEduTitle"><strong>제목</strong></label>
		            <div class="col-sm-12">
		                <input type="text" class="form-control form-control-sm" name="ttl" id="ttl" placeholder="제목"/>
		            </div>
		        </div>
		        <div class="mb-2 form-group row required">
		            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="schdl"><strong>일시</strong></label>
		            <div class="col-12">
		                <input class="form-control form-control-sm" type="text" name="schdl" id="schdl"/>
		            </div>
		        </div>
		        <div class="mb-2 form-group row required">
		            <div class="mb-0 form-group">
		                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="environmentEduThumbnailImg"><strong>썸네일이미지</strong></label>
		                <div class="col-sm-12">
		                    <input type="file" class="form-control form-control-sm" id="thmbnFile" name="thmbnFile"/>
                            <input type="hidden" name="thmbnFilegrpid" id="thmbnFilegrpid" value="0">
                            <input type="hidden" name="thmbnFileid" id="thmbnFileid" value="0">		                    
		                </div>
		                <div class="mt-2 row">
		                    <div class="col-auto">
		                        <div id="fileUploadSuccess">
		                        </div>
		                    </div>
		                </div>
		            </div>
		        </div>
		        <div class="mb-2 form-group row">
		            <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>유형</strong></div>
		            <div class="col-12">
		                <div class="form-radio">
		                    <div class="radio radio-inline">
		                        <label class="mb-0 form-label">
		                            <input type="radio" name="typeCd" id="typeCd1" value="html" checked/>
		                            <i class="helper"></i>HTML
		                        </label>
		                    </div>
		                    <div class="radio radio-inline">
		                        <label class="mb-0 form-label">
		                            <input type="radio" name="typeCd" id="typeCd2" value="url"/>
		                            <i class="helper"></i>URL
		                        </label>
		                    </div>
		                </div>
		            </div>
		        </div>
		        <div class="mb-2 form-group row url">
		            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="url"><strong>URL</strong></label>
		            <div class="col-12">
		                <input type="text" class="form-control form-control-sm" name="url" id="url" placeholder="URL"/>
		            </div>
		        </div>
		        <div class="mb-2 form-group row cnStyle">
		            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="cnStyle"><strong>내용 style(css)</strong></label>
		            <div class="col-sm-12">
		                <textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="내용 style(css)" name="cnStyle" id="cnStyle"></textarea>
		            </div>
		        </div>
		        <div class="mb-2 form-group row cn">
		            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="cn"><strong>내용</strong></label>
		            <div class="col-12">
		                <textarea class="form-control form-control-sm" name="cn" id="cn"></textarea>
		            </div>
		        </div>
		        <div class="mb-0 form-group row required">
		            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="cn"><strong>요약 내용</strong></label>
		            <div class="col-12">
		                <input type="text" class="form-control form-control-sm" name="cnSumry" id="cnSumry" placeholder="요약 내용은 200자 이하여야 합니다."/>
		            </div>
		        </div>
		    </div>
		</div>
	    <div class="card-block-small">
	        <button type="button" class="btn btn-disabled m-r-5" id="cancelInsertPrgrmgd" onclick="gridHelper1.toggleContent()">취소</button>
	        <th:block sec:authorize-url="/mng/wbzn/now/prgrmgd/insertPrgrmgd.do"><button type="button" class="btn btn-primary" id="insertPrgrmgd" onclick="fn_insertPrgrmgd()">저장</button></th:block>
	    </div>
		<!-- Tab Container End -->
</form>

<script th:inline="javascript">
	init();
	
	var validator= $("#prgrmgdInsertForm").validate({
	    rules: {
	    	rgnCd	   :	{ required: true }
	    	,qu 	   :	{ required: true }  
	     	,ttl   	   :	{ required: true }
     		,schdl     : 	{ required: true }
	     	,cnSumry   : 	{ required: true, maxlength: 200 }
	    },
	    messages: {
	    	rgnCd  	 :   { required: "지역구분을 선택해주십시오." }
	    	,qu		 :   { required: "분기를 선택해주십시오." }
		    ,ttl   	 :   { required: "제목을 입력해주십시오." }
		    ,schdl   :   { required: "일시를 선택해주십시오." }
		    ,cnSumry : 	 { required: "요약 내용을 입력해주십시오.", maxlength: "요약 내용은 200자 이하여야 합니다." }
	    }
	})
	
	var editor;
	
	$(function () {
	    editor = CKEDITOR.replace('cn');
	});

	$("input[name='typeCd']").change(function(){
		if($("input[name='typeCd']:checked").val() == 'html') {
			$(".url").hide();
			$(".cnStyle").show();
			$(".cn").show();
		}else{
			$(".url").show();
			$(".cnStyle").hide();
			$(".cn").hide();
		}
	});
	
	$('#thmbnFile').change(function(event) {
	    var formData = new FormData();
	    var objFile = event.target;
	    var content = "";

	    formData.append("file", objFile.files[0]);
	    formData.append("filegrpNm", "thmbn_file");
	    if($('#thmbnFilegrpid').val() != '')
	        formData.append("filegrpid", $('#thmbnFilegrpid').val());

	    if(displayWorkProgress()){
		    $.ajax({
		        url : '/uploadFile.do',
		        processData : false,
		        contentType : false,
		        data : formData,
		        type : 'POST',
		        success : function(response) {
		            if(response.result == 'fail'){
				        alert(response.msg);
				    }else if(response.filegrpid != undefined && response.filegrpid != ''){
				        $("#thmbnFilegrpid").val(response.filegrpid);
				        $("#thmbnFileid").val(response.fileid);
				        content = "<div class ='col-12 label label-inverse text-white' id='"+response.fileid+"'><a href=javascript:downloadFileByFileid('"+response.fileid+"','"+response.fileIdntfcKey+"') class='text-white'>"+response.orginlFileNm+"&nbsp;&nbsp;</a>";
	                    content +="<a href=javascript:fn_deleteFileList('"+response.fileid+"','"+response.fileIdntfcKey+"') class='text-white'>X</a></div>";
	                    $('#fileUploadSuccess').html(content);
				    }
				    closeWorkProgress();
		        }
		    });
		    $("#thmbnFile").val("");
		}
	    event.preventDefault();
	});
	
	function fn_deleteFileList(fileid, fileIdntfcKey){
	    if(!confirm("파일을 삭제하시겠습니까?")){return;}
	    fn_deleteFile(fileid, fileIdntfcKey);
	    $("#"+fileid).remove();
	    $('#thmbnFile').val('');
	} 

	function fn_deleteFile(fileid, fileIdntfcKey){
	               
	    var deleteFileUrl="/deleteFile.do?fileid="+fileid+"&file_idntfc_key=" + fileIdntfcKey; 
	      $.ajax({
	        url : deleteFileUrl,
	        type: 'GET',
	        cache : false,
	        dataType: 'json',
	        success : function (data){
	            if(data.result=="success"){
	                $("#"+fileid).remove();
	                $('#thmbnFileid').val(0);
	                $('#thmbnFilegrpid').val(0);
	                $('#thmbnFile').val('');
	                alert("파일삭제가 완료 되었습니다.");
	            }else{
	                alert("파일삭제중 에러가 발생하였습니다. 관리자에게 문의 부탁드립니다.");
	            }
	        },
	        error : function (error){
	        } 
	     })
	};
		
	function init() {
		if($("input[name='typeCd']:checked").val() == 'html') {
			$(".url").hide();
			$(".cnStyle").show();
			$(".cn").show();
		}else{
			$(".url").show();
			$(".cnStyle").hide();
			$(".cn").hide();
		}
	}
	
 	function fn_insertPrgrmgd(){
	 	if(!($("#prgrmgdInsertForm").valid())) return;
	 	
		if($("#thmbnFileid").val() == 0) {
			alert("썸네일이미지를 첨부해 주십시오.")
			return false;
		}
		
		if($("#url").val() != "") {
			if(!(($("#url").val().includes("https://") || $("#url").val().includes("http://")))){
				alert("URL에 https:// 또는 http://를 포함시켜 주십시오.");
				return false;
			}			
		}

  	 	if(!confirm("저장하시겠습니까?")) return;
  	 	
  	 	var editorData = editor.getData();
        $("#cn").val(editorData);
  	 	    
	    var data =  $("#prgrmgdInsertForm").serialize();
	    if(displayWorkProgress()){
			$.ajax({
				url : "/mng/wbzn/carbon/prgrmgd/insertPrgrmgd.do",
				type: 'POST',
				cache : false,
				dataType: 'json',
				data : data,
				success : function (data){
					if(data.result=="success"){
						alert(data.msg);
						gridHelper1.resetListContent();
					}else{
						alert(data.msg);
					}
					closeWorkProgress();
				}
			});
		}
	}
</script>