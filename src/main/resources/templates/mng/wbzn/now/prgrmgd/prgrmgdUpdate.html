<form id ="prgrmgdUpdateForm">
<input type="hidden" id="prgrmid" name="prgrmid" th:value="${prgrmgd.prgrmid}">
<input type="hidden" id=clsfCd name="clsfCd" th:value="${prgrmgd.clsfCd}">
		 <!-- UPDATE -->
         <div class="card-header p-b-0">
             <h3 class="sub-title"><strong>기본정보</strong></h3>
         </div>
         <div class="card-block-small p-t-0">
             <div class="row">
		        <div class="mb-2 row">
		            <div class="col-12 col-lg-3 mb-2 mb-lg-0">
		                <div class="mb-0 form-group required">
		                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>환경교육구분</strong></div>
		                    <div class="col-sm-12">
		                        <select name="rgnCd" id="rgnCd" class="form-select form-select-sm form-control-sm">
		                        	<option value="">- 선택 -</option>
			                        <option value="서울" th:selected="${prgrmgd.rgnCd == '서울'}">서울</option>
			                        <option value="경기/인천" th:selected="${prgrmgd.rgnCd == '경기/인천'}">경기/인천</option>
			                        <option value="강원/제주" th:selected="${prgrmgd.rgnCd == '강원/제주'}">강원/제주</option>
			                        <option value="호남권" th:selected="${prgrmgd.rgnCd == '호남권'}">호남권</option>
			                        <option value="충청권" th:selected="${prgrmgd.rgnCd == '충청권'}">충청권</option>
			                        <option value="영남권" th:selected="${prgrmgd.rgnCd == '영남권'}">영남권</option>
		                        </select>
		                    </div>
		                </div>
		            </div>
		            <div class="col-12 col-lg-3 mb-2 mb-lg-0">
		                <div class="mb-0 form-group required">
		                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>연도</strong></div>
		                    <div class="col-sm-12">
		                        <select name="yr" id="yr" class="form-select form-select-sm form-control-sm">
			                        <option value="">- 선택 -</option>
									<th:block th:each="year : ${years}">
									<option th:value="${year}" th:selected="${prgrmgd.yr} == ${year}"><th:block th:text="${year}" /></option>
									</th:block>
		                        </select>
		                    </div>
		                </div>
		            </div>
		            <div class="col-12 col-lg-3">
		                <div class="mb-0 form-group required">
		                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>월</strong></div>
		                    <div class="col-sm-12">
		                        <select name="mm" id="mm" class="form-select form-select-sm form-control-sm">
			                        <option value="">- 선택 -</option>
									<th:block th:each="month : ${month}">
									<option th:value="${month}" th:selected="${prgrmgd.mm} == ${month}"><th:block th:text="${month}" /></option>
		                        </select>
		                    </div>
		                </div>
		            </div>
		        </div>
		        <div class="mb-2 form-group row required">
		            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="environmentEduTitle"><strong>제목</strong></label>
		            <div class="col-sm-12">
		                <input type="text" class="form-control form-control-sm" name="ttl" id="ttl" placeholder="제목" th:value="${prgrmgd.ttl}"/>
		            </div>
		        </div>
		        <div class="mb-2 form-group row required">
		            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="dt"><strong>일시</strong></label>
		            <div class="col-auto">
		                <input class="form-control form-control-sm" type="datetime-local" name="dt" id="dt" th:value="${prgrmgd.dt}"/>
		            </div>
		        </div>		        
		        <div class="mb-2 form-group row">
		            <div class="mb-0 form-group">
		                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="environmentEduThumbnailImg"><strong>썸네일이미지</strong></label>
		                <div class="col-sm-12">
		                    <input type="file" class="form-control form-control-sm" id="thmbnFile" name="thmbnFile"/>
                            <input type="hidden" name="thmbnFilegrpid" id="thmbnFilegrpid" th:value="${prgrmgd.filegrpid}">
                            <input type="hidden" name="thmbnFileid" id="thmbnFileid" th:value="${prgrmgd.thmbnFileid}">		                    
		                </div>
		                <div class="mt-2 row">
		                    <div class="col-auto">
		                    	<th:block th:if="${fileBtn}">
		                        <div id="fileUploadSuccess" th:utext="${fileBtn}">
		                        </div>
		                        </th:block>
                		        <th:block th:unless="${fileBtn}">
		                        <div id="fileUploadSuccess">
		                        </div>
		                        </th:block>
		                    </div>
		                </div>		                
		            </div>
		        </div>
		        <div class="mb-2 form-group row">
		            <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>유형</strong></div>
		            <div class="col-12">
		                <div class="form-radio">
		                    <div class="radio radio-inline">
		                        <label class="mb-0 form-label">
		                            <input type="radio" name="typeCd" id="typeCd1" value="html" th:checked="${prgrmgd.typeCd eq 'html'}"/>
		                            <i class="helper"></i>HTML
		                        </label>
		                    </div>
		                    <div class="radio radio-inline">
		                        <label class="mb-0 form-label">
		                            <input type="radio" name="typeCd" id="typeCd2" value="url" th:checked="${prgrmgd.typeCd eq 'url'}"/>
		                            <i class="helper"></i>URL
		                        </label>
		                    </div>
		                </div>
		            </div>
		        </div>
		        <div class="mb-2 form-group row url">
		            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="url"><strong>URL</strong></label>
		            <div class="col-12">
		                <input type="text" class="form-control form-control-sm" name="url" id="url" placeholder="URL" th:value="${prgrmgd.url}"/>
		            </div>
		        </div>
		        <div class="mb-2 form-group row cnStyle">
		            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="cnStyle"><strong>내용 style(css)</strong></label>
		            <div class="col-sm-12">
		                <textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="내용 style(css)" name="cnStyle" id="cnStyle" th:value="${prgrmgd.cnStyle}" th:text="${prgrmgd.cnStyle}"></textarea>
		            </div>
		        </div>
		        <div class="mb-0 form-group row cn">
		            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="cn"><strong>내용</strong></label>
		            <div class="col-12">
		                <textarea class="form-control form-control-sm" name="cn" id="cn"><th:block th:text="${prgrmgd.cn}"></th:block></textarea>
		            </div>
		        </div>
		    </div>
		</div>
	    <div class="card-block-small">
	        <button type="button" class="btn btn-disabled m-r-5" id="cancelUpdatePrgrmgd" onclick="gridHelper1.toggleContent()">취소</button>
	        <th:block sec:authorize-url="/mng/wbzn/now/prgrmgd/updatePrgrmgd.do"><button type="button" class="btn btn-primary" id="updatePrgrmgd" onclick="fn_updatePrgrmgd()">저장</button></th:block>
	    </div>
		<!-- Tab Container End -->
</form>

<script type="text/javascript">
	init();
	
	var editor;
	
	$(function () {
	    editor = CKEDITOR.replace('cn');
	});
	
	$("input[name='typeCd']").change(function(){
		if($("input[name='typeCd']:checked").val() == 'html') {
			$(".url").hide();
			$(".cnStyle").show();
			$(".cn").show();
		}else{
			$(".url").show();
			$(".cnStyle").hide();
			$(".cn").hide();
		}
	});
 	
	$('#thmbnFile').change(function(event) {
	    var formData = new FormData();
	    var objFile = event.target;
	    var content = "";

	    formData.append("file", objFile.files[0]);
	    formData.append("filegrpNm", "thmbn_file");
	    if($('#thmbnFilegrpid').val() != '')
	        formData.append("filegrpid", $('#thmbnFilegrpid').val());

	    if(displayWorkProgress()){
		    $.ajax({
		        url : '/uploadFile.do',
		        processData : false,
		        contentType : false,
		        data : formData,
		        type : 'POST',
		        success : function(response) {
		            if(response.result == 'fail'){
				        alert(response.msg);
				    }else if(response.filegrpid != undefined && response.filegrpid != ''){
				        $("#thmbnFilegrpid").val(response.filegrpid);
				        $("#thmbnFileid").val(response.fileid);
				        content = "<div class ='label label-inverse text-white' id='"+response.fileid+"'><a href=javascript:downloadFileByFileid('"+response.fileid+"','"+response.fileIdntfcKey+"') class='text-white'>"+response.orginlFileNm+"&nbsp;&nbsp;</a>";
	                    content +="<a href=javascript:fn_deleteFileList('"+response.fileid+"','"+response.fileIdntfcKey+"') class='text-white'>X</a>";
	                    $('#fileUploadSuccess').html(content);
				    }
				    closeWorkProgress();
		        }
		    });
		    $("#thmbnFile").val("");
		}
	    event.preventDefault();
	});
	
	function fn_deleteFileList(fileid, fileIdntfcKey){
	    if(!confirm("파일을 삭제하시겠습니까?")){return;}
	    fn_deleteFile(fileid, fileIdntfcKey);
	    $("#"+fileid).remove();
	    $('#thmbnFile').val('');
	} 

	function fn_deleteFile(fileid, fileIdntfcKey){
	               
	    var deleteFileUrl="/deleteFile.do?fileid="+fileid+"&file_idntfc_key=" + fileIdntfcKey; 
	      $.ajax({
	        url : deleteFileUrl,
	        type: 'GET',
	        cache : false,
	        dataType: 'json',
	        success : function (data){
	            console.log(data);
	            if(data.result=="success"){
	                $("#"+fileid).remove();
	                $('#thmbnFile').val('');
	                $('#thmbnFileid').val(0);
	                $('#thmbnFilegrpid').val(0);
	                alert("파일삭제가 완료 되었습니다.");
	            }else{
	                alert("파일삭제중 에러가 발생하였습니다. 관리자에게 문의 부탁드립니다.");
	            }
	        },
	        error : function (error){
	        } 
	     })
	};
	
 	function init() {
		$(".url").hide();
		$(".cnStyle").hide();
		$(".cn").hide();
		
		if($("input[name='typeCd']").val() == 'html') {
			$(".url").hide();
			$(".cnStyle").show();
			$(".cn").show();
		}else{
			$(".url").show();
			$(".cnStyle").hide();
			$(".cn").hide();
		}
		console.log();
 	}
 	
 	function fn_updatePrgrmgd(){
	 	if(!($("#prgrmgdUpdateForm").valid())) return;

  	 	if(!confirm("저장하시겠습니까?")) return;
  	 	
  	 	var editorData = editor.getData();
        $("#cn").val(editorData);
  	 	    
	    var data =  $("#prgrmgdUpdateForm").serialize();
	    if(displayWorkProgress()){
			$.ajax({
				url : "/mng/wbzn/now/prgrmgd/updatePrgrmgd.do",
				type: 'POST',
				cache : false,
				dataType: 'json',
				data : data,
				success : function (data){
					if(data.result=="success"){
						alert(data.msg);
						gridHelper1.resetListContent();
					}else{
						alert(data.msg);
					}
					closeWorkProgress();
				}
			});
		}
	}
</script>