<form id ="envtcherTrnngInstUpdateForm">
<input type="hidden" name="ordrid" id="ordrid" th:value="${envtcherTrnngInst.ordrid}"/>
		<!-- INSERT -->
		<div class="card-header p-b-0">
        	<h3 class="sub-title"><strong>환경교육사 양성기관 정보</strong></h3>
        </div>

		<!-- Tab Container Start -->
		<div class="card-block-small p-t-0">
		    <div class="mb-2 row">
		        <div class="col-12 col-lg-6 mb-2 mb-lg-0">
		            <div class="mb-0 form-group required">
		                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="instNm"><strong>기관</strong></label>
		                <div class="d-flex">
		                    <div class="col">
		                        <input type="text" class="form-control form-control-sm" name="instNm" id="instNm" placeholder="기관" th:value="${envtcherTrnngInst.instNm}"/>
		                        <input type="hidden" name="instid" id="instid" th:value="${envtcherTrnngInst.instid}"/>
		                    </div>
		                    <div class="btn-group-sm ps-2">
		                        <button type="button" class="btn btn-inverse" onclick="fn_openInstSearchModal();">
		                            기관검색
		                        </button>
		                    </div>
		                </div>
		            </div>
		        </div>
		        <div class="col-12 col-lg-6">
		            <div class="mb-0 form-group required">
		                <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>지역</strong></div>
							<div class="row">
							    <div class="col-12 col-lg-6 mb-2 mb-lg-0">
							        <input type="text" class="form-control form-control-sm" name="sidoNm" id="sidoNm" placeholder="시도" th:value="${envtcherTrnngInst.sidoNm}" readonly/>
							    </div>
							    <div class="col-12 col-lg-6 text-right">
							        <input type="text" class="form-control form-control-sm" name="sigungu" id="signguNm" placeholder="시군구" th:value="${envtcherTrnngInst.signguNm}" readonly/>
							        <input type="hidden" name="signguCd" id="signguCd" th:value="${envtcherTrnngInst.signguCd}"/>
							    </div>
							</div>
		            </div>
		        </div>
		    </div>
		    <div class="mb-2 row">
		        <div class="col-12 col-lg-6 mb-2 mb-lg-0">
		            <div class="mb-0 form-group required">
		                <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>양성기관 등급</strong></div>
		                <div class="col-12">
		                	<span kattr:select_code="grdCd" grpCd="142" firstOptTxt="- 선택 -" th:attr="selectedCd=${envtcherTrnngInst.grdCd}" addClass="input-sm" isAdmin="true">
		                </div>
		            </div>
		        </div>
		        <div class="col-12 col-lg-6">
		            <div class="mb-0 form-group required">
		                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="agencySelectDate"><strong>양성기관 지정일</strong></label>
		                <div class="col-12">
		                    <input type="date" class="form-control form-control-sm col-auto" name="dsgnDe" id="dsgnDe" th:value="${envtcherTrnngInst.dsgnDe}"/>
		                </div>
		            </div>
		        </div>
		    </div>
		    <div class="mb-2 row">
		        <div class="col-12 col-lg-6 mb-2 mb-lg-0">
		            <div class="mb-0 form-group required">
		                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="instTypeCdNm"><strong>기관유형</strong></label>
		                <div class="col-12">
							<input type="text" class="form-control form-control-sm" name="instTypeCdNm" id="instTypeCdNm" placeholder="기관유형" th:value="${envtcherTrnngInst.instTypeCdNm}" readonly/>
							<input type="hidden" name="instTypeCd" id="instTypeCd" th:value="${envtcherTrnngInst.instTypeCd}"/>
		                </div>
		            </div>
		        </div>
		        <div class="col-12 col-lg-6">
		            <div class="mb-0 form-group required">
		                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="hmpg"><strong>홈페이지</strong></label>
		                <div class="col-sm-12">
		                    <input type="text" class="form-control form-control-sm" name="hmpg" id="hmpg" placeholder="홈페이지" th:value="${envtcherTrnngInst.hmpg}"/>
		                </div>
		            </div>
		        </div>
		    </div>
		    <div class="mb-2 row">
		        <div class="col-12 col-lg-6 mb-2 mb-lg-0">
		            <div class="mb-0 form-group required">
		                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="telno"><strong>전화번호</strong></label>
		                <div class="col-sm-12">
		                    <input type="text" class="form-control form-control-sm" name="telno" id="telno" placeholder="전화번호" th:value="${envtcherTrnngInst.telno}" readonly/>
		                </div>
		            </div>
		        </div>
		        <div class="col-12 col-lg-6">
		            <div class="mb-0 form-group required">
		                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="fxno"><strong>팩스번호</strong></label>
		                <div class="col-sm-12">
		                    <input type="text" class="form-control form-control-sm" name="fxno" id="fxno" placeholder="팩스번호" th:value="${envtcherTrnngInst.fxno}"/>
		                </div>
		            </div>
		        </div>
		    </div>
		    <div class="mb-2 row">
		        <div class="col-12 col-lg-6 mb-2 mb-lg-0">
		            <div class="mb-0 form-group required">
		                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="addr"><strong>주소</strong></label>
		                <div class="col-12">
		                    <input type="text" class="form-control form-control-sm" name="addr" id="addr" placeholder="주소" th:value="${envtcherTrnngInst.addr}" readonly/>
		                </div>
		            </div>
		        </div>
		        <div class="col-12 col-lg-6">
		            <div class="mb-0 form-group required">
		                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="addrDtl"><strong>상세주소</strong></label>
		                <div class="col-sm-12">
		                    <input type="text" class="form-control form-control-sm" name="addrDtl" id="addrDtl" placeholder="상세주소" th:value="${envtcherTrnngInst.addrDtl}" readonly/>
		                </div>
		            </div>
		        </div>
		    </div>
		    <div class="mb-2 form-group row">
		        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="agencyExplanation"><strong>설명</strong></label>
		        <div class="col-12">
		            <textarea rows="5" cols="5" class="form-control form-control-sm" id="expln" name="expln" placeholder="설명" th:value="${envtcherTrnngInst.expln}" th:text="${envtcherTrnngInst.expln}"></textarea>
		        </div>
		    </div>
		    <div class="mb-0 form-group row required">
		        <div class="col-12 p-t-0 pb-1">
		            <label class="col-form-label p-t-0 pb-1"><strong>썸네일 이미지</strong></label>
		            <strong>(권장 사이즈 : 000x000)</strong>
		        </div>
				<div class="col-sm-12">
				    <input type="file" class="form-control form-control-sm" id="thmbnFile" name="thmbnFile"/>
				    <input type="hidden" name="thmbnFilegrpid" id="thmbnFilegrpid" th:value="${envtcherTrnngInst.filegrpid}">
				    <input type="hidden" name="thmbnFileid" id="thmbnFileid" th:value="${envtcherTrnngInst.thmbnFileid}">		                    
				</div>
				<div class="mt-2 row">
				    <div class="col-auto">
	                   	<th:block th:if="${fileBtn}">
	                       <div id="fileUploadSuccess" th:utext="${fileBtn}">
	                       </div>
                        </th:block>
           		    	<th:block th:unless="${fileBtn}">
	                       <div id="fileUploadSuccess">
	                       </div>
                    	</th:block>
				    </div>
				</div>
		    </div>
		</div>
	    <div class="card-block-small">
	        <button type="button" class="btn btn-disabled m-r-5" id="cancelInsertRgnEnveduCntr" onclick="gridHelper1.toggleContent()">취소</button>
	        <th:block sec:authorize-url="/mng/envtcherTrnngInst/insertEnvtcherTrnngInst.do">
	        	<button type="button" class="btn btn-primary" id="insertRgnEnveduCntr" onclick="fn_insertEnvtcherTrnngInst()">저장</button>
	        </th:block>
	    </div>
		<!-- Tab Container End -->
</form>

<div class="modal fade" id="instSearchPopup" data-bs-backdrop="static"></div>
<script th:inline="javascript">
	var instSearchAddModal;
	
	fn_openInstSearchModal = () => {
		var instSearchPopupUrl = "/mng/envtcherTrnngInst/instSearchPopup.html?instNm=" + $("#instNm").val();
		$("#instSearchPopup").load(instSearchPopupUrl, function(response, status, xhr) {
			if (status == "success") {
				instSearchAddModal = new bootstrap.Modal($('#instSearchPopup'));
				instSearchAddModal.show();
			}
		});
	}

	var validator= $("#envtcherTrnngInstUpdateForm").validate({
	    rules: {
	    	seCd	:   { required: true }  
	    	,rgnCd  :   { required: true }  
	    	,cntrNm : 	{ required: true }
	    	,instNm : 	{ required: true }  
	     	,hmpg   : 	{ required: true }
	    },
	    messages: {
	    	seCd    :   { required: "구분을 선택해주십시오." }  
	    	,rgnCd  :   { required: "시도를 선택해주십시오." }
    	    ,cntrNm :   { required: "센터명을 입력해주십시오."  }
	    	,instNm :   { required: "기관명을 입력해주십시오." }
		    ,hmpg   :   { required: "홈페이지를 입력해주십시오." }
	    }
	})
	
	$('#thmbnFile').change(function(event) {
	    var formData = new FormData();
	    var objFile = event.target;
	    var content = "";
	
	    formData.append("file", objFile.files[0]);
	    formData.append("filegrpNm", "envtcher_thmbn_file");
	    if($('#thmbnFilegrpid').val() != '')
	        formData.append("filegrpid", $('#thmbnFilegrpid').val());
	
	    if(displayWorkProgress()){
		    $.ajax({
		        url : '/uploadFile.do',
		        processData : false,
		        contentType : false,
		        data : formData,
		        type : 'POST',
		        success : function(response) {
		            if(response.result == 'fail'){
				        alert(response.msg);
				    }else if(response.filegrpid != undefined && response.filegrpid != ''){
				        $("#thmbnFilegrpid").val(response.filegrpid);
				        $("#thmbnFileid").val(response.fileid);
				        content = "<div class ='col-12 label label-inverse text-white' id='"+response.fileid+"'><a href=javascript:downloadFileByFileid('"+response.fileid+"','"+response.fileIdntfcKey+"') class='text-white'>"+response.orginlFileNm+"&nbsp;&nbsp;</a>";
	                    content +="<a href=javascript:fn_deleteFileList('"+response.fileid+"','"+response.fileIdntfcKey+"') class='text-white'>X</a></div>";
	                    $('#fileUploadSuccess').html(content);
				    }
				    closeWorkProgress();
		        }
		    });
		    $("#thmbnFile").val("");
		}
	
	    event.preventDefault();

	});
	
	function fn_deleteFileList(fileid, fileIdntfcKey){
	    if(!confirm("파일을 삭제하시겠습니까?")){return;}
	    fn_deleteFile(fileid, fileIdntfcKey);
	    $("#"+fileid).remove();
	    $('#thmbnFile').val('');
	} 

	function fn_deleteFile(fileid, fileIdntfcKey){
	               
	    var deleteFileUrl="/deleteFile.do?fileid="+fileid+"&file_idntfc_key=" + fileIdntfcKey; 
	      $.ajax({
	        url : deleteFileUrl,
	        type: 'GET',
	        cache : false,
	        dataType: 'json',
	        success : function (data){
	            if(data.result=="success"){
	                $("#"+fileid).remove();
	                $('#thmbnFileid').val(0);
	                $('#thmbnFilegrpid').val(0);
	                $('#thmbnFile').val('');
	                alert("파일삭제가 완료 되었습니다.");
	            }else{
	                alert("파일삭제중 에러가 발생하였습니다. 관리자에게 문의 부탁드립니다.");
	            }
	        },
	        error : function (error){
	        } 
	     })
	};
	
 	function fn_insertEnvtcherTrnngInst(){
	 	if(!($("#envtcherTrnngInstUpdateForm").valid())) return;

  	 	if(!confirm("저장하시겠습니까?")) return;
  	 	
	    var data =  $("#envtcherTrnngInstUpdateForm").serialize();
	    if(displayWorkProgress()){
			$.ajax({
				url : "/mng/envtcherTrnngInst/updateEnvtcherTrnngInst.do",
				type: 'POST',
				cache : false,
				dataType: 'json',
				data : data,
				success : function (data){
					if(data.result=="success"){
						alert(data.msg);
						gridHelper1.resetPageContent();
					}else{
						alert(data.msg);
					}
					closeWorkProgress();
				}
			});
		}
	}
</script>