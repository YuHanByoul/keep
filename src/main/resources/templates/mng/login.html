<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security" 
	xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout" 
	layout:decorator="layout/mng/gateLayout" 
>
	<body>
		<div layout:fragment="content">
			<script type="text/javascript" charset="utf-8" src="/js/common/jquery/jquery.cookie.js"></script>
			<script th:inline="javascript">
			
				jQuery(document).ready(function(){		
					var f = document.login_form;
					if(jQuery.cookie != null)
					{			
						if(jQuery.cookie('userid') && jQuery.cookie('userid') != 'undefined' && jQuery.cookie('userid') != 'null'){
							f.p_userid.value =jQuery.cookie('userid');
						}
					}
					if(f.p_userid.value == ""){
						jQuery("#p_userid").focus();
					}else if(f.p_pswd.value == ""){
						jQuery("#p_pswd").focus();
					}
					
					//validateLogin();
				});
				
				// 유효성검증기(로그인)
				/*var validator;
			    function validateLogin(){
			        validator = $("#login_form").validate({
			            onsubmit: false,
			            rules: {
			                p_userid: {
                                required: true
                               ,maxlength: 40
                            },
			                p_pswd: {
			                    required: true
			                   ,maxlength: 40
			                }
			            },
			            messages: { 
			                p_userid: {
			                    required: "아이디를 입력해주십시오."
			                   ,maxlength: "아이디는 40자를 넘을 수 없습니다."
			                },
			                p_pswd: {
			                    required: "비밀번호를 입력해주십시오."
			                   ,maxlength: "비밀번호는 40자를 넘을 수 없습니다."
			                }
			            }
			        });
			    }*/
			
				function login(){			    
					var f = document.login_form;
					//if(!$('#login_form').valid()) return false;
					if($("#p_userid").val() == '') {
                        alert("아이디를 입력해주십시오.");
                        /*[# th:if="${T(org.springframework.mobile.device.DeviceUtils).getCurrentDevice(#request).isNormal()}"]*/
                        $("#p_userid").focus();
                        /*[/]*/
                        return false;
                    }
                    if($("#p_pswd").val() == '') {
                        alert("비밀번호를 입력해주십시오.");
                        /*[# th:if="${T(org.springframework.mobile.device.DeviceUtils).getCurrentDevice(#request).isNormal()}"]*/
                        $("#p_pswd").focus();
                        /*[/]*/
                        return false;
                    }
					/*[# th:if="${!@commonServiceImpl.selectCertIpList().contains(T(com.kbrainc.plum.rte.util.CommonUtil).getClientIp(#request))}"]*/
					if($("#encodeData").val() == "") {
                        alert("본인인증을 진행해주십시오.");

                        return false;
                    }
                    /*[/]*/
                    
					if(f.p_userid.value){
						jQuery.cookie('userid', f.p_userid.value, {expires:30});
					}
					return true;
				}
				
				function fnAuthPopup(){
                    window.open('', 'popupChk', 'width=500, height=550, top=100, left=100, fullscreen=no, menubar=no, status=no, toolbar=no, titlebar=yes, location=no, scrollbar=no');
                    document.form_chk.target = "popupChk";
                    document.form_chk.submit();
                }
                
                function setEncodeData(encodeData) {
                    document.login_form.encodeData.value = encodeData;
                    $("#authButton").attr("disabled", true);
                }
			</script>

        	<!-- Pre-loader start -->
            <div class="theme-loader">
                <div class="ball-scale">
                    <div class='contain'>
                        <div class="ring">
                            <div class="frame"></div>
                        </div>
                        <div class="ring">
                            <div class="frame"></div>
                        </div>
                        <div class="ring">
                            <div class="frame"></div>
                        </div>
                        <div class="ring">
                            <div class="frame"></div>
                        </div>
                        <div class="ring">
                            <div class="frame"></div>
                        </div>
                        <div class="ring">
                            <div class="frame"></div>
                        </div>
                        <div class="ring">
                            <div class="frame"></div>
                        </div>
                        <div class="ring">
                            <div class="frame"></div>
                        </div>
                        <div class="ring">
                            <div class="frame"></div>
                        </div>
                        <div class="ring">
                            <div class="frame"></div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Pre-loader end -->
        
            <section class="login-block">
                <!-- Container-fluid starts -->
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12">
                            <!-- Authentication card start -->
        
                            <form class="md-float-material form-material" name="login_form" id="login_form" th:action="@{/login}" method="post" onsubmit="return login();">
                                <input type="hidden" name="encodeData" id="encodeData" />
                                <div class="text-center">
                                    <img th:src="'/downloadFileByFileid.do?fileid='+${session.site.logoFileid}+'&file_idntfc_key='+${session.site.logoFileIdntfcKey}" width="150" height="30">
                                </div>
                                <div class="auth-box card">
                                    <div class="card-block">
                                        <div class="row m-b-20">
                                            <div class="col-md-12">
                                                <h3 class="text-center">Sign In</h3>
                                            </div>
                                        </div>
                                        <div class="mb-3 form-primary">
                                            <input type="text" name="p_userid" id="p_userid" maxlength="50" class="form-control" 
                                                placeholder="Id">
                                            <span class="form-bar"></span>
                                        </div>
                                        <div class="mb-3 form-primary">
                                            <input type="password" name="p_pswd" id="p_pswd" maxlength="50" class="form-control" 
                                                placeholder="Password" autocomplete="off">
                                            <span class="form-bar"></span>
                                        </div>
                                        <div class="row m-t-30" th:if="${!@commonServiceImpl.selectCertIpList().contains(T(com.kbrainc.plum.rte.util.CommonUtil).getClientIp(#request))}">
                                            <div class="col-md-12">
                                                <div class="d-grid">
                                                    <input type="button" class="btn btn-primary btn-md waves-effect waves-light text-center m-b-20" id="authButton" onclick="fnAuthPopup()" value="휴대폰 본인인증 하기" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row m-t-30">
                                            <div class="col-md-12">
                                                <div class="d-grid">
                                                    <input type="submit" class="btn btn-primary btn-md waves-effect waves-light text-center m-b-20 " value="Sign in" />
                                                </div>
                                            </div>
                                        </div>
                                        <hr />
                                        <div class="row">
                                            <div class="col-md-12">
                                                <th:block th:if="${param.msg}">
                                                <p class="text-inverse text-start m-b-0"><th:block th:text="${T(com.kbrainc.plum.rte.util.StringUtil).base64DecodeFromUrlSafeString(param.msg)}" /></p>
                                                </th:block>
                                                <th:block th:unless="${param.msg}">
                                                    <th:block th:if="${param.error}">
                                                        <p class="text-inverse text-start m-b-0">아이디 또는 비밀번호를 다시 확인해 주십시오.</p>
                                                    </th:block>
                                                </th:block>
                                                <th:block th:if="${param.timeout}">
                                                <p class="text-inverse text-start m-b-0">세션이 유효하지 않습니다. 다시 로그인 해주십시오.</p>
                                                </th:block>
                                            </div>
                                        </div>
                                    </div>
                                    <!--/* <span th:text="${T(com.kbrainc.plum.rte.util.CommonUtil).getClientIpTest(#request)}" style="color:white"></span> */-->
                                </div>
                            </form>
                            <form name="form_chk" th:action="@{/CheckPlusSafeModel/checkplus.html}" method="post">
                                <input type="hidden" name="kind" value="info" />
                            </form>
                            <!-- end of form -->
                        </div>
                        <!-- end of col-sm-12 -->
                    </div>
                    <!-- end of row -->
                </div>
                <!-- end of container-fluid -->
            </section>
            <!-- Required Jquery -->
            <script type="text/javascript" src="/files/bower_components/jquery/dist/jquery.min.js"></script>
            <script type="text/javascript" src="/files/bower_components/jquery-ui/jquery-ui.min.js"></script>
            <script type="text/javascript" src="/files/bower_components/popper.js/dist/umd/popper.min.js"></script>
            <script type="text/javascript" src="/files/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
            <!-- jquery slimscroll js -->
            <script type="text/javascript" src="/files/bower_components/jquery-slimscroll/jquery.slimscroll.js"></script>
            <!-- modernizr js -->
            <script type="text/javascript" src="/files/bower_components/modernizr/modernizr.js"></script>
            <script type="text/javascript" src="/files/bower_components/modernizr/feature-detects/css-scrollbars.js"></script>
            <!-- i18next.min.js -->
            <script type="text/javascript" src="/files/bower_components/i18next/i18next.min.js"></script>
            <script type="text/javascript"
                src="/files/bower_components/i18next-xhr-backend/i18nextXHRBackend.min.js"></script>
            <script type="text/javascript"
                src="/files/bower_components/i18next-browser-languagedetector/i18nextBrowserLanguageDetector.min.js"></script>
            <script type="text/javascript" src="/files/bower_components/jquery-i18next/jquery-i18next.min.js"></script>
            <script type="text/javascript" src="/files/assets/js/common-pages.js"></script>
		</div>
	</body>
</html>