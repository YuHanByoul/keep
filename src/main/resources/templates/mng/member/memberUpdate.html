<form id="memberFrm" >
       <!-- insert 부분 -->
           <div class="card-header p-b-0">
               <h3 class="sub-title"><strong>기본정보</strong></h3>
           </div>
           <div class="card-block-small p-t-0">
               <div class="row">
                   <div class="col-lg-6">
                   
                       <div class="mb-2 form-group row  ">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" ><strong>아이디</strong></label>
                           <div class="col-sm-12">
                               <input type="text" class="form-control form-control-sm"  th:value="${member.acnt}" readonly >
                               <!-- <span class="messages"></span> -->
                           </div>
                       </div>
                       
                       <div class="mb-2 form-group row required ">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="nm"><strong>이름</strong></label>
                           <div class="col-sm-12">
                               <input type="text" class="form-control form-control-sm" name="nm" id="nm" placeholder="이름" th:value="${member.nm}" />
                               <span class="messages"></span>
                           </div>
                       </div>
                       
                       <div class="mb-2 form-group row required ">
                           <span class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>성별</strong></span>
                           <div class="col-sm-12">
                               <select id="gndr" name="gndr" class="form-select form-select-sm form-control-sm">
                                   <option value="">- 선택 -</option>
                                   <option value="M" th:selected="${member.gndr =='M'}">남</option>
                                   <option value="F" th:selected="${member.gndr =='F'}">여</option>
                               </select>
                           </div>
                       </div>
                       
                       <div class="mb-2 form-group row">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" ><strong>전화번호</strong></label>
                           <div class="col-sm-12">
                               <input type="number" class="form-control form-control-sm" name="telno" id="telno" placeholder="전화번호" th:value="${member.telno}">
                               <span class="messages"></span>
                           </div>
                       </div>
                       
                       <div class="mb-2 form-group row required" >
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="email"><strong>이메일</strong></label>
                           <div class="col-sm-12">
                               <input type="text" class="form-control form-control-sm" name="eml" id="eml" placeholder="이메일" th:value="${member.eml}" >
                               <span class="messages"></span>
                           </div>
                       </div>
                       
                       <div class="mb-2 form-group row">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="addr"><strong>주소</strong></label>
                           <div class="col-sm-12">
                               <input type="text" class="form-control form-control-sm" name="addr" id="addr" placeholder="주소" onclick="daumPostcode()" readonly th:value="${member.addr}">
                               <span class="messages"></span>
                           </div>
                       </div>
                       
                      <div class="mb-2 form-group row">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" ><strong>가입일</strong></label>
                           <div class="col-sm-12">
                               <input class="form-control form-control-sm" type="text" th:value="${#dates.format(member.regDt, 'yyyy-MM-dd HH:mm')}" readonly/>
                           </div>
                       </div>
                       
                   </div>
                   
                   <div class="col-lg-6">
                   
                       <div class="mb-2 form-group row required">
	                       <span class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>비밀번호</strong></span>
	                       <div class="col-sm-12 btn-group-sm">
	                           <button type="button" class="btn btn-inverse"  onclick="fn_openTempPswdModal()">임시 비밀번호 발급</button>
	                       </div>
                       </div>
                       
                      <div class="mb-2 form-group row">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" ><strong>회원유형</strong></label>
                           <div class="col-sm-12">
                               <th:block th:if="${member.rolecd =='A'}">
                                  <input type="text" class="form-control form-control-sm"  value="관리자" readonly/>
                               </th:block>
                               <th:block th:if="${member.rolecd =='C'}">
                                  <input type="text" class="form-control form-control-sm"  value="기업회원" readonly/>
                               </th:block>
                               <th:block th:if="${member.rolecd =='U'}">
                                  <input type="text" class="form-control form-control-sm"  value="개인회원" readonly/>
                               </th:block>
                               <span class="messages"></span>
                           </div>
                       </div>
                       
                       <div class="mb-2 form-group row required">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"
                                  for="birthDate"><strong>생년월일</strong></label>
                           <div class="col-sm-12">
                               <input class="form-control form-control-sm" type="date" name="brdt" id="brdt" th:value="${member.brdt}"/>
                           </div>
                       </div>
                       
                      <div class="mb-2 form-group row required">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"
                                  for="mobileNum"><strong>휴대전화</strong></label>
                           <div class="col-sm-12">
                               <input type="text" class="form-control form-control-sm" name="moblphon" id="moblphon" placeholder="휴대폰번호" th:value="${member.moblphon}">
                               <span class="messages"></span>
                           </div>
                       </div>
                       
                       <div class="mb-2 form-group row">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"
                                  for="zipcode"><strong>우편번호</strong></label>
                           <div class="col-sm-12">
                               <input type="text" class="form-control form-control-sm" name="zip" id="zip" placeholder="우편번호 클릭하여 검색"  onclick="daumPostcode()" readonly th:value="${member.zip}"/>
                               <span class="messages"></span>
                           </div>
                       </div>
                       
                       <div class="mb-2 form-group row">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="addrDtl"><strong>상세주소</strong></label>
                           <div class="col-sm-12">
                               <input type="text" class="form-control form-control-sm" name="addrDtl" id="addrDtl" placeholder="상세주소" th:value="${member.addrDtl}">
                               <span class="messages"></span>
                           </div>
                       </div>
                       
                       <div class="mb-2 form-group row">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"  for="recentDate"><strong>최종 접속 이력</strong></label>
                           <div class="col-sm-12">
                               <input class="form-control form-control-sm" type="text" readonly th:value="${#dates.format(member.lgnDt, 'yyyy-MM-dd HH:mm')}" />
                           </div>
                       </div>
                       
                   </div>
                   
                   <div class="col-lg-12">
                       <div class="mb-2 form-group row">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"  for="recentDate"><strong>계정잠금 여부</strong></label>
                           <div class="col-sm-12 row">
                               <div class="col-sm-2">
                                   <span kattr:radio_yn="acntLockYn" label1="Y" label2="N"   th:attr="defaultVal=${member.acntLockYn}" addStyle="margin-top:4px" addClass="col-sm-3" onchange="changeAcntLockYn"></span>
                               </div>
                               <div class="col-sm-2">
                                   <span kattr:select_code="acntLockCd" grpCd="101" firstOptTxt="- 선택 -"  th:attr="selectedCd=${member.acntLockCd}" addClass="form-select form-select-sm form-control-sm" addStyle="margin-left:5px;width:150px;"></span>
                               </div>
                               
                               <div class="col-sm-3 btn-group-sm">
                               <div class="col-sm-12 btn-group-sm">
                                 <th:block sec:authorize-url="/mng/member/clearAcntLock.do">
                                 <button type="button" class="btn btn-inverse" id="btn_clear" onclick="fn_clearAcntLock()">잠금 해제</button>
                                 </th:block>
                               </div>
                               </div>
                               
                           </div>
                       </div>
                   </div>
                   
               </div>
           </div>
           
           <div class="card-header p-t-0 p-b-0">
               <h4 class="sub-title"><strong>관심분야</strong></h4>
           </div>
           
           <div class="card-block-small p-t-0">
               <div class="border-checkbox-section">
               
                   <div class="border-checkbox-group border-checkbox-group-inverse">
                       <span kattr:check_code="itrstfldCds" grpCd="104"  th:attr="selectedCd=${member.itrstfldCd}" isAdmin="true" addClass="itrstfldCds">
                   </div>
 
               </div>
           </div>
           <div class="card-header p-t-0 p-b-0">
               <h4 class="sub-title"><strong>맞춤환경정보</strong></h4>
           </div>
           <div class="card-block-small p-t-0">
               <div class="row">
               
                   <div class="col-sm-6 col-lg-3">
                       <div class="form-label col-sm-12 col-form-label p-t-0"><strong>교육 프로그램</strong></div>
                           <div class="border-checkbox-section">
                           <span kattr:check_code_v="envfldCds" grpCd="105"  upprCd="105101"  isAdmin="true"  addClass="envfldCds" th:attr="selectedCd=${member.envfldCd}"/>
                       </div>
                   </div>
                   
                   <div class="col-sm-6 col-lg-3">
                       <div class="form-label col-sm-12 col-form-label p-t-0">
                           <strong>지원사업</strong></div>
                       <div class="border-checkbox-section">
                           <span kattr:check_code_v="envfldCds1" grpCd="105"  upprCd="105102"  isAdmin="true" addClass="envfldCds" th:attr="selectedCd=${member.envfldCd}"/>
                       </div>
                       
                   </div>
                   
                   <div class="col-sm-6 col-lg-3">
                       <div class="form-label col-sm-12 col-form-label p-t-0">
                           <strong>제도지원</strong></div>
                       <div class="border-checkbox-section">
                          <span kattr:check_code_v="envfldCds2" grpCd="105"  upprCd="105103"  isAdmin="true" addClass="envfldCds" th:attr="selectedCd=${member.envfldCd}"/>
                       </div>
                   </div>
                   
                   <div class="col-sm-6 col-lg-3">
                       <div class="form-label col-sm-12 col-form-label p-t-0">
                           <strong>기타</strong></div>
                       <div class="border-checkbox-section">
                          <span kattr:check_code_v="envfldCds3" grpCd="105"  upprCd="105104"  isAdmin="true" addClass="envfldCds" th:attr="selectedCd=${member.envfldCd}"/>
                       </div>
                   </div>
                   
               </div>
           </div>
           
       <!--차 후 필요시 사용  -->    
       <!--<div class="card-header p-t-0 p-b-0">
               <h4 class="sub-title"><strong>간편 로그인 연동</strong></h4>
           </div>
           <div class="card-block-small p-t-0">
               <div class="border-checkbox-section">
                  <span kattr:check_code_v="esylgnCds" grpCd="106"  isAdmin="true" addClass="esylgnCds" th:attr="selectedCd=${member.esylgnCd},readOnly=${member.esylgnCd}"/>
               </div>
           </div> -->
           
           <div class="card-block-small">
           
               <th:block sec:authorize-url="/mng/member/quitMember.do">
                   <button type="button" class="btn btn-inverse m-r-5" onclick="fn_quitMember()">탈퇴</button>
               </th:block>
               
               <button type="button" class="btn btn-disabled m-r-5" onclick="gridHelper1.toggleContent()" >취소</button>
               
               <th:block sec:authorize-url="/mng/member/modifyMember.do">
               <button type="button" class="btn btn-primary" onclick ="fn_updateMember()" >저장</button>
               </th:block>
               
           </div>
       
      <input type="hidden" id="userid" name="userid"   th:value="${member.userid}">
      <input type="hidden" id="delYn" name="delYn"   th:value="${member.delYn}">
      <input type="hidden" id="sttsCd" name="sttsCd" th:value="${member.sttsCd}">
      
</form>
    
<!-- 임시비밀번호발급 Start -->
<div class="modal fade" id="popCon1" tabindex="-1" role="dialog" aria-labelledby="popCon1Title" aria-hidden="true"></div>
<!-- 임시비밀번호발급 End -->

<!--임시 비밀번호 발급 팝업-->
<div class="modal fade" id="tempPswdPopup" aria-hidden="true" data-bs-backdrop="static" ></div>
		                      
<script th:inline="javascript">
	
	init();
    
    var validator= $("#memberFrm").validate({
        rules: {
             eml        :   { required: true ,isBlank : true, maxlength: 50 }
            ,moblphon   :   { required: true ,number :true ,maxlength: 12}
            ,acntLockCd :   { required: true  }
            ,telno      :   { number :true ,maxlength: 12}
            ,gndr       :   { required: true  }
            ,brdt       :   { required: true  }
            ,nm         :   { required: true ,isBlank : true, maxlength: 20 }
            ,pswd       :   { required: true ,isBlank : true , passwordPolicy2 :true , minlength: 8, maxlength: 20 ,isHangulOff :true }
            ,pswdChk    :   { required: true ,isBlank : true , passwordPolicy2 :true , minlength: 8, maxlength: 20 ,isHangulOff :true }
        },
        messages: {
             eml        :   { required: "이메일 항목을 입력해주십시오."  }
            ,gndr       :   { required: "성별을 입력하세요"  }  
            ,moblphon   :   { required: "휴대폰 번호를 입력하세요" ,number : "숫자만 입력가능합니다.", maxlength:"휴대폰 번호는 12자리 이하여야 합니다."}  
            ,acntLockCd :   { required: "계정 잠김 코드를 선택해주세요"  }
            ,telno      :   { number  : "숫자만 입력가능합니다.", maxlength:"전화 번호는 12자리 이하여야 합니다."}
            ,brdt       :   { required: "생년월일을 입력하세요"  }  
            ,nm         :   { required: "이름을 입력해주십시오." , isBlank : "입력값에 공백이 있습니다.", maxlength: "이름은 20자 이하여야 합니다."   }
            ,pswd       :   { required: "비밀번호를 입력해주십시오." , isBlank : "입력값에 공백이 있습니다.", passwordPolicy2 : "영문,숫자,특수기호가  하나 이상 포함되어야 합니다." ,minlength:"비밀번호는 8자 이상이어야 합니다.", maxlength: "비밀번호는 20자 이하여야 합니다." ,isHangulOff :"한글은 사용하실 수 없습니다."   }
            ,pswdChk    :   { required: "비밀번호 확인란을 입력해주십시오." , isBlank : "입력값에 공백이 있습니다.", passwordPolicy2 : "영문,숫자,특수기호가  하나 이상 포함되어야 합니다." ,minlength:"비밀번호는 8자 이상이어야 합니다.", maxlength: "비밀번호는 20자 이하여야 합니다." ,isHangulOff :"한글은 사용하실 수 없습니다."    }
        }
    })
	 		 
 	function fn_updateMember(){

  	 	
 	    if(!($("#memberFrm").valid())) return;

        let today = new Date();   
        let year = today.getFullYear(); // 년도
        let month = today.getMonth() + 1;  // 월
        let date = today.getDate();  // 날짜
        let thisday =  year+""+month+""+date;
        let brdt = ($("#brdt").val()).replaceAll("-","");
        
 	    if(Number(brdt)  > Number(thisday)) {
           alert("생년월일은 금일보다 이전이어야 합니다."); 
           showErrorMark("#brdt");
           return;
        }
  	 	  
  	 	if($('input:radio[name=acntLockYn]:checked').val() == "Y"){

  	         if($('#acntLockCd').val() == "101101"){ // 가입대기
  	 			$('#delYn').val('N');
  	 			$('#sttsCd').val('2'); // 대기
  	 		}else if($('#acntLockCd').val() == "101106"){ // 탈퇴
  	 			$('#delYn').val('Y');
  	 			$('#sttsCd').val('9'); // 탈퇴
  	 		}else{
  	 			$('#delYn').val('N');
  		 		$('#sttsCd').val('1'); // 가입	
  	 		}
  	 	}else{
  	 		$('#delYn').val('N');
	 		$('#sttsCd').val('1'); // 가입
  	 	}
  	 	
  	 	if(!confirm("수정하시겠습니까?")) return;
  	 	
        //관심분야 조합
        let itrstfldCds = $('.itrstfldCds:checked').map(function(){ return $(this).val();}).get().join(",");
        let esylgnCds   = $('.esylgnCds:checked').map(function(){ return $(this).val();}).get().join(",");
        let envfldCds   = $('.envfldCds:checked').map(function(){ return $(this).val();}).get().join(",");
        
        let data =  $("#memberFrm").serialize() ;
        //&esylgnCds="+esylgnCds+" 간편 로그인 보류
        data = data+"&itrstfldCds="+itrstfldCds+"&envfldCds="+envfldCds
  	 	    
	    if(displayWorkProgress()){
			$.ajax({
				url : "/mng/member/modifyMember.do",
				type: 'POST',
				cache : false,
				dataType: 'json',
				data : data,
				success : function (data){
					if(data.result=="success"){
						alert(data.msg);
						gridHelper1.resetListContent();
					}else{
						alert(data.msg);
					}
					closeWorkProgress();
				}
			});
		}
	}

 	function init() {
 		changeAcntLockYn();
 	}
 	
	function changeAcntLockYn() {
		if($('input:radio[name=acntLockYn]:checked').val() == "Y"){
			$('#acntLockCd').show();
			$('#btn_clear').show();
		}else{
			$('#acntLockCd').val('');
			$('#acntLockCd').hide();
			$('#btn_clear').hide();
		}
	} 
    	
	function daumPostcode(){
        new daum.Postcode({
            oncomplete: function(data) {
                let addr = '';
                if (data.userSelectedType === 'R') {
                    addr = data.roadAddress;
                } else {
                    addr = data.jibunAddress;
                }
                $('#areaCd').val(data.sigunguCode);
                $('#zip').val(data.zonecode);
                $('#addr').val(addr);
                $('#addrDtl').focus();
            }
        }).open();
	}

	fn_clearAcntLock = ()=>{

		if(!confirm("계정잠금을 해제하시겠습니까?"))return;
		
	    if(displayWorkProgress()){
	            $.ajax({
	                url : "/mng/member/clearAcntLock.do",
	                type: 'POST',
	                cache : false,
	                dataType: 'json',
	                data : {userid : $("#userid").val()},
	                success : function (data){
	                    if(data.result=="success"){
	                        alert(data.msg);
	                        $("input:radio[name='acntLockYn']:radio[value='N']").prop('checked', true); 
	                        $("#acntLockCd").val("");
	                    }else{
	                        alert(data.msg);
	                    }
	                    closeWorkProgress();
	                }
	            });
	        }
    }

    fn_quitMember = ()=>{

        if(!confirm("탈퇴 처리 하시겠습니까?"))return;
        
        if(displayWorkProgress()){
                $.ajax({
                    url : "/mng/member/quitMember.do",
                    type: 'POST',
                    cache : false,
                    dataType: 'json',
                    data : {
                        userid : $("#userid").val(),
                        delYn : "Y"
                    },
                    success : function (data){
                        if(data.result=="success"){
                            alert(data.msg);
                            gridHelper1.resetListContent();
                        }else{
                            alert(data.msg);
                        }
                        closeWorkProgress();
                    }
                });
            }
    }

    //임시비밀번호 모달 오픈   
    fn_openTempPswdModal = () => {
        
        let url = "/mng/member/tempPwdPop.html?userid="+$("#userid").val();
        
        $("#tempPswdPopup").load(url, function(response, status, xhr) {
            if (status == "success") {
                userAddModal = new bootstrap.Modal($('#tempPswdPopup'));
                userAddModal.show();
            }
        });
    }
    
	$('#popCon1').on('show.bs.modal', function() {
		$('#popCon1').load("/mng/member/tempPwdPop.html?userid=" + $("#userid").val()); 
	});
	$('#popCon1').on('hide.bs.modal', function() {
		$('#popCon1').html(""); 
	});

</script> 
<form id="frontLoginFrm" name="frontLoginFrm" th:action="${frontServerHost}" target="_blank">
	<input type="hidden" id="token" name="token" value="">
</form>