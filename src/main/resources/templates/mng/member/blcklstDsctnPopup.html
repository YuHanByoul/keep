<form id="blcklstFrm">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content type_2">
            <div class="modal-header">
                <h4 class="modal-title">블랙리스트 처리</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true"></span>
                </button>
            </div>
            <div class="modal-body">
                <div class="card m-b-10">
                    <div class="card-block-small">
                        <p class="mb-1"><strong><span class="blck-names"></span>블랙리스트 처리 사유</strong></p>
                        <br/>
                        <textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="블랙리스트 사유" id="blcklstRsn" name="blcklstRsn"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary waves-effect waves-light" onclick="applyBlcklst()" >저장</button>
            </div>
        </div>
    </div>
</form>

<script th:inline="javascript">

	var users = [[${users}]];
	var names = [];
	var ids = [];
	
	$(function(){
		users.forEach((item)=>{
			names.push(item.nm+"("+item.acnt+") &nbsp;&nbsp;");
			ids.push(item.userid);
		})
		$(".blck-names").html(names.join(","))
	});

	
    var validator= $("#blcklstFrm").validate({
        rules: {
        	blcklstRsn : { required: true , maxlength: 1000 }
        },
        messages: {
        	blcklstRsn : { required:"블랙리스트 사유를 입력해주십시오"   , maxlength:  "블랙리스트 사유는 1,000자 이하여야 합니다."}
        }
    })
	
	applyBlcklst =()=>{

        if(!($("#blcklstFrm").valid())) return;
        
        var params ={
        	    blcklstIds : ids.join(",")
                ,blcklstYn : 'Y'
                ,blcklstRsn : $("#blcklstRsn").val()
        }
        
	    if(displayWorkProgress()){
	        $.ajax({
	            url : "/mng/member/updatetBlcklstDsctn.do",
	            type: 'POST',
	            cache : false,
	            dataType: 'json',
	            data : params,
	            success : function (data){
	               alert(data.msg);
	               userAddModal.hide();
	               gridHelper1.resetListContent();
	               selectedItems = [];
	               closeWorkProgress();
	            }
	        });
	    }
	}
	
</script>