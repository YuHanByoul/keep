<form id="memberFrm" >
       <!-- insert 부분 -->
           <div class="card-header p-b-0">
               <h3 class="sub-title"><strong>기본정보</strong></h3>
           </div>
           <div class="card-block-small p-t-0">
               <div class="row">
                   <div class="col-lg-6">
                   
                       <div class="mb-2 form-group row required ">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" ><strong>아이디</strong></label>
                           <div class="col-sm-12">
                               <input type="text" class="form-control form-control-sm" name="acnt" id="acnt" onblur="fn_checkIdYn()" placeholder="아이디">
                               <!-- <span class="messages"></span> -->
                           </div>
                       </div>
                       
                       <div class="mb-2 form-group row required ">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="nm"><strong>이름</strong></label>
                           <div class="col-sm-12">
                               <input type="text" class="form-control form-control-sm" name="nm" id="nm" placeholder="이름" />
                               <span class="messages"></span>
                           </div>
                       </div>
                       
                       <div class="mb-2 form-group row required ">
                           <span class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>성별</strong></span>
                           <div class="col-sm-12">
                               <select id="gndr" name="gndr" class="form-select form-select-sm form-control-sm">
                                   <option value="">- 선택 -</option>
                                   <option value="M">남</option>
                                   <option value="F">여</option>
                               </select>
                           </div>
                       </div>
                       
                       <div class="mb-2 form-group row">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="phoneNum"><strong>전화번호</strong></label>
                           <div class="col-sm-12">
                               <input type="text" class="form-control form-control-sm" name="telno" id="telno" placeholder="전화번호" >
                               <span class="messages"></span>
                           </div>
                       </div>
                       
                       <div class="mb-2 form-group row required" >
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="email"><strong>이메일</strong></label>
                           <div class="col-sm-12">
                               <input type="text" class="form-control form-control-sm" name="eml" id="eml" placeholder="이메일">
                               <span class="messages"></span>
                           </div>
                       </div>
                       
                       <div class="mb-2 form-group row">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="addr"><strong>주소</strong></label>
                           <div class="col-sm-12">
                               <input type="text" class="form-control form-control-sm" name="addr" id="addr" placeholder="주소" onclick="daumPostcode()" readonly>
                               <span class="messages"></span>
                           </div>
                       </div>
                       
                      <div class="mb-2 form-group row">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" ><strong>가입일</strong></label>
                           <div class="col-sm-12">
                               <input class="form-control form-control-sm" type="text"  disabled/>
                           </div>
                       </div>
                       
                   </div>
                   
                   <div class="col-lg-6">
                   
                       <div class="mb-2 form-group row required">
                       
                           <div class="col-sm-6">
                           <label class="form-label col-sm-6 col-form-label p-t-0 pb-1" for="pswd"><strong>비밀번호</strong></label>
                               <input type="password" class="form-control form-control-sm" name="pswd" id="pswd" placeholder="비밀번호" autocomplete="off">
                               <span class="messages"></span>
                           </div>
                           
                           <div class="col-sm-6 required">
                           <label class="form-label col-sm-6 col-form-label p-t-0 pb-1" for="pswdChk"><strong>비밀번호 확인</strong></label>
                               <input type="password" class="form-control form-control-sm" name="pswdChk" id="pswdChk" placeholder="비밀번호 확인" autocomplete="off">
                               <span class="messages"></span>
                           </div>
                           
                       </div>
                       
                      <div class="mb-2 form-group row">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" ><strong>회원유형</strong></label>
                           <div class="col-sm-12">
                               <input type="text" class="form-control form-control-sm"  disabled/>
                               <span class="messages"></span>
                           </div>
                       </div>
                       
                       <div class="mb-2 form-group row required">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"
                                  for="birthDate"><strong>생년월일</strong></label>
                           <div class="col-sm-12">
                               <input class="form-control form-control-sm" type="date" name="brdt" id="brdt"/>
                           </div>
                       </div>
                       
                       <div class="mb-2 form-group row required">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"
                                  for="mobileNum"><strong>휴대전화</strong></label>
                           <div class="col-sm-12">
                               <input type="text" class="form-control form-control-sm" name="moblphon" id="moblphon" placeholder="휴대폰번호">
                               <span class="messages"></span>
                           </div>
                       </div>
                       
                       <div class="mb-2 form-group row">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"
                                  for="zipcode"><strong>우편번호</strong></label>
                           <div class="col-sm-12">
                               <input type="text" class="form-control form-control-sm" name="zip" id="zip" placeholder="우편번호 클릭하여 검색"  onclick="daumPostcode()" readonly/>
                               <span class="messages"></span>
                           </div>
                       </div>
                       <div class="mb-2 form-group row">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="addrDtl"><strong>상세주소</strong></label>
                           <div class="col-sm-12">
                               <input type="text" class="form-control form-control-sm" name="addrDtl" id="addrDtl" placeholder="상세주소">
                               <span class="messages"></span>
                           </div>
                       </div>
                       
                       <div class="mb-2 form-group row">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"  for="recentDate"><strong>최종 접속 이력</strong></label>
                           <div class="col-sm-12">
                               <input class="form-control form-control-sm" type="text" name="" id=""  disabled/>
                           </div>
                       </div>
                       
                   </div>
                   
                   <div class="col-lg-12">
                       <div class="mb-2 form-group row">
                           <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"  for="recentDate"><strong>계정잠김 여부</strong></label>
                           <div class="col-sm-12 row">
	                           <div class="col-sm-2">
	                               <span kattr:radio_yn="acntLockYn" label1="Y" label2="N"  defaultVal="N" addStyle="margin-top:4px" addClass="col-sm-3" onchange="changeAcntLockYn" isAdmin="true"></span>
	                           </div>
	                           <div class="col-sm-2">
	                               <span kattr:select_code="acntLockCd" grpCd="101" firstOptTxt="-선택 -"  addClass="form-select form-select-sm form-control-sm" addStyle="margin-left:5px;width:150px;" isAdmin="true"></span>
	                           </div>
	                           
	                           <!-- <div class="col-sm-2">
	                               <span class='label label-inverse'>잠김 해제</span>
	                           </div> -->
	                           
                           </div>
                       </div>
                   </div>
                   
               </div>
           </div>
           
           <div class="card-header p-t-0 p-b-0">
               <h4 class="sub-title"><strong>맞춤환경정보</strong></h4>
           </div>
           
           <div class="card-block-small p-t-0">
               <div class="border-checkbox-section">
               
               
                   <div class="border-checkbox-group border-checkbox-group-inverse">
                       <span kattr:check_code="envfldCds" grpCd="104" isAdmin="true" addClass="envfldCds">
                   </div>
 
               </div>
           </div>
           <div class="card-header p-t-0 p-b-0">
               <h4 class="sub-title"><strong>관심분야</strong></h4>
           </div>
           <div class="card-block-small p-t-0">
               <div class="row">
               
                    <th:block th:each="item,stat:${itrstfldList}">
                       <div class="col-sm-6 col-lg-3">
                           <div class="form-label col-sm-12 col-form-label p-t-0"><strong>[[${item.CD_NM}]]</strong></div>
                               <div class="border-checkbox-section">
                               <span th:kattr:check_code_v="'itrstfldCds'+${stat.index}" grpCd="105"   isAdmin="true"  addClass="itrstfldCds" th:attr="upprCd=${item.CD}"/>
                           </div>
                       </div>
                     </th:block>
                     
               </div>
           </div>
           
       <!-- 간편로그인 차후 필요시 사용 -->    
       <!--<div class="card-header p-t-0 p-b-0">
               <h4 class="sub-title"><strong>간편 로그인 연동</strong></h4>
           </div>
           <div class="card-block-small p-t-0">
               <div class="border-checkbox-section">
                  <span kattr:check_code_v="esylgnCds" grpCd="106"  isAdmin="true" addClass="esylgnCds" />
               </div>
           </div> -->
           
           <div class="card-block-small">
               <button type="button" class="btn btn-disabled m-r-5" onclick="gridHelper1.toggleContent()" >취소</button>
               
               <th:block sec:authorize-url="/mng/member/insertMember.do">
                   <button type="button" class="btn btn-primary" onclick ="fn_insertMember()" >저장</button>
               </th:block>
           </div>
       
      <input type="hidden" id="delYn" name="delYn" value="N">
      <input type="hidden" id="sttsCd" name="sttsCd" value="1">
</form>
    
<!-- 임시비밀번호발급 Start -->
<div class="modal fade" id="popCon1" tabindex="-1" role="dialog" aria-labelledby="popCon1Title" aria-hidden="true"></div>
<!-- 임시비밀번호발급 End -->

<script type="text/javascript">
	init();
    //아이디 중복 체크 여부 판별용 
    var checkId = "";
    var isDuplicatedId = false;
	var validator= $("#memberFrm").validate({
		    onsubmit: false,
		    rules: {
		         acnt       :   { required: true ,isBlank : true, maxlength: 20 }
		    	,eml        :   { required: true ,isBlank : true, maxlength: 50 }
	            ,acntLockCd :   { required: true  }
		    	,moblphon   :   { required: true ,number :true ,maxlength: 12}
		    	,telno      :   { number :true ,maxlength: 12}
		    	,gndr       :   { required: true  }
		    	,brdt       :   { required: true  }
		    	,nm         : 	{ required: true ,isBlank : true, maxlength: 20 }
		     	,pswd       : 	{ required: true ,isBlank : true , passwordPolicy2 :true , minlength: 8, maxlength: 20 ,isHangulOff :true }
		    	,pswdChk    : 	{ required: true ,isBlank : true , passwordPolicy2 :true , minlength: 8, maxlength: 20 ,isHangulOff :true }
		    },
		    messages: {
		         acnt       :   { required: "아이디를 입력해주십시오." , isBlank : "아이디에 공백이 있습니다.", maxlength: "아이디는 20자 이하여야 합니다." }  
	    	    ,eml        :   { required: "이메일 항목을 입력해주십시오."  }
	            ,acntLockCd :   { required: "계정 잠김 코드를 선택해주세요"  }
		    	,gndr       :   { required: "성별을 입력하세요"  }  
		    	,moblphon   :   { required: "휴대폰 번호를 입력하세요" ,number : "숫자만 입력가능합니다.", maxlength:"휴대폰 번호는 12자리 이하여야 합니다."}  
		    	,telno      :   { number  : "숫자만 입력가능합니다." , maxlength:"전화 번호는 12자리 이하여야 합니다."}
		    	,brdt       :   { required: "생년월일을 입력하세요"  }  
		    	,nm         :   { required: "이름을 입력해주십시오." , isBlank : "입력값에 공백이 있습니다.", maxlength: "이름은 20자 이하여야 합니다."   }
			    ,pswd       :   { required: "비밀번호를 입력해주십시오." , isBlank : "입력값에 공백이 있습니다.", passwordPolicy2 : "영문,숫자,특수기호가  하나 이상 포함되어야 합니다." ,minlength:"비밀번호는 8자 이상이어야 합니다.", maxlength: "비밀번호는 20자 이하여야 합니다." ,isHangulOff :"한글은 사용하실 수 없습니다."   }
		    	,pswdChk    :   { required: "비밀번호 확인란을 입력해주십시오." , isBlank : "입력값에 공백이 있습니다.", passwordPolicy2 : "영문,숫자,특수기호가  하나 이상 포함되어야 합니다." ,minlength:"비밀번호는 8자 이상이어야 합니다.", maxlength: "비밀번호는 20자 이하여야 합니다." ,isHangulOff :"한글은 사용하실 수 없습니다."    }
		    }
		})
    
	//아이디 중복 체크 
 	function fn_checkIdYn(){
	 	
 		if($('#acnt').val().length >20){
			alert("아이디는 20자 이하여야 합니다.");
			return;
 		}
 		
        if(displayWorkProgress()){
			$.ajax({
				url : "/mng/member/checkIdYn.do",
				type: 'POST',
				cache : false,
				dataType: 'json',
				data : { acnt: $("#acnt").val() },
				success : function (data){
					if(data.result=="fail"){
						alert("에러 발생 다시 시도 해주십시오.");
					}else{
						if(data.result!="N"){
							alert("이미 사용중인 아이디입니다.")
							checkId = "";
							isDuplicatedId=true;
						}else{
							checkId = $("#acnt").val();
							isDuplicatedId=false;
						}
					}
					closeWorkProgress();
				}
			});
		}
	}
	        
 	function fn_insertMember(){
 	 	
 		let today = new Date();   
 		let year = today.getFullYear(); // 년도
 		let month = today.getMonth() + 1;  // 월
 		let monthStr = (month < 10)? "0"+month : month;  // 월
 		let date = today.getDate();  // 날짜
 		let dateStr = (date < 10)? "0"+date : date;
 		let thisday =  year+""+monthStr+""+dateStr;
 		let brdt = ($("#brdt").val()).replaceAll("-","");
 		
	 	if(!($("#memberFrm").valid())) return;
	 	
	 	if(isDuplicatedId ||checkId !=  $("#acnt").val()){
 	    	alert("아이디 중복 여부를 확인 해주시기 바랍니다.");
 	    	showErrorMark("#acnt"); 
 	    	return;
	 	}
	 	
 	    if($("#pswd").val()!=$("#pswdChk").val()) {
 	    	alert("비밀번호와 비밀번호 확인 입력 값이 일치하지 않습니다.");
 	    	showErrorMark("#pswd"); 
 	    	showErrorMark("#pswdChk"); 
 	    	return;
 	    }

 	    if(Number(brdt) > Number(thisday)) {
 	    	alert("생년월일은 금일보다 이전이어야 합니다."); 
 	    	showErrorMark("#brdt"); 
 	    	return;
 	 	}
 	 	
  	 	if($('input:radio[name=acntLockYn]:checked').val() == "Y"){
            if($('#acntLockCd').val() ==null || $('#acntLockCd').val() == ""){
                alert("계정잠김 코드를 선택해주십시오.");
                return;
            }else if($('#acntLockCd').val() == "101101"){ // 가입대기
  	 			$('#delYn').val('N');
  	 			$('#sttsCd').val('2'); // 대기
  	 		}else if($('#acntLockCd').val() == "101106"){ // 탈퇴
  	 			$('#delYn').val('Y');
  	 			$('#sttsCd').val('9'); // 탈퇴
  	 		}else{
  	 			$('#delYn').val('N');
  		 		$('#sttsCd').val('1'); // 가입	
  	 		}
  	 	}else{
  	 		$('#delYn').val('N');
	 		$('#sttsCd').val('1'); // 가입
  	 	}
  	 	
  	 	if(!confirm("저장하시겠습니까?")) return;

  	 	//관심분야 조합
  	 	var itrstfldCds = $('.itrstfldCds:checked').map(function(){ return $(this).val();}).get().join(",");
  	 	var esylgnCds   = $('.esylgnCds:checked').map(function(){ return $(this).val();}).get().join(",");
	    var data =  $("#memberFrm").serialize() ;
	    //&esylgnCds="+esylgnCds+" -- 간편로그인 보류 
  	 	data = data+"&itrstfldCds="+itrstfldCds
	    
	    if(displayWorkProgress()){
			$.ajax({
				url : "/mng/member/insertMember.do",
				type: 'POST',
				cache : false,
				dataType: 'json',
				data : data,
				success : function (data){
					if(data.result=="success"){
						alert(data.msg);
						gridHelper1.resetListContent();
					}else{
						alert(data.msg);
					}
					closeWorkProgress();
				}
			});
		}
	}
		    
 	function init() {
 		changeAcntLockYn();
 		//setDefaultImage('imgPreview','profile');
 	}
 	
	function changeAcntLockYn() {
		
		if($('input:radio[name=acntLockYn]:checked').val() == "Y"){
			$('#acntLockCd').show();
		}else{
			$('#acntLockCd').val('');
			$('#acntLockCd').hide();
		}
	} 
	
	function changeAcnt() {
		checkId = "";
		$("#checkIdYnStr").text("");
	}
	
	function daumPostcode(){
        new daum.Postcode({
            oncomplete: function(data) {
                var addr = '';
                if (data.userSelectedType === 'R') {
                    addr = data.roadAddress;
                } else {
                    addr = data.jibunAddress;
                }
                //$('#areaCd').val(data.sigunguCode);
                $('#zip').val(data.zonecode);
                $('#addr').val(addr);
                $('#addrDtl').focus();
            }
        }).open();
	}
	
</script>