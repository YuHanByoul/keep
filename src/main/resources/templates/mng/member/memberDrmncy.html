<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security" 
	xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout" 
 	layout:decorator="layout/subLayout" 
>
<style>
.hide
{
   display:none;
}
</style>
	<body>
	<div layout:fragment="content">
		<form name="searchFrm" id="searchFrm" action="" onsubmit="return false;">
	        <div class="well well-sm col-sm-12">
	        <div class="row col-sm-12">
	            <div class="form-group col-sm-1 form-control-static" >
	                <label class="control-label ">키워드</label>
	            </div>
	            <div class="col-sm-5 form-group form-control-static">
	                <select name="searchType" id="searchType" class="form-control input-sm" style="padding:0px; width:80px; display: inline-block;">
	                    <option value="">전체</option>
	                    <option value="id">아이디</option>
	                    <option value="name">이름 </option>
	                </select>
	                <input type="text" name="searchKeyword" id="searchKeyword" class="form-control input-sm" style="padding:0; width:180px;display: inline-block;">
	            </div>
	            <div class="form-group col-sm-1 form-control-static">
	                <label class="control-label ">가입기간</label>
	            </div>
	            <div class="form-group col-sm-3 form-control-static">
	                <div class="date-picker-area">
	                    <th:block kattr:date_pic="searchStartDay" dateForm="yy-mm-dd" addStyle="width:110px;display: inline-block;" addClass=" input-sm"></th:block> 
	                    ~
	                    <th:block kattr:date_pic="searchEndDay" dateForm="yy-mm-dd" addStyle="width:110px;display: inline-block;" addClass=" input-sm"></th:block>
	                </div>
	            </div>
	        </div>
	        <div class="row col-sm-12" >
	            <div class="form-group col-sm-1 form-control-static">
	                <label class="control-label">상태</label>
	            </div>
	            <div class="form-group col-sm-5 form-control-static">               
	                <!-- <h6><th:block kattr:check_code="pop_sts" grpCd="109"  addClass=" input-sm form-control-static " addStyle="padding:0px; width:150px; text-align:center;" ></th:block></h6> -->
	                <div class="checkbox-group">
	                    <input type="checkbox" name="searchDelYn" value="N"><label>회원</label>
	                    <input type="checkbox" name="searchDelYn" value="Y"><label>탈퇴회원</label>
	                </div>
	            </div>
	            <div class="form-group col-sm-6 form-control-static text-right" >
	                <button type="submit" class="btn btn-sm btn-primary" onclick="fn_searchForm()">검색</button>
	            </div>
	        </div>
	    </div>
	    </form>		
		<!-- Button Group Start -->
		<div class="row text-right" style = "margin-bottom: 5px; margin-right: 5px;">
        <div class="justify-button-group" style="overflow:visible">
			<p class="left-align-text" style = "margin-left: 15px;">
				<th:block sec:authorize-url="/mng/member/emailPop.html"><button type="button" class="btn btn-sm btn-primary" data-toggle="modal" data-target="#popCon3">e-mail 발송</button></th:block>
			</p>
		</div>
		</div>
  		      <!--  리스트 인서트 패널 Row start -->
		 <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
			<!-- List Area -->
			<div class="panel panel-default">
		    	<div class="panel-heading" role="tab" id="headingOne">
		      		<h4 class="panel-title">
		        		<a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne" onclick="toggleList();">목록</a>
		      		</h4>
		    	</div>
		    	<div id="collapseList" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
		      		<div class="panel-body">		
		      
						<div class="row">
							<table id="jsGrid"></table>
							<div id="listPager" class="text-center"></div>
						</div>
				
					</div>
				</div>
			</div>
			<!-- Content Area -->
			<div id="contentPanel" class="panel panel-default" style="display:none"></div>
		</div>
		
		<!-- SMS 발송 Start -->
		<div class="modal fade" id="popCon2" tabindex="-1" role="dialog" aria-labelledby="popCon2Title" aria-hidden="true">
		</div>
		
		<!-- e-mail 발송 Start -->
		<div class="modal fade" id="popCon3" tabindex="-1" role="dialog" aria-labelledby="popCon3Title" aria-hidden="true">
		</div>
			     
<script th:inline="javascript">
	var selectedItems = [];
            
	$(function(){
		writeJsGridData();
		
		$('#popCon2').on('show.bs.modal', function() {
			if(validChecked()) {
				$('#popCon2').load("/mng/member/smsPop.html", { userids: selectedItems.join(','), drmncyYn: 'Y' });
			}else{
				return false;
			}
		});
		
		$('#popCon2').on('hide.bs.modal', function() {
			$('#popCon2').html(""); 
		});
		
		$('#popCon3').on('show.bs.modal', function() {
			if(validChecked()) {
				$('#popCon3').load("/mng/member/emailPop.html", { userids: selectedItems.join(','), drmncyYn: 'Y' });
			}else{
				return false;
			}
		});
		
		$('#popCon3').on('hide.bs.modal', function() {
			$('#popCon3').html(""); 
		});
	});
			
	function validChecked() {
		if(selectedItems.length == 0) {
			alert("대상을 선택해주세요.");
			return false;
		}
		return true;
	}
	
    function fn_searchForm(){
    	resetListContent();
    }
	        
	function writeJsGridData(){
    	$("#jsGrid").jsGrid({
   			height: "auto",
   		    width: "100%",
   		    autoload: true,
   		    sorting: true,
   		    paging: true,
   		    pagerContainer: "#listPager",
   		    pagerFormat: "{first} {prev} {pages} {next} {last}",
   		    pagePrevText: "이전",
   		    pageNextText: "다음",
   		    pageFirstText: " < 처음 ㅣ",
   		    pageLastText: " | 마지막 >",
   	        pageSize: 10,
   	        pageButtonCount: 10,
   	        pageLoading: true,
   	        pageIndex: 1,
   	        noDataContent: "데이터가 없습니다.",
   	        
   	        controller: {
   	            loadData: function (filter) {
   	            	var data = $.Deferred();
   	            	    	            	
   	            	var formData = $('#searchFrm').serializeArray();
   	            	var params = [
   	            			{name: "pageNumber", value: filter.pageIndex},
   	            			{name: "rowPerPage", value: filter.pageSize},
   	            	]
   	            	
   	            	if(filter.sortField != undefined){
   	            		params.push({name: "orderField", value: filter.sortField});
       					params.push({name: "orderDirection", value: filter.sortOrder});
   	            	}
   	            	formData = formData.concat(params);
   	            	
   	                $.ajax({
   	                  type: "GET",
   	                  contentType: "application/json; charset=utf-8",
   	                  url: "/mng/member/selectDrmncyMemberList.do",
   	                  dataType: "json",
   	                  data: formData
   	                }).done(function(response){
   	                	var da = {
                                   data : escapeGridData(response.list)
                                   ,itemsCount : response.totalCount
                               };
   	                  data.resolve(da);
   	                });
   	                return data.promise();
   	            },
   	        },
   	        fields: [
   	        	 {
  				 	 headerTemplate: function() {
  					  	 return $("<input>").attr("type", "checkbox").attr("id", "selectAllCheckbox")
  				 	 },
  				 	 itemTemplate: function(_, item) {
  					  	 return $("<input>").attr("type", "checkbox").attr("class", "singleCheckbox")
  					  	 .prop("checked", $.inArray(String(item.userid), selectedItems) > -1)
  					  	 .on("change", function () {
  					  	 $(this).is(":checked") ? selectItem($(this).parent().next().text()) : unselectItem($(this).parent().next().text());
  					  	 });
  				 	 },
  				 	 align: "center",
  				 	 width: "2%",
  				 	 sorting: false
  				 }   	        	
   	        	,{ name: 'userid', css: 'hide' }
                   ,{ title: '번호' ,name: 'rowNumber',    type: "number", width : "5%", align:"center",  sorting :false }
                   ,{ title: '아이디'    ,name: 'acnt',    type: "text", width: "5%"}
                   ,{ title: '이름'    ,name: 'nm', type: "text", width: "5%"}//, cellRenderer: cellRendererUserNm }
                   ,{ title: '이메일'   ,name: 'email',   type: "text", width: "10%" }
                   ,{ title: '휴대폰'   ,name: 'mobno',   type: "text", width: "10%", align:"center" }
                   ,{ title: '탈퇴' ,name: 'del_yn',  type: "text", width: "5%", align:"center" }
                   ,{ title: '가입일' ,name: 'reg_dt',  type: "text", width: "5%", align:"center" }
                   ,{ title: '최종접속일' ,name: 'login_dt',  type: "text", width: "5%", align:"center" }
                   ,{ title: '휴면계정전환일' ,name: 'drmncy_dt',  type: "text", width: "5%", align:"center" }
                   ,{ title: '계정삭제예정일' ,name: 'expected_del_dt',  type: "text", width: "5%", align:"center" }
   	        ],
   	     	/*[# sec:authorize-url="/mng/member/memberDetailForm.html"]*/
   	        /*rowClick: function(args) {
   	        	if(args.event.originalEvent.target.cellIndex == 0 || isNaN(args.event.originalEvent.target.cellIndex)) return;
   	        	var detailUrl = "/mng/member/memberForm.html?userid=" + args.item.userid; 
   	       	    location.href = detailUrl;
   	        },*/
   	     	/*[/]*/
   	        onPageChanged: function(args) {
   	            selectedItems = [];
   	        }
   	    });
   		
	    var selectItem = function(item) {
		    selectedItems.push(item);
		    if($(".singleCheckbox").length == $(".singleCheckbox:checked").length) {
                $("#selectAllCheckbox").prop("checked", true);
            } else {
                $("#selectAllCheckbox").prop("checked", false);
            }
		};
	     
	    var unselectItem = function(item) {
		    selectedItems = $.grep(selectedItems, function(i) {
		    return i !== item;
		    });
		    if(selectedItems.length == 0) {
		    	$('#selectAllCheckbox').attr('checked', false);
		    }
		    if($(".singleCheckbox").length == $(".singleCheckbox:checked").length) {
                $("#selectAllCheckbox").prop("checked", true);
            } else {
                $("#selectAllCheckbox").prop("checked", false);
            }
	    };
		
	    $("#selectAllCheckbox").click(function(item) {
	    	selectedItems = [];
	    	if(this.checked) { // check select status
	            $('.singleCheckbox').each(function() { 
	                this.checked = true;   
	                selectItem($(this).parent().next().text());           
	            });	
	        }else {
	            $('.singleCheckbox').each(function() { 
	                this.checked = false;      
	                unselectItem(item);
	            });  
	            selectedItems = [];
	        }
    	});
 	}
           
    function cellRendererUserNm(value, item){
   		return '<td><u><a href="/mng/member/memberForm.html?userid=' + item.userid + '">' + item.nm + '</a></u></td>';
   	}
        
</script>
<script src="/js/ckeditor/ckeditor.js"></script>
	</div> 
    </body>
</html>