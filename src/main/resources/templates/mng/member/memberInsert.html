<form id ="userInsertForm">
<input type="hidden" id="userSeCd" name="userSeCd" value="P">
<input type="hidden" id="email" name= "email">
<input type="hidden" name="pphotoFilegrpid" id="pphotoFilegrpid" value="0">
<input type="hidden" name="pphotoFileid" id="pphotoFileid" value="0">
<input type="hidden" id="areaCd" name="areaCd">
<input type="hidden" id="delYn" name="delYn" value="N">
<input type="hidden" id="sttsCd" name="sttsCd" value="1">
<input type="hidden" id="moonYn" name="moonYn" value="N">

	<!-- Hidden Contents Start -->
	<div class="panel panel-default" id="hiddenCon">
		<!-- Hidden Contents Title Start -->
		<div class="panel-heading trans"><strong>등록</strong></div>
		<!-- Hidden Contents Title End -->

		<!-- Tab Menu Start -->
		<ul id="myTab" class="nav nav-tabs">
		<li class="active"><a href="#tabCon1" data-toggle="tab">회원정보</a></li>
		</ul>
		<!-- Tab Menu End -->

		<!-- Tab Container Start -->
		<div id="myTabContent" class="tab-content">
			<!-- 회원정보 Start -->
			<div id="tabCon1" class="tab-pane fade active in trans1">
				<b class="tab-title">회원공통</b>
				<div class="list-row">
					<strong class="control-label">아이디 <em class="text-danger">*</em></strong>
					<div class="form-con custom-email custom-radio">
						<input type="text" class="form-control input-sm" id="acnt" name="acnt" onkeyup="changeAcnt()">
						<th:block sec:authorize-url="/mng/member/checkIdYn.do"><button type="button" class="btn btn-sm btn-primary" id="checkId" onclick="fn_checkIdYn()">중복확인</button></th:block>
						<p id="checkIdYnStr"class="text-danger"></p>
					</div>
				</div>
				<div class="list-row">
					<strong class="control-label">이름 <em class="text-danger">*</em></strong>
					<div class="form-con custom-button"><input type="text" class="form-control input-sm" id="nm" name="nm"></div>
				</div>
				<div class="list-row">
					<strong class="control-label">비밀번호 <em class="text-danger">*</em></strong>
					<div class="form-con custom-button">
						<input type="password" class="form-control input-sm" id="pswd" name="pswd" autocomplete="off">
						<p class="text-info">영문, 숫자, 특수문자 조합 8자리 이상</p>
					</div>
				</div>
				<div class="list-row">
					<strong class="control-label">비밀번호 확인 <em class="text-danger">*</em></strong>
					<div class="form-con custom-button"><input type="password" class="form-control input-sm" id="chkpswd" name="chkpswd" autocomplete="off"></div>
				</div>
				<div class="list-row">
					<strong class="control-label">휴대폰번호</strong>
					<div class="form-con custom-button custom-radio">
						<input type="text" class="form-control input-sm" id="mobno" name="mobno" placeholder="하이픈(-) 없이 입력해주세요.">
					</div>
				</div>
				<div class="list-row">
                    <strong class="control-label">이메일 <em class="text-danger">*</em></strong>
                    <div class="form-con custom-email custom-radio">
                        <input type="text" class="form-control input-sm" id="email1" name= "email1">
                        <span>@</span>
                        <input type="text" class="form-control input-sm" id="email2" name= "email2">
                        <select class="form-control input-sm"  name="email3" id="email3" onchange="fn_changeDomain();" > 
                            <option value="1">직접입력</option> 
                            <option value="naver.com" >naver.com</option> 
                            <option value="hanmail.net">hanmail.net</option> 
                            <option value="hotmail.com">hotmail.com</option> 
                            <option value="nate.com">nate.com</option> 
                            <option value="yahoo.co.kr">yahoo.co.kr</option> 
                            <option value="empas.com">empas.com</option> 
                            <option value="dreamwiz.com">dreamwiz.com</option> 
                            <option value="freechal.com">freechal.com</option> 
                            <option value="lycos.co.kr">lycos.co.kr</option> 
                            <option value="korea.com">korea.com</option> 
                            <option value="gmail.com">gmail.com</option> 
                            <option value="hanmir.com">hanmir.com</option> 
                            <option value="paran.com">paran.com</option> 
                         </select>
                    </div>
                </div>
				<div class="list-row">
					<strong class="control-label">이용약관 동의 여부 <em class="text-danger">*</em></strong>
					<span kattr:radio_yn="tosAgreYn" label1="Y" label2="N" defaultVal="N" addStyle="margin-right:5px" isAdmin="true"></span>					
				</div>
				<div class="list-row">
					<strong class="control-label">개인정보수집 동의 여부 <em class="text-danger">*</em></strong>
					<div class="form-con custom-button custom-radio">
						<span kattr:radio_yn="prvcyAgreYn" label1="Y" label2="N" defaultVal="N" addStyle="margin-top:4px" isAdmin="true"></span>
					</div>
				</div>
				<div class="list-row">
					<strong class="control-label">계정 잠김 여부 <em class="text-danger">*</em></strong>
					<div class="form-con custom-radio custom-select">					
						<span kattr:radio_yn="acntLockYn" label1="Y" label2="N"  defaultVal="N" addStyle="margin-top:4px" onchange="changeAcntLockYn" isAdmin="true"></span>
						<span kattr:select_code="acntLockCd" grpCd="101" firstOptTxt="선택 안함" addClass=" input-sm " addStyle="margin-left:5px;width:150px;"></span>
					</div>
				</div>

				<b class="tab-title">개인회원 상세</b>
				<div class="list-row">
					<strong class="control-label">생년월일</strong>
					<div class="form-con custom-select">
						<select id="brthdyYear" name="brthdyYear" class="form-control input-sm w-type1">
							<option value="">선택</option>
							<th:block th:each="year : ${years}">
							<option th:value="${year}"><th:block th:text="${year}" /></option>
							</th:block>
						</select>
						<span>년</span>
						<select id="brthdyMonth" name="brthdyMonth" class="form-control input-sm w-type2">
							<option value="">선택</option>
							<option value="01">1</option>
							<option value="02">2</option>
							<option value="03">3</option>
							<option value="04">4</option>
							<option value="05">5</option>
							<option value="06">6</option>
							<option value="07">7</option>
							<option value="08">8</option>
							<option value="09">9</option>
							<option value="10">10</option>
							<option value="11">11</option>
							<option value="12">12</option>
						</select>
						<span>월</span>
						<select id="brthdyDay" name="brthdyDay" class="form-control input-sm w-type2">
							<option value="">선택</option>
							<option value="01">1</option>
							<option value="02">2</option>
							<option value="03">3</option>
							<option value="04">4</option>
							<option value="05">5</option>
							<option value="06">6</option>
							<option value="07">7</option>
							<option value="08">8</option>
							<option value="09">9</option>
							<option value="10">10</option>
							<option value="11">11</option>
							<option value="12">12</option>
							<option value="13">13</option>
							<option value="14">14</option>
							<option value="15">15</option>
							<option value="16">16</option>
							<option value="17">17</option>
							<option value="18">18</option>
							<option value="19">19</option>
							<option value="20">20</option>
							<option value="21">21</option>
							<option value="22">22</option>
							<option value="23">23</option>
							<option value="24">24</option>
							<option value="25">25</option>
							<option value="26">26</option>
							<option value="27">27</option>
							<option value="28">28</option>
							<option value="29">29</option>
							<option value="30">30</option>
							<option value="31">31</option>
						</select>
						<span>일</span>
					</div>
				</div>
				<div class="list-row">
					<strong class="control-label">성별</strong>
					<div class="form-con custom-radio">
						<label><input type="radio" name="sex" value="M" checked><span>남자</span></label>
						<label><input type="radio" name="sex" value="F"><span>여자</span></label>
					</div>
				</div>
				<div class="list-row">
					<strong class="control-label">우편번호</strong>
					<div class="form-con custom-button"><input type="text" id="zip" name="zip" class="form-control input-sm" onclick="daumPostcode()" readonly></div>
				</div>
				<div class="list-row">
					<strong class="control-label">주소 1</strong>
					<div class="form-con"><input type="text" id="addr" name="addr" class="form-control input-sm" onclick="daumPostcode()" readonly></div>
				</div>
				<div class="list-row">
					<strong class="control-label">주소 2</strong>
					<div class="form-con"><input type="text" id="addrDtl" name="addrDtl" class="form-control input-sm"></div>
				</div>
				<div class="list-row">
					<strong class="control-label">마케팅 이메일 동의 여부</strong>
					<span kattr:radio_yn="marktEmailAgreYn" label1="Y" label2="N"  addStyle="margin-right:5px" isAdmin="true"></span>
				</div>
				<div class="list-row">
					<strong class="control-label">마케팅 SMS 동의 여부</strong>
					<span kattr:radio_yn="marktSmsAgreYn" label1="Y" label2="N" addStyle="margin-right:5px" isAdmin="true"></span>
				</div>

				<b class="tab-title">프로필 정보</b>
				<div class="profile-layout">
					<div class="list-row">
						<strong class="control-label">소개 <em class="text-danger">*</em></strong>
						<div class="form-con"><input type="text" id="intrcn" name="intrcn" class="form-control input-sm"></div>
					</div>
					<div class="profile-photo">
						<p class="img"><img id="imgPreview" src="/images/mng/default_profile.png"></p>
						<th:block sec:authorize-url="/uploadFile.do">
						<p class="btn-file">
							<span class="btn btn-sm btn-primary">사진등록/수정</span>
							<input type="file" name="pphotoFile" accept="image/jpeg,image/gif,image/png" id="pphotoFile">
						</p>
						</th:block>
					</div>
				</div>

				<div class="right-align-text">
					<th:block sec:authorize-url="/mng/member/insertMember.do"><button type="button" class="btn btn-sm btn-primary" id="insertMember" onclick="fn_insertMember()">저장</button></th:block>
					<button type="button" class="btn btn-sm btn-secondary" id="cancelInsertMember" onclick="gridHelper1.toggleContent()">취소</button>
				</div>
			</div>
			<!-- 회원정보 End -->
		</div>
		<!-- Tab Container End -->
	</div>
	<!-- Hidden Contents End -->
</form>

<script type="text/javascript">
	init();
    //아이디 중복 체크 여부 판별용 
    var checkId = "";
   	var validator= $("#userInsertForm").validate({
	    rules: {
	         acnt       :   { required: true ,isBlank : true, maxlength: 20 }  
	    	,email1     :     { required: true ,isBlank : true, maxlength: 50 }  
	    	,email2     : 	{ required: true }
	    	,nm         : 	{ required: true ,isBlank : true, maxlength: 20 }  
	     	,pswd        : 	{ required: true ,isBlank : true , passwordPolicy2 :true , minlength: 8, maxlength: 20 ,isHangulOff :true }  
	    	,chkpswd     : 	{ required: true ,isBlank : true , passwordPolicy2 :true , minlength: 8, maxlength: 20 ,isHangulOff :true }
	    	,mobno      :   { number: true, minlength: 11, maxlength: 11 }
	    	,addr       :   { maxlength: 200 }
	    	,addrDtl   :   { maxlength: 400 }
	    	,intrcn     : 	{ required: true , maxlength: 50 }
	    },
	    messages: {
	         acnt       :   { required: "아이디를 입력해주십시오." , isBlank : "아이디에 공백이 있습니다.", maxlength: "아이디는 20자 이하여야 합니다." }  
	    	,email1     :   { required: "이메일을 입력해주십시오." , isBlank : "입력값에 공백이 있습니다.", maxlength: "이메일은 50자 이하여야 합니다." }
    	    ,email2     :   { required: "이메일 도메인 항목을 입력해주십시오."  }
	    	,nm         :   { required: "이름을 입력해주십시오." , isBlank : "입력값에 공백이 있습니다.", maxlength: "이름은 20자 이하여야 합니다."   }
		    ,pswd        :   { required: "비밀번호를 입력해주십시오." , isBlank : "입력값에 공백이 있습니다.", passwordPolicy2 : "영문,숫자,특수기호가  하나 이상 포함되어야 합니다." ,minlength:"비밀번호는 8자 이상이어야 합니다.", maxlength: "비밀번호는 20자 이하여야 합니다." ,isHangulOff :"한글은 사용하실 수 없습니다."   }
	    	,chkpswd     :   { required: "비밀번호 확인란을 입력해주십시오." , isBlank : "입력값에 공백이 있습니다.", passwordPolicy2 : "영문,숫자,특수기호가  하나 이상 포함되어야 합니다." ,minlength:"비밀번호는 8자 이상이어야 합니다.", maxlength: "비밀번호는 20자 이하여야 합니다." ,isHangulOff :"한글은 사용하실 수 없습니다."    }
	    	,mobno      :   { number: "휴대폰번호는 숫자만 입력가능합니다.", minlength: "휴대폰번호는 11자리 이어야 합니다.", maxlength: "휴대폰번호는 11자리 이어야 합니다." }
	    	,addr       :   { maxlength: "주소1은 200자 이하여야 합니다." }
	    	,addrDtl   :   { maxlength: "주소2는 400자 이하여야 합니다." }
	    	,intrcn     :   { required: "소개를 입력해주십시오." , maxlength: "소개는 50글자 이하여야 합니다." }
	    }
	})
	 		 
	//이메일 도메인 셀렉트 박스 선택시 호출 
	function fn_changeDomain(){
   		var selected = $("#email3").val();
   		if(selected=="1") $("#email2").val(null);
   		else $("#email2").val(selected);
   	}
	 		 
	//아이디 중복 체크 
 	function fn_checkIdYn(){
 		if(!validator.element('#acnt')) return;

        if(displayWorkProgress()){
			$.ajax({
				url : "/mng/member/checkIdYn.do",
				type: 'POST',
				cache : false,
				dataType: 'json',
				data : { acnt: $("#acnt").val() },
				success : function (data){
					if(data.result=="fail"){
						alert("에러 발생 다시 시도 해주십시오.");
					}else{
						if(data.result=="N"){
							$("#checkIdYnStr").text("사용 가능한 아이디입니다.");
							checkId = $("#acnt").val();
						}else{
							$("#checkIdYnStr").text("이미 사용중인 아이디입니다.");
							checkId = "";
						}
					}
					closeWorkProgress();
				}
			});
		}
	}
	        
 	function fn_insertMember(){
	 	if(!($("#userInsertForm").valid())) return;
	 	    
	 	var email = $("#email1").val()+"@"+$("#email2").val();
	 	$("#email").val(email);
  	 	    
 	    if($("#pswd").val()!=$("#chkpswd").val()) {
 	    	alert("비밀번호와 비밀번호 확인 입력 값이 일치하지 않습니다."); 
 	    	return;
 	    }
  	 	 
  	 	if(!confirm("저장하시겠습니까?")) return;
  	 	
  	 	if($('input:radio[name=acntLockYn]:checked').val() == "Y"){
  	 		if($('#acntLockCd').val() == "101101"){ // 가입대기
  	 			$('#delYn').val('N');
  	 			$('#sttsCd').val('2'); // 대기
  	 		}else if($('#acntLockCd').val() == "101106"){ // 탈퇴
  	 			$('#delYn').val('Y');
  	 			$('#sttsCd').val('9'); // 탈퇴
  	 		}else{
  	 			$('#delYn').val('N');
  		 		$('#sttsCd').val('1'); // 가입	
  	 		}
  	 	}else{
  	 		$('#delYn').val('N');
	 		$('#sttsCd').val('1'); // 가입
  	 	}
  	 	    
	    var data =  $("#userInsertForm").serialize() ;
	    if(displayWorkProgress()){
			$.ajax({
				url : "/mng/member/insertMember.do",
				type: 'POST',
				cache : false,
				dataType: 'json',
				data : data,
				success : function (data){
					if(data.result=="success"){
						alert(data.msg);
						gridHelper1.resetListContent();
					}else{
						alert(data.msg);
					}
					closeWorkProgress();
				}
			});
		}
	}
		    
 	function init() {
 		changeAcntLockYn();
 		setDefaultImage('imgPreview','profile');
 	}
 	
	function changeAcntLockYn() {
		
		if($('input:radio[name=acntLockYn]:checked').val() == "Y"){
			$('#acntLockCd').show();
		}else{
			$('#acntLockCd').val('');
			$('#acntLockCd').hide();
		}
	} 
	
	function changeAcnt() {
		checkId = "";
		$("#checkIdYnStr").text("");
	}
	
	$('#pphotoFile').on('change', function(event) {
		var formData = new FormData();
		var objFile = event.target;
		
		formData.append("file", objFile.files[0]);
		formData.append("filegrpNm", "user_profile");
		
		if($('#pphotoFilegrpid').val() != '')
			formData.append("filegrpid", $('#pphotoFilegrpid').val());

		if(displayWorkProgress()){
			$.ajax({
				url : '/uploadFile.do',
				processData : false,
				contentType : false,
				data : formData,
				type : 'POST',
				success : function(response) {
					if(response.result == 'fail'){
						alert(response.msg);
					}else if(response.filegrpid != undefined && response.filegrpid != ''){
						$("#pphotoFilegrpid").val(response.filegrpid);
						$("#pphotoFileid").val(response.fileid);
						$("#imgPreview").attr('src', "/downloadFileByFileid.do?fileid=" + response.fileid + "&file_idntfc_key=" + response.fileIdntfcKey);
					}
					closeWorkProgress();
				}
			});
		}

		event.preventDefault();

	});
	
	function daumPostcode(){
        new daum.Postcode({
            oncomplete: function(data) {
                var addr = '';
                if (data.userSelectedType === 'R') {
                    addr = data.roadAddress;
                } else {
                    addr = data.jibunAddress;
                }
                $('#areaCd').val(data.sigunguCode);
                $('#zip').val(data.zonecode);
                $('#addr').val(addr);
                $('#addrDtl').focus();
            }
        }).open();
	}
	
</script>