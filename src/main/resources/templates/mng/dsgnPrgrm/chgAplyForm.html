<form id="chgAplyFrm">
<div class="tab-pane" id="updateRequest" role="tabpanel">
    <div class="card-header p-t-0 p-b-0">
        <h3 class="sub-title"><strong>기본 정보</strong></h3>
    </div>
    <div class="card-block-small p-t-0">
        <div class="mb-2 row">
            <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                <div class="mb-0 form-group">
                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="updateRequestProgramName"><strong>프로그램명</strong></label>
                    <div class="col-sm-12">
                        <input type="text" class="form-control form-control-sm" name="prgrmNm" id="prgrmNm" placeholder="Text Input Validation" th:value="${chgAplyPrgrmInfo.prgrmNm}" readonly="">
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-6">
                <div class="mb-0 form-group">
                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="updateRequestAgencyName"><strong>기관명</strong></label>
                    <div class="col-sm-12">
                        <input type="text" class="form-control form-control-sm" name="instNm" id="instNm" placeholder="Text Input Validation" th:value="${chgAplyPrgrmInfo.instNm}"  readonly="">
                    </div>
                </div>
            </div>
        </div>
        <div class="mb-0 row">
            <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                <div class="mb-0 form-group">
                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="updateRequestDegree"><strong>차수 / 지정번호</strong></label>
                    <div class="col-sm-12">
                        <input type="text" class="form-control form-control-sm" name="cyclNo" id="cyclNo" placeholder="Text Input Validation" th:value="${chgAplyPrgrmInfo.cyclNo}"  readonly="">
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-6">
                <div class="mb-0 form-group">
                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="updateRequestAssignAvailableDate"><strong>지정유효기간</strong></label>
                    <div class="col-sm-12">
                        <input type="text" class="form-control form-control-sm" name="dsgnPrd" id="dsgnPrd" placeholder="Text Input Validation" th:value="${chgAplyPrgrmInfo.dsgnPrd}"  readonly="">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="card-header p-t-0 p-b-0">
        <h3 class="sub-title"><strong>변경 신청</strong></h3>
    </div>
    <div class="card-block-small p-t-0">
        <div class="col-12 table-border-style">
            <div class="table-responsive">
                <table id="chgAplyGrid" class="table"></table>
<!--
                <table class="table">
                    <thead>
                    <tr>
                        <th class="text-center v-middle" style="width: 60px;">No.</th>
                        <th class="text-center v-middle" style="width: 120px;">상태
                        </th>
                        <th class="text-center v-middle">변경사유</th>
                        <th class="text-center v-middle" style="width: 120px;">등록일시</th>
                        <th class="text-center v-middle" style="width: 100px;">완료처리일</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td class="text-center v-middle">3</td>
                        <td class="text-center v-middle">신청</td>
                        <td class="v-middle"><a
                                href="javascript:void(0)" data-bs-toggle="modal" data-bs-target="#updateRequestDetailInfoPopup">프로그램 시행 횟수 증가</a></td>
                        <td class="text-center v-middle">2023-05-07 00:00</td>
                        <td class="text-center v-middle">-</td>
                    </tr>
                    <tr>
                        <td class="text-center v-middle">2</td>
                        <td class="text-center v-middle">보완완료</td>
                        <td class="v-middle"><a
                                href="javascript:void(0)" data-bs-toggle="modal" data-bs-target="#updateRequestDetailInfoPopup">프로그램 시행 횟수 증가</a></td>
                        <td class="text-center v-middle">2023-03-31 00:00</td>
                        <td class="text-center v-middle">-</td>
                    </tr>
                    <tr>
                        <td class="text-center v-middle">1</td>
                        <td class="text-center v-middle">변경승인</td>
                        <td class="v-middle"><a href="javascript:void(0)" data-bs-toggle="modal" data-bs-target="#updateRequestDetailInfoPopup">지도자의 자격 및 배치 내용 ㅇㅇㅇㅇㅇㅇ를 추가해 주세요</a></td>
                        <td class="text-center v-middle">2023-03-30 00:00</td>
                        <td class="text-center v-middle">2023-03-31</td>
                    </tr>
                    </tbody>
                </table>
 -->
            </div>
        </div>
    </div>
</div>
</form>

<!--변경신청 상세보기 팝업-->
<div class="modal fade" id="chgAplyDtlPopup" aria-hidden="true" data-bs-backdrop="static"></div>

<script th:inline="javascript">

var chgAplyGridHelper;

$(function(){

	chgAplyGridHelper = new GridHelper('chgAplyGrid','contentPanel');
    writeChgAplyGridData();

});

function writeChgAplyGridData(){


//jsgrid-header-row ->jsgrid-row
	//jsgrid-grid-header jsgrid-header-scrollbar

    $("#chgAplyGrid").jsGrid({
        height: "220px",
        width: "100%",
        autoload: true,
        sorting:false,
        paging: false,
        pageLoading: true,
        pageIndex: 1,
        noDataContent: "데이터가 없습니다.",

        controller: {
            loadData: function (filter) {
                var data = $.Deferred();

                var formData = $('#searchFrm').serializeArray();
                var params = [
                        {name: "pageNumber", value: filter.pageIndex},
                        {name: "rowPerPage", value: filter.pageSize},
                        {name: "prgrmid", value: prgrmid},

                ]

                if(filter.sortField != undefined){
                    params.push({name: "orderField", value: filter.sortField});
                    params.push({name: "orderDirection", value: filter.sortOrder});
                }else{
                    params.push({name: "orderField", value: 'reg_dt'});
                }

                formData = formData.concat(params);

                $.ajax({
                  type: "GET",
                  contentType: "application/json; charset=utf-8",
                  url: "/mng/dsgnPrgrm/selectChgAplyList.do",
                  dataType: "json",
                  data: formData
                }).done(function(response){

console.log("@@@@@1");
//
console.log("@@@@@2");
                    var da = {
                            data : escapeGridData(response.chgAplyList)
                            ,itemsCount : response.totalCount
                        };
                  data.resolve(da);
                });
                return data.promise();
            },
        },
        fields: [
             { name: 'aplyid', css:'hide'}
            ,{ title: 'No.'        ,name: 'rowNumber',   type: "number", width : "80", align:"center",  sorting :false }
            ,{ title: '상태'       ,name: 'aplySttsCdNm',  type: "text", width: "40", align:"center"}
            ,{ title: '변경사유'   ,name: 'chgRsn',      type: "text", width: "250", align:"center"}
            ,{ title: '등록일시'   ,name: 'regDt',       type: "text", width: "50", align:"center" }
            ,{ title: '완료처리일' ,name: 'sttsMdfcnDt', type: "text", width: "50", align:"center" }

        ],

        rowClick: function(args) {

            if(args.event.originalEvent.target.cellIndex == 0 || isNaN(args.event.originalEvent.target.cellIndex)) return;


            if(args.event.originalEvent.target.cellIndex == 3){

            	openChgAplyDtlModal(args.item.aplyid);
            }

        },
        onPageChanged: function(args) {
            selectedItems = [];
        }
    });

}

//변경신청상세보기 모달
var chgAplyDtlModal;
var openChgAplyDtlModal = (rowAplyid) => {


    var url = "/mng/dsgnPrgrm/chgAplyDtlPopup.html?aplyid="+rowAplyid;

    $("#chgAplyDtlPopup").load(url, function(response, status, xhr) {
        if (status == "success") {
            chgAplyDtlModal = new bootstrap.Modal($('#chgAplyDtlPopup'));
            chgAplyDtlModal.show();
        }
    });
}


</script>
</div>
</body>
</html>