<form id="dsgnInfoFrm">
<input type="hidden" id="dsgnBgngDe"   name="dsgnBgngDe"   th:value="${dsgnAplyInfo.dsgnBgngDe}">
<input type="hidden" id="dsgnEndDe"    name="dsgnEndDe"    th:value="${dsgnAplyInfo.dsgnEndDe}">
<input type="hidden" id="dsgnCycl"     name="dsgnCycl"     th:value="${dsgnAplyInfo.dsgnCycl}">
<input type="hidden" id="dsgnNo"       name="dsgnNo"       th:value="${dsgnAplyInfo.dsgnNo}">
<input type="hidden" id="dsgnObtainDe" name="dsgnObtainDe" th:value="${dsgnAplyInfo.dsgnObtainDe}">
<input type="hidden" id="dsgnCnclDe"   name="dsgnCnclDe"   th:value="${dsgnAplyInfo.dsgnCnclDe}">
<input type="hidden" id="hstryid"      name="hstryid"      th:value="${dsgnAplyInfo.hstryid}">
<input type="hidden" id="prgrmid"      name="prgrmid"      th:value="${dsgnAplyInfo.prgrmid}">

    <div class="tab-pane active" id="assignInfo" role="tabpanel">
        <div class="card-header p-t-0 p-b-0">
            <h3 class="sub-title"><strong>신청 정보</strong></h3>
        </div>
        <div class="card-block-small p-t-0">
            <div class="mb-2 row">
                <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="assignInfoProgramName"><strong>프로그램명</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" name="prgrmNm" id="prgrmNm" placeholder="Text Input Validation" th:value="${dsgnAplyInfo.prgrmNm}" readonly/>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-6">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="assignInfoAgencyName"><strong>기관명</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" name="applyInfoAgencyName" id="applyInfoAgencyName" placeholder="Text Input Validation" th:value="${dsgnAplyInfo.instNm}"  readonly/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-2 row">
                <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                    <div class="mb-0 form-group">
                        <div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
                            <strong>기관유형</strong></div>
                        <div class="col-12">
                            <span kattr:select_code="instTypeCd" th:attr="grpCd=108,selectedCd=${dsgnAplyInfo.instTypeCd}" firstOptTxt="- 전체 -" addClass="form-select form-select-sm form-control-sm" isAdmin="true" />
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-6">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="assignInfoRepresentativeName"><strong>대표자명</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" name="applyInfoRepresentativeName" id="applyInfoRepresentativeName" placeholder="Text Input Validation" th:value="${dsgnAplyInfo.prgrmNm}"  readonly/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-2 row">
                <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="assignInfoApplicant"><strong>신청자</strong></label>
                        <div class="col-12 row">
                            <div class="col-8">
                                <input type="text" class="form-control form-control-sm" name="applyInfoApplicant" id="applyInfoApplicant" placeholder="Text Input Validation" th:value="${dsgnAplyInfo.aplcntNm}" readonly/>
                            </div>
                            <div class="col-4 btn-group-sm">
                                <button type="button" class="btn btn-inverse" data-bs-toggle="modal" onclick="">담당자 변경</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-6">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="assignInfoManagerPhoneNum"><strong>담당자연락처</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" name="applyInfoManagerPhoneNum" id="applyInfoManagerPhoneNum" placeholder="Text Input Validation" th:value="${dsgnAplyInfo.aplcntMoblphon}" readonly/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-2 row">
                <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="assignInfoManagerEmail"><strong>담당자 이메일</strong></label>
                        <div class="col-12">
                            <input type="text" class="form-control form-control-sm" name="applyInfoManagerEmail" id="applyInfoManagerEmail" placeholder="Text Input Validation" th:value="${dsgnAplyInfo.aplcntEml}" readonly/>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-6">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="applyInfoBusinessNum"><strong>사업자등록번호</strong></label>
                        <div class="col-12">
                            <input type="text" class="form-control form-control-sm" name="brno" id="brno" placeholder="Text Input Validation" th:value="${dsgnAplyInfo.brno}" readonly/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-2 row">
                <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="assignInfoAgencyEmail"><strong>기관 이메일</strong></label>
                        <div class="col-12">
                            <input type="text" class="form-control form-control-sm" name="applyInfoAgencyEmail" id="applyInfoAgencyEmail" placeholder="Text Input Validation" th:value="${dsgnAplyInfo.instEml}" readonly/>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-6">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="assignInfoAgencyPhoneNum"><strong>기관 연락처</strong></label>
                        <div class="col-12">
                            <input type="text" class="form-control form-control-sm" name="applyInfoAgencyPhoneNum" id="applyInfoAgencyPhoneNum" placeholder="Text Input Validation" th:value="${dsgnAplyInfo.instCntct}" readonly/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-2 row">
                <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                    <div class="mb-0 form-group">
                        <div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
                            <strong>지역</strong></div>
                        <div class="col-12">
                            <span kattr:select_code="rgnCd" th:attr="grpCd=125,selectedCd=${dsgnAplyInfo.instRgnCd}" firstOptTxt="- 전체 -" addClass="form-select form-select-sm form-control-sm" isAdmin="true" >
<!--                             <th:block kattr:select_rgn="searchRgn" width="50%" th:selectedCd="${dsgnAplyInfo.instRgnCd}" firstOptTxt="- 선택 -" firstOptVal="" addClass="form-select form-select-sm form-control-sm" ></th:block> -->
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-6">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="assignInfoAgencyHomePage"><strong>기관 홈페이지</strong></label>
                        <div class="col-12">
                            <input type="text" class="form-control form-control-sm" name="applyInfoAgencyHomePage" id="applyInfoAgencyHomePage" placeholder="Text Input Validation" th:value="${dsgnAplyInfo.instHmpg}" readonly/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-2 row">
                <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="assignInfoAgencyAddress"><strong>기관주소</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" name="agencyAddress" id="agencyAddress" placeholder="Text Input Validation" th:value="${dsgnAplyInfo.instAddr}" readonly/>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-6">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="assignInfoAgencyDetailAddress"><strong>상세주소</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" name="agencyDetailAddress" id="agencyDetailAddress" placeholder="Text Input Validation" th:value="${dsgnAplyInfo.instDtladdr}" readonly/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-2 row">
                <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                    <div class="mb-0 form-group">
                        <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>증빙서류</strong></div>
                        <div class="col-sm-12">

                            <input type="file" id="evdncDcmntFile" name="evdncDcmntFile" class="form-control form-control-sm"/>

                            <div class="row">
                                <th:block th:if="${fileList != null}">


                                <div class="row">
                                <th:block th:if="${fileList != null}">
                                    <div th:each="item : ${fileList}" th:id="${item.fileid}" class="col-auto">
                                        <th:block th:if="${item.orginlFileNm != null}">
                                            <span th:fileid='${item.fileid}' th:fileIdntfcKey="${item.fileIdntfcKey}" th:onclick="downloadFileByFileid(this.getAttribute('fileid'),this.getAttribute('fileIdntfcKey'))" href="javascript:void(0)" class='label label-inverse'>
                                                <th:block th:text="${item.orginlFileNm}" /> <a th:name="${item.fileid}" th:attr="data-idntfc-key=${item.fileIdntfcKey}" th:onclick="fn_deleteFileList(this.name, this.dataset.idntfcKey)" class='text-white'><th:block th:text="X"</th:block></a>
                                            </span>
                                        </th:block>
                                    </div>
                                 </th:block>
                                 </div>
                           </div>

                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-6">
                    <div class="mb-0 form-group">
                        <div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
                            <strong>지정상태</strong></div>
                        <div class="col-12">
                            <span kattr:select_code="sttsCd" th:attr="grpCd=132,selectedCd=${dsgnAplyInfo.sttsCd}" firstOptTxt="- 전체 -" addClass="form-select form-select-sm form-control-sm" isAdmin="true">
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-0 row">
                <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="assignInfoDegree"><strong>차수 / 지정번호</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" name="assignInfoDegree" id="assignInfoDegree" placeholder="Text Input Validation" th:value="${dsgnAplyInfo.cyclNo}" readonly/>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-6">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="assignInfoAssignAvailableDate"><strong>지정유효기간</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" name="assignInfoAssignAvailableDate" id="assignInfoAssignAvailableDate" placeholder="Text Input Validation" th:value="${dsgnAplyInfo.dsgnPrd}" readonly/>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- [230125] 하단버튼과 타이틀 분리 수정 -->
        <div class="card-block-small">
            <div class="mb-2 row">
                <div class="col-12 btn-group-sm">
                    <div class="col-12 btn-group-sm">
                    <button type="button" class="col-auto btn btn-inverse m-r-5" onclick="gridHelper1.toggleContent()">목록</button>
                    <button type="button" id="reDsgnBtn" onclick="openDsgnInfoChgModal(this.id)" class="col-auto btn btn-disabled m-r-5">재지정</button>
                    <button type="button" id="dsgnRtrcnBtn" onclick="openDsgnRtrcnModal()" class="col-auto btn btn-disabled m-r-5" >지정취소</button>
                    <button type="button" class="col-auto btn btn-primary m-r-5">인쇄</button>
                    <button type="button" class="col-auto btn btn-primary m-r-5"  onclick="openDsgnPrgrmOutlModal()">지정프로그램 개요보기</button>
                    <button type="button" class="col-auto btn btn-primary">지정프로그램 상세보기</button>
                </div>
                </div>
            </div>
        </div>
        <div class="card-header p-b-0">
            <div class="sub-title row m-l-0 m-r-0 m-b-0 align-items-center">
                <div class="col-12 col-lg-6 mb-2 mb-lg-0 p-l-0">
                    <strong>지정 내역</strong>
                </div>
                <div class="col-12 col-lg-6 text-right p-r-0 btn-group-sm">
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#assignUpdatePopup">지정정보 변경
                    </button>
                </div>
            </div>
        </div>
        <!-- // [230125] 하단버튼과 타이틀 분리 수정 -->

<!--         <div class="card-header p-t-0 p-b-0"> -->
<!--             <div class="mb-2 row"> -->
<!--                 <div class="col-12 btn-group-sm"> -->
<!--                     <button type="button" class="col-auto btn btn-inverse m-r-5" onclick="gridHelper1.toggleContent()">목록</button> -->
<!--                     <button type="button" id="reDsgnBtn" onclick="openDsgnInfoChgModal(this.id)" class="col-auto btn btn-disabled m-r-5">재지정</button> -->
<!--                     <button type="button" id="dsgnRtrcnBtn" onclick="openDsgnRtrcnModal()" class="col-auto btn btn-disabled m-r-5" >지정취소</button> -->

<!--                     <button type="button" class="col-auto btn btn-primary m-r-5">인쇄</button> -->
<!--                     <button type="button" class="col-auto btn btn-primary m-r-5"  onclick="openDsgnPrgrmOutlModal()">지정프로그램 개요보기</button> -->
<!--                     <button type="button" class="col-auto btn btn-primary">지정프로그램 상세보기</button> -->
<!--                 </div> -->
<!--             </div> -->
<!--             <div class="sub-title row m-l-0 m-r-0 m-b-0 align-items-center"> -->
<!--                 <div class="col-12 col-lg-6 mb-2 mb-lg-0 p-l-0"> -->
<!--                     <strong>지정 내역</strong> -->
<!--                 </div> -->
<!--                 <div class="col-12 col-lg-6 text-right p-r-0 btn-group-sm"> -->
<!--                     <button type="button" class="btn btn-primary" onclick="openDsgnInfoChgModal()">지정정보 변경</button> -->
<!--                 </div> -->
<!--             </div> -->
<!--         </div> -->
        <div class="card-block-small p-t-0">
            <div class="col-12 table-border-style">
                <div class="table-responsive">
                    <table id="dsgnDsctnGrid" class="table"></table>
                </div>
            </div>
        </div>
    </div>
</form>

<!-- 지정취소 팝업 -->
<div class="modal fade" id="dsgnRtrcnPopup" aria-hidden="true" data-bs-backdrop="static"></div>
<!-- 지정프로그램 개요보기 팝업 -->
<div class="modal fade" id="dsgnPrgrmOutlPopup" aria-hidden="true" data-bs-backdrop="static"></div>
<!-- 지정프로그램 상세보기 팝업 -->

<!-- 지정정보 변경 팝업 -->
<div class="modal fade" id="dsgnInfoChgPopup" aria-hidden="true" data-bs-backdrop="static"></div>

<script th:inline="javascript">

var dsgnDsctnGridHelper = new GridHelper('dsgnDsctnGrid','contentPanel');
//보완요청 그리드
function writeSplmntDmndGridData(){

    $("#dsgnDsctnGrid").jsGrid({
//         height: "auto",
        height: "220px",
        width: "100%",
        autoload: true,
        sorting: true,
        paging: false,
        pagerContainer: "#splmntDmndListPager",
        pagerFormat: "{first} {prev} {pages} {next} {last}",
        pagePrevText: "이전",
        pageNextText: "다음",
        pageFirstText: " < 처음 ㅣ",
        pageLastText: " | 마지막 >",
//         pageSize: 5,
        pageButtonCount: 10,
        pageLoading: true,
        pageIndex: 1,
        noDataContent: "데이터가 없습니다.",

        controller: {
            loadData: function (filter) {
                var data = $.Deferred();

                var formData = $('#searchFrm').serializeArray();
                var params = [
                        {name: "pageNumber", value: filter.pageIndex},
                        {name: "rowPerPage", value: filter.pageSize},
                        {name: "prgrmid", value: prgrmid},

                ]

                if(filter.sortField != undefined){
                    params.push({name: "orderField", value: filter.sortField});
                    params.push({name: "orderDirection", value: filter.sortOrder});
                }else{
                    params.push({name: "orderField", value: 'reg_dt'});
                }

                formData = formData.concat(params);

                $.ajax({
                  type: "GET",
                  contentType: "application/json; charset=utf-8",
                  url: "/mng/dsgnPrgrm/selectDsgnDsctnList.do",
                  dataType: "json",
                  data: formData
                }).done(function(response){

console.log("@@@@@1");
//
console.log("@@@@@2");
                    var da = {
                            data : escapeGridData(response.dsgnDsctnList)
                            ,itemsCount : response.totalCount
                        };
                  data.resolve(da);
                });
                return data.promise();
            },
        },
        fields: [
             { name: 'prgrmid', css:'hide'}
            ,{ title: 'No.'         ,name: 'rowNumber',    type: "number", width : "80", align:"center",  sorting :false }
            ,{ title: '지정상태'    ,name: 'sttsCdNm',     type: "text", width: "100", align:"center"}
            ,{ title: '차수'        ,name: 'dsgnCycl',     type: "text", width: "100", align:"center"}
            ,{ title: '지정번호'    ,name: 'dsgnNo',       type: "text", width: "100", align:"center" }
            ,{ title: '지정획득일'  ,name: 'dsgnObtainDe', type: "text", align:"center" }
            ,{ title: '지정취소일'  ,name: 'dsgnCnclDe',   type: "text", align:"center" }
            ,{ title: '지정유효기간',name: 'dsgnPrd',      type: "text", align:"center" }
            ,{ title: '등록일'      ,name: 'regDt',        type: "text", align:"center" }
            ,{ title: '등록자'      ,name: 'rgtrNm',       type: "text", align:"center" }
        ],

        rowClick: function(args) {

            if(args.event.originalEvent.target.cellIndex == 0 || isNaN(args.event.originalEvent.target.cellIndex)) return;

        },
        onPageChanged: function(args) {
            selectedItems = [];
        }
    });
}

//지정취소
var dsgnRtrcnModal;
var openDsgnRtrcnModal = () => {


    var vHstryid= $("#hstryid").val();
    var vPrgrmid= $("#prgrmid").val();

    var url = "/mng/dsgnPrgrm/dsgnRtrcnPopup.html?prgrmid="+vPrgrmid+"&hstryid="+vHstryid;

    $("#dsgnRtrcnPopup").load(url, function(response, status, xhr) {
        if (status == "success") {
            dsgnRtrcnModal = new bootstrap.Modal($('#dsgnRtrcnPopup'));
            dsgnRtrcnModal.show();
        }
    });
}

//지정프로그램개요보기
var dsgnPrgrmOutlModal;
var openDsgnPrgrmOutlModal = () => {

    var url = "/mng/dsgnPrgrm/dsgnPrgrmOutlPopup.html?mode="+prgrmid;

    $("#dsgnPrgrmOutlPopup").load(url, function(response, status, xhr) {
        if (status == "success") {
            dsgnPrgrmOutlModal = new bootstrap.Modal($('#dsgnPrgrmOutlPopup'));
            dsgnPrgrmOutlModal.show();
        }
    });
}

//지정 정보 변경/재지정
var dsgnInfoChgModal;
var openDsgnInfoChgModal = (id) => {

    var vHstryid= $("#hstryid").val();
    var vPrgrmid= $("#prgrmid").val();

    var url = "/mng/dsgnPrgrm/dsgnInfoChgPopup.html?prgrmid="+vPrgrmid+"&hstryid="+vHstryid;


    if("reDsgnBtn"==id ){
        url+="&callSe=reDsgn";
    }else{
        url+="&callSe=dsgnInfoChgB";
    }

    $("#dsgnInfoChgPopup").load(url, function(response, status, xhr) {
        if (status == "success") {
            dsgnInfoChgModal = new bootstrap.Modal($('#dsgnInfoChgPopup'));
            dsgnInfoChgModal.show();
        }
    });
}

function initDsgnInfoFrm(){

    //지정상태가 지정 탈락인 경우 탈락일 표시
    if($("#sttsCd").val() == "132102"){
        $("#reDsgnBtn").show()
        $("#dsgnRtrcnBtn").hide();

        var vCnclDe = $("#dsgnCnclDe").val();
        $("#sttsCd option:selected").text("지정탈락"+" (탈락일 : "+vCnclDe+")" );

    }else{
        $("#reDsgnBtn").hide();
        $("#dsgnRtrcnBtn").show();
    }

    $("#rgnCd").attr("disabled",true);
    $("#instTypeCd").attr("disabled",true);
    $("#sttsCd").attr("disabled",true);

    //지정내역 목록 조회
    writeSplmntDmndGridData();
}

initDsgnInfoFrm();
</script>
