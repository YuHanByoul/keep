<style>
    .hide {
        display: none;
    }

    #objcJsGrid .jsgrid-grid-body {
        max-height: 200px;
    }
</style>

<form id="objcInfoFrm">
    <input type="hidden" id="aplcntid" name="aplcntid" th:value="${dsgnAplyInfo.aplcntid}">
    <input type="hidden" id="prgrmid" name="prgrmid" th:value="${dsgnAplyInfo.prgrmid}">

    <div class="tab-pane" id="protestRequest" role="tabpanel">
        <div class="card-header p-t-0 p-b-0">
            <h3 class="sub-title"><strong>기본 정보</strong></h3>
        </div>
        <div class="card-block-small p-t-0">
            <div class="mb-2 row">
                <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="protestRequestProgramName"><strong>프로그램명</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" name="protestRequestProgramName" id="protestRequestProgramName" th:value="${dsgnAplyInfo.prgrmNm}" readonly>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-6">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="protestRequestAgencyName"><strong>기관명</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" name="protestRequestAgencyName" id="protestRequestAgencyName" th:value="${dsgnAplyInfo.instNm}" readonly>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-0 row">
                <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="protestRequestDegree"><strong>차수 / 지정번호</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" name="protestRequestDegree" id="protestRequestDegree" th:value="${dsgnAplyInfo.cyclNo}" readonly>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-6">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="protestRequestAssignAvailableDate"><strong>지정유효기간</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" name="protestRequestAssignAvailableDate" id="protestRequestAssignAvailableDate" th:value="${dsgnAplyInfo.dsgnPrd}"
                                   readonly>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-header p-b-0">
            <div class="sub-title row m-l-0 m-r-0 m-b-0 align-items-center">
                <div class="col-12 col-lg-6 mb-2 mb-lg-0 p-l-0">
                    <strong>이의 신청</strong>
                </div>
                <div class="col-12 col-lg-6 text-right p-r-0 btn-group-sm">
                    <button type="button" class="btn btn-primary" onclick="objc.showModal('reg')">이의신청등록</button>
                </div>
            </div>
        </div>

        <div class="card-block-small p-t-0">
            <div class="col-12 table-border-style">
                <table id="objcJsGrid" class="table-responsive"/>
                <div id="objcListPager" class="text-center"/>
            </div>
        </div>
    </div>
</form>

<div class="modal fade" aria-hidden="true" data-bs-backdrop="static" id="objcModal"/>

<script th:inline="javascript">
    var objc = {
        selectListUrl: "/mng/dsgnPrgrm/selectObjcList.do",
        modalUrl: '/mng/dsgnPrgrm/objcInfoPopup.html',
        modal: null,
        gridHelper: null,

        init: function () {

            this.writeObjcListData();
            this.gridHelper = new GridHelper('objcJsGrid');
        },

        writeObjcListData: function () {
            $('#objcJsGrid').jsGrid({
                height: "220px",
                width: "100%",
                autoload: true,
                sorting:false,
                pageLoading: true,
                pageIndex: 1,
                noDataContent: "데이터가 없습니다.",
                controller: {
                    loadData: function (filter) {
                        var data = $.Deferred();

                        params = [];

                        if (filter.sortField != undefined) {
                            params.push({name: "orderField", value: mapCamelCaseToUnderscore(filter.sortField)});
                            params.push({name: "orderDirection", value: filter.sortOrder});
                        } else {
                            params.push({name: "orderField", value: 'reg_dt'});
                        }

                        $.ajax({
                            type: "GET",
                            url: objc.selectListUrl + "?prgrmid=" + prgrmid,
                            dataType: "json",
                            data: params
                        }).done(function (response) {
                            var da = {
                                data: escapeGridData(response.list)
                                , itemsCount: response.totalCount
                            };
                            data.resolve(da);
                        });
                        return data.promise();
                    },
                },
                fields: [
                    {name: 'aplyid', css: 'hide'},
                    {title: 'No.', name: 'rowNumber', type: "number", width: "80", align: "center", sorting: false},
                    {title: '상태', name: 'aplySttsCdNm', type: 'text', width: '100', align: 'center', sorting:false},
                    {title: '이의사유', name: 'ttl', type: 'text', width: '300'},
                    {title: '등록일시', name: 'regDt', type: 'text', width: '150', align: 'center'},
                    {title: '완료처리일', name: 'ansDt', type: 'text', width: '120', align: 'center'}
                ],
                /*[# sec:authorize-url="/mng/dsgnPrgrm/objcInfoPopup.html"]*/
                rowClick: function (args) {
                    objc.showModal('mod',args.item.aplyid);
                }
                /*[/]*/
            });
        },

        showModal: function (mod,keyid) {
        	var aplyid = keyid ?? 0;
            var url = objc.modalUrl + "?mod="+mod+"&aplyid=" + aplyid;
            $("#objcModal").load(url, function (response, status, xhr) {
                if (status == "success") {
                    objc.modal = new bootstrap.Modal($('#objcModal'));
                    objc.modal.show();
                }
            });
        }
    }

    $(function () {
        objc.init();
    });
</script>
</div>
</body>
</html>