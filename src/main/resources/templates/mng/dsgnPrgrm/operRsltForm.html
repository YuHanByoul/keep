<form id="operRsltFrm">
    <input type="hidden" id="prgrmid" name="prgrmid" th:value="${prgrmBscInfo.prgrmid}">
    <input type="hidden" id="instRgnCd" name="instRgnCd" th:value="${prgrmBscInfo.instRgnCd}">


	<div class="card-header p-t-0 p-b-0">
	    <h3 class="sub-title"><strong>기본 정보</strong></h3>
	</div>
	<div class="card-block-small p-t-0">
	    <div class="mb-2 row">
	        <div class="col-12 col-lg-6 mb-2 mb-lg-0">
	            <div class="mb-0 form-group">
	                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="operationResultProgramName"><strong>프로그램명</strong></label>
	                <div class="col-sm-12">
	                    <input type="text" class="form-control form-control-sm" name="operationResultProgramName" id="operationResultProgramName" th:value="${prgrmBscInfo.prgrmNm}" readonly="">
	                </div>
	            </div>
	        </div>
	        <div class="col-12 col-lg-6">
	            <div class="mb-0 form-group">
	                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="operationResultAgencyName"><strong>기관명</strong></label>
	                <div class="col-sm-12">
	                    <input type="text" class="form-control form-control-sm" name="operationResultAgencyName" id="operationResultAgencyName" th:value="${prgrmBscInfo.instNm}" readonly="">
	                </div>
	            </div>
	        </div>
	    </div>
	    <div class="mb-2 row">
	        <div class="col-12 col-lg-6 mb-2 mb-lg-0">
	            <div class="mb-0 form-group">
	                <div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
	                    <strong>지역</strong></div>
	                <div class="col-12">
                        <!-- <th:block kattr:select_rgn="rgnCd" selectedCd="${prgrmBscInfo.instRgnCd}" width="50%" firstOptTxt="- 선택 -" firstOptVal="" readonly> -->
                        <input type="text" class="form-control form-control-sm" name="instRgnCdNm" id="instRgnCdNm" th:value="${prgrmBscInfo.instRgnCdNm}" readonly="">
	                </div>
	            </div>
	        </div>
	        <div class="col-12 col-lg-6">
	            <div class="mb-0 form-group">
	                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="operationResultAssignStatus"><strong>지정상태</strong></label>
	                <div class="col-12">
                        <!-- <span kattr:select_code="sttsCd" th:attr="grpCd=132,selectedCd=${prgrmBscInfo.sttsCd}" firstOptTxt="- 전체 -" addClass="form-select form-select-sm form-control-sm" isAdmin="true"> -->
                        <input type="text" class="form-control form-control-sm" name="sttsCdNm" id="sttsCdNm" th:value="${prgrmBscInfo.sttsCdNm}" readonly="">
	                </div>
	            </div>
	        </div>
	    </div>
	    <div class="mb-0 row">
	        <div class="col-12 col-lg-6 mb-2 mb-lg-0">
	            <div class="mb-0 form-group">
	                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="operationResultDegree"><strong>차수 / 지정번호</strong></label>
	                <div class="col-sm-12">
	                    <input type="text" class="form-control form-control-sm" name="cyclNo" id="cyclNo" th:value="${prgrmBscInfo.cyclNo}" readonly="">
	                </div>
	            </div>
	        </div>
	        <div class="col-12 col-lg-6">
	            <div class="mb-0 form-group">
	                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="operationResultAssignAvailableDate"><strong>지정유효기간</strong></label>
	                <div class="col-sm-12">
	                    <input type="text" class="form-control form-control-sm" name="dsgnPrd" id="dsgnPrd" placeholder="" th:value="${prgrmBscInfo.dsgnPrd}" readonly="">
	                </div>
	            </div>
	        </div>
	    </div>
	</div>
	<div class="card-header p-t-0 p-b-0">
	    <h3 class="sub-title"><strong>운영결과서</strong></h3>
	</div>
	<div class="card-block-small p-t-0">
	    <div class="col-12 table-border-style">
	        <div class="table-responsive">

                <!-- 운영결과 목록 -->
                <table id="operRsltGrid" class="table"></table>
                <div id="listPager2" class="text-center"></div>
<!--
	            <table class="table">
	                <thead>
	                <tr>
	                    <th class="text-center v-middle" style="width: 60px;">회차</th>
	                    <th class="text-center v-middle">제출기간</th>
	                    <th class="text-center v-middle" style="width: 100px;">제출확인</th>
	                    <th class="text-center v-middle" style="width: 120px;">최종제출일시</th>
	                    <th class="text-center v-middle" style="width: 80px;">제출상태</th>
	                </tr>
	                </thead>
	                <tbody>
	                <tr>
	                    <td class="text-center v-middle">3</td>
	                    <td class="text-center v-middle"><a href="javascript:void(0)" data-bs-toggle="modal" data-bs-target="#operationResultSubmissionPeriodUpdatePopup">2023-01-01 ~ 2023-01-31</a></td>
	                    <td class="text-center v-middle">-</td>
	                    <td class="text-center v-middle">-</td>
	                    <td class="text-center v-middle">제외</td>
	                </tr>
	                <tr>
	                    <td class="text-center v-middle">2</td>
	                    <td class="text-center v-middle"><a href="javascript:void(0)" data-bs-toggle="modal" data-bs-target="#operationResultSubmissionPeriodUpdatePopup">2023-01-01 ~ 2023-01-31</a></td>
	                    <td class="text-center v-middle"><a href="javascript:void(0)">내용확인</a></td>
	                    <td class="text-center v-middle">2023-03-31</td>
	                    <td class="text-center v-middle">제출</td>
	                </tr>
	                <tr>
	                    <td class="text-center v-middle">1</td>
	                    <td class="text-center v-middle"><a href="javascript:void(0)" data-bs-toggle="modal" data-bs-target="#operationResultSubmissionPeriodUpdatePopup">2023-01-01 ~ 2023-01-31</a></td>
	                    <td class="text-center v-middle">대기중</td>
	                    <td class="text-center v-middle">-</td>
	                    <td class="text-center v-middle">-</td>
	                </tr>
	                </tbody>
	            </table>
 -->
	        </div>
	    </div>
	</div>
</form>
<div id="operRsltContentPanel" style="display:none"></div>

<!-- 기간변경 팝업 -->
<div class="modal fade" id="sbmsnPrdChgPopup" aria-hidden="true" data-bs-backdrop="static"></div>

<script th:inline="javascript">

initOperRsltFrm();

var operRsltGridHelper;

function initOperRsltFrm() {



    //$("#rgnCd").val($("#instRgnCd").val());
    //operRsltGrid = new GridHelper('operRsltGrid','contentPanel');

    operRsltGridHelper = new GridHelper('operRsltGrid','operRsltContentPanel');
     writeOperRsltGridData();

     $("#operRsltDtlFrm").hide();
}

//목록
function writeOperRsltGridData(){
    $("#operRsltGrid").jsGrid({
        height: "auto",
        width: "100%",
        autoload: true,
        sorting:false,
        paging: false,
        pagerContainer: "#listPager2",
        pagerFormat: "{first} {prev} {pages} {next} {last}",
        pagePrevText: "이전",
        pageNextText: "다음",
        pageFirstText: " < 처음 ㅣ",
        pageLastText: " | 마지막 >",
        pageSize: 10,
        pageButtonCount: 10,
        pageLoading: true,
        pageIndex: 1,
        sortOrder:"asc",
        noDataContent: "데이터가 없습니다.",

        controller: {
            loadData: function (filter) {

                var data = $.Deferred();

                var formData = $('#operRsltFrm').serializeArray();
                var params = [
                        {name: "pageNumber", value: filter.pageIndex},
                        {name: "rowPerPage", value: filter.pageSize},
                        {name: "orderField", value: 'cycl'},
                        {name: "orderDirection", value: 'asc'}
                ]

                formData = formData.concat(params);

                $.ajax({
                  type: "GET",
                  contentType: "application/json; charset=utf-8",
                  url: "/mng/dsgnPrgrm/selectOperRsltList.do",
                  dataType: "json",
                  data: formData
                }).done(function(response){


                    var da = {
                            data : escapeGridData(response.operRsltList)
                            ,itemsCount : response.totalCount
                        };
                  data.resolve(da);
                });
                return data.promise();
            },
        },
        fields: [
             { name: 'cyclid', css:'hide'}
            ,{ title: '회차'         ,name: 'cycl',          type: "number", width: "20",  align:"center"}
            ,{ title: '제출기간'     ,name: 'sbmsnPrd',      type: "text",   width: "200", align:"center"}
            ,{ title: '제출확인'     ,name: 'sbmsnIdnty',    type: "text",   width: "20", align:"center"}
            ,{ title: '최종제출일시' ,name: 'lastSbmsnDt',   type: "text",   width: "40", align:"center" }
            ,{ title: '제출상태'     ,name: 'sbmsnSttsCdNm', type: "text",   width: "20", align:"center" }
            ,{ name: 'cyclid', css:'hide'}
        ],

        rowClick: function(args) {

            if(args.event.originalEvent.target.cellIndex == 0 || isNaN(args.event.originalEvent.target.cellIndex)) return;

            if(args.event.originalEvent.target.cellIndex == 2) {
            	openSbmsnPrdChgModal(args.item.cyclid);
            }

            if(args.event.originalEvent.target.cellIndex == 3 && args.item.sbmsnIdnty == "내용확인") {


                var detailUrl = "/mng/dsgnPrgrm/selectOperRsltDetail.html?cyclid=" + args.item.cyclid;

                operRsltGridHelper.loadContent(detailUrl);
                operRsltGridHelper.rowClick(args);
            }

        },
        onPageChanged: function(args) {
            selectedItems = [];
        }
    });
}

var sbmsnPrdChgModal;
var openSbmsnPrdChgModal= (cyclid) => {

    var url = "/mng/dsgnPrgrm/sbmsnPrdChgPopup.html?cyclid="+cyclid;

    $("#sbmsnPrdChgPopup").load(url, function(response, status, xhr) {
        if (status == "success") {
            sbmsnPrdChgModal = new bootstrap.Modal($('#sbmsnPrdChgPopup'));

            sbmsnPrdChgModal.show();

        }
    });
}

</script>
</div>
</body>
</html>