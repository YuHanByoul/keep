<form id="implmntIdntySrngFrm">
<input type="hidden" id="prgrmid" name="prgrmid" th:value="${prgrmBscInfo.prgrmid}">
<input type="hidden" id="cyclid" name="cyclid" th:value="${prgrmBscInfo.cyclid}"> <!-- 차수ID -->

    <div class="tab-pane" id="implmntIdntySrng" role="tabpanel">
        <div class="card-header p-t-0 p-b-0">
            <h3 class="sub-title"><strong>기본 정보</strong></h3>
        </div>
        <div class="card-block-small p-t-0">
            <div class="mb-2 row">
                <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="implmntIdntySrngProgramName"><strong>프로그램명</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" name="prgrmNm" id="prgrmNm" placeholder="" th:value="${prgrmBscInfo.prgrmNm}" readonly="">
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-6">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="implmntIdntySrngAgencyName"><strong>기관명</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" name="instNm" id="instNm" placeholder="Text Input Validation" th:value="${prgrmBscInfo.instNm}" readonly="">
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-2 row">
                <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                    <div class="mb-0 form-group">
                        <div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
                            <strong>지역</strong></div>
                        <div class="col-12">
<!--                             <th:block kattr:select_rgn="rgnCd" selectedCd="${prgrmBscInfo.instRgnCd}" width="50%" firstOptTxt="- 선택 -" firstOptVal="" readonly> -->
                            <input type="text" class="form-control form-control-sm" name="instRgnCdNm" id="instRgnCdNm" th:value="${prgrmBscInfo.instRgnCdNm}" readonly="">
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-6">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="implmntIdntySrngAssignStatus"><strong>지정상태</strong></label>
                        <div class="col-12">
<!--                             <span kattr:select_code="sttsCd" th:attr="grpCd=132,selectedCd=${prgrmBscInfo.sttsCd}" firstOptTxt="- 전체 -" addClass="form-select form-select-sm form-control-sm" isAdmin="true"> -->
                            <input type="text" class="form-control form-control-sm" name="sttsCdNm" id="sttsCdNm" th:value="${prgrmBscInfo.sttsCdNm}" readonly="">
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-0 row">
                <div class="col-12 col-lg-6 mb-2 mb-lg-0">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="implmntIdntySrngDegree"><strong>차수 / 지정번호</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" name="cyclNo" id="cyclNo" placeholder="" th:value="${prgrmBscInfo.cyclNo}" readonly="">
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-6">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="implmntIdntySrngAssignAvailableDate"><strong>지정유효기간</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" name="dsgnPrd" id="dsgnPrd" placeholder="Text Input Validation" th:value="${prgrmBscInfo.dsgnPrd}" readonly="">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-header p-t-0 p-b-0">
            <h3 class="sub-title"><strong>이행확인심사</strong></h3>
        </div>
        <div class="card-block-small p-t-0">
            <div class="col-12 table-border-style">
                <div class="table-responsive">
                    <!-- 이행확인 심사 목록 -->
                    <table id="implmntIdntySrngGrid" class="table"></table>
                    <div id="listPager2" class="text-center"></div>
                </div>
            </div>
        </div>

        <!-- 상세 -->
        <div id="contentPanel2" class="" style="display:none"></div>
        <!-- 상세 -->

    </div>
</form>
<script th:inline="javascript">

var implmntSrngGridHelper;

implmntSrngFrm();


function implmntSrngFrm() {

    implmntSrngGridHelper = new GridHelper("implmntIdntySrngGrid", "contentPanel2");
    writeImplmntSrngGridData();
}



//목록
function writeImplmntSrngGridData(){


    $("#implmntIdntySrngGrid").jsGrid({
    	height: "220px",
        width: "100%",
        autoload: true,
        sorting:false,
        paging: false,
        pageLoading: true,
        pageIndex: 1,
        sortOrder:"asc",
        noDataContent: "데이터가 없습니다.",

        controller: {
            loadData: function (filter) {

                var data = $.Deferred();

                var formData = $('#implmntIdntySrngFrm').serializeArray();
                var params = [
                        {name: "pageNumber", value: filter.pageIndex},
                        {name: "rowPerPage", value: filter.pageSize},
                        {name: "orderField", value: 'cycl'},
                        {name: "orderDirection", value: 'asc'}
                ]

                formData = formData.concat(params);

                $.ajax({
                  type: "GET",
                  contentType: "application/json; charset=utf-8",
                  url: "/mng/dsgnPrgrm/selectImplmntIdntySrngList.do",
                  dataType: "json",
                  data: formData
                }).done(function(response){

                    var da = {
                            data : escapeGridData(response.implmntIdntySrngList)
                            ,itemsCount : response.totalCount
                        };
                  data.resolve(da);
                });
                return data.promise();
            },
        },
        fields: [
             { name: 'cyclid', css:'hide'}
            ,{ title: '회차'                ,name: 'cycl',          type: "number", width: "80",  align:"center"}
            ,{ title: '이행확인심사 요청일' ,name: 'regDt',         type: "text",   width: "80", align:"center"}
            ,{ title: '지원단'              ,name: 'picNm',         type: "text",   width: "100", align:"center"}
            ,{ title: '현장방문일'          ,name: 'vstDe',         type: "text",   width: "80", align:"center" }
            ,{ title: '보완개선 요청서'     ,name: 'splmntImprvDmndln', type: "text",   width: "80", align:"center" }
            ,{ title: '보완요청 완료일'     ,name: 'dmndCmptnDe',   type: "text",   width: "80", align:"center" }
            ,{ title: '보완개선 계획서'     ,name: 'splmntImprvWrtpln', type: "text",   width: "80", align:"center" }
            ,{ title: '결과보고서'          ,name: 'rsltln', type: "text",   width: "80", align:"center" }
            ,{ name: 'srngid', css:'hide'}
            ,{ name: 'dmndid', css:'hide'}


        ],

        rowClick: function(args) {

            var dtlUrl = "/mng/dsgnPrgrm/implmntIdntySrngDetailForm.html";
            var key1   = args.item.cyclid;
            var key2   = args.item.srngid;
            var key3   = args.item.dmndid;
            var idx    = args.event.originalEvent.target.cellIndex;

            if(args.event.originalEvent.target.cellIndex == 0 || isNaN(args.event.originalEvent.target.cellIndex)) return;

            dtlUrl = dtlUrl +"?cyclid=" + key1 + "&srngid="+key2 + "&dmndid="+ key3 + "&cidx="+idx;

            //이행확인심사 상세
            implmntSrngGridHelper.loadContent(dtlUrl);
            implmntSrngGridHelper.rowClick(args);


        },
        onPageChanged: function(args) {
            selectedItems = [];
        }
    });
}

</script>
</div>
</body>
</html>