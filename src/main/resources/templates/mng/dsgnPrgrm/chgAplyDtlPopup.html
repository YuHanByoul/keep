<form id="chgAplyDtlPopupFrm">
<input type="hidden" id="aplyid" name="aplyid" th:value="${chgAplyInfo.aplyid}">

	<div class="modal-dialog modal-xl" role="document">
	    <div class="modal-content type_2">
	        <div class="modal-header">
	            <h4 class="modal-title">변경신청 상세보기</h4>
	            <button type="button" class="btn-close" data-bs-dismiss="modal" onclick="closeChgAplyDtlBtn()">
	                <span aria-hidden="true"></span>
	            </button>
	        </div>
	        <div class="modal-body">
	            <div class="card m-b-10">
	                <div class="card-header p-b-0">
	                    <h3 class="sub-title"><strong>변경사항</strong></h3>
	                </div>
	                <div class="card-block-small">
	                    <div class="col-12 mb-2 table-border-style">
	                        <div class="col-12 table-responsive">
	                            <table class="table table-bordered">
	                                <thead>
	                                <tr class="border-top border-bottom-inverse" style="border-top-color: rgb(33, 37, 41) !important;">
	                                    <th colspan="2" class="text-center v-middle">구분</th>
	                                    <th class="text-center v-middle" style="width: 110px;">여부</th>
	                                    <th class="text-center v-middle" style="width: 120px;">추가제출서류</th>
	                                    <th class="text-center v-middle">변경내용</th>
	                                </tr>
	                                </thead>
	                                <tbody>
	                                <tr class="border-bottom">
	                                    <td colspan="2" class="table-active v-middle"><strong>변경사항은 지정프로그램의 제목/목적과 동일한가?</strong></td>
	                                    <td class="text-center v-middle">
	                                        <div class="col-12">
                                                <span kattr:radio_yn="samenssYn" label1="O" label2="X"   th:attr="defaultVal=${chgAplyInfo.samenssYn}" onchange="" isAdmin="true"></span>
	                                        </div>
	                                    </td>
	                                    <td class="text-center v-middle">-</td>
	                                    <td>
	                                       <textarea id="samenssCn" name="samenssCn" class="form-control form-control-sm"><th:block th:text="${chgAplyInfo .samenssCn}"></th:block></textarea>
	                                    </td>
	                                </tr>
	                                <tr class="border-bottom">
	                                    <td rowspan="2" class="table-active v-middle"><strong class="text-break">1. 프로그램영역</strong></td>
	                                    <td class="table-active v-middle" style="width: 250px;"><strong>활동프로그램 세부 내용의 일부 변경</strong></td>
	                                    <td class="text-center v-middle">
	                                        <div class="col-12">
	                                           <span kattr:radio_yn="prgrmChgYn" label1="O" label2="X"   th:attr="defaultVal=${chgAplyInfo.prgrmChgYn}" onchange="" isAdmin="true"></span>
	                                        </div>
	                                    </td>
	                                    <td class="text-center v-middle">-</td>
	                                    <td>
	                                       <textarea id="prgrmChgCn" name="prgrmChgCn" class="form-control form-control-sm"><th:block th:text="${chgAplyInfo .prgrmChgCn}"></th:block></textarea>
	                                    </td>
	                                </tr>
	                                <tr class="border-bottom">
	                                    <td class="table-active v-middle"><strong class="text-break">20% 이내의 예산변경</strong></td>
	                                    <td class="text-center v-middle">
	                                        <div class="col-12">
	                                            <span kattr:radio_yn="bgtChgYn" label1="O" label2="X"   th:attr="defaultVal=${chgAplyInfo.bgtChgYn}" onchange="" isAdmin="true"></span>
	                                        </div>
	                                    </td>
	                                    <td class="text-center v-middle">-</td>
	                                    <td>
	                                        <textarea id="bgtChgCn" name="bgtChgCn" class="form-control form-control-sm"><th:block th:text="${chgAplyInfo .bgtChgCn}"></th:block></textarea>
	                                    </td>
	                                </tr>
	                                <tr class="border-bottom">
	                                    <td colspan="2" class="table-active v-middle"><strong class="text-break">2. 지도자 영역 : 동일한 경력 및 유사 자격을 가진 자로 변경</strong></td>
	                                    <td class="text-center v-middle">
	                                        <div class="col-12">
	                                            <span kattr:radio_yn="ldrChgYn" label1="O" label2="X"   th:attr="defaultVal=${chgAplyInfo.ldrChgYn}" onchange="" isAdmin="true"></span>
	                                        </div>
	                                    </td>
	                                    <td class="text-center v-middle">-</td>
	                                    <td>
                                            <textarea id="ldrChgCn" name="ldrChgCn" class="form-control form-control-sm"><th:block th:text="${chgAplyInfo .ldrChgCn}"></th:block></textarea>
	                                    </td>
	                                </tr>
	                                <tr class="border-bottom">
	                                    <td colspan="2" class="table-active v-middle"><strong class="text-break">3. 교육활동환경영역 : 동일한 장소 및 유사한 장소로 변경,<br/>안전관리 인력 및 영양위생관리자의 유사 경력 및 자격을 가진 자로 담당자 변경</strong></td>
	                                    <td class="text-center v-middle">
	                                        <div class="col-12">
	                                            <span kattr:radio_yn="eduEnvChgYn" label1="O" label2="X"   th:attr="defaultVal=${chgAplyInfo.eduEnvChgYn}" onchange="" isAdmin="true"></span>
	                                        </div>
	                                    </td>
	                                    <td class="text-center v-middle">-</td>
	                                    <td>
                                            <textarea id="eduEnvChgCn" name="eduEnvChgCn" class="form-control form-control-sm"><th:block th:text="${chgAplyInfo .eduEnvChgCn}"></th:block></textarea>
	                                    </td>
	                                </tr>
	                                </tbody>
	                            </table>
	                        </div>
	                    </div>
	                    <div class="mb-2 form-group row required">
	                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="chgRsn"><strong>변경사유</strong></label>
	                        <div class="col-sm-12">
	                            <input type="text" class="form-control form-control-sm" name="chgRsn" id="chgRsn" placeholder="" th:value="${chgAplyInfo.chgRsn}" >
	                        </div>
	                    </div>
	                    <div class="mb-2 form-group row">
	                        <div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
                                <div class="col-sm-12">
	                               <strong>첨부파일</strong></div>



                                    <input type="file" id="evdncDcmntFile" name="evdncDcmntFile" class="form-control form-control-sm" multiple accept="image/jpeg,image/gif,image/png,application/pdf"/>

									<div id="multipleFileUploadError"></div>
                                    <div id="multipleFileUploadSuccess">
                                        <th:block th:if="${fileList != null}" th:each="item : ${fileList}" th:id="${item.fileid}">
                                            <th:block th:if="${item.orginlFileNm != null}">
                                                <span th:id='${item.fileid}' th:fileIdntfcKey="${item.fileIdntfcKey}" th:onclick="downloadFileByFileid(this.getAttribute('fileid'),this.getAttribute('fileIdntfcKey'))" href="javascript:void(0)" class='label label-inverse'> <th:block th:text="${item.orginlFileNm}" /> <a th:name="${item.fileid}" th:attr="data-idntfc-key=${item.fileIdntfcKey}" th:onclick="fn_deleteFileList(this.name, this.dataset.idntfcKey)" class='text-white'><th:block th:text="X"</th:block></a>
                                                </span>
                                            </th:block>
                                        </th:block>
                                    </div>

                            </div>

	                    </div>
	                    <div class="mb-2 form-group row">
	                        <div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
	                            <strong>진행상태</strong></div>
	                        <div class="col-12 col-lg-6">
	                            <span kattr:select_code="aplySttsCd" th:attr="grpCd=119,selectedCd=${chgAplyInfo.aplySttsCd}" firstOptTxt="- 전체 -" addClass="form-select form-select-sm form-control-sm" isAdmin="true" th:value="${aplySttsCd}" isDisable/>
	                        </div>
	                    </div>
	                    <div class="mb-2 form-group row">
	                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="splmntDmndCn"><strong>보완요청 내용</strong></label>
	                        <div class="col-sm-12">
	                            <input type="text" class="form-control form-control-sm" name="splmntDmndCn" id="splmntDmndCn" placeholder="" th:value="${chgAplyInfo.splmntDmndCn}" readonly>
	                        </div>
	                    </div>
	                    <div class="mb-0 row">
	                        <div class="col-12 col-lg-6 mb-2 mb-lg-0">
	                            <div class="mb-0 form-group">
	                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="regDt"><strong>등록일</strong></label>
	                                <div class="col-sm-12">
	                                    <input type="text" class="form-control form-control-sm" name="regDt" id="regDt" th:value="${chgAplyInfo.regDt != null ? #dates.format(chgAplyInfo.regDt, 'yyyy-MM-dd') : #dates.format(#dates.createNow(), 'yyyy-MM-dd')}" readonly />

	                                </div>
	                            </div>
	                        </div>
	                        <div class="col-12 col-lg-6">
	                            <div class="mb-0 form-group">
	                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="sttsMdfcnDt"><strong>최종수정일</strong></label>
	                                <div class="col-sm-12">
                                        <input type="text" class="form-control form-control-sm" name="sttsMdfcnDt" id="sttsMdfcnDt" th:value="${chgAplyInfo.sttsMdfcnDt != null ? #dates.format(chgAplyInfo.sttsMdfcnDt, 'yyyy-MM-dd') : #dates.format(#dates.createNow(), 'yyyy-MM-dd')}" readonly />
	                                </div>
	                            </div>
	                        </div>
	                    </div>
	                </div>
	            </div>
	        </div>
	        <div class="modal-footer">
	            <button type="button" class="btn btn-inverse m-r-5" data-bs-toggle="modal" onclick="openChgAplySttsChgModal()" >상태변경</button>
	            <button type="button" class="btn btn-primary" onclick="saveChgAplyDtlBtn()">저장</button>
	        </div>
	    </div>
	</div>
	<input type="hidden" id="filegrpid" name="filegrpid" value="0"/>
</form>
<!--변경신청 상태변경 팝업-->
<div class="modal fade" id="chgAplySttsChgPopup" aria-hidden="true" data-bs-backdrop="static"></div>

<script th:inline="javascript">
/*<[[*/
var fileList = /*[[${fileList}]]*/null;
/*]]>*/

initChgAplyDtlPopup();

function initChgAplyDtlPopup(){


	if(fileList != null && fileList.length > 0) {
		$("#evdncDcmntFile").hide();
	}else{
        $("#evdncDcmntFile").show();
	}

	//$(".radio.radio-inline").addClass("m-0")    //라디오 정렬
	$("#aplySttsCd").attr("disabled", true);

}

//첨부파일
var atchfileCnt = 5 ;
var uploadFileCnt = 0 ;

$('#evdncDcmntFile').on("change", function(event) {
debugger;
	        var objFile = document.querySelector('#evdncDcmntFile');
	        var formData = new FormData();
	        var content = "";

	        for( i = 0 ; i < objFile.files.length ; i++) {

	               if(uploadFileCnt >= atchfileCnt){
	                   alert("첨부파일은  "+atchfileCnt+ " 개 까지 가능합니다." ); break;
	               }else{
	                   formData.append("files", objFile.files[i]);
	                   uploadFileCnt++;
	               }
	        }

	        formData.append("filegrpid", $("#filegrpid").val());
	        formData.append("filegrpNm", "asgsysSrng_file");

	        if(uploadFileCnt >0 ){
	            $.ajax({
	                url : '/uploadMultipleFiles.do',
	                processData : false,
	                contentType : false,
	                data : formData,
	                type : 'POST',
	                success : function(response) {
                        if(response.result == 'fail'){
                            alert(response.msg);
                        }else{
    	                    if($("#filegrpid").val()=='0' || $("#filegrpid").val()==''  || $("#filegrpid").val()==null){
    	                        $("#filegrpid").val( response[0].filegrpid );
    	                    }




    	                    for(i = 0 ;i < response.length; i++ ){


    	                        content =  "<span id='"+response[i].fileid+"' class='label label-inverse' href=javascript:downloadFileByFileid('"+response[i].fileid+"','"+response[i].fileIdntfcKey+"')>"+response[i].orginlFileNm
    	                        content += "&nbsp;&nbsp;<a href='javascript:void(0)' onclick =uploadFileCnt--;fn_deleteFileList('"+response[i].fileid+"','"+response[i].fileIdntfcKey+"') class='text-white'>X</a></span>"

    	                        $('#multipleFileUploadSuccess').append(content);
    	                    }
                        }
	                }
	            });
	           $("#evdncDcmntFile").val("");
	        }

	        debugger;
	        $('#multipleFileUploadSuccess').childeren();
	        if(response.length > 0) {
                $("#evdncDcmntFile").hide();
            }else{
                $("#evdncDcmntFile").show();
            }
	});

function fn_deleteFileList(fileid, fileIdntfcKey){
    if(!confirm("파일을 삭제하시겠습니까?")){return;}
    fn_deleteFile(fileid, fileIdntfcKey);
    $("#"+fileid).remove();
}

function fn_deleteFile(fileid, fileIdntfcKey){

    var deleteFileUrl="/deleteFile.do?fileid="+fileid+"&file_idntfc_key=" + fileIdntfcKey;
      $.ajax({
        url : deleteFileUrl,
        type: 'GET',
        cache : false,
        dataType: 'json',
        success : function (data){
            console.log(data);
            if(data.result=="success"){
                $("#"+fileid).remove();
                alert("파일삭제가 완료 되었습니다.");
            }else{
                alert("파일삭제중 에러가 발생하였습니다. 관리자에게 문의 부탁드립니다.");
            }
        },
        error : function (error){
        }
     })
};

var chgAplySttsChgModal;
var openChgAplySttsChgModal = () =>{

	var vAplyid = $("#aplyid").val();

    var url = "/mng/dsgnPrgrm/chgAplySttsChgPopup.html?aplyid=" + vAplyid;

    $("#chgAplySttsChgPopup").load(url, function(response, status, xhr) {
        if (status == "success") {
        	chgAplySttsChgModal = new bootstrap.Modal($('#chgAplySttsChgPopup'));
        	chgAplySttsChgModal.show();
        }
    });

}

function closeChgAplyDtlBtn(){
	chgAplyDtlModal.hide();
}


var validator= $("#chgAplyDtlPopupFrm").validate(
		{
			rules    : { chgRsn : { required: true, maxlength: 400 } }
	      , messages : { chgRsn : { required:"변경사유를 입력해 주십시오." , maxlength: '그룹명은 400자를 넘을 수 없습니다.' } }
	    })


function saveChgAplyDtlBtn(){
	if(!($("#chgAplyDtlPopupFrm").valid())) return;

	var formData = $("#chgAplyDtlPopupFrm").serializeArray();


    $.ajax({
        url : "/mng/dsgnPrgrm/updateChgAply.do",
        type: 'POST',
        cache : false,
        dataType: 'json',
        data : formData,
        success : function (data){
            alert(data.msg);
            chgAplyDtlModal.hide();
            chgAplyGridHelper.resetPageContent();
        }
    });

}

$("input[name$='Yn']:radio").change(function () {

    var samenssYn = this.value;

    if(samenssYn == "N"){
    	alert("해당항목이 “X”이면 변경될 내용이 없는 것으로 확인하여 변경 신청이 불가합니다. 내용을 확인하고 다시 선택해 주시기 바랍니다.");
    }

});

</script>