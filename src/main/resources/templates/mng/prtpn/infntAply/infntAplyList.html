<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
	layout:decorator="layout/mng/mainLayout">

<body>
	<div layout:fragment="content">
		<style>
		.hide
		{
		   display:none;
		}
		</style>
		
		<div class="page-body">
			<div class="row">
			    <!-- 필터 부분 -->
                <div class="col-12">
                    <link rel="stylesheet" type="text/css" href="/files/bower_components/bootstrap-daterangepicker/daterangepicker.css">
					<form name="searchFrm" id="searchFrm" action="@{/}" onsubmit="return false;" class="card">
						<!-- 필터 부분 -->
						<div class="card-block-small">
							<!-- 키워드 filter -->
							<div class="row">
								<div class="col-lg-3 col-md-6 mb-3">
									<div class="mb-0 form-group row">
										<div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
											<strong>교육년도</strong>
										</div>
										<div class="col-sm-12">
	                                        <select name="searchEduYr" id="searchEduYr" class="form-select form-select-sm form-control-sm">
	                                            <option value="">- 전체 -</option>
	                                            <th:block th:each="year : ${years}">
	                                                <option th:value="${year}"><th:block th:text="${year}" /></option>
	                                            </th:block>
	                                        </select>
										</div>
									</div>
								</div>
	                            <div class="col-lg-3 col-md-6 mb-3">
	                                <div class="mb-0 form-group row">
	                                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
	                                        <strong>교육관</strong>
	                                    </div>
	                                    <div class="col-sm-12">
	                                        <select name="searchClssrmId" id="searchClssrmId" class="form-select form-select-sm form-control-sm">
	                                            <option value="">- 전체 -</option>
	                                            <th:block th:each="item : ${clssList}">
	                                                <option th:value="${item.clssrmId}"><th:block th:text="${item.clssrmNm}" /></option>
	                                            </th:block>
	                                        </select>
	                                    </div>
	                                </div>
	                            </div>		
                                <div class="col-lg-3 col-md-6 mb-3">
                                    <div class="mb-0 form-group row">
                                        <div class="form-label col-sm-12 col-form-label p-t-0 pb-1">
                                            <strong>교육월</strong>
                                        </div>
                                        <div class="col-sm-12">
                                            <select name="searchClssrmMm" id="searchClssrmMm" class="form-select form-select-sm form-control-sm">
                                                <option value="">- 전체 -</option>
                                                <option value="01">1월</option>
                                                <option value="02">2월</option>
                                                <option value="03">3월</option>
                                                <option value="04">4월</option>
                                                <option value="05">5월</option>
                                                <option value="06">6월</option>
                                                <option value="07">7월</option>
                                                <option value="08">8월</option>
                                                <option value="09">9월</option>
                                                <option value="10">10월</option>
                                                <option value="11">11월</option>
                                                <option value="12">12월</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>      
                                <div class="col-lg-3 col-md-6 mb-3">
                                    <div class="mb-0 form-group row">
                                        <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>접수방법</strong></div>
                                        <div class="col-sm-12"> 
                                            <th:block kattr:select_code="searchRcptMthdCd" grpCd="156" upprCd="0" selectedCd="" onchange="" firstOptTxt="- 전체 -" isAdmin="true"></th:block>
                                        </div>
                                    </div>
                                </div>
							</div>		
							<div class="row">		
                                <div class="col-lg-3 col-md-6 mb-3">
                                    <div class="mb-0 form-group row">
                                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="searchKeyword"><strong>프로그램명</strong></label>
                                        <div class="col-12">
                                            <input type="text" class="form-control form-control-sm" id="searchKeyword" name="searchKeyword" aria-label="Text input with dropdown button">
                                        </div>
                                    </div>
                                </div>                                              
	                            <div class="col-lg-3 col-md-6 mb-3">
	                                <div class="mb-0 form-group row">
	                                    <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>접수단계</strong></div>
	                                    <div class="col-sm-12">	
	                                        <th:block kattr:select_code="searchSttsCd" grpCd="174" upprCd="0" selectedCd="" onchange="" firstOptTxt="- 전체 -" isAdmin="true"></th:block>
	                                    </div>
	                                </div>
	                            </div>
							</div>
							<!-- //키워드 filter -->
							<!-- 키워드 filter-btn -->
							<div class="mt-1 p-t-20 text-center border-top">
								<button type="button" class="btn btn-disabled m-r-5" onclick="fn_init()">초기화</button>
								<button type="submit" class="btn btn-primary" onclick="fn_searchForm()">검색</button>
							</div>
						</div>
					</form>
                </div>
                <div class="col-12">
					<div class="card">
						<div class="row p-20 p-b-0">
							<div class="col-12 col-md-6">
								<h5>
									<strong>교육신청 검색결과</strong>
								</h5>
							</div>
<!-- 							<div class="col-12 col-md-6 text-right">
								<button type="button" class="btn btn-primary waves-effect waves-light" onclick="fn_goInsertForm();">등록</button>
							</div>
 -->						</div>
						<div class="card-block-small">
							<div class="dt-responsive table-responsive">
								<div id="order-table_wrapper" class="dataTables_wrapper dt-bootstrap4">
									<table id="jsGrid" class="table-responsive"></table>
									<div id="listPager" class="text-center"></div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!-- Content Area -->
				<div class="col-12">
				   <div id="contentPanel" style="display: none"></div>
				</div>   
			</div>
		</div>

<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script type="text/javascript" src="/js/common/jsgrid-master/dist/jsgrid.min.js"></script>
<!-- Date-range picker js -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script type="text/javascript" src="/files/bower_components/bootstrap-daterangepicker/daterangepicker.js"></script>

<script th:inline="javascript">
    var selectedItems = [];
    //커스텀 테그 라이브러리 임시 설정
       var getCodeListUrl = "/mng/customAttr/grpCodeList.do";
       function fn_getNextDepthList(grpcd , upprcd, targetId){
           $.ajax({
               url : getCodeListUrl,
               type: 'GET',
               cache : false,
               dataType: 'json',
               data: {
                     grpcd  : grpcd
                   , upprcd : upprcd
               }, 
               success : function (data){
                   writeHtml(grpcd,targetId,data,"");
               },
               error : function (error){
               } 
           });
       }
       
          function writeHtml(grpcd,targetId,list,selected){
              var cntArr = targetId.split("_");
              var nextCnt = Number(cntArr[1])+1;
              var nextTarget =  cntArr[0]+"_"+nextCnt;
              var html ="<select id='"+targetId+"' class ='form-control' onchange=setNextDepth('"+grpcd+"',this.value,'"+nextTarget+"') >";
                  html +="    <option  >전체</option>";
                  for(var i=0 ; i < list.length;i++){
                    if(list[i].cdid==selected){
                        html +="    <option value="+list[i].cd+" selected>"+ list[i].cdNm+ "</option>";
                    }else{
                        html +="    <option value="+list[i].cd+">"+ list[i].cdNm+ "</option>";
                    }
                  }
                  if(list.length == 0 && jQuery("#"+nextTarget)[0] != undefined){
                     writeHtml(grpcd,nextTarget,list,selected);
                  }
                  html +="    </select>";
                  $("#"+targetId).html(html);
          }
          
          function setNextDepth(grpcd , upprcd , targetId){
              fn_getNextDepthList(grpcd , upprcd , targetId);
          }
       
	var selectedItems = [];
	
	var gridHelper1;
	
	$(function() {
		gridHelper1 = new GridHelper('jsGrid', 'contentPanel');
		writeJsGridData();
	});

	function fn_goInsertForm() {
		var insertUrl = "/mng/prtpn/infntAply/infntAplyInsertForm.html";
		gridHelper1.loadContent(insertUrl);
	}

	function fn_searchForm() {
		gridHelper1.resetListContent();
	}

	function fn_init() {
		$("#searchKeyword").val('');
		$("#searchEduYr").val('');
		$("#searchClssrmId").val('');
		$("#searchClssrmMm").val('');
		$("#searchRcptMthdCd").val('');
		$("#searchSttsCd").val('');
		gridHelper1.resetListContent();
	}

	function writeJsGridData() {
        $("#jsGrid").jsGrid({
            height: "auto",
            width: "100%",
            autoload: true,
            sorting: true,
            paging: true,
            pagerContainer: "#listPager",
            pagerFormat: "{first} {prev} {pages} {next} {last}",
            pagePrevText: "이전",
            pageNextText: "다음",
            pageFirstText: " < 처음 ㅣ",
            pageLastText: " | 마지막 >",
            pageSize: 10,
            pageButtonCount: 10,
            pageLoading: true,
            pageIndex: 1,
            noDataContent: "데이터가 없습니다.",

            controller: {
                loadData: function (filter) {
                    var data = $.Deferred();
                                            
                    var formData = $('#searchFrm').serializeArray();
                    var params = [
                            {name: "pageNumber", value: filter.pageIndex},
                            {name: "rowPerPage", value: filter.pageSize},
                    ]
                    
                    if(filter.sortField != undefined){
                        params.push({name: "orderField", value: filter.sortField});
                        params.push({name: "orderDirection", value: filter.sortOrder});
                    }else{
                        params.push({name: "orderField", value: 'REG_DT DESC, CLSSRMID, PRGRMID'});
                    }
                    formData = formData.concat(params);
                    
                    $.ajax({
                        type: "GET",
                        contentType: "application/json; charset=utf-8",
                        url: "/mng/prtpn/infntAply/selectInfntAplyList.do",
                        dataType: "json",
                        data: formData,
                      }).done(function(response){
                          var da = {
                                  data : escapeGridData(response.list)
                                  ,itemsCount : response.totalCount
                              };
                        data.resolve(da);
                      });
                      return data.promise();
                  },				
			},
			fields : [
			    { name : 'prgrmId', css : 'hide' }
			  , { name : 'clssrmId', css : 'hide' } 
			  , { name : 'prgrmSchdlid', css : 'hide' } 
			  , { title : 'No.', name : 'rowNumber', type : "number", width : "80", align : "center", sorting : false }
			  , { title : '교육년도', name : 'eduYr', type : "text", width : "120", align : "center" }
			  , { title : '교육관', name : 'clssrmNm', type : "text", width : "263", align : "center" }
			  , { title : '프로그램명', name : 'prgrmNm', type : "text", width : "223", align : "center" }
			  , { title : '교육월', name : 'eduMm', type : "text", width : "96", align : "center" }
			  , { title : '접수방법', name : 'rcptMthdNm', type : "text", width : "120", align : "center" }
			  , { title : '교육정원', name : 'eduNope', type : "text", width : "80", align : "center",  sorting :false }
			  , { title : '신청완료', name : 'aplyCmpltCnt', type : "text", width : "80", align : "center",  sorting :false }
			  , { title : '대기신청', name : 'wtngAplyCnt', type : "text", width : "80", align : "center",  sorting :false }
			  , { title : '승인대기', name : 'wtngApprvCnt', type : "text", width : "80", align : "center",  sorting :false }
			  , { title : '신청취소', name : 'cnclAplyCnt', type : "text", width : "80", align : "center",  sorting :false }
			  , { title : '승인거부', name : 'dnlApprvCnt', type : "text", width : "80", align : "center",  sorting :false }
			],
			
			rowClick : function(args) {
				if (args.event.originalEvent.target.cellIndex == 0 || isNaN(args.event.originalEvent.target.cellIndex)) return;
				var detailUrl = detailUrl = "/mng/prtpn/infntAply/infntAplyDetailForm.html?prgrmSchdlid=" + args.item.prgrmSchdlid + "&prgrmId=" + args.item.prgrmId;
				gridHelper1.loadContent(detailUrl);
				gridHelper1.rowClick(args);
                selectedItems.push({"prgrmSchdlid": args.item.prgrmSchdlid, "eduYr": args.item.eduYr, "clssrmId":args.item.clssrmId, "clssrmNm" : args.item.clssrmNm, "prgrmId":args.item.prgrmId, "prgrmNm":args.item.prgrmNm});
			},
			onPageChanged : function(args) {
				selectedItems = [];
			}
		});
	}
</script>
<script src="/js/ckeditor/ckeditor.js"></script>

	</div>
</body>
</html>