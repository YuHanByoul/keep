<!-- 신청마감  팝업 -->
<form name="searchCloseFrm" id="searchCloseFrm" action="@{/}" onsubmit="return false;">
<input type="hidden" id="eduYr" name="eduYr" th:value="${mvmnAplyParamVo.eduYr}" />
<input type="hidden" id="sareaId" name="sareaId" th:value="${mvmnAplyParamVo.sareaId}" />
<input type="hidden" id="prgrmId" name="prgrmId" th:value="${mvmnAplyParamVo.prgrmId}" />
<input type="hidden" id="ym" name="ym" th:value="${mvmnAplyParamVo.ym}" />

<div class="modal-dialog modal-md" role="document">
    <div class="modal-content type_2">
        <div class="modal-header">
            <h4 class="modal-title">신청마감</h4>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                <span aria-hidden="true"></span>
            </button>
        </div>
        <div class="modal-body">
            <div class="card">
	            <div class="card-block-small">
	                <div class="dt-responsive table-responsive">
	                    <div id="order-table_wrapper" class="dataTables_wrapper dt-bootstrap4">
	                        <table id="jsCloseGrid" class="table-responsive"></table>
	                        <div id="listClosePager" class="text-center"></div>
	                    </div>
	                </div>
	            </div>
            </div>
        </div>
<!--         <div class="modal-footer"> -->
<!--             <button type="button" class="btn btn-primary waves-effect waves-light ">저장</button> -->
<!--         </div> -->
    </div>
</div>
</form>
<!-- Content Area -->
<div class="col-12">
   <div id="contentClosePanel" style="display: none" class="card"></div>
</div>   

<!-- 신청마감  팝업 -->
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script type="text/javascript" src="/js/common/jsgrid-master/dist/jsgrid.min.js"></script>

  <script th:inline="javascript">
  var gridHelper;
  
  $(function() {
      gridHelper = new GridHelper('jsCloseGrid', 'contentClosePanel');
      writeJsCloseGridData();
  });
  
  function writeJsCloseGridData() {
      $("#jsCloseGrid").jsGrid({
          height: "auto",
          width: "100%",
          autoload: true,
          sorting: true,
          selecting: true,
          editing: true,
          paging: true,
          pagerContainer: "#listClosePager",
          pagerFormat: "{first} {prev} {pages} {next} {last}",
          pagePrevText: "이전",
          pageNextText: "다음",
          pageFirstText: " < 처음 ㅣ",
          pageLastText: " | 마지막 >",
          pageSize: 10,
          pageButtonCount: 10,
          pageLoading: true,
          pageIndex: 1,
          noDataContent: "데이터가 없습니다.",
          controller: {
              loadData: function (filter) {
                  var data = $.Deferred();
                                          
                  var formData = $('#searchCloseFrm').serializeArray();
                  var params = [
                          {name: "pageNumber", value: filter.pageIndex},
                          {name: "rowPerPage", value: filter.pageSize},
                  ]
                  
                  if(filter.sortField != undefined){
                      params.push({name: "orderField", value: filter.sortField});
                      params.push({name: "orderDirection", value: filter.sortOrder});
                  }else{
                      params.push({name: "orderField", value: 'de'});
                  }
                  formData = formData.concat(params);
                  
                  $.ajax({
                      type: "GET",
                      contentType: "application/json; charset=utf-8",
                      url: "/mng/prtpn/mvmnAply/selectMvmnAplyCloseList.do",
                      dataType: "json",
                      data: formData,
                    }).done(function(response){
                        var da = {
                                data : escapeGridData(response.list)
                                ,itemsCount : response.totalCount
                            };
                      data.resolve(da);
                    });
                    return data.promise();
                }    
          },
          
          fields : [
             { name : 'tmeId', css : 'hide' }
//             , { title : 'No.', name : 'rowNumber', type : "number", width : "80", align : "center", sorting : false, editing : false }
            , { title : '교육일자', name : 'de', type : "text", width : "135", align : "center", editing : false }
            , { title : '회차', name : 'tmeNm', type : "text", width : "135", align : "center", editing : false }
            , { title : '접수단계', name : 'rcptCd', type : "select", items : [{"cd":"174102","cdNm":"접수중","cdgrpid":"174"},{"cd":"174103","cdNm":"마감","cdgrpid":"174"}], valueField : "cd", textField : "cdNm", width : "130", sorting : false, editing : true, editTemplate: function (value, item) {
                var grid = this._grid;
                var selectedTmeId = grid.fields[0]._value;
                var $editControl = jsGrid.fields.select.prototype.editTemplate.call(this, value);
                $editControl.change(function (value, item) {
                	debugger;
                    var selectedUseYn = $(this).val() == "174102" ? "Y" : "N";
                    var data = "tmeId="+selectedTmeId+"&useYn="+selectedUseYn;
                    if(displayWorkProgress()){
                        $.ajax({
                            url : "/mng/prtpn/mvmnAply/updateMvmnAplyClose.do",
                            type: 'POST',
                            cache : false,
                            dataType: 'json',
                            data : data,
                            success : function (data){
                                if(data.result=="success"){
                                    gridHelper.resetListContent();
                                }else{
                                    alert(data.msg);
                                }
                                closeWorkProgress();
                            }
                        });
                    }
                });
                return $editControl;
            }}
          ],
          rowClick : function(args) {
              if(args.event.originalEvent.target.cellIndex == 3){
                  jsGrid.Grid.prototype.rowClick.call(this, args);
              }
          }
      });
  }
</script>
</body>
</html>