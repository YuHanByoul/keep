<form id ="eduSareaInsertForm">
<input type="hidden" value="Y" name="useYn" id="useYn">
        <!-- INSERT -->
        <div class="card-header p-b-0">
            <h3 class="sub-title"><strong>기본정보</strong></h3>
        </div>

        <!-- Tab Container Start -->
         <div class="card-block-small p-t-0">
             <div class="row">
                 <div class="col-lg-6 mb-3">                                                                    
                     <div class="mb-0 form-group required" >
                         <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="sareaNm"><strong>운영권역명</strong></label>
                         <div class="col-sm-12">
                             <input type="text" class="form-control form-control-sm" name="sareaNm" id="sareaNm" placeholder="" >
                         </div>
                     </div>
                 </div>
             </div>
             <div class="row">
                 <div class="col-md-6 col-lg-3 mb-3">
                     <div class="mb-0 form-group required">
                         <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>운영기관</strong></div>
                         <div class="col-12 row">
                             <div class="col-8">
                                 <input type="text" class="form-control form-control-sm" name="cnsgnInstNm" id="instNm" placeholder="기관" readonly />
                                 <input type="hidden" name="cnsgnInstId" id="instid" />
                             </div>
                             <div class="col-4 btn-group-sm">
                                 <button type="button" class="btn btn-inverse" onclick="fn_openInstSearchModal();">
                                     기관검색
                                 </button>
                             </div>
                         </div>
                     </div>
                 </div>
             </div>
             <div class="row">
                 <div class="col-12 mb-3">
                     <div class="mb-0 form-group required">
                         <div class="form-label col-sm-12 col-form-label p-t-0"><strong>지역</strong></div>
                         <div class="row pt-1">
                             <div class="col col-md-6 col-lg-3">
                             <select name="ctprvnCd" id="ctprvnCd" class="form-select form-select-sm form-control-sm">
                                 <option value="">- 선택 -</option>
                                 <th:block th:each="item : ${ctprvnCdList}">
                                     <option th:value="${item.ctprvnCd}"><th:block th:text="${item.ctprvnNm}" /></option>
                                 </th:block>
                             </select>

                             </div>
                             <div class="col-auto ps-0">
                                 <button type="button" id="addRowCtprvnCds" class="input-group-text btn btn-primary btn-sm addRowCtprvn" onclick="fn_addRowCtprvnCds(this)">+</button>
                             </div>
                         </div>
                     </div>
                 </div>
             </div>
             <div class="row">
                 <div class="col-lg-6 mb-3">
                     <div class="mb-0 form-group required">
                         <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="aplyLmtCnt"><strong>연도별 기관당 신청 횟수 제한</strong></label>
                         <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" name="aplyLmtCnt" id="aplyLmtCnt" placeholder="신청 가능 횟수를 입력하세요.">
                         </div>
                     </div>
                 </div>
             </div>
             <div class="row form-group mb-3">
                 <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="expln"><strong>설명</strong></label>
                 <div class="col-sm-12">
                     <input type="text" class="form-control form-control-sm" name="expln" id="expln" placeholder=""/>
                 </div>
             </div>             
             <div class="row form-group mb-3">       
                  <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="sareaUseYn"><strong>사용여부</strong></label>
                  <div class="col-12">
                      <input type="hidden" class="js-single"/>
                      <span kattr:switch_yn="sareaUseYn" defaultVal="Y" onchange="useSwitch()" isAdmin="true"></span>
                  </div>
             </div>
        </div>
        <div class="card-block-small">
            <button type="button" class="btn btn-disabled m-r-5" id="canceeduSarea" onclick="gridHelper1.toggleContent()">취소</button>
            <th:block sec:authorize-url="/mng/prtpn/eduSarea/insertEduSarea.do"><button type="button" class="btn btn-primary" id="inserteduSarea" onclick="fn_insertEduSarea()">저장</button></th:block>
        </div>
        <!-- Tab Container End -->
</form>
<div class="modal fade" id="instSearchPopup" data-bs-backdrop="static"></div>

<script th:inline="javascript">
	var instSearchPopupUrl = "/mng/prtpn/eduSarea/instSearchPopup.html";
	var instSearchPopup;

    /* 기관 검색 팝업 */
	fn_openInstSearchModal = () => {
	    $("#instSearchPopup").load(instSearchPopupUrl, function(response, status, xhr) {
	        if (status == "success") {
                instSearchPopup = new bootstrap.Modal($('#instSearchPopup'));
                instSearchPopup.show();
	        }
	    });
	}

    /* 초기화 함수 */
	function init() {
        var elemsingleSmallList = document.querySelectorAll('.js-single-small');
        for(var i = 0; i < elemsingleSmallList.length; i++) {
            new Switchery(elemsingleSmallList[i], {color: "#93BE52", jackColor: "#fff", size: "small"});
       }
       $(".switchery").css({pointerEvents: "block"});
		
	}
	
    function useSwitch() {
        if ($("#useYn").is(":checked")) {
            $('#eduSareaInsertForm').find('#useYn').val("Y");
        } else {
            $('#eduSareaInsertForm').find('#useYn').val("N");
        }
    }

    //지역 행추가
    function fn_addRowCtprvnCds(item){
        var $parent = $(item).parent().parent();
        var delBtn = `<button type="button" class="input-group-text btn btn-primary btn-sm" onclick="fn_delRowCtprvnCds(this)">-</button>`;
        $(item).parent().append(delBtn);
        $(item).remove();
        $parent.last().after( fn_makeCtprvnCdsListHtml() );
    }

    //지역 행삭제
    function fn_delRowCtprvnCds(item){
        $(item).parent().parent().remove();
    }
    
    function fn_makeCtprvnCdsListHtml() {
        var ctprvnCdsHtml = "";
        var ctprvnCdsList = /*[[${ctprvnCdList}]]*/null;
        
        ctprvnCdsHtml += '<div class="row pt-1">   '
        ctprvnCdsHtml += '  <div class="col col-md-6 col-lg-3">';                         
        ctprvnCdsHtml += '      <select class="form-select form-select-sm form-control-sm" style="" id="ctprvnCd" name="ctprvnCd">';
        ctprvnCdsHtml += '          <option value="">- 선택 -</option>';
        for(var i=0; i<ctprvnCdsList.length; i++){
        	ctprvnCdsHtml += '      <option value="'+ctprvnCdsList[i].ctprvnCd+'">'+ctprvnCdsList[i].ctprvnNm+'</option>';        	
        }
        ctprvnCdsHtml += '      </select>';
        ctprvnCdsHtml += '  </div>';        
        ctprvnCdsHtml += '  <div class="col-auto ps-0">';
        ctprvnCdsHtml += '      <button type="button" id="addRowCtprvnCds" class="input-group-text btn btn-primary btn-sm addRowCtprvn" onclick="fn_addRowCtprvnCds(this)">+</button>';
        ctprvnCdsHtml += '  </div>';                             
        ctprvnCdsHtml += '</div>';                             
        
        return ctprvnCdsHtml;
    }    
    
    function fn_insertEduSarea(){
        if(!($("#eduSareaInsertForm").valid())) return;

        if(!confirm("저장하시겠습니까?")) return;

        var ctprvnCds = $('[name=ctprvnCd] option:selected').map(function(){ return $(this).val();}).get().join(",");
        var setCtprvnCd = new Set($('[name=ctprvnCd] option:selected').map(function(){ return $(this).val();}));
        var isDuplicate = setCtprvnCd.size < $('[name=ctprvnCd] option:selected').length;

        if(isDuplicate){
            alert("타 운영권역과 중복되는 지역이 있습니다.");
            return;
        }

        var data =  $("#eduSareaInsertForm").serialize();
        data = data + "&ctprvnCds="+ctprvnCds;
        
        if(displayWorkProgress()){
            $.ajax({
                url : "/mng/prtpn/eduSarea/insertEduSarea.do",
                type: 'POST',
                cache : false,
                dataType: 'json',
                data : data,
                success : function (data){
                    if(data.result=="success"){
                        alert(data.msg);
                        gridHelper1.resetListContent();
                    }else{
                        alert(data.msg);
                    }
                    closeWorkProgress();
                }
            });
        }
    }
    
    $(function () {
    	init(); 
        validForm();
    })
    
    function validForm() {
        $("#eduSareaInsertForm").validate({
            onsubmit: false,
            rules: {
            	sareaNm: {required: true, maxlength: 100},
            	cnsgnInstNm: {required: true},
                ctprvnCd: {required: true},
                aplyLmtCnt: {required: true, maxlength: 11},
                expln: {required: false, maxlength: 200}

            },
            messages: {
            	sareaNm: {required: "운영권역명을 입력해주십시오.", maxlength: "운영권역명은 100자를 넘을 수 없습니다."},
            	cnsgnInstNm: {required: "운영기관을 입력해주십시오."},
                ctprvnCd: {required: "지역을 선택해주십시오."},
                aplyLmtCnt: {required: "연도별 기관당 신청 횟수 제한을 입력해주십시오.", maxlength: "연도별 기관당 신청 횟수 제한은 11자를 넘을 수 없습니다."},
                expln: {maxlength: "설명은 200자를 넘을 수 없습니다."}
            }
        });    
    }
</script>