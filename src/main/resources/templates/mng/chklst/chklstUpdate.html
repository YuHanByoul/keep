<form id ="chklstUpdateForm">
    <input type="hidden" name="chklstid" th:value="${chklstInfo.chklstid}">
    <div class="tab-pane active" id="chklstInsert" role="tabpanel">
        <!--
        <div class="card-header p-t-0 p-b-0">
            <h3 class="sub-title"><strong>기본정보</strong></h3>
        </div>
        -->
        <div class="card-block-small p-t-0">
            <div class="mb-2 row">
                <div class="col-12 col-lg-6">
                    <div class="mb-0 form-group required">
                        <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>운영 형태</strong></div>
                        <div class="col-12">
                            <span  kattr:select_code="operFrmCd" th:attr="grpcd=145, selectedCd=${chklstInfo.operFrmCd}" firstOptTxt="- 선택 -" isAdmin="true"></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-2 form-group row required">
                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="chklstNm"><strong>체크리스트 명</strong></label>
                <div class="col-sm-12">
                    <input type="text" class="form-control form-control-sm" name="chklstNm" id="chklstNm" placeholder="체크리스트 명을 입력해주세요." th:value="${chklstInfo.chklstNm}">
                </div>
            </div>
            <div class="mb-2 form-group row">
                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="checkListExplanation"><strong>체크리스트 설명</strong></label>
                <div class="col-12">
                    <textarea rows="5" cols="5" class="form-control form-control-sm" placeholder="체크리스트 설명을 입력해주세요." id="chklstExpln" name="chklstExpln" th:text="${chklstInfo.chklstExpln}"></textarea>
                </div>
            </div>
            <div class="mb-0 form-group row">
                <div class="col-12">
                    <input type="hidden" name="useYn" th:value="${chklstInfo.useYn}">
                    <input type="checkbox" class="js-single-small" id="useYn" checked onchange="chklstUpdate.onChangeUseYn();"/>
                    <label for="useYn" class="v-middle">사용여부</label>
                </div>
            </div>
        </div>
        <div class="card-block-small p-t-0">
            <button type="button" class="btn btn-disabled m-r-5" onclick="chklstUpdate.offUpdateChklst();">취소</button>
            <th:block sec:authorize-url="/mng/chklst/updateChklst.do"><button type="button" class="btn btn-primary" onclick="chklstUpdate.onUpdateChklst();">저장</button></th:block>
        </div>
    </div>
</form>

<script th:inline="javascript">
    var chklstUpdate = {
        isInit: false
        , init: function() {
            var elemsingleSmallList = document.querySelectorAll('.js-single-small');
            for(var i = 0; i < elemsingleSmallList.length; i++) {
                new Switchery(elemsingleSmallList[i], {color: "#93BE52", jackColor: "#fff", size: "small"});
            }
           $(".js-example-basic-single").select2();
           toggleSwitch("#useYn", $("input[name='useYn']").val() == "Y" ? true : false);
           
           this.registEvent();
           this.setValid();
           this.isInit = true;
        },
        
        registEvent: function() {
            // TODO
        }
        
        , setValid: function() {
            var validator = $('#chklstUpdateForm').validate({
                rules: {
                    operFrmCd: {required: true},
                    chklstNm: {required: true, maxlength: 40},
                    expln: {maxlength: 60}
                },
                messages: {
                    operFrmCd: {required: "운영 형태를 선택해주세요."},
                    chklstNm: {required: "체크리스트 명을 입력해주세요.", maxlength: "체크리스트 명은 40자 이하여야 합니다."},
                    expln: {maxlength: "체크리스트 설명은 60자 이하여야 합니다."}
                }
            });
        }
        
        , onChangeUseYn: function() {
            if(this.isInit) {
                var param = {operFrmCd: $("#operFrmCd").val()};
                if($("#useYn").is(":checked")) {
                    if(displayWorkProgress()) {
                        $.ajax({
                            url : "/mng/chklst/isUseChklst.do",
                            type: "POST",
                            cache: false,
                            dataType: "json",
                            data: param,
                            success: function(response) {
                                console.log(response)
                                var isUseChklst = response.chklstInfo.isUseChklst;
                                closeWorkProgress();
                                if(isUseChklst == "Y") {
                                    toggleSwitch("#useYn", false);
                                    alert("동일한 운영형태의 사용중인 체크리스트가 있습니다.\n사용중인 체크리스트를 사용안함 처리 후 진행해주세요.");
                                }
                            }
                        });
                    }
                }
            }
        }
        
        , onUpdateChklst: function() {
            if(!($("#chklstUpdateForm").valid())) return;
            $("input[name='useYn']").val($("#useYn").is(":checked") ? "Y" : "N");
            var param = $("#chklstUpdateForm").serialize();
            
            if(displayWorkProgress()) {
                $.ajax({
                    url : "/mng/chklst/updateChklst.do",
                    type: "POST",
                    cache: false,
                    dataType: "json",
                    data: param,
                    success: function(response) {
                        if(response.result == "success") {
                            alert(response.msg);
                            chklstGrid.resetListContent();
                        } else {
                            alert(response.msg);
                        }
                        closeWorkProgress();
                    }
                });
            }
        }
        
        , offUpdateChklst: function() {
            chklstGrid.toggleContent();
        }
    };
    
    chklstUpdate.init();
</script>