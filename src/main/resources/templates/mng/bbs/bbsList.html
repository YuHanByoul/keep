<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security" 
    xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout" 
    layout:decorator="layout/mng/mainLayout" 
>

<body>
 <div layout:fragment="content">
 <!-- <style>
.hide{display:none;}
</style> -->
<!-- Page-body start -->
  <div class="page-body">
      <div class="row">
          <div class="col-12">
          <form name="bbsSearchForm" id="bbsSearchForm" action="" onsubmit="return false;" class="card">
             <!-- 필터 부분 -->
                 <div class="card-block-small">
                     <!-- 키워드 filter -->
                     <div class="row">
                     
                         <div class="col-lg-3 mb-2">
                             <div class="mb-0 form-group row">
                                 <span class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>게시판 유형</strong></span>
                                 <div class="col-sm-12">
				                     <select name="searchCl" id="searchCl" class="form-select form-select-sm form-control-sm" >
				                         <option value=""> - 선택 - </option>
				                         <option value="1">일반형</option>
				                         <option value="2">공지형</option>
				                     </select>
                                 </div>
                             </div>
                         </div>
                     
                         <div class="col-lg-3 mb-2">
                             <div class="mb-0 form-group row">
                                 <span class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>기관 키워드</strong></span>
                                 <div class="input-group input-group-sm input-group-dropdown mb-0">
                                     <select name="searchType" id="searchType" class="form-select form-control form-control-primary form-bg-primary">
                                        <option value="">- 선택 -</option>
                                        <option value="bbsName">게시판명</option>
                                     </select>
                                     <input type="text" name="searchKeyword" id="searchKeyword" class="form-control" 
                                     aria-label="Text input with dropdown button">
                                     
                                 </div>
                             </div>
                         </div>
                     </div>
                     <!-- //키워드 filter -->
                     <!-- 키워드 filter-btn -->
                     <div class="m-t-20 text-center">
                         <button class="btn btn-disabled m-r-5" onclick="fn_init()" >초기화</button>
                         <button class="btn btn-primary" onclick="fn_searchForm()" >검색</button>
                     </div>
                 </div>
           </form>
           </div>
           <!-- //필터 부분 -->
           <div class="col-12">  
            <div class="card">
           
                <div class="row p-20 p-b-0">
                    <div class="col-12 col-md-6 mb-2 mb-md-0">
                        <h5><strong>기관 검색 결과</strong></h5>
                    </div>
                    <div class="col-12 col-md-6 text-right">
                    
                        <th:block sec:authorize-url="/bbs/bbsInsertForm.html">
                            <button type="button" class="btn btn-primary waves-effect waves-light" onclick="fn_goInsertForm();" >등록</button>
                        </th:block>
                        
                    </div>
                </div>
                
                <div class="card-block-small">
                    <div class="dt-responsive table-responsive">
                        <div id="order-table_wrapper" class="dataTables_wrapper dt-bootstrap4">
                                <table id="jsGrid" class="table-responsive"></table>
                                <div id="listPager" class="text-center"></div>
                       </div>
                    </div>
                </div>
            </div>
          </div>
          <!-- Content Area -->
          <div class="col-12">
              <div id="contentPanel" class="card"></div>
          </div>
          
      </div>
  </div>
  
<!-- 분류관리 팝업 Start -->
<div class="modal fade" id="clCdModal" aria-hidden="true" data-bs-backdrop="static"></div>
<!-- 분류관리 팝업 END -->


<script th:inline="javascript">
	var gridHelper1;
	$(function(){
		  
		  if($("#bbsid").val() !=null ){
			  $("#bbsCl").val($("#bbsid").val());
		  }
		  
          gridHelper1 = new GridHelper('jsGrid','contentPanel');
          
		  writeJsGridData();
	})
	
    function fn_init() {
        $("#searchCl").val('');
        $("#searchType").val('');
        $("#searchKeyword").val('');
    }
    function fn_goInsertForm(){
    	gridHelper1.loadContent("/bbs/bbsInsertForm.html");
    }
    
    function fn_goUpdateForm(bbsid){
   	    var modifyUrl = "/bbs/bbsUpdateForm.html?bbsid=" + bbsid;
   	    gridHelper1.loadContent(modifyUrl);
    }
    function fn_searchForm(){
       gridHelper1.resetListContent();
   	   //writeJsGridData();
    }
    
    function writeJsGridData(){
   		$("#jsGrid").jsGrid({
   	        height: "auto",
   	        width: "100%",
   	        autoload: true,
   	        sorting: false,
   	        paging: true,
   	        pagerContainer: "#listPager",
   	        pagerFormat: "{first} {prev} {pages} {next} {last}",
   	        pagePrevText: "이전",
   	        pageNextText: "다음",
   	        pageFirstText: "< 처음ㅣ",
   	        pageLastText: "ㅣ 마지막 >",
   	        pageSize: 10,
   	        pageButtonCount: 10,
   	        pageLoading: true,
   	        pageIndex: 1,
   	        noDataContent: "데이터가 없습니다.",
   	        
   	        controller: {
   	            loadData: function (filter) {
   	            	var data = $.Deferred();
   	            	var params = {
   	            			"searchCl"  :$('#searchCl').val()
   	            			,"searchType": $('#searchType').val()
   	            			,"searchKeyword": $('#searchKeyword').val()
   	            			,"pageNumber": filter.pageIndex
   	            			,"rowPerPage": filter.pageSize
   	            			,"orderField": filter.sortField
   	            			,"orderDirection": filter.sortOrder
   	            	}
   	            	if(filter.sortField == undefined){
   	            		params.orderField = "MDFCN_DT";
   	            	}
   	                $.ajax({
   	                  type: "GET",
   	                  contentType: "application/json; charset=utf-8",
   	                  url: "/bbs/getBbsList.do?pageNumber="+filter.pageIndex+"&rowPerPage="+filter.pageSize,
   	                  dataType: "json",
   	                  data: params
   	                }).done(function(response){
   	                	var da = {
                                   data : escapeGridData(response.list)
                                   ,itemsCount : response.totalCount
                               };
   	                  data.resolve(da);
   	                });
   	                
   	                return data.promise();
   	            }
   	        },
    	    fields: [ 
                     { title: '번호'      ,name: 'rowNumber' ,type: "number", width: "5%" , align:"center", sorting :false }
                    ,{ title: '게시판 유형' ,name: 'clNm'     ,type: "text"  , width: "7%" , align:"center"}
                    ,{ title: '게시판 코드' ,name: 'bbsid'     ,type: "text"  , width: "7%" , align:"center"}
                    ,{ title: '게시판명'   ,name: 'nm'        ,type: "text"  , width: "25%"   }
                    ,{ title: '게시글수'   ,name: 'pstCnt'   ,type: "text"  , width: "7%" , align:"center"}
                    ,{ title: '사용여부'   ,name: 'useYn'    ,type: "text"  , width: "4%" , align:"center"}
                    ,{ title:'분류관리'    ,name: 'clUseYn' ,type: "text"  , width: "5%" , align:"center",
                    	 itemTemplate: function(value, item) {
                    	if(value=="Y"){
                    		return $("<button class='btn btn-xs btn-info btn-mini'>").text("분류 관리").on("click", function() {  fn_openBbsClListModal(item.bbsid);  return false;});
                    	}else{
                    		return "<td>  -  </td> "
                    	}
		              }
                    }
                    ,{ title: '게시물관리'  ,width: "5%",name: '' ,type: "text",sorting:false, align :"center"  ,itemTemplate : function(value,item){
                    	return $("<button class='btn btn-inverse  btn-mini'>").text("게시물 관리").on("click", function() { 
                    		location.href="/bbs/bbsPstForm.html?bbsid="+item.bbsid;
                    		return false;
                    		})
                    }}
    	     ],
	        /*[# sec:authorize-url="/bbs/bbsUpdateForm.html"]*/
   	        rowClick: function(args) {
   	        	//fn_goUpdateForm(args.item.bbsid);
   	        	var modifyUrl = "/bbs/bbsUpdateForm.html?bbsid=" + args.item.bbsid;
   	            gridHelper1.loadContent(modifyUrl);
   	        }, 
            /*[/]*/
   	    });
  		}



    var clCdModal ;
    
    //분류 관리 open   
    var fn_openBbsClListModal = (bbsid) => {
        
        var url ="/bbs/bbsClPop.html?bbsid="+bbsid;

        $("#clCdModal").load(url, function(response, status, xhr) {
            if (status == "success") {
            	clCdModal = new bootstrap.Modal($('#clCdModal'));
            	clCdModal.show();
            }
        });
    }





    
   	var clPop = "";	    	
   	
   	function fn_goClUse(bbsid){
   		console.log(clPop);
   		if(clPop == null || clPop == "undefined" || clPop == ""){
    		fn_bbsPop(bbsid);
   		}else{
   			clPop.close();
   			fn_bbsPop(bbsid);
   		}
      }
   	
      function fn_bbsPop(bbsid){
   	   var popUrl ="/bbs/bbsClPop.html?bbsid="+bbsid;
   	   var popupOption="scrollbars=yes,left=500,width=600, height=600";
   	    clPop = window.open(popUrl, "_blank", popupOption);
      }
      
      function fn_goPst(bbsid){
   	   location.herf="/bbs/bbsPstForm.html?bbsid="+bbsid;
      }
  </script> 
</div>
</body>
</html>