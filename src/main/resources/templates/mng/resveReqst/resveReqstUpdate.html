<form id="resveReqstUpdate" onsubmit="return false;">
    <input type="hidden" id="aplyid" name="aplyid" th:value="${resveReqst.aplyid}">
    <!--탭영역 start -->
    <div class="tab-content tabs p-t-20">
        <div class="tab-pane active" id="reserveRequestInfo" role="tabpanel">
            <!-- 예약 정보 -->
            <div class="card-header p-t-0 p-b-0">
                <h3 class="sub-title"><strong>예약 정보</strong></h3>
            </div>
            <div class="card-block-small p-t-0">
                <div class="row">
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>운영기관</strong></label>
                            <div class="col-12">
                                <input type="text" class="form-control form-control-sm" readonly="" th:value="${resveReqst.instNm}">
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>시설</strong></label>
                            <div class="col-12">
                                <input type="text" class="form-control form-control-sm" readonly="" th:value="${resveReqst.fcltNm}">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>공간</strong></label>
                            <div class="col-12">
                                <input type="text" class="form-control form-control-sm" readonly="" th:value="${resveReqst.spceNm}">
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>이용일(시)</strong></label>
                            <div class="col-12">
                                <th:block th:if ="${#dates.format(resveReqst.bgngDt, 'yyyy-MM-dd')} != ${#dates.format(resveReqst.endDt, 'yyyy-MM-dd')}">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${#dates.format(resveReqst.bgngDt, 'yyyy-MM-dd')}+' ~ '+${#dates.format(resveReqst.endDt, 'yyyy-MM-dd')}">
                                </th:block>
                                <th:block th:if ="${#dates.format(resveReqst.bgngDt, 'yyyy-MM-dd')} == ${#dates.format(resveReqst.endDt, 'yyyy-MM-dd')}">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${#dates.format(resveReqst.bgngDt, 'yyyy-MM-dd HH:mm')}+' ~ '+${#dates.format(resveReqst.endDt, 'HH:mm')}">
                                </th:block>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>신청상태</strong></label>
                            <div class="col-12">
                                <input type="text" class="form-control form-control-sm" readonly="" th:value="${resveReqst.aplySttsCdNm}">
                            </div>
                        </div>
                    </div>
                    <th:block th:if ="${resveReqst.aplySttsCd} == '160103'">
                        <!-- 취소상태 -->
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>예약취소일시</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${#dates.format(resveReqst.cnclDt, 'yyyy-MM-dd HH:mm:ss')}">
                                </div>
                            </div>
                        </div>
                    </th:block>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>결제금액</strong></label>
                            <div class="col-12">
                                <input type="text" class="form-control form-control-sm" readonly="" th:value="${resveReqst.amt}">
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>결제상태</strong></label>
                            <div class="col-12">
                                <input type="text" class="form-control form-control-sm" readonly="" th:value="${resveReqst.stlmSttsCdNm}">
                            </div>
                        </div>
                    </div>
                </div>
                <th:block th:if ="${resveReqst.stlmSttsCd} == '161103' or ${resveReqst.stlmSttsCd} == '161104'">
                    <!-- 환불요청 or 환불완료 -->
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>환불요청금액</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${resveReqst.rfndDmndAmt}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>환불요청일시</strong></label>
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" readonly="" th:value="${#dates.format(resveReqst.rfndDmndDt, 'yyyy-MM-dd HH:mm:ss')}">
                                </div>
                            </div>
                        </div>
                    </div>
                </th:block>
                <th:block th:if ="${resveReqst.aplySttsCd} == '160103'">
                    <!-- 취소상태 -->
                    <div class="row form-group mb-3">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>예약취소사유</strong></label>
                        <div class="col-12">
                            <textarea rows="5" cols="5" class="form-control form-control-sm" readonly=""><th:block th:text="${resveReqst.rsvtCnclRsn}"/></textarea>
                        </div>
                    </div>
                </th:block>
            </div>
            <!-- 신청자 정보 -->
            <div class="card-header p-t-0 p-b-0">
                <h3 class="sub-title"><strong>신청자 정보</strong></h3>
            </div>
            <div class="card-block-small p-t-0">
                <div class="row">
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>신청자 ID</strong></label>
                            <div class="col-12">
                                <input type="text" class="form-control form-control-sm" readonly="" th:value="${resveReqst.acnt}">
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>이름/기관명</strong></label>
                            <div class="col-12">
                                <input type="text" class="form-control form-control-sm" readonly="" th:value="${resveReqst.nm}+' / '+${resveReqst.userInstNm}">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>회원유형</strong></label>
                            <div class="col-12">
                                <input type="text" class="form-control form-control-sm" readonly="" th:value="${resveReqst.rolecdnm}">
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>기관유형</strong></label>
                            <div class="col-12">
                                <input type="text" class="form-control form-control-sm" readonly="" th:value="${resveReqst.instTypeCdNm}">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>휴대전화</strong></label>
                            <div class="col-12">
                                <input type="text" class="form-control form-control-sm" readonly="" th:value="${resveReqst.moblphon}">
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>이메일</strong></label>
                            <div class="col-12">
                                <input type="text" class="form-control form-control-sm" readonly="" th:value="${resveReqst.eml}">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 mb-3">
                        <div class="mb-0 form-group required">
                            <div class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>이용인원</strong></div>
                            <div class="col-12 row align-items-center">
                                <div class="col-auto p-r-0">
                                    성인
                                </div>
                                <div class="col-auto">
                                    <input type="text" class="col-lg-auto form-control form-control-sm" name="nopeAdult" id="nopeAdult" style="width: 80px;" th:value="${resveReqst.nopeAdult}">
                                </div>
                                <div class="col-auto p-l-0 p-r-0">
                                    명
                                </div>
                                <div class="col-auto p-r-0">
                                    아동
                                </div>
                                <div class="col-auto">
                                    <input type="text" class="col-lg-auto form-control form-control-sm" name="nopeChil" id="nopeChil" style="width: 80px;" th:value="${resveReqst.nopeChil}">
                                </div>
                                <div class="col-auto p-l-0 p-r-0">
                                    명
                                </div>
                                <div class="col-auto p-r-0">
                                    유아
                                </div>
                                <div class="col-auto">
                                    <input type="text" class="col-lg-auto form-control form-control-sm" name="nopeInfnt" id="nopeInfnt" style="width: 80px;" th:value="${resveReqst.nopeInfnt}">
                                </div>
                                <div class="col-auto p-l-0 p-r-0">
                                    명
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row form-group mb-3 required">
                    <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="utztnPrps"><strong>이용목적</strong></label>
                    <div class="col-12">
                        <textarea rows="5" cols="5" class="form-control form-control-sm" id="utztnPrps" name="utztnPrps"><th:block th:text="${resveReqst.utztnPrps}"/></textarea>
                    </div>
                </div>
            </div>
            <!-- 예약자 정보 -->
            <div class="card-header p-t-0 p-b-0">
                <h3 class="sub-title"><strong>예약자 정보</strong></h3>
            </div>
            <div class="card-block-small p-t-0">
                <div class="row">
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group required">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="aplcntNm"><strong>이름</strong></label>
                            <div class="col-12">
                                <input type="text" class="form-control form-control-sm" name="aplcntNm" id="aplcntNm" th:value="${resveReqst.aplcntNm}">
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group required">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="aplcntMoblphon"><strong>휴대전화</strong></label>
                            <div class="col-12">
                                <input type="text" class="form-control form-control-sm" name="aplcntMoblphon" id="aplcntMoblphon" th:value="${resveReqst.aplcntMoblphon}">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mb-0 row">
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group required">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="aplcntEml"><strong>이메일</strong></label>
                            <div class="col-12">
                                <input type="text" class="form-control form-control-sm" name="aplcntEml" id="aplcntEml" th:value="${resveReqst.aplcntEml}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 입금정보 -->
            <div class="card-header p-t-0 p-b-0">
                <h3 class="sub-title"><strong>입금정보</strong></h3>
            </div>
            <div class="card-block-small p-t-0">
                <div class="row">
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>결제방법</strong></label>
                            <div class="col-12">
                                <input type="text" class="form-control form-control-sm" readonly="" th:value="${resveReqst.stlmMthdCdNm}">
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>입금계좌</strong></label>
                            <div class="col-12">
                                <input type="text" class="form-control form-control-sm" readonly="" th:value="${resveReqst.bankCdNm}+' '+${resveReqst.bacntNo}+' '+${resveReqst.dpstrNm}">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group required">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="pyrNm"><strong>입금자명</strong></label>
                            <div class="col-12">
                                <input type="text" class="form-control form-control-sm" name="pyrNm" id="pyrNm" th:value="${resveReqst.pyrNm}">
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group required">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="dpstAmt"><strong>입금금액</strong></label>
                            <div class="d-flex align-items-center">
                                <div class="col">
                                    <input type="text" class="form-control form-control-sm" name="dpstAmt" id="dpstAmt" th:value="${resveReqst.dpstAmt}">
                                </div>
                                <span class="ps-2">원</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-6 mb-3">
                        <div class="mb-0 form-group required">
                            <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="dpstDe"><strong>입금일</strong></label>
                            <div class="col-12">
                                <input type="date" class="form-control form-control-sm" name="dpstDe" id="dpstDe" th:value="${resveReqst.dpstDe}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <th:block th:if ="${resveReqst.stlmSttsCd} == '161103' or ${resveReqst.stlmSttsCd} == '161104'">
                <!-- 환불요청 or 환불완료 -->
                <!-- 환불정보 -->
                <div class="card-header p-t-0 p-b-0">
                    <h3 class="sub-title"><strong>환불정보</strong></h3>
                </div>
                <div class="card-block-small p-t-0">
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group required">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="rfndBankCd"><strong>환불계좌</strong></label>
                                <div class="row">
                                    <div class="col-3">
                                        <span kattr:select_code="rfndBankCd" id="rfndBankCd" grpCd="154" firstOptTxt="- 선택 -" th:attr="selectedCd=${resveReqst.rfndBankCd}" addClass="form-select form-select-sm form-control-sm" ></span>
                                    </div>
                                    <div class="col-6 px-0">
                                        <input type="text" class="form-control form-control-sm" name="rfndBacnt" id="rfndBacnt" th:value="${resveReqst.rfndBacnt}">
                                    </div>
                                    <div class="col-3">
                                        <input type="text" class="form-control form-control-sm" name="rfndPyrNm" id="rfndPyrNm" th:value="${resveReqst.rfndPyrNm}">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group required">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="rfndAmt"><strong>환불금액</strong></label>
                                <div class="d-flex align-items-center">
                                    <div class="col">
                                        <input type="text" class="form-control form-control-sm" name="rfndAmt" id="rfndAmt" th:value="${resveReqst.rfndAmt}">
                                    </div>
                                    <span class="ps-2">원</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-6 mb-3">
                            <div class="mb-0 form-group required">
                                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="rfndDe"><strong>환불일</strong></label>
                                <div class="col-12">
                                    <input type="date" class="form-control form-control-sm" name="rfndDe" id="rfndDe" th:value="${resveReqst.rfndDe}">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </th:block>
            <!-- 하단버튼 -->
            <div class="card-block-small">
                <button class="btn btn-disabled m-r-5" onclick="gridHelper2.toggleContent()">취소</button>
                <button type="submit" class="btn btn-primary" onclick="fn_updateResveReqst()">저장</button>
            </div>
            <!-- // -->
        </div>
    </div>

</form>

<script th:inline="javascript">

    var validator= $("#resveReqstUpdate").validate({
        onsubmit: false,
          rules: {
                 nopeAdult  : { number :true }
                , nopeChil  : { number :true }
                , nopeInfnt : { number :true }
                , utztnPrps : { required :true, maxlength: 100}
                , aplcntNm  : { required :true, maxlength: 10}
                , aplcntMoblphon  : { required :true, number :true, maxlength: 20}
                , aplcntEml  : { required :true, email :true, maxlength: 100}
                , pyrNm  : { required :true, maxlength: 10}
                , dpstAmt  : { required :true, maxlength: 10, number:true }
                , dpstDe  : { required :true}
                , rfndBankCd  : { required :true}
                , rfndBacnt  : { required :true ,maxlength: 20 }
                , rfndPyrNm  : { required :true ,maxlength: 10 }
                , rfndAmt  : { required :true ,maxlength: 20 ,number:true}
                , rfndDe  : { required :true}
                
            },
            messages: {
                 nopeAdult  : { number :"숫자만 입력 가능합니다." }
                , nopeChil  : { number :"숫자만 입력 가능합니다." }
                , nopeInfnt : { number :"숫자만 입력 가능합니다." }
                , utztnPrps : { required :"이용목적을 입력해주세요" ,maxlength: "이용목적은 100자 이하여야 합니다."}
                , aplcntNm  : { required :"신청자명을 입력해주세요" ,maxlength: "신청자명은 10자 이하여야 합니다."}
                , aplcntMoblphon  : { required : "휴대전화번호를 입력해주십시오", number : "숫자만 입력 가능합니다.", maxlength : "20자리 미만이어야 합니다." }
                , aplcntEml  : { required : "이메일을 입력해주십시오.", email:"올바른 이메일 형식이 아닙니다." , maxlength : "100자 미만이어야 합니다."}
                , pyrNm   : { required :"입금자명을 입력해주십시오.", maxlength : "입금자명은 10자 이하여야 합니다." }
                , dpstAmt : { required :"입금금액을 입력해주십시오.", maxlength: "입금금액은 10자리 이하입니다." , number :"숫자만 입력 가능합니다." }
                , dpstDe : { required :"입금 일자를 입력해주십시오."}
                , rfndBankCd : { required :"환불 일자를 선택해주십시오."}
                , rfndBacnt : { required :"환불계좌를 입력해주십시오." , maxlength: "환불계좌는 20자리 이하입니다." }
                , rfndPyrNm : { required :"환불계좌 예금주명를 입력해주십시오." , maxlength: "환불계좌 예금주명은 10자리 이하입니다." }
                , rfndAmt : { required :"환불 금액을 입력해주십시오." , maxlength: "환불 금액은 10자리 이하입니다." , number :"숫자만 입력 가능합니다." }
                , rfndDe : { required :"환불 일자를 입력해주십시오."}
                
            }
    })
    
    // 데이터 submit
    function fn_updateResveReqst(){
        
        if(!($("#resveReqstUpdate").valid())) return;

    	var nopeAdult = Number($("#nopeAdult").val());
    	var nopeChil  = Number($("#nopeChil" ).val());
    	var nopeInfnt = Number($("#nopeInfnt").val());
    	
        if((nopeAdult+nopeChil+nopeInfnt) <= 0 ){
            alert("이용 인원을 입력해주십시오.");
            showErrorMark("#nopeAdult");
            showErrorMark("#nopeChil" );
            showErrorMark("#nopeInfnt");
            return;
        }
        
        if(!confirm("저장하시겠습니까?")) return;

        let data =  $("#resveReqstUpdate").serialize() ;

        if(displayWorkProgress()){
            $.ajax({
                url : "/mng/resveReqst/updateResveReqst.do",
                type: 'POST',
                cache : false,
                dataType: 'json',
                data : data,
                success : function (data){
                    if(data.result=="success"){
                        alert(data.msg);
                        gridHelper2.resetPageContent();
                    }else{
                        alert(data.msg);
                    }
                    closeWorkProgress();
                }
            });
        }
    }
</script>

