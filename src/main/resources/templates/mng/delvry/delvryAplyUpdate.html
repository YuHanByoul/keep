<form id ="delvryAplyUpdateForm">
    <input type="hidden" name="delvryAplyid" th:value="${delvryAplyInfo.delvryAplyid}" />
    <div class="card">
        <div class="card-header p-b-0">
            <div class="sub-title">
                <div class="row align-items-end">
                    <div class="col">
                        <strong>신청정보</strong>
                    </div>
                    <div class="col-auto btn-group-sm">
                        <button type="button" class="btn btn-primary" onclick="delvryAplyUpdate.onDelvryAplyPopup();">교부신청서</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-block-small p-t-0">
            <div class="row">
                <div class="col-12 col-md-6 col-lg-3 mb-3">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>접수번호</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" id="" placeholder="" th:value="${delvryAplyInfo.rcptno}" readonly>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-md-6 col-lg-3 mb-3">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>기관명</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" id="" placeholder="" th:value="${delvryAplyInfo.instNm}" readonly>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-lg-6 mb-3">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1"><strong>프로그램명/동아리명</strong></label>
                        <div class="col-12">
                            <th:block th:if="${delvryAplyInfo.clubNm != null}">
                                <input type="text" class="form-control form-control-sm" id="" placeholder="" th:value="${delvryAplyInfo.prgrmNm + '(' + delvryAplyInfo.clubNm + ')'}" readonly>
                            </th:block>
                            <th:block th:unless="${delvryAplyInfo.clubNm != null}">
                                <input type="text" class="form-control form-control-sm" id="" placeholder="" th:value="${delvryAplyInfo.prgrmNm}" readonly>
                            </th:block>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12 col-md-6 col-lg-3 mb-3">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>신청자</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" id="" placeholder="" th:value="${delvryAplyInfo.aplcntNm}" readonly>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-md-6 col-lg-3 mb-3">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>사업기간</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" th:value="${#dates.format(delvryAplyInfo.bsnsBgngDe, 'yyyy-MM-dd HH:mm:ss') + ' ~ ' + #dates.format(delvryAplyInfo.bsnsEndDe, 'yyyy-MM-dd HH:mm:ss')}" disabled>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-md-6 col-lg-3 mb-3">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>교부신청일</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" id="" th:value="${#dates.format(delvryAplyInfo.regDt, 'yyyy-MM-dd HH:mm:ss')}" readonly>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-md-6 col-lg-3 mb-3">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>지원신청금액(원)</strong></label>
                        <div class="col-sm-12">
                            <input type="text" class="form-control form-control-sm" id="" placeholder="" th:value="${delvryAplyInfo.totAmt}" readonly>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-12 col-lg-6 mb-3">
                    <div class="mb-0 row form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="depositorMoneyInfo2"><strong>송금은행 계좌번호</strong></label>
                        <div class="col-12 row m-r-0 m-l-0">
                            <div class="col-3 p-l-0 p-r-0">
                                <span  kattr:select_code="bankCd" th:attr="grpcd=154, selectedCd=${delvryAplyInfo.bankCd}" isAdmin="true"></span>
                            </div>
                            <div class="col-6 p-r-0">
                                <input type="text" class="form-control form-control-sm" name="bacntno" id="bacntno" placeholder="" th:value="${delvryAplyInfo.bacntno}"/>
                            </div>
                            <div class="col-3 p-r-0">
                                <input type="text" class="form-control form-control-sm" name="dpstrNm" id="dpstrNm" placeholder="" th:value="${delvryAplyInfo.dpstrNm}"/>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-md-6 col-lg-3 mb-3">
                    <div class="mb-0 form-group">
                        <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for=""><strong>교부상태</strong></label>
                        <div class="col-sm-12">
                            <span  kattr:select_code="delvrySttsCd" th:attr="grpcd=202, selectedCd=${delvryAplyInfo.delvrySttsCd}" isAdmin="true" disabled></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-3 form-group">
                <label class="form-label col-sm-12 col-form-label p-t-0 pb-1" for="addFile"><strong>첨부파일</strong></label>
                <div class="col-12">
                   <input type="file" multiple id="delvryAplyAtchFile" name="delvryAplyAtchFile" class="form-control form-control-sm"/>
                </div>
                <div class="mt-2 row">
                    <div class="col-auto">
                        <th:block th:if = "${delvryAplyInfo.atchFilegrpid != null and delvryAplyInfo.atchFilegrpid != 0}">
                            <input type="hidden" id="atchFilegrpid" name="atchFilegrpid" th:value="${delvryAplyInfo.atchFilegrpid}"/>
                        </th:block>
                        <th:block th:unless = "${delvryAplyInfo.atchFilegrpid != null and delvryAplyInfo.atchFilegrpid != 0}">
                            <input type="hidden" id="atchFilegrpid" name="atchFilegrpid" th:value="0"/>
                        </th:block>
                        <!-- 파일 명 및 삭제 버튼 영역-->
                        <span id="delvryAplyAtchFileArea">
                            <th:block th:if = "${fileList} != null">
                                <th:block th:if = "${fileList} != null">
                                    <span th:each="item: ${fileList}" th:id="'delvryAplyAtchFile' + ${item.fileid}" class="label label-inverse">
                                        <th:block th:text = "${item.orginlFileNm}"></th:block>&nbsp;&nbsp;&nbsp;
                                        <a href="javascript:void(0);" onclick="delvryAplyUpdate.removeFile(this.getAttribute('spanid'), this.getAttribute('fileid'), this.getAttribute('fileIdntfcKey'));" th:spanid="'delvryAplyAtchFile' + ${item.fileid}" th:fileid="${item.fileid}" th:fileIdntfcKey="${item.fileIdntfcKey}" class="text-white">X</a>
                                    </span>
                                </th:block>
                            </th:block>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="card-header p-t-0 p-b-0">
            <h3 class="sub-title"><strong>산출내역서 입력</strong></h3>
        </div>
        <div class="card-block-small p-t-0">
            <div class="table-responsive">
                <!-- [CASE] 종교인, 생애주기, 학습공동체 -->
                <th:block th:if="${delvryAplyInfo.fldCd == '173101' or delvryAplyInfo.fldCd == '173102' or delvryAplyInfo.fldCd == '173103'}"> 
                <table class="table table-framed table-bordered">
                    <thead>
                    <tr class="border-bottom-inverse">
                        <th class="text-center v-middle" style="width: 120px;">항목</th>
                        <th class="text-center v-middle" style="width: 160px;">세부항목</th>
                        <th class="text-center v-middle" style="width: 150px;">금액(원)</th>
                        <th class="text-center v-middle">세부내역</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr data-expitm-cd="218102">
                        <th class="text-center v-middle" rowspan="10">일반수용비</th>
                        <td class="v-middle">활동비</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    <tr data-expitm-cd="218103">
                        <td class="v-middle">강사비</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    <tr data-expitm-cd="218104">
                        <td class="v-middle">회의비</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    <tr data-expitm-cd="218105">
                        <td class="v-middle">인쇄비 및 홍보비</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    <tr data-expitm-cd="218106">
                        <td class="v-middle">사무용품 구입비</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    <tr data-expitm-cd="218107">
                        <td class="v-middle">기타 운영비</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    <tr data-expitm-cd="218108">
                        <td class="v-middle">공공요금 및 제세</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    <tr data-expitm-cd="218109">
                        <td class="v-middle">임차료</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    <tr data-expitm-cd="218110">
                        <td class="v-middle">재료비</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    <tr data-expitm-cd="218111">
                        <td class="v-middle">일반용역비</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    <tr data-expitm-cd="218122">
                        <th class="text-center v-middle">여비</th>
                        <td class="v-middle">국내여비</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    <tr data-expitm-cd="218142">
                        <th class="text-center v-middle">반환금 등</th>
                        <td class="v-middle">일반관리비</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    </tbody>
                </table>
                </th:block>
                <!-- [CASE] 환경동아리 -->
                <th:block th:if="${delvryAplyInfo.fldCd == '173104'}">
                <table class="table table-framed table-bordered">
                    <thead>
                    <tr class="border-bottom-inverse">
                        <th class="text-center v-middle" style="width: 120px;">항목</th>
                        <th class="text-center v-middle" style="width: 160px;">세부항목</th>
                        <th class="text-center v-middle" style="width: 150px;">금액(원)</th>
                        <th class="text-center v-middle">세부내역</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr data-expitm-cd="218202">
                        <th class="text-center v-middle" rowspan="4">경비</th>
                        <td class="v-middle">강사비</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    <tr data-expitm-cd="218203">
                        <td class="v-middle">교육진행비</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    <tr data-expitm-cd="218204">
                        <td class="v-middle">운영경비</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    <tr data-expitm-cd="218205">
                        <td class="v-middle">여비</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    </tbody>
                </table>
                </th:block>
                <!-- [CASE] 그린캠퍼스 -->
                <th:block th:if="${delvryAplyInfo.fldCd == '173106'}">
                <table class="table table-framed table-bordered">
                    <thead>
                    <tr class="border-bottom-inverse">
                        <th class="text-center v-middle" style="width: 120px;">항목</th>
                        <th class="text-center v-middle" style="width: 160px;">세부항목</th>
                        <th class="text-center v-middle" style="width: 150px;">금액(원)</th>
                        <th class="text-center v-middle">세부내역</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr data-expitm-cd="218302">
                        <th class="text-center v-middle" rowspan="4">경비</th>
                        <td class="v-middle">물품구입비</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    <tr data-expitm-cd="218303">
                        <td class="v-middle">운영경비</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    <tr data-expitm-cd="218304">
                        <td class="v-middle">회의비</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    <tr data-expitm-cd="218305">
                        <td class="v-middle">여비</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    </tbody>
                </table>
                </th:block>
                <!-- [CASE] 교사학습공동체 -->
                <th:block th:if="${delvryAplyInfo.fldCd == '173105'}">
                <table class="table table-framed table-bordered">
                    <thead>
                    <tr class="border-bottom-inverse">
                        <th class="text-center v-middle" style="width: 120px;">항목</th>
                        <th class="text-center v-middle" style="width: 160px;">세부항목</th>
                        <th class="text-center v-middle" style="width: 150px;">금액(원)</th>
                        <th class="text-center v-middle">세부내역</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr data-expitm-cd="218402">
                        <th class="text-center v-middle" rowspan="7">경비</th>
                        <td class="v-middle">강사비</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="amt">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    <tr data-expitm-cd="218403">
                        <td class="v-middle">여비</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    <tr data-expitm-cd="218404">
                        <td class="v-middle">물품구입비</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    <tr data-expitm-cd="218405">
                        <td class="v-middle">임차비</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    <tr data-expitm-cd="218406">
                        <td class="v-middle">회의비</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    <tr data-expitm-cd="218407">
                        <td class="v-middle">우편료</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    <tr data-expitm-cd="218408">
                        <td class="v-middle">여비</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    </tbody>
                </table>
                </th:block>
                <!-- [CASE] 환경교육 우수학교 지정 -->
                <th:block th:if="${delvryAplyInfo.fldCd == '173107'}">
                <table class="table table-framed table-bordered">
                    <thead>
                    <tr class="border-bottom-inverse">
                        <th class="text-center v-middle" style="width: 120px;">항목</th>
                        <th class="text-center v-middle" style="width: 160px;">세부항목</th>
                        <th class="text-center v-middle" style="width: 150px;">금액(원)</th>
                        <th class="text-center v-middle">세부내역</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr data-expitm-cd="218502">
                        <th class="text-center v-middle">교육비</th>
                        <td class="v-middle">교육비</td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm amt" name="" id="">
                        </td>
                        <td class="text-center v-middle">
                            <input type="text" class="form-control form-control-sm cn" name="" id="">
                        </td>
                    </tr>
                    </tbody>
                </table>
                <!-- // -->
                </th:block>
            </div>
        </div>
    
        <div class="card-block-small">
            <button type="button" class="btn btn-disabled" onclick="delvryAplyUpdate.offUpdateDelvryAply();">취소</button>
            <button type="button" class="btn btn-inverse" onClick="delvryAplyUpdate.onUpdateDelvryStts('202106');">교부취소</button>
            <button type="button" class="btn btn-inverse" onClick="delvryAplyUpdate.onUpdateDelvryStts('202105');">탈락</button>
            <button type="button" class="btn btn-primary" onClick="delvryAplyUpdate.onUpdateDelvryStts('202102');">확정</button>
            <button type="button" class="btn btn-primary" onclick="delvryAplyUpdate.onUpdateDelvryAply();">저장</button>
        </div>
    </div>
</form>

<div class="card">
    <div class="row p-20 p-b-0">
        <div class="col-12 col-md-8 mb-2 mb-md-0">
            <h5><strong>보완요청</strong></h5>
        </div>
        <div class="col-12 col-md-4 text-right">
            <button type="button" class="btn btn-primary" onclick="delvryAplyUpdate.onSplmntInsertPopup();">보완요청</button>
        </div>
    </div>
    <div class="card-block-small">
        <table id="splmntGrid" class="table-responsive"></table>
        <div id="splmntGrid" class="text-center"></div>
    </div>
</div>

<div class="modal fade" id="delvryAplyPopup" aria-hidden="true" data-bs-backdrop="static"></div>
<div class="modal fade" id="splmntInsertPopup" aria-hidden="true" data-bs-backdrop="static"></div>
<div class="modal fade" id="splmntUpdatePopup" aria-hidden="true" data-bs-backdrop="static"></div>

<script th:inline="javascript">
    var delvryAplyUpdate = {
        delvryAplyInfo: /*[[${delvryAplyInfo}]]*/
        , computList: /*[[${computList}]]*/
        , listUrl: "/mng/delvry/selectDelvryAplySplmntList.do"
        
        , init: function() {
            splmntGrid = new GridHelper("splmntGrid");
            
            this.setValid();
            this.setComputList();
            this.setGrid();
            this.registEvent();
        }
        
        , registEvent: function() {
            $("#delvryAplyAtchFile").on("change", function(e) {
                var fileInput = e.target;
                var inputid = $(e.target).attr("id");
                var grpid = "atchFilegrpid";
                var fileid = "delvryAplyAtchFile";
                var areaid = "delvryAplyAtchFileArea";
                var formData = new FormData();
                for(var i = 0; i < fileInput.files.length; i++) {
                    formData.append("files", fileInput.files[i]);
                }
                formData.append("filegrpNm", inputid);
                formData.append("filegrpid", $("#" + grpid).val());
                if(displayWorkProgress()) {
                    $.ajax({
                        url: '/uploadMultipleFiles.do'
                        , processData: false
                        , contentType: false
                        , data: formData
                        , type: "POST"
                        , success: function(response) {
                            if(response.result == "fail") {
                                alert(response.msg);
                            } else {
                                if($("#" + grpid).val() == "0" || $("#" + grpid).val() == "" || $("#" + grpid).val() == null) {
                                    $("#" + grpid).val(response[0].filegrpid);
                                }
                                var displayFile = "";
                                for(var i = 0; i < response.length; i++) {
                                    displayFile = '<span id="' + inputid + response[i].fileid + '" class="label label-inverse">' + response[i].orginlFileNm;
                                    displayFile += ' &nbsp;&nbsp;&nbsp;<a href="javascript:delvryAplyUpdate.removeFile(' + "'" + inputid + response[i].fileid + "', "; 
                                    displayFile += response[i].fileid + ", '" + response[i].fileIdntfcKey + "'" + ');" class="text-white">X</a>';
                                    displayFile += '</span>';
                                    $("#" + areaid).append(displayFile);                                    
                                }
                            }
                            delvryAplyUpdate.initFileInput(inputid);
                            closeWorkProgress();
                        }
                    });
                }
            });
        }
        
        , initFileInput: function(inputid) {
            if(detectBrowser() == "other") {
                $("#" + inputid).val("");
            } else {
                $("#" + inputid).replaceWith($("#" + inputid).clone(true));
            }
        }
        
         , removeFile: function(inputid, fileid, fileIdntfcKey) {
            $("#" + inputid).remove();
            delvryAplyUpdate.deleteFile(fileid, fileIdntfcKey);
        }
        
        , deleteFile: function(fileid, fileIdntfcKey) {
            var path = "/deleteFile.do?fileid=" + fileid + "&file_idntfc_key=" + fileIdntfcKey;
            $.ajax({
                url: path
                , type: "GET"
                , cache: false
                , dataType: "json"
                , success: function(result) {
                }
                , error: function(error) {
                }
            });
        }
        
        , setComputList: function() {
            var len = this.computList.length;
            if(len > 0) {
                for(var i = 0; i < len; i++) {
                    var data = this.computList[i];
                    var tr = $("[data-expitm-cd=" + data.expitmCd + "]");
                    tr.attr("data-computid", data.computid);
                    tr.find(".amt").val(data.amt);
                    tr.find(".cn").val(data.cn);
                }
            }
        }
        
        , setValid: function() {
            var validator = $('#delvryAplyUpdateForm').validate({
                rules: {
                    bacntno: {maxlength: 30}
                    , dpstrNm: {maxlength: 10}
                }
                , messages: {
                    bacntno: {maxlength: "계좌번호는 30자 이하여야 합니다."}
                    , dpstrNm: {maxlength: "예금주명은 10자 이하여야 합니다."}
                }
            });
            jQuery.validator.addClassRules({
                amt: {digits: true}
            });
            jQuery.validator.addClassRules({
                cn: {maxlength: 100}
            });
        }
        
        , onUpdateDelvryAply: function() {
            if(!$("#delvryAplyUpdateForm").valid()) return;
            if(!($(".amt").valid())) return;
            if(!($(".cn").valid())) return;
            var param = $("#delvryAplyUpdateForm").serialize();
            var count = 0;
            $("[data-expitm-cd]").each(function(index, item) {
                var amt = $(this).find(".amt").val() || 0;
                var cn = $(this).find(".cn").val();
                var computid = $(this).attr("data-computid") || 0;
                var expitmCd = $(this).attr("data-expitm-cd");
                param += "&computList[" + count + "].computid=" + computid;
                param += "&computList[" + count + "].expitmCd=" + expitmCd;
                param += "&computList[" + count + "].amt=" + amt;
                param += "&computList[" + count + "].cn=" + cn;
                param += "&computList[" + count + "].ordr=" + (index + 1);
                param += "&computList[" + count + "].delvryAplyid=" + $("input[name='delvryAplyid']").val();
                count += 1;
            });
            if(displayWorkProgress()) {
                $.ajax({
                    url : "/mng/delvry/updateDelvryAply.do",
                    type: "POST",
                    cache: false,
                    dataType: "json",
                    data: param,
                    success: function(response) {
                        if(response.result == "success") {
                            alert(response.msg);
                            aplyGrid.resetPageContent();
                        } else {
                            alert(response.msg);
                        }
                        closeWorkProgress();
                    }
                });
            }
        }
        
        , setGrid: function() {
            $("#splmntGrid").jsGrid({
                    height: "auto",
                    width: "100%",
                    autoload: true,
                    sorting: false,
                    paging: true,
                    pagerContainer: "#splmntPager",
                    pagerFormat: "{first} {prev} {pages} {next} {last}",
                    pagePrevText: "이전",
                    pageNextText: "다음",
                    pageFirstText: "< 처음 ㅣ",
                    pageLastText: "ㅣ 마지막 >",
                    noDataContent: "데이터가 없습니다.",
                    pageSize: 10,
                    pageButtonCount: 10,
                    pageLoading: true,
                    pageIndex: 1,
                    controller: {
                        loadData: function(filter) {
                            var data = $.Deferred();
                            var params = {
                                "delvryAplyid": $("input[name='delvryAplyid']").val(),
                                "pageNumber": filter.pageIndex,
                                "rowPerPage": filter.pageSize,
                                "orderField": "REG_DT",
                                "orderDirection": "desc"
                            };
                            $.ajax({
                              type: "GET",
                              contentType: "application/json; charset=utf-8",
                              url: delvryAplyUpdate.listUrl,
                              data: params,
                              dataType: "json"
                            }).done(function(response) {
                                var da = {
                                    data : escapeGridData(response.list),
                                    itemsCount : response.totalCount
                                };
                                data.resolve(da);
                            });
                            
                            return data.promise();
                        }
                    },
                    fields: [
                        {title: "No.", name: "rowNumber", type: "number", width: "80", align: "center", sorting: false}
                        , {title: "상태", name: "ansSttsCdNm", type: "text", width: "150", align: "center"}
                        , {title: "요청내용", name: "dmndCn", type: "text" , width: "300", align: "left"}
                        , {title: "요청일", name: "regDtStr", type: "text", align: "center", width: "80"}
                        , {title: "답변일", name: "ansDtStr", type: "number", align: "center", width: "80"}
                    ]
                    , rowClick: function(args) { 
                        if(args.event.originalEvent.target.cellIndex == 0 || isNaN(args.event.originalEvent.target.cellIndex)) return;
                        var splmntid = args.item.splmntid;
                        var sttsCd = args.item.ansSttsCd;
                        if(sttsCd == "201101") {
                            var url = "/mng/delvry/delvryAplySplmntUpdatePopup.html?splmntid=" + splmntid;
                            $("#splmntUpdatePopup").load(url, function(response, status, xhr) {
                                if(status == "success") {
                                    splmntUpdateModal = new bootstrap.Modal($("#splmntUpdatePopup"));
                                    splmntUpdateModal.show();
                                }
                            });
                        } else if(sttsCd == "201102") {
                            var url = "/mng/delvry/delvryAplySplmntUpdatePopup.html?splmntid=" + splmntid;
                            $("#splmntUpdatePopup").load(url, function(response, status, xhr) {
                                if(status == "success") {
                                    splmntUpdateModal = new bootstrap.Modal($("#splmntUpdatePopup"));
                                    splmntUpdateModal.show();
                                }
                            });                            
                        }
                    }
                });
        }
        
        , offUpdateDelvryAply: function() {
            aplyGrid.toggleContent();
        }
        
        , onUpdateDelvryStts: function(sttsCd) {
            if(!($("#delvryAplyUpdateForm").valid())) return;
            
            return false;
            var param = {updateDelvryAplyids: $("input[name='delvryAplyid']").val(), delvrySttsCd: sttsCd};
            if(displayWorkProgress()) {
                $.ajax({
                    url : "/mng/delvry/updateDelvryStts.do",
                    type: "POST",
                    cache: false,
                    dataType: "json",
                    data: param,
                    success: function(response) {
                        if(response.result == "success") {
                            alert(response.msg);
                            aplyGrid.resetPageContent();
                        } else {
                            alert(response.msg);
                        }
                        closeWorkProgress();
                    }
                });
            }
        }
        
        , onSplmntInsertPopup: function() {
            var url = "/mng/delvry/delvryAplySplmntInsertPopup.html";
            $("#splmntInsertPopup").load(url, function(response, status, xhr) {
                if(status == "success") {
                    splmntInsertModal = new bootstrap.Modal($("#splmntInsertPopup"));
                    splmntInsertModal.show();
                }
            });
        }
        
        , onDelvryAplyPopup: function() {
            var url = "/cmm/reporting/pcntstDelvryAply.html?id=" + delvryAplyUpdate.delvryAplyInfo.aplyid;
            window.open(url);
            /*
            var url = "/mng/delvry/delvryAplyPopup.html";
            $("#delvryAplyPopup").load(url, function(response, status, xhr) {
                if(status == "success") {
                    splmntInsertModal = new bootstrap.Modal($("#delvryAplyPopup"));
                    splmntInsertModal.show();
                }
            });
            */
        }
        
    };
    
    delvryAplyUpdate.init();
</script>