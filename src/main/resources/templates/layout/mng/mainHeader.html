<script type="text/javascript">

	function logout(){
		var f = document.logout_form;
		f.submit();
	}
	
	function changeRole(role){
		location.href = "/cmm/changeRole.do?afterRoleid=" + role;
	}
	
	window.onpageshow = function() { // 뒤로버튼을 통해 재진입시 역할셀렉드박스 재셋팅을 위해 리로드
        if ( event.persisted || (window.performance && window.performance.navigation.type == 2) ) {
            location.reload();
        }
    }

</script>
<nav class="navbar header-navbar pcoded-header">
    <div class="navbar-wrapper">

        <div class="navbar-logo">
            <a class="mobile-menu" id="mobile-collapse" href="#!">
                <i class="feather icon-menu"></i>
            </a>
            <div id="mobile-btn-back"></div>
            <a href="/">
                <img class="img-fluid" th:src="'/downloadLogo.do?fileid='+${session.site.logoFileid}+'&file_idntfc_key='+${session.site.logoFileIdntfcKey}" width="150" height="30" />
            </a>
            <span id="mobile-btn-search"></span>
            <a class="mobile-options">
                <i class="feather icon-more-horizontal"></i>
            </a>
        </div>

        <div class="navbar-container">
            <ul class="nav-left">
                <li>
                    <a href="#!" onclick="javascript:toggleFullScreen()" class="waves-effect waves-light">
                    <i class="full-screen feather icon-maximize"></i>
                </a>
                </li>
            </ul>
            <ul class="nav-right">
                <li>
                    <div class="col-12 mt-2">
                        <select onChange="changeRole(this.value)" class="form-select form-control" id="currentRole">
                        <th:block th:each="authority : ${session.user.authorities}">
                            <th:block th:if="${session.SPRING_SECURITY_CONTEXT.getAuthentication().getAuthorities().iterator().next().getAuthority() == authority.roleid}"> 
                                <option th:if="${authority.se_cd == 'A' and #arrays.contains(#strings.arraySplit(authority.allowed_siteids, ','), session.site.siteid)}" th:value="${authority.roleid}" selected><th:block th:text="${authority.nm}" /></option>
                            </th:block>
                            <th:block th:unless="${session.SPRING_SECURITY_CONTEXT.getAuthentication().getAuthorities().iterator().next().getAuthority() == authority.roleid}">
                                <option th:if="${authority.se_cd == 'A' and #arrays.contains(#strings.arraySplit(authority.allowed_siteids, ','), session.site.siteid)}" th:value="${authority.roleid}" ><th:block th:text="${authority.nm}" /></option>
                            </th:block>
                        </th:block>
                        </select>
                    </div>
                </li>
                <li class="user-profile header-notification">
                    <div class="dropdown-primary dropdown">
                        <div class="dropdown-toggle" data-bs-toggle="dropdown">
                            <span><th:block th:text="${session.user.nm}"></th:block></span>
                            <i class="feather icon-chevron-down"></i>
                        </div>
                        <ul class="show-notification profile-notification dropdown-menu"
                            data-dropdown-in="fadeIn" data-dropdown-out="fadeOut">
                            <li>
                                <a href="javascript:logout()">
                                    <i class="feather icon-log-out"></i> Logout
                                </a>
                            </li>
                        </ul>

                    </div>
                </li>
            </ul>
        </div>
    </div>
</nav>
<form name="logout_form" th:action="@{/logout}" method="post" onsubmit="return false">
</form>