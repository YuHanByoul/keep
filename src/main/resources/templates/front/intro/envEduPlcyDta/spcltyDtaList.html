<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="layout/front/subLayout">

<div layout:fragment="content">
    <form class="search-filter" id="searchForm" name="searchForm" method="get">
        <div class="form-input-wrap">
            <div class="form-row">
                <div class="form-header"><strong class="label">검색어</strong></div>
                <div class="form-body">
                    <div class="form-input">
                        <select title="검색어" id="searchType" name="searchType">
                            <option value="">- 전체 -</option>
                            <option value="ttl">제목</option>
                            <option value="cn">내용</option>
                        </select>
                        <input type="search" title="검색어" placeholder="제목을 입력해 주세요." id="searchKeyword" name="searchKeyword">
                    </div>
                </div>
            </div>
            <div class="form-row">
                <div class="form-header"><strong class="label">저자</strong></div>
                <div class="form-body">
                    <input type="search" title="저자" placeholder="저자를 입력해 주세요." id="writr" name="writr">
                </div>
            </div>
            <div class="form-row">
                <div class="form-header"><strong class="label">발행년도</strong></div>
                <div class="form-body">
                    <div class="form-input">
                        <input type="date" title="시작일" id="searchFromRegDt" name="searchFromRegDt">
                        <div class="bul">~</div>
                        <input type="date" title="종료일" id="searchToRegDt" name="searchToRegDt">
                    </div>
                </div>
            </div>
            <div class="form-row">
                <div class="form-header"><strong class="label">분류</strong></div>
                <div class="form-body">
                    <th:block kattr:select_code="searchClsfCd" grpCd="228" firstOptTxt="- 전체 - "/>
                </div>
            </div>
        </div>
        <div class="search-filter-submit">
            <button type="reset" class="btn-medium btn-gray btn-before-refresh">초기화</button>
            <button type="submit" class="btn-medium btn-green btn-before-search">검색</button>
        </div>

        <input type="hidden" id="orderField" name="orderField" value="reg_dt">
        <input type="hidden" id="rowPerPage" name="rowPerPage" value="10">
        <input type="hidden" id="dtaid" name="dtaid">
        <input type="hidden" id="pageNumber" name="pageNumber" >
    </form>

    <div class="table-caption flex-nowrap">
        <div class="left">
            <p>총 <b id="totalCount">0</b> 건</p>
        </div>
        <div class="right">
            <select title="글 보기 개수" id="selectRowPerPage" name="selectRowPerPage" onchange="onChangePageSize($(this).val(), selectList);">
                <option value="10">10개씩 보기</option>
                <option value="50">50개씩 보기</option>
                <option value="100">100개씩 보기</option>
            </select>
        </div>
    </div>

    <div class="pc-only">
        <div class="table-col table-layout-auto table-col-mo">
            <table>
                <caption>전문자료 - 번호, 분류, 제목, 발행년도, 저자, 등록일, 조회수</caption>
                <colgroup>
                    <col>
                    <col style="width:10%">
                    <col style="width:40%;">
                    <col style="width:10%">
                    <col style="width:15%">
                    <col>
                </colgroup>
                <thead>
                <tr>
                    <th scope="col">번호</th>
                    <th scope="col">분류</th>
                    <th scope="col">제목</th>
                    <th scope="col">발행년도</th>
                    <th scope="col">저자</th>
                    <th scope="col">등록일</th>
                    <th scope="col">조회수</th>
                </tr>
                </thead>
                <tbody id="pcListArea">
                </tbody>
            </table>
        </div>
    </div>

    <div class="mo-only">
        <div class="table-list">
            <ul id="moListArea">
            </ul>
        </div>
    </div>


    <div id="pagination" aria-label="pagination" />

    <script th:inline="javascript">
        const listUrl = '/front/intro/envEduPlcyDta/selectSpcltyDtaList.do';
        const detailUrl = '/front/intro/envEduPlcyDta/spcltyDtaDetail.html';
        const searchVo = /*[[${searchVo}]]*/null;

        $(function () {
            $('#searchClsfCd').val(searchVo.searchClsfCd);
            $('#searchType').val(searchVo.searchType);
            $('#searchKeyword').val(searchVo.searchKeyword);
            $('#writr').val(searchVo.writr);
            $('#searchFromRegDt').val(searchVo.searchFromRegDt);
            $('#searchToRegDt').val(searchVo.searchToRegDt);
            $('#rowPerPage').val(searchVo.rowPerPage);
            $('#selectRowPerPage').val(searchVo.rowPerPage);
            $('#pageNumber').val(searchVo.pageNumber);

            selectList();

            $('#searchForm').on('submit', function (e) {
                e.preventDefault();
                selectList();
            });

        });

        let selectList = () => {
            if (displayWorkProgress(true)) {
                $.ajax({
                    url: listUrl,
                    cache: false,
                    dataType: 'json',
                    data: $('#searchForm').serializeArray(),
                    type: 'GET',
                    success: function (response) {
                        let data = escapeData(response.list);

                        $('#pcListArea').html(makeListHtmlForPc(data));
                        $('#moListArea').html(makeListHtmlForMo(data));
                        $('#pagination').html(response.pagination);
                        $('#totalCount').html(response.totalCount);

                        closeWorkProgress();
                    }
                });
            }
        }

        let goToDetail = (dtaid) => {
            let f = document.forms.searchForm;
            f.dtaid.value = dtaid;
            f.action = detailUrl;
            f.submit();
        }
        let makeListHtmlForPc = (list) => {
            var html = "";
            if (list == null || list.length <= 0) {
                html += `<tr>
                            <td class="nodata" colspan="7">
                                <p><span class="icon icon-notice bg-black9"></span>등록된 전문자료가 없습니다.</p>
                            </td>
                        </tr>`;
            } else {
                list.forEach(function (item) {
                    html += `<tr>
                                <td>${item.rowNumber}</td>
                                <td><span class="ellipsis">${item.clsfCdNm}</span></td>
                                <td class="al article"><a class="link ellipsis" onclick="goToDetail(${item.dtaid})">${item.ttl}</a></td>
                                <td>${item.yy ?? ''}</td>
                                <td> <span class="ellipsis">${item.writr}</span></td>
                                <td>${item.regDt}</td>
                                <td>${item.hits}</td>
                            </tr>`;
                });
            }
            return html;
        }

        let makeListHtmlForMo = (list) => {
            var html = "";
            if (list == null || list.length <= 0) {
                html += `<li class="block">
                            <div class="nodata">
                                <p><span class="icon icon-notice bg-black9"></span>등록된 자료가 없습니다.</p>
                            </div>
                        </li>`;
            } else {
                list.forEach(function (item) {
                    html += `<li class="block">
                                <div class="tbody">
                                    <dl>
                                        <div class="list">
                                            <dt>번호</dt>
                                            <dd>${item.rowNumber}</dd>
                                        </div>
                                        <div class="list">
                                            <dt>분류</dt>
                                            <dd>${item.clsfCdNm}</dd>
                                        </div>
                                        <div class="list">
                                            <dt>제목</dt>
                                            <dd><a class="link ellipsis" onclick="goToDetail(${item.dtaid})">${item.ttl}</a></dd>
                                        </div>
                                        <div class="list">
                                            <dt>발행년도</dt>
                                            <dd>${item.yy ?? ''}</dd>
                                        </div>
                                        <div class="list">
                                            <dt>저자</dt>
                                            <dd>${item.writr}</dd>
                                        </div>
                                        <div class="list">
                                            <dt>등록일</dt>
                                            <dd>${item.regDt}</dd>
                                        </div>
                                        <div class="list">
                                            <dt>조회수</dt>
                                            <dd>${item.hits}</dd>
                                        </div>
                                    </dl>
                                </div>
                            </li>`;
                });
            }
            return html;
        }

    </script>
</div>