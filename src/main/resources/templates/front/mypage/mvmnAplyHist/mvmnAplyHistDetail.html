<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="layout/front/subLayout">

<div layout:fragment="content">
    <div class="table-caption flex-nowrap">
        <div class="left">
            <h3 class="sub-title">프로그램 정보</h3>
        </div>
        <div class="right d-flex a-center">
            <div class="toggleParent toggle-layer mr5">
                <button class="toggleTrigger mt0" title="툴팁">
                    <span class="icon icon-question"></span>
                    <span class="blind">
                        <span class="on" aria-hidden="false">툴팁 열기</span>
                        <span class="off" aria-hidden="true">툴팁 닫기</span>
                    </span>
                </button>
                <div class="toggle-layer-inner" style="">
                    <button class="toggleTrigger toggle-layer-close" title="레이어팝업 닫기"></button>
                    <dl>
                        <dt class="fs-16 fw-500 fc-black mb5">설문참여란?</dt>
                        <dd class="fs-14 fc-black6 mb15">회원님이 참여할 수 있는 설문입니다. <br> 설문 참여 후 ‘마이페이지 &gt; 설문조사 참여이력’ 페이지에서 참여한 설문을 확인하실 수 있습니다.</dd>
                        <dt class="fs-16 fw-500 fc-black mb5">설문공유란?</dt>
                        <dd class="fs-14 fc-black6 mb15">푸름이 이동환경교실 또는 유아환경교육관 교육에 참여한 학생들에게 설문 링크를 SMS 메시지로 공유할 수 있습니다.</dd>
                        <dt class="fs-16 fw-500 fc-black mb5">공유설문 결과란?</dt>
                        <dd class="fs-14 fc-black6 ">설문공유 기능을 통해 참여한 학생들의 설문 작성 결과를 확인할 수 있습니다.</dd>
                    </dl>
                </div>
            </div>
            <div class="btn-wrap mt0">
                <div class="left">
                    <button type="button" class="btn-small btn-blue" th:onclick="mvmnAplyHistDetail.onSrvySbmsnInsertPopup([[${mvmnAplyHistInfoVo.aplyid}]], [[${mvmnAplyHistInfoVo.aplcntDgstfnSrvyid}]], [[${mvmnAplyHistInfoVo.aplcntDgstfnQestnrid}]])">설문참여</button>
                    <button type="button" class="btn-small btn-outline-blue" th:onclick="mvmnAplyHistDetail.srvySendPopup([[${mvmnAplyHistInfoVo.aplyid}]], [[${mvmnAplyHistInfoVo.stdntDgstfnSrvyid}]], [[${mvmnAplyHistInfoVo.stdntDgstfnQestnrid}]])">설문공유</button>
                    <button type="button" class="btn-small btn-outline-blue" th:onclick="mvmnAplyHistDetail.srvyRsltPopup([[${mvmnAplyHistInfoVo.aplyid}]], [[${mvmnAplyHistInfoVo.stdntDgstfnSrvyid}]], [[${mvmnAplyHistInfoVo.stdntDgstfnQestnrid}]])">공유설문 결과</button>
                </div>
            </div>
        </div>
    </div>
    <form id="mvmnAplyHistForm" name="mvmnAplyHistForm" method="post">
        <div class="table-row">
            <table>
                <caption>프로그램 정보 - 프로그램, 권역/지역, 교육정원, 교육시간, 교육대상, 교육회차</caption>
                <colgroup>
                    <col style="width:140px;">
                    <col>
                    <col style="width:140px;">
                    <col>
                </colgroup>
                <tbody>
                    <tr>
                        <th scope="row">프로그램</th>
                        <td><th:block th:text="${mvmnAplyHistInfoVo.prgrmNm}"></th:block></td>
                        <th scope="row">권역/지역</th>
                        <td><th:block th:text="${mvmnAplyHistInfoVo.sareaNm}"></th:block></td>
                    </tr>
                    <tr>
                        <th scope="row">교육정원</th>
                        <td><th:block th:text="|${mvmnAplyHistInfoVo.eduNope}명|"></th:block></td>
                        <th scope="row">교육시간</th>
                        <td><th:block th:text="|${mvmnAplyHistInfoVo.eduHrMnt}분|"></th:block></td>
                    </tr>
                    <tr>
                        <th scope="row">교육대상</th>
                        <td><th:block th:text="${mvmnAplyHistInfoVo.trgtNm}"></th:block></td>
                        <th scope="row">교육회차</th>
                        <td><th:block th:text="|${mvmnAplyHistInfoVo.de}, ${mvmnAplyHistInfoVo.tmeNm}|"></th:block></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="table-caption">
            <h3 class="sub-title">신청 정보</h3>
        </div>
        <div class="table-row table-row-mo">
            <table>
                <caption>신청 정보 - 신청기관, 신청일, 신청기관, 전화번호, 신청자명, 휴대전화, 기관주소, 상세주소, 이메일, 기관 FAX번호, 교육대상, 총 교육인원, 비고</caption>
                <colgroup>
                    <col style="width:140px;">
                    <col>
                    <col style="width:140px;">
                    <col>
                </colgroup>
                <tbody>
                    <tr>
                        <th scope="row">신청상태</th>
                        <td><th:block th:text="${mvmnAplyHistRegVo.sttsNm}"></th:block></td>
                        <th scope="row">신청일</th>
                        <td><th:block th:text="${mvmnAplyHistRegVo.aplyDt}"></th:block></td>
                    </tr>
                    <tr>
                        <th scope="row">신청기관</th>
                        <td><th:block th:text="${mvmnAplyHistRegVo.instNm}"></th:block></td>
                        <th scope="row">전화번호</th>
                        <td><th:block th:text="${mvmnAplyHistRegVo.telno}"></th:block></td>
                    </tr>
                    <tr>
                        <th scope="row">신청자명</th>
                        <td><th:block th:text="${mvmnAplyHistRegVo.aplyUserNm}"></th:block></td>
                        <th scope="row">휴대전화</th>
                        <td><th:block th:text="${mvmnAplyHistRegVo.moblphon}"></th:block></td>
                    </tr>
                    <tr>
                        <th scope="row">기관주소</th>
                        <td><th:block th:text="${mvmnAplyHistRegVo.addr}"></th:block></td>
                        <th scope="row">상세주소</th>
                        <td><th:block th:text="${mvmnAplyHistRegVo.addrDtl}"></th:block></td>
                    </tr>
                    <tr>
                        <th scope="row">이메일</th>
                        <td><th:block th:text="${mvmnAplyHistRegVo.eml}"></th:block></td>
                        <th scope="row">기관 FAX번호</th>
                        <td><th:block th:text="${mvmnAplyHistRegVo.fxno}"></th:block></td>
                    </tr>
                    <tr>
                        <th scope="row">교육대상</th>
                        <td>
                            <div class="form-input">
                                <div class="form-check-list">
                                    <th:block th:each="item, stat : ${trgtList}">
                                       <label class="inp"><input type="checkbox" class="trgtCds" th:id="|trgtCd${stat.count}|" name="trgtCd" th:value="${item.TRGTCD}" th:checked="${item.TRGTCHK == 'checked'}" disabled><b><th:block th:text="${item.TRGTNM}"></th:block></b></label>
                                    </th:block>
                                </div>
                            </div>
                        </td>
                        <th scope="row">총 교육인원</th>
                        <td>
                            <div class="form-input mo-flex-wrap">
                                <div class="bul">총</div>
                                <input type="number" class="ar" title="총 교육인원" style="flex:0 0 50px;width:50px;" th:value="${mvmnAplyHistRegVo.eduNope}" readonly>
                                <div class="bul">명</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th scope="row">비고</th>
                        <td colspan="3">
                            <textarea title="비고" placeholder="요청사항 또는 특이사항이 있으시면, 여기에 남겨주세요." readonly><th:block th:text="${mvmnAplyHistRegVo.rmrk}"></th:block></textarea>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="btn-wrap">
            <div class="right">
                <th:block th:if="${(mvmnAplyHistRegVo.sttsCd == '180101' || mvmnAplyHistRegVo.sttsCd == '180102' || mvmnAplyHistRegVo.sttsCd == '180103')}">
                    <a href="javascript:void(0)" class="fc-black6 fs-14 fw-300 underline" th:onclick="mvmnAplyHistDetail.cancelAply('[[${mvmnAplyHistInfoVo.aplyid}]]',[[${mvmnAplyHistRegVo.sttsCd}]])">신청취소</a>
                </th:block>
            </div>
        </div>
        <div class="btn-wrap">
            <div class="center">
                <button type="button" class="btn-medium btn-gray" onclick="mvmnAplyHistDetail.moveToList()">목록</button>
            </div>
        </div>
    </form>
    <form id="listForm" th:action="@{/}" method="get" onsubmit="return false;">
        <input type="hidden" id="pageNumber" name="pageNumber" th:value="${mvmnAplyHistVo.pageNumber}">
        <input type="hidden" id="rowPerPage" name="rowPerPage" th:value="${mvmnAplyHistVo.rowPerPage}">
        <input type="hidden" id="searchPrgrmNm" name="searchPrgrmNm" th:value="${mvmnAplyHistVo.searchPrgrmNm}">
        <input type="hidden" id="orderField" name="orderField" th:value="${mvmnAplyHistVo.orderField}">
        <input type="hidden" id="aplyid" name="aplyid" th:value="${mvmnAplyHistInfoVo.aplyid}">
        <input type="hidden" id="prgrmNm" name="prgrmNm" th:value="${mvmnAplyHistVo.prgrmNm}">        
    </form>
    <!-- layerpopup -->
    <div class="layer-popup layer-large" data-layer-id="srvySendModalPopup">
        <div class="layer-dimmed" title="레이어팝업 닫기"></div>
        <div class="layer-wrap" id="srvySendModalPopup">
        </div>
    </div>
    <!-- layerpopup -->
    <div class="layer-popup layer-large" data-layer-id="srvyRsltModalPopup">
        <div class="layer-dimmed" title="레이어팝업 닫기"></div>
        <div class="layer-wrap" id="srvyRsltModalPopup">
        </div>
    </div>    
    <script th:inline="javascript">
    /*<![CDATA[*/
        let mvmnAplyHistDetail = {
            listUrl: '/front/mypage/mvmnAplyHist/mvmnAplyHistListForm.html',
            cancelUrl: '/front/mypage/mvmnAplyHist/updateCancelMvmnAply.do',
            cancelAply(id, stat) {
               if ("180103" == stat || "180101" == stat) {
                   alert("신청을 취소할 수 없습니다. 관리자에게 문의하세요.");
                   return;
               } 
               if (!confirm('신청을 취소 하시겠습니까?')) return;
               if (displayWorkProgress(true)) {
                   $.ajax({
                       method: 'post',
                       url: mvmnAplyHistDetail.cancelUrl,
                       dataType: 'json',
                       data: {aplyid: id},
                       success: function (response) {
                           closeWorkProgress();
                           alert(response.msg);
                           if (response.success)
                               mvmnAplyHistDetail.submit(mvmnAplyHistDetail.listUrl);
                       }
                   })
               }
            },
            moveToList() {
                this.submit(this.listUrl);
            },

            submit(url) {
                let f = document.forms.listForm;
                f.action = url;
                f.submit();
            },
            onSrvySbmsnInsertPopup: function(aplyid, srvyid, qestnrid) {
                popupCenter({url: '/front/srvy/srvySbmsnInsertPopup.html?srvyid=' + srvyid + '&qestnrid=' + qestnrid+ '&mvmnPrgrmAplyid=' + aplyid, title: '설문조사', w: 1280, h: 1000, l: 0, t: 0});
            },
            
            srvySendPopup: function(aplyid, srvyid, qestnrid) {
                $("#srvySendModalPopup").load("/front/mypage/mvmnAplyHist/mvmnAplyHistSrvySendPopup.html?aplyid=" + aplyid + "&stdntDgstfnSrvyid=" + srvyid + "&stdntDgstfnQestnrid=" + qestnrid + "&prgrmNm=" + $("#prgrmNm").val(), function(response, status, xhr) {
                    if (status == "success") {
                        layerPopup.open({target:'srvySendModalPopup'});
                    }
                });
            },            
            srvyRsltPopup: function(aplyid, srvyid, qestnrid) {
                $("#srvyRsltModalPopup").load("/front/mypage/mvmnAplyHist/mvmnAplyHistSrvyRsltPopup.html?aplyid=" + aplyid + "&stdntDgstfnSrvyid=" + srvyid + "&stdntDgstfnQestnrid=" + qestnrid, function(response, status, xhr) {
                    if (status == "success") {
                        layerPopup.open({target:'srvyRsltModalPopup'});
                    }
                });
            }                  
        }
        /*]]>*/
    </script>
</div>

