<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="layout/front/subLayout">

<div layout:fragment="content">
    <form class="search-filter" id="searchForm" name="searchForm" onsubmit="return false;">
        <div class="form-input mo-flex-wrap">
            <strong class="label">프로그램</strong>
            <div class="form-input">
                <input type="search" id="searchPrgrmNm" name="searchPrgrmNm" title="프로그램" placeholder="프로그램명을 입력해주세요.">            
            </div>
            <div class="search-filter-submit">
                <button type="submit" class="btn-medium btn-green btn-before-search" onclick="mvmnAplyHist.onSearch();">검색</button>
                <button type="button" class="btn-medium btn-transparent btn-before-refresh" onclick="mvmnAplyHist.initSearch();">초기화</button>
            </div>
        </div>    
        <input type="hidden" id="aplyid" name="aplyid">
        <input type="hidden" id="operFomCd" name="operFomCd">
        <input type="hidden" id="tmeid" name="tmeid">
        <input type="hidden" id="tmeSchdlid" name="tmeSchdlid">
        <input type="hidden" id="pageNumber" name="pageNumber" value="1">
        <input type="hidden" id="rowPerPage" name="rowPerPage" value="10">
        <input type="hidden" id="orderField" name="orderField" value="REG_DT">
    </form>

    <div class="table-caption flex-nowrap">
        <div class="left">
            <p>총 <b id="total-count">0</b> 건</p>
        </div>
        <div class="right d-flex">
            <select title="글 보기 개수" id="selectRowPerPage" name="selectRowPerPage" class="sort-filter">
                <option value="10">10개</option>
                <option value="50">50개</option>
                <option value="100">100개</option>
            </select>
            <div><button type="button" class="btn-medium btn-outline-black" onclick="mvmnAplyHist.changeRowPerPage()" >보기</button></div>
        </div>
    </div>
    <div class="pc-only">
        <div class="table-col table-layout-auto">
            <table>
                <caption>푸름이이동환경교실 - 번호, 권역, 프로그램명, 운영형식, 교육일자, 회차, 신청상태, 신청일, 설문참여</caption>
                <colgroup>
                    <col>
                    <col>
                    <col style="width:25%;">
                    <col>
                    <col style="width:10%;">
                    <col>
                    <col>
                    <col>
                    <col>
                </colgroup>
                <thead>
                    <tr>
                        <th scoep="col">번호</th>
                        <th scoep="col">권역</th>
                        <th scoep="col">프로그램명</th>
                        <th scoep="col">운영형식</th>
                        <th scoep="col">교육일자</th>
                        <th scoep="col">회차</th>
                        <th scoep="col">신청상태</th>
                        <th scoep="col">신청일</th>
                        <th scoep="col">설문참여</th>
                    </tr>
                </thead>
                <tbody id="list-area">
                </tbody>
            </table>
        </div>
    </div>
    <div class="mo-only">
        <div class="table-list">
            <ul id="mo-list-area">
                <li class="block">
                    
                </li>
            </ul>
        </div>    

    <div class="pagination" aria-label="pagination" id="pagination">
    </div>

    <script th:inline="javascript">
        var mvmnAplyHist = {
            listUrl: '/front/mypage/mvmnAplyHist/selectMvmnAplyHistList.do',
            detailUrl: '/front/mypage/mvmnAplyHist/mvmnAplyHistDetail.html',
            searchVo: /*[[${searchVo}]]*/null,

            initSearch: function() {
                 $("#searchPrgrmNm").val("");
            },
            
            onSearch: function() {
                $("#pageNumber").val("1");
                mvmnAplyHist.selectMvmnAplyHistList();
            },

            changeRowPerPage() {
                $('#rowPerPage').val($('#selectRowPerPage').val());
                $("#pageNumber").val("1");
                mvmnAplyHist.selectMvmnAplyHistList();
            },

            moveToDetail(aplyid, tmeid, tmeSchdlid, operFomCd) {
                let f = document.forms.searchForm;
                f.aplyid.value = aplyid;
                f.operFomCd.value = operFomCd;
                f.tmeid.value = tmeid;
                f.tmeSchdlid.value = tmeSchdlid;
                f.action = this.detailUrl;
                f.submit();
            },

            selectMvmnAplyHistList() {
                if (displayWorkProgress(true)) {
                    $.ajax({
                        url: mvmnAplyHist.listUrl,
                        cache: false,
                        dataType: 'json',
                        data: $('#searchForm').serializeArray(),
                        type: 'GET',
                        success: function (data) {
                        	//var data = escapeData(data);
                            $("#list-area").html(mvmnAplyHist.makeListHtml(data.list));
                            $("#mo-list-area").html(mvmnAplyHist.makeListMoHtml(data.list));
                            $("#pagination").html(data.pagination);
                            $("#total-count").html(data.totalCount);
                            closeWorkProgress();
                        }
                    });
                }
            },

            makeListHtml(list) {
                let html = "";
                if (list == null || list.length <= 0) {
                    html += `<tr>
                                <td class="nodata" colspan="9">
                                    <p><span class="icon icon-notice bg-black9"></span>푸름이 이동환경교실 신청 이력이 없습니다.</p>
                                </td>
                            </tr>`;
                } else {
                    list.forEach(function (item) {
                        html += `<tr>
                                    <td>${item.rowNumber}</td>
                                    <td>${item.sareaNm}</td>
                                    <td class="al article">
                                        <a class="link ellipsis" href="javascript:mvmnAplyHist.moveToDetail(${item.aplyid}, ${item.tmeid}, ${item.tmeSchdlid}, ${item.operFomCd})">
                                            ${item.prgrmNm}
                                        </a>
                                    </td>
                                    <td>${item.operFomNm}</td>
                                    <td>${item.de}</td>
                                    <td>${item.tmeNm}</td>
                                    <td>${item.sttsNm}</td>
                                    <td>${item.regDt}</td><td>`;
                                    if(item.sttsCd == '180103'){
                                        if(item.canSrvy == 'Y'){
                                            // 현재날짜가 교육종료일인 경우
                                            if(item.submitSrvy == 'Y') {
                                                //설문 제출한 경우
                                                html += `<button type="button" class="btn-small btn-outline-black" onclick="infntAplyHist.onSrvySbmsnInfoPopup(${item.aplyid}, ${item.sbmsnid}, ${item.aplcntDgstfnSrvyid}, ${item.aplcntDgstfnQestnrid})">설문확인</button>`;
                                            } else {
                                                //설문 미제출한 경우
                                                html += `<button type="button" class="btn-small btn-outline-blue" onclick="infntAplyHist.onSrvySbmsnInsertPopup(${item.aplyid}, ${item.aplcntDgstfnSrvyid}, ${item.aplcntDgstfnQestnrid})">설문참여</button>`;
                                            }
                                        }
                                    }
                                    html += `</td>
                                </tr>`;
                    });
                }
                return html;
            },
            makeListMoHtml(list) {
                let moHtml = "";
                if (list == null || list.length <= 0) {
                    moHtml += `<li class="block"><div class="nodata">
                        <p><span class="icon icon-notice bg-black9"></span>푸름이 이동환경교실 신청 이력이 없습니다.</p>
                        </li></div>`;
                } else {
                    list.forEach(function (item) {
                        moHtml += `<li class="block"><div class="tbody"><dl>
                            <div class="list">
                                <dt>번호</dt>
                                <dd>${item.rowNumber}</dd>
                            </div>
                            <div class="list">
                                <dt>권역</dt>
                                <dd>${item.sareaNm}</dd>
                            </div>
                            <div class="list">
                                <dt>프로그램명</dt>
                                <dd><a class="link ellipsis" href="javascript:mvmnAplyHist.moveToDetail(${item.aplyid}, ${item.tmeid}, ${item.tmeSchdlid}, ${item.operFomCd})">${item.prgrmNm}</a></dd>
                            </div>
                            <div class="list">
                                <dt>운영형식</dt>
                                <dd>${item.operFomNm}</dd>
                            </div>
                            <div class="list">
                                <dt>교육일자</dt>
                                <dd>${item.de}</dd>
                            </div>
                            <div class="list">
                                <dt>회차</dt>
                                <dd>${item.tmeNm}</dd>
                            </div>
                            <div class="list">
                                <dt>신청상태</dt>
                                <dd>${item.sttsNm}</dd>
                            </div>
                            <div class="list">
                                <dt>신청일</dt>
                                <dd>${item.regDt}</dd>
                            </div>
                            </dl></div>
                            <div class="btn-wrap">
                            <div class="center">`;
                            if(item.sttsCd == '180103'){
                                if(item.canSrvy == 'Y'){
                                    // 현재날짜가 교육종료일인 경우
                                    if(item.submitSrvy == 'Y') {
                                        //설문 제출한 경우
                                        html += `<button type="button" class="btn-small btn-outline-black" onclick="infntAplyHist.onSrvySbmsnInfoPopup(${item.aplyid}, ${item.sbmsnid}, ${item.aplcntDgstfnSrvyid}, ${item.aplcntDgstfnQestnrid})">설문확인</button>`;
                                    } else {
                                        //설문 미제출한 경우
                                        html += `<button type="button" class="btn-small btn-outline-blue" onclick="infntAplyHist.onSrvySbmsnInsertPopup(${item.aplyid}, ${item.aplcntDgstfnSrvyid}, ${item.aplcntDgstfnQestnrid})">설문참여</button>`;
                                    }
                                }
                            }
                            moHtml += `
                            </div>
                            </div></li>`;

                    });
                }
                return moHtml;
            },
            onSrvySbmsnInsertPopup: function(aplyid, srvyid, qestnrid) {
                popupCenter({url: '/front/srvy/srvySbmsnInsertPopup.html?srvyid=' + srvyid + '&qestnrid=' + qestnrid + '&mvmnPrgrmAplyid=' + aplyid, title: '설문조사', w: 1280, h: 1000, l: 0, t: 0});
            },
            onSrvySbmsnInfoPopup: function(aplyid, sbmsnid, srvyid, qestnrid) {
                popupCenter({url: '/front/srvy/srvySbmsnInfoPopup.html?sbmsnid=' + sbmsnid + '&mvmnPrgrmAplyid=' + aplyid + '&srvyid=' + srvyid + '&qestnrid=' + qestnrid, title: '설문확인', w: 1280, h: 1000, l: 0, t: 0});
            }            
        };

        function goPage(num) {
            $("#pageNumber").val(num);
            mvmnAplyHist.selectMvmnAplyHistList();
        }

        $(function () {
            $("#pageNumber").val(mvmnAplyHist.searchVo.pageNumber);
            $("#searchPrgrmNm").val(mvmnAplyHist.searchVo.searchPrgrmNm);
            $('#rowPerPage').val(mvmnAplyHist.searchVo.rowPerPage);
            $('#selectRowPerPage').val(mvmnAplyHist.searchVo.rowPerPage);

            mvmnAplyHist.selectMvmnAplyHistList();
        })
    </script>
</div>
<body>