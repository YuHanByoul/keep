<div class="layer-header">
    <strong class="tit">쪽지 보내기</strong>
    <button type="button" class="btn-layer-close" title="레이어팝업 닫기" data-layer-close></button>
</div>
<form id="msgSendForm">
    <input type="hidden" id="trgtDelYn" name="trgtDelYn"/>
	<div class="layer-content">
	    <div class="form-group">
	        <dl>
	            <dt>받는 사람</dt>
	            <dd><input type="text" id="popMaskAcnt" title="받는 사람" placeholder="받는 사람 아이디를 입력해 주세요." value="" readonly></dd>
	        </dl>
	        <dl>
	            <dt>쪽지 내용</dt>
	            <dd>
	                <textarea id="cn" name="cn" title="쪽지 내용" placeholder="내용을 입력해주세요."></textarea>
	                <div class="check-wrap">
	                    <label class="inp"><input type="checkbox" id="trgtDelCheck" checked disabled><b>보낸 쪽지함에 저장</b></label>
	                    <div class="size"><span id="cnTextSize">0</span> / 1,000자</div>
	                </div>
	            </dd>
	        </dl>
	    </div>
	</div>
	</form>
<div class="layer-footer">
    <div class="btn-wrap">
        <div class="center">
            <button type="button" class="btn-medium btn-gray" data-layer-close>취소</button>
            <button type="button" class="btn-medium btn-green" onclick="msgSendPopup.msgSendProgress();">보내기</button>
        </div>
    </div>
</div>
<script th:inline="javascript">
    var msgSendPopup = {
        init: function() {
        	$("#popMaskAcnt").val(mymsgDetail.maskAcnt);
        }
        , msgSendProgress: function() {
            if(!$("textarea[name='cn']").val()) {
                alert("내용을 입력해주세요.");
                $("textarea[name='cn']").focus();
                return false;
            }
            if (!confirm('쪽지를 보내시겠습니까?')) return;
            $('#trgtDelCheck').prop("checked") ? $('#trgtDelYn').val("N") : $('#trgtDelYn').val("Y");
            
	        var param = $("#msgSendForm").serialize();
	        param += "&msgid=" + mymsgDetail.msgid+"&sendid=" + mymsgDetail.sendid;
	        
	        if(displayWorkProgress(true)) {
	            $.ajax({
	                url : "/front/mypage/mymsg/insertSendMsg.do"
	                , type: "POST"
	                , cache: false
	                , dataType: "json"
	                , data: param
	                , success: function(response) {
	                	var response = escapeData(response);
	                    if(response.result == "success") {
	                        alert(response.msg);
	                        $("[data-layer-id='msgSendPopup']").removeClass("active");
	                        //mymsgRecv.selectRecvMsgList();
	                        mymsgDetail.submit(mymsgDetail.listUrl);
	                    } else {
	                        alert(response.msg);
	                    }
	                    closeWorkProgress();
	                }
	            });
	        }
        }
        , onCheckLen: function() {
            var len = $("textarea[name='rvwCn']").val().length;
            $("#rvwCnLen").text(addComma3(len));
        }
    };
    
    $('#cn').keyup(function (e) {
        let content = $(this).val();
        if (content == '' || content.length == 0) {
            $('#cnTextSize').text('0');
        } else {
            $('#cnTextSize').text(content.length);
        }
        // 내용 text size 제한
        if (content.length > 1000) {
            $(this).val($(this).val().substring(0, 1000));
        };
    });        
    
    $(function() {
        msgSendPopup.init();
    });
</script>