<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="layout/front/subLayout">
<body>
	<div layout:fragment="content">
		<form id="mymsgForm" name="mymsgForm" method="post">
		    <input type="hidden" id="msgid" name="msgid" th:value="${mymsgInfoVo.msgid}">
		    <input type="hidden" id="sendid" name="sendid" th:value="${mymsgInfoVo.sendid}">
		    <input type="hidden" id="maskAcnt" name="maskAcnt" th:value="${mymsgInfoVo.maskAcnt}">
		    <div class="alarm-detail">
		        <div class="alarm-detail-header">
		            <div class="message">
		                <div class="sender">
		                    <dl>
		                        <dt>보낸사람</dt>
		                        <dd><th:block th:text="${mymsgInfoVo.maskAcnt}"></th:block></dd>
		                        <dt>수신일시</dt>
		                        <dd><th:block th:text="${mymsgInfoVo.regDt}"></th:block></dd>
		                    </dl>
		                </div>
		            </div>
		        </div>
		        <div class="alarm-detail-content">
		            <p style="word-wrap: break-word;"><th:block th:text="${mymsgInfoVo.cn}"></th:block></p>
		
		            <div class="btn-wrap">
		                <div class="center">
		                    <button type="button" class="btn-large btn-green" data-layer-href="layer-popup08" th:onclick="mymsgDetail.onMsgSendPopup([[${mymsgInfoVo.msgid}]])">답장</button>
		                </div>
		            </div>
		        </div>
		    </div>
		    <div class="btn-wrap">
		        <div class="center">
		            <button type="button" class="btn-medium btn-gray" onclick="mymsgDetail.delRecvMsg();">삭제</button>
		            <button type="button" class="btn-medium btn-gray" onclick="mymsgDetail.moveToList();">목록</button>
		        </div>
		    </div>
			<div class="layer-popup layer-medium" data-layer-id="msgSendPopup">
			    <div class="layer-dimmed" title="레이어팝업 닫기"></div>
			    <div class="layer-wrap" id="msgSendPopup">
			    </div>
			</div>
		    
	    </form>
	    <form id="listForm" th:action="@{/}" method="get" onsubmit="return false;">
	        <input type="hidden" id="pageNumber" name="pageNumber" th:value="${mymsgVo.pageNumber}">
	        <input type="hidden" id="rowPerPage" name="rowPerPage" th:value="${mymsgVo.rowPerPage}">
	        <input type="hidden" id="searchKeyword" name="searchKeyword" th:value="${mymsgVo.searchKeyword}">
	        <input type="hidden" id="orderField" name="orderField" th:value="${mymsgVo.orderField}">
	        <input type="hidden" id="msgid" name="msgid" th:value="${mymsgInfoVo.msgid}">
	    </form>
	    
	    <script th:inline="javascript">
	        var mymsgDetail = {
	            listUrl: '/front/mypage/mymsg/mymsgRecvListForm.html',
	            popUrl: '/front/mypage/mymsg/mymsgSendPopup.html',
	            delUrl: '/front/mypage/mymsg/updateUserDelMsg.do',
	            msgid: null,
	            sendid: null,
	            maskAcnt: null,
	            init: function() {
                },
 	            delRecvMsg: function() {
	               if (!confirm('쪽지를 삭제 하시겠습니까?')) return;
	               if (displayWorkProgress(true)) {
	                   $.ajax({
	                       method: 'post',
	                       url: mymsgDetail.delUrl,
	                       dataType: 'json',
	                       data: {msgid: $("#msgid").val()},
	                       success: function (response) {
	                           closeWorkProgress();
	                           alert(response.msg);
	                           if (response.success)
	                        	   mymsgDetail.submit(mymsgDetail.listUrl);
	                       }
	                   })
	               }
	            },
	            moveToList() {
	                this.submit(this.listUrl);
	            },
	            onMsgSendPopup: function(msgid) {
	            	this.msgid = msgid;
	            	this.sendid = $("#sendid").val();
	            	this.maskAcnt = $("#maskAcnt").val();
	                $("#msgSendPopup").empty();
	                $("#msgSendPopup").load(mymsgDetail.popUrl, function(response, status, xhr) {
	                    if(status == "success") {
	                        layerPopup.open({target:'msgSendPopup'});
	                    }
	                });
	            },
	            submit(url) {
	                let f = document.forms.listForm;
	                f.action = url;
	                f.submit();
	            }
	        }
            $(function() {
            	mymsgDetail.init();
            });

	    </script>
	</div>
</body>