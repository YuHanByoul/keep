<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="layout/front/subLayout">

<div layout:fragment="content">
	<div class="table-caption">
	    <h3 class="sub-title">프로그램 정보</h3>
	</div>
	<form id="infntAplyHistForm" name="infntAplyHistForm" method="post">
		<div class="table-row">
		    <table>
		        <caption>프로그램 정보 - 프로그램, 교육관, 교육정원, 교육시간, 교육대상, 교육회차</caption>
		        <colgroup>
		            <col style="width:140px;">
		            <col>
		            <col style="width:140px;">
		            <col>
		        </colgroup>
		        <tbody>
		            <tr>
		                <th scope="row">프로그램</th>
		                <td><th:block th:text="${infntAplyHistInfoVo.prgrmNm}"></th:block></td>
		                <th scope="row">교육관</th>
		                <td><th:block th:text="${infntAplyHistInfoVo.clssrmNm}"></th:block></td>
		            </tr>
		            <tr>
		                <th scope="row">교육정원</th>
		                <td><th:block th:text="|${infntAplyHistInfoVo.eduNope}명|"></th:block></td>
		                <th scope="row">교육시간</th>
		                <td><th:block th:text="|${infntAplyHistInfoVo.eduHrMnt}분|"></th:block></td>
		            </tr>
		            <tr>
		                <th scope="row">교육대상</th>
		                <td><th:block th:text="${infntAplyHistInfoVo.trgtNm}"></th:block></td>
		                <th scope="row">교육회차</th>
		                <td><th:block th:text="|${infntAplyHistInfoVo.de}, ${infntAplyHistInfoVo.tmeNm}|"></th:block></td>
		            </tr>
		            <tr>
		                <th scope="row">지역</th>
		                <td><th:block th:text="${infntAplyHistInfoVo.ctprvnNm}"></th:block></td>
		            </tr>
		        </tbody>
		    </table>
		</div>
		<div class="table-caption">
		    <h3 class="sub-title">신청 정보</h3>
		</div>
		<div class="table-row table-row-mo">
		    <table>
		        <caption>신청 정보 - 신청상태, 신청일, 신청기관, 전화번호, 신청자명, 휴대전화, 기관주소, 상세주소, 이메일, 교육대상, 총 교육인원, 인솔교사인원, 신청인 지역, 기타사항</caption>
		        <colgroup>
		            <col style="width:140px;">
		            <col>
		            <col style="width:140px;">
		            <col>
		        </colgroup>
		        <tbody>
		            <tr>
		                <th scope="row">신청상태</th>
		                <td><th:block th:text="${infntAplyHistRegVo.sttsNm}"></th:block></td>
		                <th scope="row">신청일</th>
		                <td><th:block th:text="${infntAplyHistRegVo.aplyDt}"></th:block></td>
		            </tr>
		            <tr>
		                <th scope="row">신청기관</th>
		                <td><th:block th:text="${infntAplyHistRegVo.instNm}"></th:block></td>
		                <th scope="row">전화번호</th>
		                <td><th:block th:text="${infntAplyHistRegVo.telno}"></th:block></td>
		            </tr>
		            <tr>
		                <th scope="row">신청자명</th>
		                <td><th:block th:text="${infntAplyHistRegVo.aplyUserNm}"></th:block></td>
		                <th scope="row">휴대전화</th>
		                <td><th:block th:text="${infntAplyHistRegVo.moblphon}"></th:block></td>
		            </tr>
		            <tr>
		                <th scope="row">기관주소</th>
		                <td><th:block th:text="${infntAplyHistRegVo.addr}"></th:block></td>
		                <th scope="row">상세주소</th>
		                <td><th:block th:text="${infntAplyHistRegVo.addrDtl}"></th:block></td>
		            </tr>
		            <tr>
		                <th scope="row">이메일</th>
		                <td><th:block th:text="${infntAplyHistRegVo.eml}"></th:block></td>
		                <th scope="row">교육대상</th>
		                <td>
		                    <div class="form-input">
		                        <div class="form-check-list">
                                    <th:block th:each="item, stat : ${trgtList}">
                                       <label class="inp"><input type="checkbox" class="trgtCds" th:id="|trgtCd${stat.count}|" name="trgtCd" th:value="${item.TRGTCD}" th:checked="${item.TRGTCHK == 'checked'}" readonly><b><th:block th:text="${item.TRGTNM}"></th:block></b></label>
		                            </th:block>
		                        </div>
		                    </div>
		                </td>
		            </tr>
		            <tr>
		                <th scope="row">총 교육인원</th>
		                <td>
		                    <div class="form-input mo-flex-wrap">
		                        <div class="bul">총</div>
		                        <input type="number" class="ar" title="총 교육인원" style="flex:0 0 50px;width:50px;" th:value="${infntAplyHistRegVo.eduNope}" readonly>
		                        <div class="bul">명</div>
		                    </div>
		                </td>
		                <th scope="row">인솔교사인원</th>
		                <td>
		                    <div class="form-input mo-flex-wrap">
		                        <div class="bul">총</div>
		                        <input type="number" class="ar" title="총 교육인원" style="flex:0 0 50px;width:50px;" th:value="${infntAplyHistRegVo.tcherNope}" readonly>
		                        <div class="bul">명</div>
		                    </div>
		                    <p class="desc fc-red">※ 유아 10명당 인솔교사 1명 필수 참석</p>
		                </td>
		            </tr>
		            <tr>
		                <th scope="row">신청인 지역</th>
		                <td colspan="3">
		                    <div class="form-input">
		                        <th:block kattr:select_code="ctprvnCd" title="신청인 지역" th:attr="grpCd=143,selectedCd=${infntAplyHistRegVo.ctprvnCd}"  readonly></th:block>
		                    </div>
		                </td>
		            </tr>
		            <tr>
		                <th scope="row">기타사항</th>
		                <td colspan="3">
		                    <textarea title="기타사항" placeholder="요청사항 또는 특이사항이 있으시면, 여기에 남겨주세요." readonly><th:block th:text="${infntAplyHistRegVo.etc}"></th:block></textarea>
		                </td>
		            </tr>
		        </tbody>
		    </table>
		</div>
		<div class="form-check-all">
		    <label class="inp"><input type="checkbox" th:checked="${infntAplyHistRegVo.towwayOnlnEduAgreYn == 'Y'}" readonly onclick="return false;"><b class="normal-wrap">쌍방향 온라인 시범교육 신청 동의(비동의 시 교육 선정 및 진행 불가)</b></label>
        </div>
        <div class="btn-wrap">
            <div class="right">
                <th:block th:if="${(infntAplyHistRegVo.sttsCd == '180101' || infntAplyHistRegVo.sttsCd == '180102' || infntAplyHistRegVo.sttsCd == '180103')}">
                    <a href="javascript:void(0)" class="fc-black6 fs-14 fw-300 underline" th:onclick="infntAplyHistDetail.cancelAply('[[${infntAplyHistInfoVo.aplyid}]]',[[${infntAplyHistRegVo.sttsCd}]])">신청취소</a>
                </th:block>
            </div>
        </div>
        <div class="btn-wrap">
            <div class="center">
                <button type="button" class="btn-medium btn-gray" onclick="infntAplyHistDetail.moveToList()">목록</button>
            </div>
        </div>
    </form>
    <form id="listForm" th:action="@{/}" method="get" onsubmit="return false;">
        <input type="hidden" id="pageNumber" name="pageNumber" th:value="${infntAplyHistVo.pageNumber}">
        <input type="hidden" id="rowPerPage" name="rowPerPage" th:value="${infntAplyHistVo.rowPerPage}">
        <input type="hidden" id="searchType" name="searchType" th:value="${infntAplyHistVo.searchType}">
        <input type="hidden" id="searchKeyword" name="searchKeyword" th:value="${infntAplyHistVo.searchKeyword}">
        <input type="hidden" id="orderField" name="orderField" th:value="${infntAplyHistVo.orderField}">
        <input type="hidden" id="aplyid" name="aplyid" th:value="${infntAplyHistInfoVo.aplyid}">
    </form>
    
    <script th:inline="javascript">
        let infntAplyHistDetail = {
            listUrl: '/front/mypage/infntAplyHist/infntAplyHistListForm.html',
            cancelUrl: '/front/mypage/infntAplyHist/updateCancelInfntAply.do',
            cancelAply(id, stat) {
               if ("180103" == stat || "180101" == stat) {
            	   alert("신청을 취소할 수 없습니다. 관리자에게 문의하세요.");
            	   return;
               } 
               if (!confirm('신청을 취소 하시겠습니까?')) return;
               if (displayWorkProgress(true)) {
                   $.ajax({
                       method: 'post',
                       url: infntAplyHistDetail.cancelUrl,
                       dataType: 'json',
                       data: {aplyid: id},
                       success: function (response) {
                           closeWorkProgress();
                           alert(response.msg);
                           if (response.success)
                        	   infntAplyHistDetail.submit(infntAplyHistDetail.listUrl);
                       }
                   })
               }
            },
            moveToList() {
                this.submit(this.listUrl);
            },

            submit(url) {
                let f = document.forms.listForm;
                f.action = url;
                f.submit();
            }
        }
    </script>
</div>

