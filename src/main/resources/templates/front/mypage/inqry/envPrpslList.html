<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="layout/front/subLayout">

<div layout:fragment="content">

    <form class="search-filter" id="searchForm" name="searchForm" onsubmit="return false;">
        <div class="form-input mo-flex-wrap">
            <strong class="label">제목 검색</strong>
            <div class="form-input">
                <input type="search" id="searchKeyword" name="searchKeyword" title="제목 검색" placeholder="검색어를 입력해 주세요.">
            </div>
            <div class="search-filter-submit">
                <button type="submit" class="btn-medium btn-green btn-before-search">검색</button>
                <button type="reset" class="btn-medium btn-transparent btn-before-refresh">초기화</button>
            </div>
        </div>
        <input type="hidden" id="pageNumber" name="pageNumber" value="1">
        <input type="hidden" id="orderField" name="orderField" value="REG_DT">
        <input type="hidden" id="prpslid" name="prpslid" value="0">
        <input type="hidden" id="rowPerPage" name="rowPerPage" value="10"/>
    </form>

    <div class="table-caption flex-nowrap">
        <div class="left">
            <p>총 <b id="total-count">0</b> 건</p>
        </div>
        <div class="right d-flex">
            <select title="글 보기 개수" id="selectRowPerPage" name="selectRowPerPage" onchange="changeRowPerPage()">
                <option value="10" selected>10개씩 보기</option>
                <option value="50">50개씩 보기</option>
                <option value="100">100개씩 보기</option>
            </select>
        </div>
    </div>

    <div class="pc-only">
        <div class="table-col table-layout-auto">
            <table>
                <caption>환경교육 제안 내역 - 번호, 분류, 제목, 상태, 공개여부, 등록일</caption>
                <colgroup>
                    <col style="width:10%;">
                    <col style="width:12%;">
                    <col>
                    <col style="width:12%;">
                    <col style="width:12%;">
                    <col style="width:12%;">
                </colgroup>
                <thead>
                <tr>
                    <th scope="col">번호</th>
                    <th scope="col">분류</th>
                    <th scope="col">제목</th>
                    <th scope="col">상태</th>
                    <th scope="col">공개여부</th>
                    <th scope="col">등록일</th>
                </tr>
                </thead>
                <tbody id="pcListArea">
                </tbody>
            </table>
        </div>
    </div>

    <div class="mo-only">
        <div class="table-list">
            <ul id="moListArea">
            </ul>
        </div>
    </div>

    <div class="pagination" aria-label="pagination" id="pagination">
    </div>


    <script th:inline="javascript">
        let listUrl = "/front/mypage/inqry/selectEnvPrpslList.do";
        let detailUrl = '/front/mypage/inqry/envPrpslDetail.html';
        let formUrl = '/front/mypage/inqry/envPrpslForm.html';
        let searchVo = /*[[${searchVo}]]*/null;

        function changeRowPerPage() {
            onChangePageSize($('#selectRowPerPage').val(), selectEnvPrpsList);
        };

        $(function () {

            $('#searchForm').on('submit', function (e) {
                e.preventDefault();

                $('#pageNumber').val(1);
                selectEnvPrpsList();
            });

            $("#pageNumber").val(searchVo.pageNumber);
            $("#searchKeyword").val(searchVo.searchKeyword);
            $('#rowPerPage').val(searchVo.rowPerPage);
            $('#selectRowPerPage').val(searchVo.rowPerPage);

            selectEnvPrpsList();
        });

        function selectEnvPrpsList() {

            if (displayWorkProgress(true)) {
                $.ajax({
                    url: listUrl,
                    cache: false,
                    dataType: 'json',
                    data: $('#searchForm').serializeArray(),
                    type: 'GET',
                    success: function (response) {
                        let data = escapeData(response.list);
                        $("#pcListArea").html(makeListHtmlForPc(data));
                        $("#moListArea").html(makeListHtmlForMo(data));
                        $("#pagination").html(response.pagination);
                        $("#total-count").html(response.totalCount);
                        closeWorkProgress();
                        msgAddBtn();
                    }
                });
            }
        }

        function makeListHtmlForPc(list) {
            let html = "";
            if (list == null || list.length <= 0) {
                html += `<tr>
                            <td class="nodata" colspan="6">
                                <p><span class="icon icon-notice bg-black9"></span>등록된 환경교육 제안이 없습니다.</p>
                            </td>
                        </tr>`;
            } else {
                list.forEach(function (item) {
                    html += `<tr>
                                <td>${item.rowNumber}</td>
                                <td>${item.clsfCdNm}</td>
                                <td class="al article"><a class="link ellipsis" href="javascript:moveToDetail(${item.prpslid})">
                                    ${item.prcsSttsCd == '113104' ? `<span class="box-tag tag-green">답변완료</span>` : ``}${item.ttl}</a></td>
                                <td>${item.prcsSttsCdNm}</td>
                                <td>${item.rlsYn == 'Y' ? '공개' : '비공개'}</td>
                                <td>${item.regDt}</td>
                            </tr>`;
                })
            }
            return html;
        }

        function makeListHtmlForMo(list) {
            let html = "";
            if (list == null || list.length <= 0) {
                html += `<li class="block">
                            <div class="nodata">
                                <p><span class="icon icon-notice bg-black9"></span>등록된 환경교육 제안이 없습니다.</p>
                            </div>
                        </li>`;
            } else {
                list.forEach(function (item) {
                    html += `
                            <li class="block">
                                <div class="tbody">
                                    <dl>
                                        <div class="list">
                                            <dt>번호</dt>
                                            <dd>${item.rowNumber}</dd>
                                        </div>
                                        <div class="list">
                                            <dt>분류</dt>
                                            <dd>${item.clsfCdNm}</dd>
                                        </div>
                                        <div class="list">
                                            <dt>제목</dt>
                                            <dd>
                                                <a href="javascript:moveToDetail(${item.prpslid})" class="link ellipsis">
                                                    ${item.prcsSttsCd == '113104' ? `<span class="box-tag tag-green">답변완료</span>` : ``}${item.ttl}
                                                </a>
                                            </dd>
                                        </div>
                                        <div class="list">
                                            <dt>상태</dt>
                                            <dd>${item.prcsSttsCdNm}</dd>
                                        </div>
                                        <div class="list">
                                            <dt>공개여부</dt>
                                            <dd>${item.rlsYn == 'Y' ? '공개' : '비공개'}</dd>
                                        </div>
                                        <div class="list">
                                            <dt>등록일</dt>
                                            <dd>${item.regDt}</dd>
                                        </div>
                                    </dl>
                                </div>
                            </li>`;
                });
            }
            return html;
        }

        function moveToDetail(prpslid) {
            let f = document.forms.searchForm;
            f.prpslid.value = prpslid;
            f.action = detailUrl;
            f.submit();
        }

        function goPage(num) {
            $("#pageNumber").val(num);
            selectEnvPrpsList();
        }
    </script>
</div>