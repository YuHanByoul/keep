<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
    xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
    layout:decorator="layout/front/subLayout" >
<body>
    <div layout:fragment="content">
        <form id="chgAplyDtlForm" name="chgAplyDtlForm" method="post">
            <input type="hidden" id="dmndid" name="dmndid" th:value="${chgSeeDsgnAplyInfo.dmndid}">
            <input type="hidden" id="sttsCd" name="sttsCd" th:value="${chgSeeDsgnAplyInfo.sttsCd}">
            <!-- content -->

            <div class="tab-content tab-sub dropDown">
                <button type="button" class="tab-mobile-trigger trigger"  aria-expanded="true">변경내역</button>
                <ul class="tab-list tab-list-pc target" >
                    <li class="tab"><a th:href="@{/front/mypage/seeDsgnDsctn/seeDsgnDsctnDetailForm.html}" >지정내역</a></li>
                    <li class="tab active"><a id="chgDsctnTab" th:href="@{/front/mypage/seeDsgnDsctn/chgSeeDsgnDsctnForm.html}" >변경내역</a></li>
                </ul>
            </div>

            <div class="table-caption">
                <div class="left">
                    <h3 class="sub-title">기본정보</h3>
                </div>
            </div>

            <div class="table-row">
                <table>
                    <caption>기본정보  - 접수번호, 시도, 지정번호, 기관명, 지정획득일</caption>
                    <colgroup>
                        <col style="width:140px;">
                        <col>
                        <col style="width:140px;">
                        <col>
                    </colgroup>
                    <tbody>
                        <tr>
                            <th scope="row">접수번호</th>
                            <td colspan="3">
                                <select id="aplyid" name="aplyid" value="" title="접수번호 선택" th:readonly="${chgSeeDsgnAplyInfo.sttsCd=='252101'}">
                                    <th:block th:if="${dsgnAplyList != null}" th:each="item, idx : ${dsgnAplyList}">
                                        <option th:if="${idx.count==1}"value="">선택</option>
                                        <option th:value="${item.aplyid}" th:selected="${item.aplyid == chgSeeDsgnAplyInfo.aplyid}">[[${item.rcptno}]]</option>
                                    </th:block>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">시도</th>
                            <td id="ctprvnNm" name="ctprvnNm">[[${chgSeeDsgnAplyInfo.ctprvnNm}]]</td>
                            <th scope="row">지정번호</th>
                            <td id="dsgnno" name="dsgnno">[[${chgSeeDsgnAplyInfo.dsgnno}]]</td>
                        </tr>
                        <tr>
                            <th scope="row">기관명</th>
                            <td id="instNm" name="instNm">[[${chgSeeDsgnAplyInfo.instNm}]]</td>
                            <th scope="row">지정획득일</th>
                            <td id="dsgnDe" name="dsgnDe">[[${chgSeeDsgnAplyInfo.dsgnDe}]]</td>
                        </tr>
                    </tbody>
                </table>
            </div>


            <div class="table-caption">
                <div class="left">
                    <h3 class="sub-title">변경내용</h3>
                </div>
            </div>

            <div class="table-row table-row-mo">
                <table>
                    <caption>변경내용 - 변경사유, 첨부파일, 진행상태</caption>
                    <colgroup>
                        <col style="width:140px;">
                        <col>
                    </colgroup>
                    <tbody>
                        <tr>
                            <th scope="row">변경사유</th>
                            <td>[[${chgSeeDsgnAplyInfo.dmndCn}]]</td>
                        </tr>
                        <tr>
                            <th scope="row">첨부파일</th>
                            <td>
                                <div class="form-input-file">
                                    <ul>
	                                    <th:block th:if="${fileList != null} "th:each="item : ${fileList}">
	                                        <li class="file-block" th:data_ext="${item.ext}"><span class="name">
	                                           <a th:href="|javascript:downloadFileByFileid('${item.fileid}','${item.fileIdntfcKey}')|">
	                                           <th:block th:text="${item.orginlFileNm}"></th:block>
	                                           </a></span></li>
	                                    </th:block>
                                    </ul>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">진행상태</th>
                            <td>[[${chgSeeDsgnAplyInfo.sttsNm}]]</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <th:block th:if="${chgSeeDsgnAplyInfo.sttsCd == '252102' || chgSeeDsgnAplyInfo.sttsCd == '252103'}">
	            <div class="table-caption">
	                <div class="left">
	                    <h3 class="sub-title">승인/불가 사유</h3>
	                </div>
	            </div>
	            <div class="table-row table-row-mo">
	                <table>
	                    <caption>승인/불가 사유 - 사유</caption>
	                    <colgroup>
	                        <col style="width:140px;">
	                        <col>
	                    </colgroup>
	                    <tbody>
	                        <tr>
	                            <th scope="row">사유</th>
	                            <td>[[${chgSeeDsgnAplyInfo.ansCn}]]</td>
	                        </tr>
	                    </tbody>
	                </table>
	            </div>
            </th:block>
            <div class="btn-wrap">
                <div class="center">
                    <button type="button" class="btn-medium btn-gray"  id="delBtn" onclick="chgSeeDsgnAplyCmptn.delAply()">삭제</button>
                    <button type="button" class="btn-medium btn-gray"  id="cencleBtn" onclick="chgSeeDsgnAplyCmptn.onListPage()">취소</button>
                    <button type="button" class="btn-medium btn-green" id="modBtn" onclick="chgSeeDsgnAplyCmptn.modAply()">수정</button>
                </div>
            </div>
            <!-- //content -->
        </form>
        <script th:inline="javascript">
            var chgSeeDsgnAplyCmptn = {
                init(){
                    if($("#sttsCd").val()=='252101'){
                        $("#delBtn").show();
                        $("#modBtn").hide();
                    }else{
                        $("#delBtn").hide();
                        $("#modBtn").show();
                    }
                },
                delAply() {
                    var id=$("#dmndid").val();
                     $.ajax({
                         url: "/front/mypage/seeDsgnDsctn/deleteChgSeeDsgnAply.do?dmndid="+id,
                         type: 'GET',
                         cache: false,
                         dataType: 'json',
                         success: function (data) {
                             if(data.result=="success"){
                                 alert(data.msg);
                                 $("#chgDsctnTab").get(0).click();
                             }else{
                                 alert(data.msg);
                             }
                             closeWorkProgress();
                         }
                    });
                },
                modAply() {
                    var id= $("#dmndid").val();
                    location.href = "/front/mypage/seeDsgnDsctn/chgSeeDsgnAplyUpdateForm.html?dmndid="+id;
                },
                onListPage: function() {
                    history.back();
                }
            }

            $(function(){
                chgSeeDsgnAplyCmptn.init();
            });


        </script>
    </div>
</body>
</html>