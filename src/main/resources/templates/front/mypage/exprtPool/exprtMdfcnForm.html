<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="layout/front/subLayout">

<div layout:fragment="content">
    <div class="tab-content tab-sub dropDown">
        <button type="button" class="tab-mobile-trigger trigger"  aria-expanded="true">전문가 이력 정보</button>
        <div>
            <div class="table-caption">
                <div class="left">
                    <h3 class="sub-title">재직사항</h3>
                </div>
            </div>

            <div class="table-add-group" id="hdof">
                <th:block th:each="item, itemStat : ${exprt.hdofs}">
                    <div class="table-row table-row-mo" th:id="|hdofTable${itemStat.index}|" name="hdofTable">
                        <table>
                            <caption>재직사항 입력 - 재직구분, 재직기관명, 부서(소속), 취득등급, 취득일, 재직증명서</caption>
                            <colgroup>
                                <col style="width:140px;">
                                <col>
                                <col style="width:140px;">
                                <col>
                            </colgroup>
                            <tbody>
                            <tr>
                                <th scope="row">재직구분</th>
                                <td>
                                    <th:block kattr:exprt_radio_code grpCd="136" th:attr="selectedCd=${item.hdofSeCd}, name=|hdofSeCd${itemStat.index+1}|"></th:block>
                                </td>
                                <th scope="row">재직기관명</th>
                                <td>
                                    <div class="form-input">
                                        <input type="text" title="재직기관명" placeholder="재직기관명 입력" name="instNm" maxlength="50" th:value="${item.instNm}">
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">부서(소속)</th>
                                <td>
                                    <div class="form-input">
                                        <input type="text" title="부서(소속)" placeholder="부서(소속) 입력" name="deptNm" maxlength="50" th:value="${item.deptNm}">
                                    </div>
                                </td>
                                <th scope="row">지위(직급)</th>
                                <td>
                                    <div class="form-input">
                                        <input type="text" title="지위(직급)" placeholder="지위(직급) 입력" name="jbgdNm" maxlength="50" th:value="${item.jbgdNm}">
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">재직기간</th>
                                <td>
                                    <div class="form-input flex-wrap">
                                        <div class="form-input">
                                            <input type="date" title="시작일" name="hdofBgngDe" th:value="${item.hdofBgngDe}" data-width="107">
                                            <div class="bul">~</div>
                                            <input type="date" title="종료일" name="hdofEndDe" th:value="${item.hdofEndDe}" th:readonly="${item.hdofYn == 'Y'}" data-width="107">
                                        </div>
                                        <div class="form-check-list">
                                            <label class="inp">
                                                <input type="checkbox" name="hdofYn" onclick="hdofYnCheck(this)" th:checked="${item.hdofYn == 'Y'}">
                                                <b>재직중</b>
                                            </label>
                                        </div>
                                    </div>
                                </td>
                                <th scope="row">재직증명서</th>
                                <td>
                                    <div class="form-input-file form-input-button">
                                        <label class="form-input">
                                            <input type="file" class="blind" th:accept="${uploadFileExtsn}" title="파일첨부" maxcount="1" onchange="uploadExprtFile(this,event)">
                                            <span class="btn-medium btn-green">업로드</span>
                                        </label>
                                        <input type="hidden" name="hdofcrtfFileid" th:value="${(item.hdofcrtfFileid == '' or item.hdofcrtfFileid == null) ? 0 : item.hdofcrtfFileid}">
                                        <ul>
                                            <th:block th:if="${item.hdofCrtfFile != null}">
                                                <th:block th:with="file=${item.hdofCrtfFile}">
                                                    <li class="file-block" th:data_ext="${#strings.substring(file.fileExtsn,1)}" th:id="${file.fileid}">
                                                    <span class="name">
                                                        <a th:href="|javascript:downloadFileByFileid('${file.fileid}','${file.fileIdntfcKey}')|">   
                                                            [[${file.orginlFileNm}]]
                                                        </a>
                                                    </span>
                                                        <button type="button" class="file-delete" title="삭제" th:name="${file.fileid}"
                                                                th:attr="data-file-idntfc-key=${file.fileIdntfcKey}, data-id=${file.fileid}"
                                                                th:onclick="deleteFile(this.name, this.dataset.fileIdntfcKey)">
                                                            <span class="icon icon-circle-close"></span>
                                                        </button>
                                                    </li>
                                                </th:block>
                                            </th:block>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        <div class="table-add-button">
                            <button type="button" class="btn-remove-table" title="테이블 삭제" onclick="removeTable(this)"><span class="icon icon-remove"></span></button>
                            <button type="button" class="btn-move-up-table" title="테이블 순서 위로 이동" onclick="changeOrder(this, 'up')"><span class="icon icon-up"></span></button>
                            <button type="button" class="btn-move-down-table" title="테이블 순서 아래로 이동" onclick="changeOrder(this, 'down')"><span class="icon icon-down"></span></button>
                        </div>
                    </div>
                </th:block>
                <button type="button" class="btn-row-add" title="테이블 추가" onclick="cloneTable(this)">
                    <span class="icon icon-row-add"></span>
                </button>
            </div>

            <div class="table-caption">
                <div class="left">
                    <h3 class="sub-title">자격취득사항</h3>
                </div>
            </div>

            <div class="table-add-group" id="crtfct">
                <th:block th:each="item, itemStat : ${exprt.crtfcts}">
                    <div class="table-row table-row-mo" th:id="|crtfctTable${itemStat.index}|" name="crtfctTable">
                        <table>
                            <caption>자격취득사항 - 자격증명, 취득기관, 취득번호, 취득등급, 취득일, 자격증명서</caption>
                            <colgroup>
                                <col style="width:140px;">
                                <col>
                                <col style="width:140px;">
                                <col>
                            </colgroup>
                            <tbody>
                            <tr>
                                <th scope="row">자격증명</th>
                                <td><input type="text" title="자격증명" name="crtfctNm" th:value="${item.crtfctNm}"></td>
                                <th scope="row">취득기관</th>
                                <td><input type="text" title="취득기관" name="acqsInst" th:value="${item.acqsInst}"></td>
                            </tr>
                            <tr>
                                <th scope="row">취득번호</th>
                                <td><input type="text" title="취득번호" name="acqsNo" th:value="${item.acqsNo}"></td>
                                <th scope="row">취득등급</th>
                                <td><input type="text" title="취득등급" name="acqsGrd" th:value="${item.acqsGrd}"></td>
                            </tr>
                            <tr>
                                <th scope="row">취득일</th>
                                <td>
                                    <div class="form-input">
                                        <input type="date" title="취득일" name="acqsDe" th:value="${item.acqsDe}">
                                    </div>
                                </td>
                                <th scope="row">자격증명서</th>
                                <td>
                                    <div class="form-input-file form-input-button">
                                        <label class="form-input">
                                            <input type="file" class="blind" th:accept="${uploadFileExtsn}" title="자격증명서" maxcount="1" onchange="uploadExprtFile(this,event)">
                                            <span class="btn-medium btn-green">업로드</span>
                                        </label>
                                        <input type="hidden" name="crtfctFileid" th:value="${(item.crtfctFileid == '' or item.crtfctFileid == null) ? 0 : item.crtfctFileid}">
                                        <ul>
                                            <th:block th:if="${item.crtfctFile != null}">
                                                <th:block th:with="file=${item.crtfctFile}">
                                                    <li class="file-block" th:data_ext="${#strings.substring(file.fileExtsn,1)}" th:id="${file.fileid}">
                                                <span class="name">
                                                    <a th:href="|javascript:downloadFileByFileid('${file.fileid}','${file.fileIdntfcKey}')|">   
                                                        [[${file.orginlFileNm}]]
                                                    </a>
                                                </span>
                                                        <button type="button" class="file-delete" title="삭제" th:name="${file.fileid}"
                                                                th:attr="data-file-idntfc-key=${file.fileIdntfcKey}, data-id=${file.fileid}"
                                                                th:onclick="deleteFile(this.name, this.dataset.fileIdntfcKey)">
                                                            <span class="icon icon-circle-close"></span>
                                                        </button>
                                                    </li>
                                                </th:block>
                                            </th:block>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        <div class="table-add-button">
                            <button type="button" class="btn-remove-table" title="테이블 삭제" onclick="removeTable(this)"><span class="icon icon-remove"></span></button>
                            <button type="button" class="btn-move-up-table" title="테이블 순서 위로 이동" onclick="changeOrder(this, 'up')"><span class="icon icon-up"></span></button>
                            <button type="button" class="btn-move-down-table" title="테이블 순서 아래로 이동" onclick="changeOrder(this, 'down')"><span class="icon icon-down"></span></button>
                        </div>
                    </div>
                </th:block>
                <button type="button" class="btn-row-add" title="테이블 추가" onclick="cloneTable(this)">
                    <span class="icon icon-row-add"></span>
                </button>
            </div>

            <div class="table-caption">
                <div class="left">
                    <h3 class="sub-title">환경교육 경력(실적) 사항</h3>
                </div>
            </div>
            <!--class="table-row table-row-mo" -->
            <div class="table-add-group" id="career">
                <div class="table-row table-row-mo" id="fixTable">
                    <table>
                        <caption>환경교육 경력(실적) 사항 - 총 환경교육 경력</caption>
                        <colgroup>
                            <col style="width:140px;">
                            <col>
                        </colgroup>
                        <tbody>
                        <tr>
                            <th scope="row">총 환경교육 경력</th>
                            <td>
                                <div class="form-input">
                                    <input type="number" class="ar" title="총 환경교육 경력(년)" id="envEduCareerYy" name="envEduCareerYy" data-width="50" th:value="${exprt.envEduCareerYy}">
                                    <div class="bul">년</div>
                                    <input type="number" class="ar" title="총 환경교육 경력(월)" id="envEduCareerMm" name="envEduCareerMm" data-width="50" th:value="${exprt.envEduCareerMm}">
                                    <div class="bul">월</div>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <th:block th:each="item, itemStat : ${exprt.careers}">
                    <div class="table-row table-row-mo" th:id="|careerTable{itemStat.index}|" name="careerTable">
                        <table>
                            <caption>환경교육 경력(실적) 사항 입력 - 활동분야, 활동기간, 활동시간, 확인기관, 활동내용, 확인일, 확인서</caption>
                            <colgroup>
                                <col style="width:140px;">
                                <col>
                                <col style="width:140px;">
                                <col>
                            </colgroup>
                            <tbody>
                            <tr>
                                <th scope="row">활동분야</th>
                                <td>
                                    <div class="form-input">
                                        <input type="text" title="활동분야" placeholder="활동분야 입력" name="fldNm" th:value="${item.fldNm}">
                                    </div>
                                </td>

                                <th scope="row">활동기간</th>
                                <td>
                                    <div class="form-input flex-wrap">
                                        <div class="form-input">
                                            <input type="date" title="시작일" data-width="107" name="actvtBgngDe" th:value="${item.actvtBgngDe}">
                                            <div class="bul">~</div>
                                            <input type="date" title="종료일" data-width="107" name="actvtEndDe" th:value="${item.actvtEndDe}" th:readonly="${item.actvtYn == 'Y'}">
                                        </div>
                                        <div class="form-check-list">
                                            <label class="inp">
                                                <input type="checkbox" name="actvtYn" onclick="actvtYnCheck(this)" th:checked="${item.actvtYn == 'Y'}"/>
                                                <b>활동중</b>
                                            </label>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">활동시간</th>
                                <td>
                                    <div class="form-input">
                                        <input type="text" title="활동시간" placeholder="활동시간 입력" name="actvtHr" th:value="${item.actvtHr}">
                                        <div class="bul">시간</div>
                                    </div>
                                </td>
                                <th scope="row">확인기관</th>
                                <td>
                                    <div class="form-input">
                                        <input type="text" title="확인기관" placeholder="확인기관 입력" name="idntyInstNm" th:value="${item.idntyInstNm}">
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">활동내용</th>
                                <td colspan="3">
                                    <div class="form-input">
                                    <textarea title="활동내용" placeholder="활동내용 입력 (500자 이내)" name="actvtCn" maxlength="500" th:text="${item.actvtCn}">
                                    </textarea>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">확인일</th>
                                <td colspan="3">
                                    <div class="form-input">
                                        <div class="form-input">
                                            <input type="date" title="확인일" name="idntyDe" th:value="${item.idntyDe}">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">확인서</th>
                                <td>
                                    <div class="form-input-file form-input-button">
                                        <label class="form-input">
                                            <input type="file" class="blind" th:accept="${uploadFileExtsn}" title="확인서" maxcount="1" onchange="uploadExprtFile(this,event)">
                                            <span class="btn-medium btn-green">업로드</span>
                                        </label>
                                        <input type="hidden" name="crtfFileid" th:value="${(item.crtfFileid == '' or item.crtfFileid == null) ? 0 : item.crtfFileid}">
                                        <ul>
                                            <th:block th:if="${item.crtfFile != null}">
                                                <th:block th:with="file=${item.crtfFile}">
                                                    <li class="file-block" th:data_ext="${#strings.substring(file.fileExtsn,1)}" th:id="${file.fileid}">
                                                    <span class="name">
                                                        <a th:href="|javascript:downloadFileByFileid('${file.fileid}','${file.fileIdntfcKey}')|">   
                                                            [[${file.orginlFileNm}]]
                                                        </a>
                                                    </span>
                                                        <button type="button" class="file-delete" title="삭제" th:name="${file.fileid}"
                                                                th:attr="data-file-idntfc-key=${file.fileIdntfcKey}, data-id=${file.fileid}"
                                                                th:onclick="deleteFile(this.name, this.dataset.fileIdntfcKey)">
                                                            <span class="icon icon-circle-close"></span>
                                                        </button>
                                                    </li>
                                                </th:block>
                                            </th:block>
                                        </ul>
                                    </div>
                                </td>
                                <th scope="row">정관</th>
                                <td>
                                    <div class="form-input-file form-input-button">
                                        <label class="form-input">
                                            <input type="file" class="blind" th:accept="${uploadFileExtsn}" title="정관" maxcount="1" onchange="uploadExprtFile(this,event)">
                                            <span class="btn-medium btn-green">업로드</span>
                                        </label>
                                        <input type="hidden" name="artclassFileid" th:value="${(item.artclassFileid == '' or item.artclassFileid == null) ? 0 : item.artclassFileid}">
                                        <ul>
                                            <th:block th:if="${item.artClassFile != null}">
                                                <th:block th:with="file=${item.artClassFile}">
                                                    <li class="file-block" th:data_ext="${#strings.substring(file.fileExtsn,1)}" th:id="${file.fileid}">
                                                    <span class="name">
                                                        <a th:href="|javascript:downloadFileByFileid('${file.fileid}','${file.fileIdntfcKey}')|">   
                                                            [[${file.orginlFileNm}]]
                                                        </a>
                                                    </span>
                                                        <button type="button" class="file-delete" title="삭제" th:name="${file.fileid}"
                                                                th:attr="data-file-idntfc-key=${file.fileIdntfcKey}, data-id=${file.fileid}"
                                                                th:onclick="deleteFile(this.name, this.dataset.fileIdntfcKey)">
                                                            <span class="icon icon-circle-close"></span>
                                                        </button>
                                                    </li>
                                                </th:block>
                                            </th:block>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>

                        <div class="table-add-button">
                            <button type="button" class="btn-remove-table" title="테이블 삭제" onclick="removeTable(this)"><span class="icon icon-remove"></span></button>
                            <button type="button" class="btn-move-up-table" title="테이블 순서 위로 이동" onclick="changeOrder(this, 'up')"><span class="icon icon-up"></span></button>
                            <button type="button" class="btn-move-down-table" title="테이블 순서 아래로 이동" onclick="changeOrder(this, 'down')"><span class="icon icon-down"></span></button>
                        </div>
                    </div>
                </th:block>
                <button type="button" class="btn-row-add" title="테이블 추가" onclick="cloneTable(this)">
                    <span class="icon icon-row-add"></span>
                </button>
            </div>

            <div class="table-caption">
                <div class="left">
                    <h3 class="sub-title">전문 분야 정보</h3>
                </div>
                <div class="right">
                    <p class="desc"><span class="ast">*</span>필수 입력 정보입니다.</p>
                </div>
            </div>

            <div class="table-row table-row-mo">

                <table>
                    <caption>전문분야 정보 - 자격증명, 취득기관, 취득번호, 취득등급, 취득일, 자격증명서</caption>
                    <colgroup>
                        <col style="width:143px;">
                        <col>
                    </colgroup>
                    <tbody>
                    <tr>
                        <th scope="row">전문가 유형<i class="ast" title="필수입력">*</i></th>
                        <td>
                            <th:block kattr:radio_code="exprtTypeCd" grpCd="133" th:attr="selectedCd=${exprt.exprtTypeCd}"></th:block>
                        </td>
                    </tr>
                    <tr>
                        <th scope="row">전문분야<i class="ast" title="필수입력">*</i></th>
                        <td>
                            <div class="form-check-list">
                                <label class="inp"><input type="checkbox" id="fldLctrYn" name="fldLctrYn " th:checked="${exprt.fldLctrYn == 'Y'}"><b>강의</b></label>
                                <label class="inp"><input type="checkbox" id="fldPlanngYn" name="fldPlanngYn" th:checked="${exprt.fldPlanngYn == 'Y'}"><b>기획</b></label>
                                <label class="inp"><input type="checkbox" id="fldCnsltngYn" name="fldCnsltngYn" th:checked="${exprt.fldCnsltngYn == 'Y'}"><b>사업자문 및 컨설팅</b></label>
                                <label class="inp"><input type="checkbox" id="fldEtcYn" name="fldEtcYn" th:checked="${exprt.fldEtcYn == 'Y'}">
                                    <b>기타</b>
                                    <th:block th:if="${exprt.fldEtcYn == 'Y'}">
                                        <input type="text" title="기타" placeholder="" data-width="160" class="ml10" id="fldEtcCn" name="fldEtcCn" maxlength="15"
                                               th:value="${exprt.fldEtcCn}">
                                    </th:block>
                                    <th:block th:unless="${exprt.fldEtcYn == 'Y'}">
                                        <input type="text" title="기타" placeholder="" data-width="160" class="ml10" id="fldEtcCn" name="fldEtcCn" maxlength="15" style="display:none">
                                    </th:block>
                                </label>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th scope="row">전문분야(대상)<i class="ast" title="필수입력">*</i></th>
                        <td>
                            <th:block kattr:check_code="trgtCd" grpCd="135" th:attr="selectedCd=${exprt.trgtCds}" firstOptTxt="- 전체 - "></th:block>
                        </td>
                    </tr>
                    <tr>
                        <th scope="row">전문분야(환경주제)<i class="ast" title="필수입력">*</i></th>
                        <td>
                            <th:block kattr:check_code="sbjctCd" grpCd="126" th:attr="selectedCd=${exprt.sbjctCds}" firstOptTxt="- 전체 - "></th:block>
                        </td>
                    </tr>
                    <tr>
                        <th scope="row">주요 활동지역<i class="ast" title="필수입력">*</i></th>
                        <td>
                            <th:block kattr:exprt_check_ctprvn="actvtRgnCd" th:attr="selectedCd=${exprt.actvtRgnCds}"  firstOptTxt="- 전체 -" firstOptVal=""></th:block>
                        </td>
                    </tr>
                    <tr>
                        <th scope="row">가능 활동범위<i class="ast" title="필수입력">*</i></th>
                        <td>
                            <th:block kattr:exprt_check_ctprvn="actvtScopeCd" th:attr="selectedCd=${exprt.actvtScopeCds}"  firstOptTxt="- 전체 -" firstOptVal=""></th:block>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="table-caption">
                <div class="left">
                    <h3 class="sub-title">정보변경 사유</h3>
                </div>
                <div class="right">
                    <p class="desc"><span class="ast">*</span>필수 입력 정보입니다.</p>
                </div>
            </div>
            <div class="table-row table-row-mo">
                <table>
                    <caption>정보변경 사유 - 변경사유, 취득기관, 취득번호, 취득등급, 취득일, 자격증명서</caption>
                    <colgroup>
                        <col style="width:140px;">
                        <col>
                    </colgroup>
                    <tbody>
                    <tr>
                        <th scope="row">변경사유<i class="ast" title="필수입력">*</i></th>
                        <td>
                            <textarea title="변경사유" name="infoMdfcnRsn" id="infoMdfcnRsn"></textarea>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="btn-wrap">
                <div class="center">
                    <button type="button" class="btn-medium btn-gray" onclick="previous()">취소</button>
                    <button type="button" class="btn-medium btn-green" onclick="save()">수정 요청</button>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        let hdofCnt = /*[[${exprt.hdofs == null ? 0 : exprt.hdofs.size()}]]*/0;
        let crtfctCnt = /*[[${exprt.crtfcts == null? 0 : exprt.crtfcts.size()}]]*/0;
        let careerCnt = /*[[${exprt.careers == null? 0 : exprt.careers.size()}]]*/0;
        let insertUrl = '/front/mypage/exprtPool/insertMdfcnDmnd.do';

        $(function () {
            /* 전문분야 기타 클릭*/
            $('#fldEtcYn').on('click', function (e) {
                if (e.target.checked) {
                    $('#fldEtcCn').show();
                } else {
                    $('#fldEtcCn').hide();
                    $('#fldEtcCn').val('');
                }
            });
        });

        let previous = () => {
            history.back();
        }

        let save = () => {
            if (!validateForm()) return;

            if (!confirm('전문가 정보 변경을 요청 하시겠습니까?')) return;

            insertMdfcnDmnd();
        }

        let validateForm = () => {

            if ($('input[name=exprtTypeCd]:checked').length == 0) {
                alert("전문가 유형을 선택해주십시오.");
                $('#exprtTypeCd1').focus()
                return false;
            }

            if (!$('#fldLctrYn').is(':checked') && !$('#fldPlanngYn').is(':checked') && !$('#fldCnsltngYn').is(':checked') && !$('#fldEtcYn').is(':checked')) {
                alert('전문분야를 선택해 주십시오.');
                $('#fldLctrYn').focus();
                return false;
            }

            if ($('#fldEtcYn').is(':checked') && $('#fldEtcCn').val() == '') {
                alert("기타 내용을 입력해 주십시오.")
                $('#fldEtcYn').focus();
                return false;
            }

            if ($("input[name=trgtCd]:checked").length == 0) {
                alert('전문분야(대상)을 선택해 주십시오.')
                $('#trgtCd1').focus();
                return false;
            }

            if ($("input[name=sbjctCd]:checked").length == 0) {
                alert('전문분야(환경주제)를 선택해 주십시오.')
                $('#sbjctCd1').focus();
                return false;
            }

            if ($("input[name=actvtRgnCd]:checked").length == 0) {
                alert('주요 활동지역을 선택해 주십시오.')
                $('#actvtRgnCd1').focus();
                return false;
            }

            if ($("input[name=actvtScopeCd]:checked").length == 0) {
                alert("가능 활동범위를 선택해 주십시오.");
                $('#actvtScopeCd1').focus();
                return false;
            }

            if($('#infoMdfcnRsn').val() == null || $('#infoMdfcnRsn').val() == '') {
                alert('정보변경 사유를 입력해 주십시오.');
                $('#infoMdfcnRsn').focus();
                return false;
            }

            return true;
        }

        let insertMdfcnDmnd = () => {
            if (displayWorkProgress(true)) {
                $.ajax({
                    url: insertUrl,
                    type: 'post',
                    data: JSON.stringify(makeJsonData()),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (response) {
                        closeWorkProgress();
                        alert(response.msg)
                        if (response.success) {
                            location.href = '/front/mypage/exprtPool/exprtDetail.html';
                        }
                    }
                });
            }
        }

        let makeJsonData = () => {
            let hdofs = [];
            let crtfcts = [];
            let careers = [];

            $('div[name=hdofTable]').each(function (index, item) {
                hdofs.push(
                    {
                        hdofSeCd: $(item).find('input[type=radio]:checked').val(),
                        instNm: $(item).find('input[name=instNm]').val(),
                        deptNm: $(item).find('input[name=deptNm]').val(),
                        jbgdNm: $(item).find('input[name=jbgdNm]').val(),
                        hdofBgngDe: $(item).find('input[name=hdofBgngDe]').val(),
                        hdofEndDe: $(item).find('input[name=hdofEndDe]').val(),
                        hdofYn: $(item).find('input[name=hdofYn]').is(':checked') ? 'Y' : 'N',
                        hdofcrtfFileid: $(item).find('input[name=hdofcrtfFileid]').val()
                    }
                );
            });

            $('div[name=crtfctTable]').each(function (index, item) {
                crtfcts.push(
                    {
                        crtfctNm: $(item).find('input[name=crtfctNm]').val(),
                        acqsInst: $(item).find('input[name=acqsInst]').val(),
                        acqsNo: $(item).find('input[name=acqsNo]').val(),
                        acqsGrd: $(item).find('input[name=acqsGrd]').val(),
                        acqsDe: $(item).find('input[name=acqsDe]').val(),
                        crtfctFileid: $(item).find('input[name=crtfctFileid]').val()
                    }
                );
            })

            $('div[name=careerTable]').each(function (index, item) {
                careers.push(
                    {
                        fldNm: $(item).find('input[name=fldNm]').val(),
                        actvtBgngDe: $(item).find('input[name=actvtBgngDe]').val(),
                        actvtEndDe: $(item).find('input[name=actvtEndDe]').val(),
                        actvtYn: $(item).find('input[name=actvtYn]').is(':checked') ? 'Y' : 'N',
                        actvtHr: $(item).find('input[name=actvtHr]').val(),
                        idntyInstNm: $(item).find('input[name=idntyInstNm]').val(),
                        actvtCn: $(item).find('textarea').val(),
                        idntyDe: $(item).find('input[name=idntyDe]').val(),
                        crtfFileid: $(item).find('input[name=crtfFileid]').val(),
                        artclassFileid: $(item).find('input[name=artclassFileid]').val()
                    }
                );
            });

            let trgtCds = $('input[name=trgtCd]:checked').map(function () {
                return $(this).val();
            }).get().join(",");

            let sbjctCds = $('input[name=sbjctCd]:checked').map(function () {
                return $(this).val();
            }).get().join(",");

            let actvtRgnCds = $('input[name=actvtRgnCd]:checked').map(function () {
                return $(this).val();
            }).get().join(",");

            let actvtScopeCds = $('input[name=actvtScopeCd]:checked').map(function () {
                return $(this).val();
            }).get().join(",");


            let data = {
                hdofs: hdofs,
                crtfcts: crtfcts,
                careers: careers,
                trgtCds: trgtCds,
                sbjctCds: sbjctCds,
                actvtRgnCds: actvtRgnCds,
                actvtScopeCds: actvtScopeCds,
                envEduCareerYy: $('#envEduCareerYy').val(),
                envEduCareerMm: $('#envEduCareerMm').val(),
                exprtTypeCd: $('input[name=exprtTypeCd]:checked').val(), //
                fldLctrYn: $('#fldLctrYn').is(':checked') ? 'Y' : 'N',
                fldPlanngYn: $('#fldPlanngYn').is(':checked') ? 'Y' : 'N',
                fldCnsltngYn: $('#fldCnsltngYn').is(':checked') ? 'Y' : 'N',
                fldEtcYn: $('#fldEtcYn').is(':checked') ? 'Y' : 'N',
                fldEtcCn: $('#fldEtcCn').val(),
                infoMdfcnRsn : $('#infoMdfcnRsn').val()
            };

            return data;
        }

        /* 재직중 클릭 */
        let hdofYnCheck = (hdofYnCheckbox) => {
            $hdofYnCheckbox = $(hdofYnCheckbox);
            let $hdofEndDe = $hdofYnCheckbox.closest('.form-input').find('input[name=hdofEndDe]');

            if ($hdofYnCheckbox.is(":checked")) {
                $hdofEndDe.val('');
                $hdofEndDe.prop('readonly', true);
            } else {
                $hdofEndDe.prop('readonly', false);
            }
        }

        /* 활동중 클릭*/
        let actvtYnCheck = (actvtYnCheckbox) => {
            $actvtYnCheckbox = $(actvtYnCheckbox);
            let $actvtEndDe = $actvtYnCheckbox.closest('.form-input').find('input[name=actvtEndDe]');

            if ($actvtYnCheckbox.is(":checked")) {
                $actvtEndDe.val('');
                $actvtEndDe.prop('readonly', true);
            } else {
                $actvtEndDe.prop('readonly', false);
            }
        }

        /* 테이블 추가 */
        let cloneTable = (rowAddBtn) => {
            let $rowAddBtn = $(rowAddBtn);
            let tableGroupId = $rowAddBtn.parent().attr('id');
            let $cloneTable;

            if (tableGroupId == 'hdof') {
                ++hdofCnt;
                $cloneTable = $('#hdofTableTemplate').clone(true).attr('id', 'hdofTable' + hdofCnt).attr('name', 'hdofTable');
                $cloneTable.find('input[type=radio]').attr('name', 'hdofSeCd' + hdofCnt);
            } else if (tableGroupId == 'crtfct') {
                ++crtfctCnt;
                $cloneTable = $('#crtfctTableTemplate').clone(true).attr('id', 'crtfctTable' + crtfctCnt).attr('name', 'crtfctTable');
            } else if (tableGroupId == 'career') {
                ++careerCnt;
                $cloneTable = $('#careerTableTemplate').clone(true).attr('id', 'careerTable' + careerCnt).attr('name', 'careerTable');
            }

            $cloneTable.show();
            $rowAddBtn.before($cloneTable);
        }

        /* 테이블 제거*/
        let removeTable = (el) => {
            if (!confirm('삭제 하시겠습니까?')) {
                return;
            }

            $(el).parent().parent().remove();
            let tableGroupId = $(el).closest('.table-add-group').attr('id');
            if (tableGroupId == 'hdof') {
                --hdofCnt;
            } else if (tableGroupId == 'crtfct') {
                --crtfctCnt;
            } else if (tableGroupId == 'career') {
                --careerCnt;
            }
        }

        /* 테이블 순서 변경 */
        let changeOrder = (el, mode) => {
            if (mode == 'up') {
                var $el = $(el).parent().parent();
                if ($el.prev().attr('id') != 'fixTable')
                    $el.prev().before($el);
            } else {
                var $el = $(el).parent().parent();
                if (!$el.next().hasClass('btn-row-add'))
                    $el.next().after($el);
            }
        }

        let uploadExprtFile = (fileInput, event) => {
            var formData = new FormData();
            var $fileInput = $(fileInput);
            var $fileinputDiv = $fileInput.parent().parent();

            formData.append("file", event.target.files[0]);
            formData.append("filegrpNm", "expert_file");

            if (displayWorkProgress()) {
                $.ajax({
                    url: '/uploadFile.do',
                    processData: false,
                    contentType: false,
                    data: formData,
                    type: 'POST',
                    success: function (response) {
                        if (response.result == 'fail') {
                            alert(response.msg);
                        } else if (response.filegrpid != undefined && response.filegrpid != '') {
                            $fileinputDiv.find('input[type=hidden]').val(response.filegrpid);

                            var result = `
                                    <li class='file-block' data_ext='${response.fileExtsn.substr(1)}' id="${response.fileid}">
                                        <span class="name">
                                            <a href="javascript:void(0)" data-fileid="${response.fileid}" data-file-idntfc-key="${response.fileIdntfcKey}"
                                             onclick="javascript:downloadFileByFileid(this.dataset.fileid, this.dataset.fileIdntfcKey)"> ${response.orginlFileNm}
                                            </a>
                                        </span>

                                        <button type="button" class="file-delete" title="삭제" data-fileid="${response.fileid}" data-file-idntfc-key="${response.fileIdntfcKey}"
                                              onclick="deleteFile(this.dataset.fileid, this.dataset.fileIdntfcKey)">
                                            <span class="icon icon-circle-close"></span>
                                        </button>
                                    </li>
                                `;
                            $fileinputDiv.find('ul').html(result);
                        }
                        closeWorkProgress();
                    }
                });
                $fileInput.val("");
            }
            event.preventDefault();
        }

    </script>


    <!-- 테이블 템플릿 -->
    <div class="table-row table-row-mo" id="hdofTableTemplate" style="display: none">
        <table>
            <caption>재직사항 - 재직기관 구분, 재직기관명, 부서(소속), 지위(직급), 재직기간, 재직증명서</caption>
            <colgroup>
                <col style="width:140px;">
                <col>
                <col style="width:140px;">
                <col>
            </colgroup>
            <tbody>
            <tr>
                <th scope="row">재직기관 구분</th>
                <td>
                    <th:block kattr:radio_code="hdofSeCd" grpCd="136"></th:block>
                </td>
                <th scope="row">재직기관명</th>
                <td><input type="text" title="재직기관명" name="instNm"></td>
            </tr>
            <tr>
                <th scope="row">부서(소속)</th>
                <td><input type="text" title="부서(소속)" name="deptNm"></td>
                <th scope="row">지위(직급)</th>
                <td><input type="text" title="지위(직급)" name="jbgdNm"></td>
            </tr>
            <tr>
                <th scope="row">재직기간</th>
                <td>
                    <div class="form-input flex-wrap">
                        <div class="form-input">
                            <input type="date" title="시작일" name="hdofBgngDe" data-width="107">
                            <div class="bul">~</div>
                            <input type="date" title="종료일" name="hdofEndDe" data-width="107">
                        </div>
                        <div class="form-check-list">
                            <label class="inp">
                                <input type="checkbox" name="hdofYn" onclick="hdofYnCheck(this)">
                                <b>재직중</b>
                            </label>
                        </div>
                    </div>
                </td>
                <th scope="row">재직증명서</th>
                <td>
                    <div class="form-input-file form-input-button">
                        <label class="form-input">
                            <input type="file" class="blind" th:accept="${uploadFileExtsn}" title="파일첨부" maxcount="1" onchange="uploadExprtFile(this,event)">
                            <span class="btn-medium btn-green">업로드</span>
                        </label>
                        <input type="hidden" name="hdofcrtfFileid" value="0">
                        <ul></ul>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
        <div class="table-add-button">
            <button type="button" class="btn-remove-table" title="테이블 삭제" onclick="removeTable(this)"><span class="icon icon-remove"></span></button>
            <button type="button" class="btn-move-up-table" title="테이블 순서 위로 이동" onclick="changeOrder(this, 'up')"><span class="icon icon-up"></span></button>
            <button type="button" class="btn-move-down-table" title="테이블 순서 아래로 이동" onclick="changeOrder(this, 'down')"><span class="icon icon-down"></span></button>
        </div>
    </div>

    <div class="table-row table-row-mo" id="crtfctTableTemplate" style="display:none;">
        <table>
            <caption>자격취득사항 - 자격증명, 취득기관, 취득번호, 취득등급, 취득일, 자격증명서</caption>
            <colgroup>
                <col style="width:140px;">
                <col>
                <col style="width:140px;">
                <col>
            </colgroup>
            <tbody>
            <tr>
                <th scope="row">자격증명</th>
                <td><input type="text" title="자격증명" name="crtfctNm"></td>
                <th scope="row">취득기관</th>
                <td><input type="text" title="취득기관" name="acqsInst"></td>
            </tr>
            <tr>
                <th scope="row">취득번호</th>
                <td><input type="text" title="취득번호" name="acqsNo"></td>
                <th scope="row">취득등급</th>
                <td><input type="text" title="취득등급" name="acqsGrd"></td>
            </tr>
            <tr>
                <th scope="row">취득일</th>
                <td>
                    <div class="form-input">
                        <input type="date" title="취득일" id="acqsDe" name="acqsDe">
                    </div>
                </td>
                <th scope="row">자격증명서</th>
                <td>
                    <div class="form-input-file form-input-button">
                        <label class="form-input">
                            <input type="file" class="blind" th:accept="${uploadFileExtsn}" title="자격증명서" maxcount="1" onchange="uploadExprtFile(this,event)">
                            <span class="btn-medium btn-green">업로드</span>
                        </label>
                        <input type="hidden" name="crtfctFileid" value="0">
                        <ul></ul>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
        <div class="table-add-button">
            <button type="button" class="btn-remove-table" title="테이블 삭제" onclick="removeTable(this)"><span class="icon icon-remove"></span></button>
            <button type="button" class="btn-move-up-table" title="테이블 순서 위로 이동" onclick="changeOrder(this, 'up')"><span class="icon icon-up"></span></button>
            <button type="button" class="btn-move-down-table" title="테이블 순서 아래로 이동" onclick="changeOrder(this, 'down')"><span class="icon icon-down"></span></button>
        </div>
    </div>

    <div class="table-row table-row-mo" id="careerTableTemplate" style="display:none;">
        <table>
            <caption>환경교육 경력(실적) 사항 - 활동분야, 재직(활동)기간, 활동시간, 확인기관, 활동내용, 확인일, 확인서, 정관</caption>
            <colgroup>
                <col style="width:140px;">
                <col>
                <col style="width:140px;">
                <col>
            </colgroup>
            <tbody>
            <tr>
                <th scope="row">활동분야</th>
                <td><input type="text" title="활동분야" name="fldNm"></td>
                <th scope="row">활동기간</th>
                <td>
                    <div class="form-input flex-wrap">
                        <div class="form-input">
                            <input type="date" title="시작일" data-width="107" name="actvtBgngDe">
                            <div class="bul">~</div>
                            <input type="date" title="종료일" data-width="107" name="actvtEndDe">
                        </div>
                        <div class="form-check-list"><label class="inp"><input type="checkbox" name="actvtYn" onclick="actvtYnCheck(this)"><b>활동중</b></label></div>
                    </div>
                </td>
            </tr>
            <tr>
                <th scope="row">활동시간</th>
                <td>
                    <div class="form-input">
                        <input type="number" class="ar" title="활동시간" data-width="80" name="actvtHr">
                        <div class="bul">시간</div>
                    </div>
                </td>
                <th scope="row">확인기관</th>
                <td><input type="text" title="취득기관" name="idntyInstNm"></td>
            </tr>
            <tr>
                <th scope="row">활동내용</th>
                <td colspan="3">
                    <textarea title="활동내용" name="actvtCn"></textarea>
                </td>
            </tr>
            <tr>
                <th scope="row">확인일</th>
                <td colspan="3"><input type="date" title="취득기관" name="idntyDe"></td>
            </tr>
            <tr>
                <th scope="row">확인서</th>
                <td colspan="3">
                    <div class="form-input-file">
                        <label class="form-input">
                            <input type="file" class="blind" multiple="multiple" th:accept="${uploadFileExtsn}" title="파일첨부" maxcount="1" onchange="uploadExprtFile(this,event)">
                            <span class="btn-medium btn-green">업로드</span>
                        </label>
                        <input type="hidden" name="crtfFileid" value="0"/>
                        <ul>
                        </ul>
                    </div>
                </td>
            </tr>
            <tr>
                <th scope="row">정관</th>
                <td colspan="3">
                    <div class="form-input-file">
                        <label class="form-input">
                            <input type="file" class="blind" multiple="multiple" th:accept="${uploadFileExtsn}" title="파일첨부" maxcount="1" onchange="uploadExprtFile(this,event)">
                            <span class="btn-medium btn-green">업로드</span>
                        </label>
                        <input type="hidden" name="artclassFileid" value="0"/>
                        <ul>
                        </ul>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
        <div class="table-add-button">
            <button type="button" class="btn-remove-table" title="테이블 삭제" onclick="removeTable(this)"><span class="icon icon-remove"></span></button>
            <button type="button" class="btn-move-up-table" title="테이블 순서 위로 이동" onclick="changeOrder(this, 'up')"><span class="icon icon-up"></span></button>
            <button type="button" class="btn-move-down-table" title="테이블 순서 아래로 이동" onclick="changeOrder(this, 'down')"><span class="icon icon-down"></span></button>
        </div>
    </div>
</div>

