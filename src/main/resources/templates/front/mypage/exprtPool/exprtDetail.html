<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="layout/front/subLayout">

<div layout:fragment="content">

    <th:block th:if="${exprt == null}">
        <div class="nodata">
            <p><span class="icon icon-notice bg-black9"></span>전문가가 아닙니다.</p>
        </div>
    </th:block>
    <th:block th:unless="${exprt == null}">
        <div class="tab-content tab-sub dropDown">
            <button type="button" class="tab-mobile-trigger trigger"  aria-expanded="true">전문가 이력 정보</button>
            <ul class="tab-list target" >
                <li class="tab active">
                    <button data-controls="tab-subpanel01" id="tab-sub01" >전문가 이력 정보</button>
                </li>
                <li class="tab">
                    <button data-controls="tab-subpanel02" id="tab-sub02" >쪽지 수신 및 정보 공개 설정</button>
                </li>
            </ul>
            <div id="tab-subpanel01" class="tabpanel" >
                <h3 class="blind">전문가 이력 정보</h3>
                <div class="table-caption">
                    <div class="left">
                        <h3 class="sub-title">재직사항</h3>
                    </div>
                </div>

                <th:block th:if="${exprt.hdofs.size() == 0}">
                    <div class="nodata">
                        <p class="fc-black6"><span class="icon icon-notice bg-black6"></span>등록된 재직사항이 없습니다.</p>
                    </div>
                </th:block>

                <th:block th:unless="${exprt.hdofs.size() == 0}">
                    <div class="table-row">
                        <th:block th:each="hdof : ${exprt.hdofs}">
                            <table>
                                <caption>재직사항 입력 - 재직구분, 재직기관명, 부서(소속), 취득등급, 취득일, 재직증명서</caption>
                                <colgroup>
                                    <col style="width:140px;">
                                    <col>
                                    <col style="width:140px;">
                                    <col>
                                </colgroup>
                                <tbody>
                                <tr>
                                    <th scope="row">재직구분</th>
                                    <td th:text="${hdof.hdofSeCdNm}">
                                    </td>

                                    <th scope="row">재직기관명</th>
                                    <td th:text="${hdof.instNm}">기관명</td>
                                </tr>
                                <tr>
                                    <th scope="row">부서(소속)</th>
                                    <td th:text="${hdof.deptNm}">부서명</td>

                                    <th scope="row">지위(직급)</th>
                                    <td th:text="${hdof.jbgdNm}">
                                    </td>
                                </tr>
                                <tr>
                                    <th scope="row">재직기간</th>
                                    <td colspan="3">
                                        <th:block th:if="${hdof.hdofYn == 'Y'}">
                                            <th:block th:text="|${hdof.hdofBgngDe} ~ 재직중|"></th:block>
                                        </th:block>

                                        <th:block th:unless="${hdof.hdofYn == 'Y'}">
                                            <th:block th:text="|${hdof.hdofBgngDe} ~ ${hdof.hdofEndDe}|"></th:block>
                                        </th:block>
                                    </td>

                                <tr>
                                    <th scope="row">재직증명서</th>
                                    <td colspan="3">
                                        <div class="form-input-file">
                                            <ul>
                                                <th:block th:if="${hdof.hdofCrtfFile != null}">
                                                    <th:block th:with="file=${hdof.hdofCrtfFile}">
                                                        <li class="file-block" th:data_ext="${#strings.substring(file.fileExtsn,1)}" th:id="${file.fileid}">
                                                            <span class="name">
                                                                <a th:href="|javascript:downloadFileByFileid('${file.fileid}','${file.fileIdntfcKey}')|">   
                                                                    [[${file.orginlFileNm}]]
                                                                </a>
                                                            </span>
                                                        </li>
                                                    </th:block>
                                                </th:block>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </th:block>
                    </div>
                </th:block>

                <div class="table-caption">
                    <div class="left">
                        <h3 class="sub-title">자격취득사항</h3>
                    </div>
                </div>

                <th:block th:if="${exprt.crtfcts.size() == 0}">
                    <div class="nodata">
                        <p class="fc-black6"><span class="icon icon-notice bg-black6"></span>등록된 자격취득사항이 없습니다.</p>
                    </div>
                </th:block>

                <th:block th:unless="${exprt.crtfcts.size() == 0}">
                    <div class="table-row">
                        <th:block th:each="crtfct : ${exprt.crtfcts}">
                            <table>
                                <caption>자격취득사항 - 자격증명, 취득기관, 취득번호, 취득등급, 취득일, 자격증명서</caption>
                                <colgroup>
                                    <col style="width:140px;">
                                    <col>
                                    <col style="width:140px;">
                                    <col>
                                </colgroup>
                                <tbody>
                                <tr>
                                    <th scope="row">자격증명</th>
                                    <td th:text="${crtfct.crtfctNm}">환경교육사</td>
                                    <th scope="row">취득기관</th>
                                    <td th:text="${crtfct.acqsInst}">환경부</td>
                                </tr>
                                <tr>
                                    <th scope="row">취득번호</th>
                                    <td th:text="${crtfct.acqsNo}">200-220310</td>
                                    <th scope="row">취득등급</th>
                                    <td th:text="${crtfct.acqsGrd}">2급</td>
                                </tr>
                                <tr>
                                    <th scope="row">취득일</th>
                                    <td colspan="3" th:text="${crtfct.acqsDe}">2022-08-23</td>
                                </tr>
                                <tr>
                                    <th scope="row">자격증명서</th>
                                    <td colspan="3">
                                        <div class="form-input-file">
                                            <ul>
                                                <th:block th:if="${crtfct.crtfctFile != null}">
                                                    <th:block th:with="file=${crtfct.crtfctFile}">
                                                        <li class="file-block" th:data_ext="${#strings.substring(file.fileExtsn,1)}" th:id="${file.fileid}">
                                                    <span class="name">
                                                        <a th:href="|javascript:downloadFileByFileid('${file.fileid}','${file.fileIdntfcKey}')|">   
                                                            [[${file.orginlFileNm}]]
                                                        </a>
                                                    </span>
                                                        </li>
                                                    </th:block>
                                                </th:block>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </th:block>
                    </div>
                </th:block>


                <div class="table-caption">
                    <div class="left">
                        <h3 class="sub-title">환경교육 경력(실적) 사항</h3>
                    </div>
                </div>

                <th:block th:if="${exprt.careers.size() == 0}">
                    <div class="nodata">
                        <p class="fc-black6"><span class="icon icon-notice bg-black6"></span>등록된 경력(실적) 사항이 없습니다.</p>
                    </div>
                </th:block>

                <th:block th:unless="${exprt.careers.size() == 0}">
                    <div class="table-row">
                        <table>
                            <caption>환경교육 경력(실적) 사항 - 총 환경교육 경력</caption>
                            <colgroup>
                                <col style="width:140px;">
                                <col>
                            </colgroup>
                            <tbody>
                            <tr>
                                <th scope="row">총 환경교육 경력</th>
                                <td>[[${exprt.envEduCareerYy}]]년 [[${exprt.envEduCareerMm}]]개월</td>
                            </tr>
                            </tbody>
                        </table>

                        <th:block th:each="career : ${exprt.careers}">
                            <table>
                                <caption>환경교육 경력(실적) 사항 - 활동분야, 재직(활동)기간, 활동시간, 확인기관, 활동내용, 확인일, 확인서, 정관</caption>
                                <colgroup>
                                    <col style="width:140px;">
                                    <col>
                                    <col style="width:140px;">
                                    <col>
                                </colgroup>
                                <tbody>
                                <tr>
                                    <th scope="row">활동분야</th>
                                    <td th:text="${career.fldNm}">환경</td>
                                    <th scope="row">재직(활동)기간</th>
                                    <td>
                                        <th:block th:if="${career.actvtYn == 'Y'}">
                                            <th:block th:text="|${career.actvtBgngDe} ~ 재직중|"></th:block>
                                        </th:block>

                                        <th:block th:unless="${career.actvtYn == 'Y'}">
                                            <th:block th:text="|${career.actvtBgngDe} ~ ${career.actvtEndDe}|"></th:block>
                                        </th:block>
                                    </td>
                                </tr>
                                <tr>
                                    <th scope="row">활동시간</th>
                                    <td th:text="${career.actvtHr}">hh시간</td>
                                    <th scope="row">확인기관</th>
                                    <td th:text="${career.idntyInstNm}">환경부</td>
                                </tr>
                                <tr>
                                    <th scope="row">활동내용</th>
                                    <td colspan="3">
                                        <textarea title="활동내용" readonly th:text="${career.actvtCn}">환경 활동을 했습니다.</textarea>
                                    </td>
                                </tr>
                                <tr>
                                    <th scope="row">확인일</th>
                                    <td colspan="3" th:text="${career.idntyDe}">YYYY-MM-DD</td>
                                </tr>
                                <tr>
                                    <th scope="row">확인서</th>
                                    <td colspan="3">
                                        <div class="form-input-file">
                                            <ul>
                                                <th:block th:if="${career.crtfFile != null}">
                                                    <th:block th:with="file=${career.crtfFile}">
                                                        <li class="file-block" th:data_ext="${#strings.substring(file.fileExtsn,1)}" th:id="${file.fileid}">
                                                    <span class="name">
                                                        <a th:href="|javascript:downloadFileByFileid('${file.fileid}','${file.fileIdntfcKey}')|">   
                                                            [[${file.orginlFileNm}]]
                                                        </a>
                                                    </span>
                                                        </li>
                                                    </th:block>
                                                </th:block>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <th scope="row">정관</th>
                                    <td colspan="3">
                                        <div class="form-input-file">
                                            <ul>
                                                <th:block th:if="${career.artClassFile != null}">
                                                    <th:block th:with="file=${career.artClassFile}">
                                                        <li class="file-block" th:data_ext="${#strings.substring(file.fileExtsn,1)}" th:id="${file.fileid}">
                                                    <span class="name">
                                                        <a th:href="|javascript:downloadFileByFileid('${file.fileid}','${file.fileIdntfcKey}')|">   
                                                            [[${file.orginlFileNm}]]
                                                        </a>
                                                    </span>
                                                        </li>
                                                    </th:block>
                                                </th:block>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </th:block>
                    </div>
                </th:block>

                <div class="table-caption">
                    <div class="left">
                        <h3 class="sub-title">전문분야 정보</h3>
                    </div>
                </div>
                <div class="table-row">
                    <table>
                        <caption>전문분야 정보 - 자격증명, 취득기관, 취득번호, 취득등급, 취득일, 자격증명서</caption>
                        <colgroup>
                            <col style="width:140px;">
                            <col>
                        </colgroup>
                        <tbody>
                        <tr>
                            <th scope="row">전문가 유형</th>
                            <td th:text="${exprt.exprtTypeCdNm}">국가환경교육지원단</td>
                        </tr>
                        <tr>
                            <th scope="row">전문분야</th>
                            <td th:text="${exprt.flds}">강의, 기획</td>
                        </tr>
                        <tr>
                            <th scope="row">전문분야(대상)</th>
                            <td th:text="${exprt.trgtCdNm}">유아기(~7), 아동기(8~13)</td>
                        </tr>
                        <tr>
                            <th scope="row">전문분야(환경주제)</th>
                            <td th:text="${exprt.sbjctCdNm}">지구환경, 생활환경</td>
                        </tr>
                        <tr>
                            <th scope="row">주요 활동지역</th>
                            <td th:text="${exprt.actvtRgnCdNm}">서울특별시, 인천광역시</td>
                        </tr>
                        <tr>
                            <th scope="row">가능 활동범위</th>
                            <td th:text="${exprt.actvtScopeCdNm}">서울특별시, 인천광역시</td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <div class="btn-wrap">
                    <div class="center">
                        <button type="button" class="btn-medium btn-green" onclick="layerPopup.open({target:'layer-popup19'},event);">이력 정보 수정 요청</button>
                    </div>
                </div>
            </div>

            <div id="tab-subpanel02" class="tabpanel" >
                <h3 class="blind">쪽지 수신 및 정보 공개 설정</h3>
                <div class="table-caption">
                    <div class="left">
                        <div class="d-flex a-center">
                            <h3 class="sub-title">정보 공개 범위 설정</h3>
                            <div class="toggleParent toggle-layer ml5">
                                <button class="toggleTrigger" title="툴팁">
                                    <span class="icon icon-question"></span>
                                    <span class="blind">
                                    <span class="on" aria-hidden="false">툴팁 열기</span>
                                    <span class="off" aria-hidden="true">툴팁 닫기</span>
                                </span>
                                </button>
                                <div class="alarm-layer toggle-layer-inner">
                                    <button class="toggleTrigger toggle-layer-close" title="레이어팝업 닫기"></button>
                                    <div class="toggle-layer-title">
                                        <strong>정보 공개 범위 설정</strong>
                                    </div>
                                    <div class="toggle-layer-content">
                                        <p>정보 공개에 동의 여부에 따라 전문가 회원님의 정보를 포털에 공개합니다. </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="right">
                        <p class="desc"><span class="ast">*</span>필수 입력 정보입니다.</p>
                    </div>
                </div>

                <div class="table-row table-row-mo">
                    <form name="rlsAndRcptnForm" id="rlsAndRcptnForm">
                        <table>
                            <caption>정보 공개 범위 설정 입력 - 연락처 공개 범위, 재직사항 공개 설정, 자격취득사항 공개 설정, 환경교육 경력(실적) 사항 공개 설정</caption>
                            <colgroup>
                                <col style="width:280px;">
                                <col>
                            </colgroup>
                            <tbody>
                            <tr>
                                <th scope="row">연락처 공개 범위<i class="ast" title="필수입력">*</i></th>
                                <td>
                                    <div class="form-check-list">
                                        <label class="inp"><input type="checkbox" id="chkMoblphonRlsYn" name="chkMoblphonRlsYn" th:checked="${exprt.moblphonRlsYn =='Y'}"><b>휴대전화</b></label>
                                        <label class="inp"><input type="checkbox" id="chkTelnoRlsYn" name="chkTelnoRlsYn" th:checked="${exprt.telnoRlsYn =='Y'}"><b>전화번호</b></label>
                                        <label class="inp"><input type="checkbox" id="chkEmlRlsYn" name="chkEmlRlsYn" th:checked="${exprt.emlRlsYn =='Y'}"><b>이메일</b></label>
                                        <label class="inp"><input type="checkbox" id="notOpenAll" name="notOpenAll"><b>모두 공개하지 않음</b></label>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">재직사항 공개 설정<i class="ast" title="필수입력">*</i></th>
                                <td>
                                    <th:block kattr:radio_yn="hdofRlsYn" label1="공개" label2="공개하지 않음" th:attr="defaultVal=${exprt.hdofRlsYn == 'N' ? 'N':'Y'}"></th:block>

                                </td>
                            </tr>
                            <tr>
                                <th scope="row">자격취득사항 공개 설정<i class="ast" title="필수입력">*</i></th>
                                <td>
                                    <th:block kattr:radio_yn="qlfcRlsYn" label1="공개" label2="공개하지 않음" th:attr="defaultVal=${exprt.qlfcRlsYn == 'N' ? 'N':'Y'}"></th:block>

                                </td>
                            </tr>
                            <tr>
                                <th scope="row">환경교육 경력(실적) 사항 공개 설정<i class="ast" title="필수입력">*</i></th>
                                <td>
                                    <th:block kattr:radio_yn="careerRlsYn" label1="공개" label2="공개하지 않음" th:attr="defaultVal=${exprt.careerRlsYn == 'N' ? 'N':'Y'}"></th:block>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        <!-- 강의요청 및 홍보 알림톡 서비스 수신 여부 -->
                        <div class="table-caption">
                            <div class="left">
                                <h3 class="sub-title">강의요청 및 홍보 알림톡 서비스 수신 여부</h3>
                            </div>
                            <div class="right">
                                <p class="desc"><span class="ast">*</span>필수 입력 정보입니다.</p>
                            </div>
                        </div>

                        <div class="table-row table-row-mo">
                            <table>
                                <caption>강의요청 및 홍보 알림톡 서비스 수신 여부 입력 - 기업/단체 강의요청 알림톡 수신 여부, 환경보전협회 강의요청 안내 및 홍보 알림톡 수신 여부</caption>
                                <colgroup>
                                    <col style="width:400px;">
                                    <col>
                                </colgroup>
                                <tbody>
                                <tr>
                                    <th scope="row">기업/단체 강의요청 알림톡 수신 여부<i class="ast" title="필수입력">*</i></th>
                                    <td>
                                        <th:block kattr:radio_yn="entLctrDmndRcptnYn" label1="받음" label2="받지 않음" th:attr="defaultVal=${exprt.entLctrDmndRcptnYn == 'N' ? 'N':'Y'}"></th:block>
                                    </td>
                                </tr>
                                <tr>
                                    <th scope="row">환경보전협회 강의요청 안내 및 홍보 알림톡 수신 여부<i class="ast" title="필수입력">*</i></th>
                                    <td>
                                        <th:block kattr:radio_yn="lctrGdncRcptnYn" label1="받음" label2="받지 않음" th:attr="defaultVal=${exprt.lctrGdncRcptnYn == 'N' ? 'N':'Y'}"></th:block>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="btn-wrap">
                            <div class="center">
                                <button type="button" class="btn-medium btn-green" onclick="save()">저장</button>
                            </div>
                        </div>
                    </form>
                </div>

            </div>
        </div>

        <!-- layerpopup -->
        <div class="layer-popup layer-medium" data-layer-id="layer-popup19">
            <div class="layer-dimmed" title="레이어팝업 닫기"></div>
            <div class="layer-wrap">
                <div class="layer-header">
                    <strong class="tit">이력 정보 수정 요청 유의사항</strong>
                    <button type="button" class="btn-layer-close" title="레이어팝업 닫기" data-layer-close></button>
                </div>
                <div class="layer-content">

                    <div class="thumb-info">
                        <span class="icon icon-info-pop-warning" title=""></span>
                        <dl>
                            <dt><span class="blind">이력 정보 수정 요청 유의사항</span></dt>
                            <dd><b>정보 공개 범위 설정, 강의요청 및 홍보 알림톡 서비스 수신 여부</b>를 제외한 전문가 이력 정보를 수정하기 위해서는 통합플랫폼의 승인을 받아야 하며 변경 정보가 승인되기 전까지 환경교육 전문가 풀 관리에 노출되지 않습니다.</dd>
                        </dl>
                    </div>

                </div>
                <div class="layer-footer">
                    <div class="btn-wrap">
                        <div class="center">
                            <button type="button" class="btn-medium btn-gray" data-layer-close>닫기</button>
                            <button type="button" class="btn-medium btn-green" onclick="goToNextStep()">확인</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- //layerpopup -->

        <script th:inline="javascript">
            let mdfcnUrl = '';
            let updateRlsAndRcptnUrl = '/front/mypage/exprtPool/updateRlsAndRcptn.do';

            let goToNextStep = () => {
                location.href = '/front/mypage/exprtPool/exprtMdfcnForm.html';
            }

            let save = () => {
                if (!confirm('정보를 수정하시겠습니까?')) return;

                let formData = $('#rlsAndRcptnForm').serializeArray();
                let param = [];
                param.push({name: 'moblphonRlsYn', value: $('#chkMoblphonRlsYn').is(':checked') ? 'Y' : 'N'});
                param.push({name: 'telnoRlsYn', value: $('#chkTelnoRlsYn').is(':checked') ? 'Y' : 'N'});
                param.push({name: 'emlRlsYn', value: $('#chkEmlRlsYn').is(':checked') ? 'Y' : 'N'});
                formData = formData.concat(param);

                $.ajax({
                    url: updateRlsAndRcptnUrl,
                    method: 'post',
                    data: formData,
                    dataType: 'json',
                    success: function (response) {
                        alert(response.msg);
                        if(response.success) {
                            location.reload();
                        }
                    }
                });
            }

            $(function () {
                /* 공개범위 체크 */
                $('#notOpenAll').on('click', function (e) {
                    if (e.target.checked) {
                        $('#chkMoblphonRlsYn').prop('checked', false);
                        $('#chkTelnoRlsYn').prop('checked', false);
                        $('#chkEmlRlsYn').prop('checked', false);
                    }
                });
            })
        </script>
    </th:block>
</div>