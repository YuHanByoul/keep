<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="layout/front/subLayout">
<div layout:fragment="content">
    <link rel="stylesheet" href="/css/front/flatpickr.min.css">
    <script src="/js/front/flatpickr.js"></script>
    <script src="/js/front/flatpickr-locale-ko.js"></script>

    <div class="table-caption">
        <div class="left">
            <h3 class="sub-title">예약정보</h3>
        </div>
    </div>
    <div class="table-row">
        <table>
            <caption>예약정보  - 예약상태, 신청일시, 결제상태, 운영기관, 시설, 공간, 위치, 이용일시, 최대 수용인원/평형, 입실시간, 퇴실시간, 이용금액</caption>
            <colgroup>
                <col style="width:140px;">
                <col>
                <col style="width:140px;">
                <col>
            </colgroup>
            <tbody>
            <tr>
                <th scope="row">예약상태</th>
                <td th:text="${mypageEnvReqst.aplySttsCdNm}"></td>
                <th scope="row">신청일시</th>
                <td th:text="${#dates.format(mypageEnvReqst.regDt, 'yyyy-MM-dd')}"></td>
            </tr>
            <tr>
                <th scope="row">결제상태</th>
                <td th:text="${mypageEnvReqst.stlmSttsCdNm}"></td>
                <th scope="row">운영기관</th>
                <td th:text="${mypageEnvReqst.instNm}"></td>
            </tr>
            <tr>
                <th scope="row">시설</th>
                <td th:text="${mypageEnvReqst.fcltNm}"></td>
                <th scope="row">공간</th>
                <td th:text="${mypageEnvReqst.spceNm}+${mypageEnvReqst.utztnSeCd}"></td>
            </tr>
            <tr>
                <th scope="row">위치</th>
                <td th:text ="${mypageEnvReqst.addr}+' '+${mypageEnvReqst.addrDtl}"></td>
                <th scope="row">최대 수용인원/평형</th>
                <td th:text="'최대 '+${mypageEnvReqst.maxNope}+'인 / '+${mypageEnvReqst.size}+'평형'"></td>
            </tr>
            <th:block th:if ="${mypageEnvReqst.utztnSeCd} == '169101'">
                <!-- 숙박 -->
                <tr>
                    <th scope="row">입실시간</th>
                    <td th:text="${#dates.format(mypageEnvReqst.chkinHr, 'HH:mm:ss')}"></td>
                    <th scope="row">퇴실시간</th>
                    <td th:text="${#dates.format(mypageEnvReqst.chcktHr, 'HH:mm:ss')}"></td>
                </tr>
             </th:block>
                <tr>
	                <th scope="row">이용일시(금액)</th>
	                <td colspan='3'>  
	                <th:block th:with="exid= ${#strings.arraySplit(mypageEnvReqst.resveDt,'/')} ">
	                    <th:block th:each="item:${exid}" >
	                        [[${item}]] <br/>
	                    </th:block>
	                </th:block>
                    </td>
                </tr>
                <tr>
                    <th scope="row">총 이용금액</th>
                    <td colspan='3' th:text="${ (mypageEnvReqst.amt > 0)? #numbers.formatInteger(mypageEnvReqst.amt, 0, 'COMMA') + '원':'무료'}"></td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="table-caption">
        <div class="left">
            <h3 class="sub-title">신청정보</h3>
        </div>
    </div>

    <div class="table-row table-row-mo">
        <table>
            <caption>신청정보  - 이용인원, 이용목적</caption>
            <colgroup>
                <col style="width:140px;">
                <col>
            </colgroup>
            <tbody>
            <tr>
                <th scope="row">이용인원</th>
                <td>
                    <div class="form-input mo-flex-wrap">
                        <div class="form-input">
                            <div class="bul">성인</div><input type="number" title="성인" th:value="${mypageEnvReqst.nopeAdult}" style="width:50px;flex:0 0 50px;" readonly><div class="bul">명</div>
                        </div>
                        <div class="form-input">
                            <div class="bul">아동</div><input type="number" title="아동" th:value="${mypageEnvReqst.nopeChil}" style="width:50px;flex:0 0 50px;" readonly><div class="bul">명</div>
                        </div>
                        <div class="form-input">
                            <div class="bul">유아</div><input type="number" title="유아" th:value="${mypageEnvReqst.nopeInfnt}" style="width:50px;flex:0 0 50px;" readonly><div class="bul">명</div>
                        </div>
                    </div>
                </td>
            </tr>
            <tr>
                <th scope="row">이용목적</th>
                <td>
                    <textarea title="이용목적" th:text ="${mypageEnvReqst.utztnPrps}" readonly>환경보전 관련 교육을 위해 예약 신청을 합니다.</textarea>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="table-caption">
        <div class="left">
            <h3 class="sub-title">예약자 정보</h3>
        </div>
    </div>

    <div class="table-row table-row-mo">
        <table>
            <caption>예약자 정보 - 예약자명, 휴대전화, 이메일</caption>
            <colgroup>
                <col style="width:140px;">
                <col>
                <col style="width:140px;">
                <col>
            </colgroup>
            <tbody>
            <tr>
                <th scope="row">예약자명</th>
                <td><input type="text" title="예약자명" placeholder="실명을 입력해주세요" th:value="${mypageEnvReqst.aplcntNm}" readonly></td>
                <th scope="row">휴대전화</th>
                <td><input type="text" title="휴대전화" placeholder="휴대전화번호 입력" th:value="${mypageEnvReqst.aplcntMoblphon}" readonly></td>
            </tr>
            <tr>
                <th scope="row">이메일</th>
                <td colspan="3">
                    <div class="form-input">
                        <input type="email" title="이메일 아이디" placeholder="이메일 아이디 입력" data-width="160" th:value="${mypageEnvReqst.aplcntEmlId}" readonly>
                        <div class="bul">@</div>
                        <input type="email" title="이메일 도메인" placeholder="이메일 도메인 입력" data-width="160" th:value="${mypageEnvReqst.aplcntEmlDomain}" readonly>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="table-caption">
        <div class="left">
            <h3 class="sub-title">입금정보</h3>
        </div>
    </div>

    <div class="table-row">
        <table>
            <caption>입금정보 - 결제금액, 은행명, 계좌번호, 예금주, 입금일, 입금금액</caption>
            <colgroup>
                <col style="width:140px;">
                <col>
                <col style="width:140px;">
                <col>
            </colgroup>
            <tbody>
            <tr>
                <th scope="row">결제금액</th>
                <td th:text="${#numbers.formatInteger(mypageEnvReqst.amt, 0, 'COMMA') + '원'}"></td>
                <th scope="row">은행명</th>
                <td th:text="${mypageEnvReqst.dpstBankCdNm}"></td>
            </tr>
            <tr>
                <th scope="row">계좌번호</th>
                <td th:text="${mypageEnvReqst.dpstBacnt}">000-00-00000</td>
                
                <th scope="row">예금주</th>
                <td th:text="${mypageEnvReqst.dpstrNm}">(재)환경교육재단 </td>
                
            </tr>
            <th:block th:if ="${mypageEnvReqst.stlmSttsCd} == '161102'">
                <tr>
                    <th scope="row">입금일</th>
                    <td th:text="${mypageEnvReqst.dpstDe}"></td>
                    <th scope="row">입금금액</th>
                    <td th:text="${#numbers.formatInteger(mypageEnvReqst.dpstAmt, 0, 'COMMA') + '원'}"></td>
                </tr>
            </th:block>
            </tbody>
        </table>
    </div>

    <th:block th:if ="${mypageEnvReqst.aplySttsCd} == '160103'">
        <div class="table-caption">
            <div class="left">
                <h3 class="sub-title">예약취소사유</h3>
            </div>
        </div>
        <div class="table-row table-row-mo">
            <table>
                <caption>예약취소사유  - 사유</caption>
                <colgroup>
                    <col style="width:140px;">
                    <col>
                </colgroup>
                <tbody>
                <tr>
                    <th scope="row">사유</th>
                    <td>
                        <input type="text" title="예약취소사유" th:value="${mypageEnvReqst.cnclRsnCdNm}" readonly>
                        <textarea th:if ="${mypageEnvReqst.rsvtCnclRsn} != '' and ${mypageEnvReqst.rsvtCnclRsn} != null" 
                                  title="예약취소사유 상세" readonly class="mt10" th:text="${mypageEnvReqst.rsvtCnclRsn}"></textarea>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </th:block>

    <th:block th:if ="${mypageEnvReqst.rfndDmndDt} != null and ${mypageEnvReqst.rfndDmndDt} != ''">
        <div class="table-caption">
            <div class="left">
                <h3 class="sub-title">환불요청정보</h3>
            </div>
        </div>

        <div class="table-row">
            <table>
                <caption>환불요청정보 - 환불요청일, 환불요청금액, 환불계좌은행, 환불계좌번호, 예금주</caption>
                <colgroup>
                    <col style="width:140px;">
                    <col>
                    <col style="width:140px;">
                    <col>
                </colgroup>
                <tr>
                    <th scope="row">환불요청일</th>
                    <td><th:block th:text="${#dates.format(mypageEnvReqst.rfndDmndDt, 'yyyy-MM-dd HH:mm:ss')}"/></td>
                    <th scope="row">환불요청금액</th>
                    <td><th:block th:text="${#numbers.formatInteger(mypageEnvReqst.rfndDmndAmt, 0, 'COMMA') + '원'}"/></td>
                </tr>
                <tr>
                    <th scope="row">환불계좌은행</th>
                    <td th:text="${mypageEnvReqst.rfndBankCdNm}"></td>
                    <th scope="row">환불계좌번호</th>
                    <td th:text="${mypageEnvReqst.rfndBacnt}"></td>
                </tr>
                <tr>
                    <th scope="row">예금주</th>
                    <td colspan="3" th:text="${mypageEnvReqst.rfndPyrNm}">홍길동</td>
                </tr>
                </tbody>
            </table>
        </div>
    </th:block>
    
    <th:block th:if ="${mypageEnvReqst.rfndRejectRsnCd} != '' and ${mypageEnvReqst.rfndRejectRsnCd} != null">
        <!-- 환불요청취소 사유가 있고, 입금완료일 경우 -->
        <div class="table-caption">
            <div class="left">
                <h3 class="sub-title">환불요청취소사유</h3>
            </div>
        </div>

        <div class="table-row table-row-mo">
            <table>
                <caption>환불요청취소사유  - 사유</caption>
                <colgroup>
                    <col style="width:140px;">
                    <col>
                </colgroup>
                <tbody>
                
                <tr>
                    <th scope="row">사유</th>
                    <td>
                        <input type="text" title="환불요청취소사유" readonly th:value="${mypageEnvReqst.rfndRejectRsnCdNm}">
                        <textarea  th:if ="${mypageEnvReqst.rfndRejectRsn} != '' and ${mypageEnvReqst.rfndRejectRsn} != null" title="환불요청취소사유 상세" readonly class="mt10"><th:block th:text="${mypageEnvReqst.rfndRejectRsn}"/></textarea>
                    </td>
                </tr>
                
                </tbody>
            </table>
        </div>
    </th:block>

    <th:block th:if ="${mypageEnvReqst.aplySttsCd} == '160101' and ${mypageEnvReqst.stlmSttsCd} == '161101'">
        <div class="btn-wrap">
            <div class="right">
                <button type="button" class="fc-black6 fs-14 fw-300 underline" onclick="fn_openDpstInfoPopup();">예약취소</button>
            </div>
        </div>
    </th:block>

    <div class="btn-wrap">
        <div class="center">
            <button type="button" class="btn-medium btn-gray" onclick="returnToList()">목록</button>
        </div>
    </div>

    <!-- layerpopup -->
    <div class="layer-popup layer-large" data-layer-id="insertRsnPopup">
        <div class="layer-dimmed" title="레이어팝업 닫기"></div>
        <div class="layer-wrap" id="insertRsnPopup">
        </div>
    </div>
    
    <form id="retrunToListForm">
        <input type="hidden" id="pageNumber"       name="pageNumber"       th:value="${params.pageNumber} ">
        <input type="hidden" id="searchBgngDt"     name="searchBgngDt"     th:value="${params.searchBgngDt}">
        <input type="hidden" id="searchEndDt"      name="searchEndDt"      th:value="${params.searchEndDt}">
        <input type="hidden" id="searchAplySttsCd" name="searchAplySttsCd" th:value="${params.searchAplySttsCd}">
        <input type="hidden" id="searchType"       name="searchType"       th:value="${params.searchType}">
        <input type="hidden" id="searchKeyword"    name="searchKeyword"    th:value="${params.searchKeyword}">
    </form>
    
    <script th:inline="javascript">
        var insertRsnPopupUrl = "/front/mypage/mypageEnvReqst/insertRsnPopup.html";

        function fn_openDpstInfoPopup(){
            $("#insertRsnPopup").load(insertRsnPopupUrl+"?aplyid="+/*[[${mypageEnvReqst.aplyid}]]*/null, function(response, status, xhr) {
                if (status == "success") {
                    layerPopup.open({target:'insertRsnPopup'});
                }
            });
        }
        function returnToList(){
            var f = document.forms.retrunToListForm;
            f.action = "/front/mypage/mypageEnvReqst/mypageEnvReqstList.html";
            f.submit();
        }
    </script>
</div>