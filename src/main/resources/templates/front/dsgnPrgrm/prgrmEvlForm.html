<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
    xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
    layout:decorator="layout/front/nolnbSubLayout" >
<body>
    <div layout:fragment="content">
    <form id="evlForm" name="evlForm" th:action="@{/front/dsgnPrgrm/ldrQlfcForm.html}" method="post">
        <input type="hidden"  id="prgrmid" name="prgrmid" th:value="${aplyInfo.prgrmid}" />
        <input type="hidden"  id="evlid" name="evlid" th:value="${aplyInfo.evlid}" />
        <input type="hidden"  id="opner" name="opner" th:value="${opner==null ?'':opner}" />

        <!-- content -->
        <div class="steps" id="steps" th:if="${opner!='myPage'}">
            <ol>
                <li>
                    <div class="steps-inner">
                        <span>01</span>
                        <strong>약관동의</strong>
                    </div>
                </li>
                <li>
                    <div class="steps-inner">
                        <span>02</span>
                        <strong>신청정보 확인 및 <br class="pc-only"> 증빙자료 등록</strong>
                    </div>
                </li>
                <li class="active" title="현재 단계">
                    <div class="steps-inner">
                        <span>03</span>
                        <strong>프로그램 정보 작성</strong>
                    </div>
                </li>
                <li>
                    <div class="steps-inner">
                        <span>04</span>
                        <strong>신청완료</strong>
                    </div>
                </li>
            </ol>
        </div>


        <div class="row row-section">
            <div class="col col-small">
                <div class="sticky-navigation">
                    <strong class="tit">프로그램 정보 항목</strong>
                    <div class="sticky-steps">
                        <ul>
                            <li><a th:href="@{/front/dsgnPrgrm/prgrmDstnctnForm.html?prgrmid=}+${aplyInfo.prgrmid}" >프로그램 우수성</a></li>
                            <li><a th:href="@{/front/dsgnPrgrm/prgrmOperMngForm.html?prgrmid=}+${aplyInfo.prgrmid}" >프로그램 운영관리</a></li>
                            <li class="active"><a th:href="@{/front/dsgnPrgrm/prgrmEvlForm.html?prgrmid=}+${aplyInfo.prgrmid}" >프로그램 평가</a></li>
                            <li><a th:href="@{/front/dsgnPrgrm/ldrQlfcForm.html?prgrmid=}+${aplyInfo.prgrmid}" >지도자의 자격 및 배치</a></li>
                            <li><a th:href="@{/front/dsgnPrgrm/sftyMngForm.html?prgrmid=}+${aplyInfo.prgrmid}" >안전관리</a></li>
                            <li><a th:href="@{/front/dsgnPrgrm/chkListForm.html?prgrmid=}+${aplyInfo.prgrmid}" >체크리스트</a></li>
                        </ul>
                        <div class="btn-wrap">
                            <div class="center">
                                <button type="button" class="btn-large btn-gray" onclick="doSave()">중간저장</button>
                                <button type="button" class="btn-medium btn-green" onclick="goNext()">다음</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col col-wide">

                <div class="table-caption mt0">
                    <div class="left">
                        <h3 class="sub-title">프로그램 평가 체계</h3>
                        <h4 class="dot-title">평가 체계</h4>
                    </div>
                </div>

                <div class="table-combi">
                    <table>
                        <caption>프로그램 평가 체계 - 구분(지도자 평가, 참여자 평가, 인솔자 평가, 평가목적), 평가 시기(사전,사후), 평가 목표 및 항목, 평가 도구</caption>
                        <colgroup>
                            <col style="width:15%">
                            <col style="width:50px">
                            <col>
                            <col>
                        </colgroup>
                        <thead>
                            <tr>
                                <th scope="col">구분</th>
                                <th scope="col">평가 <br class="mo-only">시기</th>
                                <th scope="col">평가목표 및 항목</th>
                                <th scope="col">평가도구</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <th scope="row" rowspan="2">지도자 평가</th>
                                <th scope="row" class="bg-white">사전</th>
                                <td class="al vt">
                                    <input type="text" title="지도자 평가 (사전)" name="bfrLdrEvlArtcl" id="bfrLdrEvlArtcl" th:value="${aplyInfo.bfrLdrEvlArtcl}" />
                                    <p class="desc">* 예)교육 전 점검평가</p>
                                </td>
                                <td class="al vt">
                                    <input type="text" title="지도자 평가 (평가도구)" name="bfrLdrEvlTl" id="bfrLdrEvlTl" th:value="${aplyInfo.bfrLdrEvlTl}" />
                                    <p class="desc">* 예)문항지</p>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row" class="bg-white">사후</th>
                                <td class="al vt">
                                    <input type="text" title="지도자 평가 (사후)" name="aftrLdrEvlArtcl" id="aftrLdrEvlArtcl" th:value="${aplyInfo.aftrLdrEvlArtcl}" />
                                    <p class="desc">* 예)교육 후 결과평가</p>
                                </td>
                                <td class="al vt">
                                    <input type="text" title="지도자 평가 (평가도구)" name="aftrLdrEvlTl" id="aftrLdrEvlTl" th:value="${aplyInfo.aftrLdrEvlTl}" />
                                    <p class="desc">* 예)프로그램평가발표</p>
                                </td>
                            </tr>

                            <tr>
                                <th scope="row" rowspan="2">참여자 평가</th>
                                <th scope="row" class="bg-white">사전</th>
                                <td class="al vt">
                                    <input type="text" title="참여자 평가 (사전)" name="bfrPrtpntEvlArtcl" id="bfrPrtpntEvlArtcl" th:value="${aplyInfo.bfrPrtpntEvlArtcl}" />
                                    <p class="desc">* 예)교육 전 점검평가</p>
                                </td>
                                <td class="al vt">
                                    <input type="text" title="참여자 평가 (평가도구)" name="bfrPrtpntEvlTl" id="bfrPrtpntEvlTl" th:value="${aplyInfo.bfrPrtpntEvlTl}" />
                                    <p class="desc">* 예)문항지</p>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row" class="bg-white">사후</th>
                                <td class="al vt">
                                    <input type="text" title="참여자 평가 (사후)" name="aftrPrtpntEvlArtcl" id="aftrPrtpntEvlArtcl" th:value="${aplyInfo.aftrPrtpntEvlArtcl}" />
                                    <p class="desc">* 예)만족도조사 및 이해도향상조사 </p>
                                </td>
                                <td class="al vt">
                                    <input type="text" title="참여자 평가 (평가도구)" name="aftrPrtpntEvlTl" id="aftrPrtpntEvlTl" th:value="${aplyInfo.aftrPrtpntEvlTl}" />
                                    <p class="desc">* 예)문항지, 조사지</p>
                                </td>
                            </tr>

                            <tr>
                                <th scope="row" rowspan="2">인솔자 평가</th>
                                <th scope="row" class="bg-white">사전</th>
                                <td class="al vt">
                                    <input type="text" title="인솔자 평가 (사전)" name="bfrGdrEvlArtcl" id="bfrGdrEvlArtcl" th:value="${aplyInfo.bfrGdrEvlArtcl}" />
                                    <p class="desc">* 예)교육 전 점검평가</p>
                                </td>
                                <td class="al vt">
                                    <input type="text" title="인솔자 평가 (평가도구)" name="bfrGdrEvlTl" id="bfrGdrEvlTl" th:value="${aplyInfo.bfrGdrEvlTl}" />
                                    <p class="desc">* 예)문항지</p>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row" class="bg-white">사후</th>
                                <td class="al vt">
                                    <input type="text" title="인솔자 평가 (사후)" name="aftrGdrEvlArtcl" id="aftrGdrEvlArtcl" th:value="${aplyInfo.aftrGdrEvlArtcl}" />
                                    <p class="desc">* 예)교육프로그램 만족도조사</p>
                                </td>
                                <td class="al vt">
                                    <input type="text" title="인솔자 평가 (평가도구)" name="aftrGdrEvlTl" id="aftrGdrEvlTl" th:value="${aplyInfo.aftrGdrEvlTl}" />
                                    <p class="desc">* 예)문항지, 조사지</p>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">평가 <br class="mo-only">목적</th>
                                <td colspan="3" class="al">
                                    <textarea title="평가목적" placeholder="평가목적을 입력해주세요." id="evlPrps" name="evlPrps" ><th:block th:text="${aplyInfo.evlPrps}" /></textarea>
                                    <div id="evlPrpsSize" class="desc ar size"><span>0</span> / 50</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="table-caption">
                    <div class="left">
                        <h4 class="dot-title">교육활동 기록 및 관리</h4>
                    </div>
                </div>


                <div class="table-row table-row-mo">
                    <table>
                        <caption>교육활동 기록 및 관리 - 기록방법</caption>
                        <colgroup>
                            <col style="width:140px;">
                            <col>
                        </colgroup>
                        <tbody>
                            <tr>
                                <th scope="row">기록방법</th>
                                <td>
                                    <div class="form-input mo-flex-wrap">
                                        <div class="form-check-list p0">
                                            <label class="inp"><input type="checkbox" value="Y" name="databaseWrtYn" id="databaseWrtYn" th:checked="${aplyInfo.databaseWrtYn=='Y'}"/>
                                                <b>데이터베이스(DB) 작성</b></label>
                                            <label class="inp"><input type="checkbox" value="Y" name="clsjrnlWrtYn" id="clsjrnlWrtYn" th:checked="${aplyInfo.clsjrnlWrtYn=='Y'}" />
                                                <b>수업일지 작성</b></label>
                                            <label class="inp"><input type="checkbox" value="Y" name="etcYn" id="etcYn" th:checked="${aplyInfo.etcYn=='Y'}" />
                                                <b class="mr10">기타</b>
                                                <span class="form-input mo-flex-wrap">
                                                    <input type="text" class="" title="기타" style="flex:0 0 140px;width:140px;" name="etcCn" id="etcCn" th:value="${aplyInfo.etcCn}" />
                                                </span>
                                            </label>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>


                <div class="mo-only">
                    <div class="btn-wrap">
                        <div class="center">
                            <button type="button" class="btn-medium btn-gray" onclick="doSave()">중간저장</button>
                        </div>
                    </div>
                    <div class="btn-wrap">
                        <div class="center">
                            <button type="button" class="btn-medium btn-gray" onclick="goPrev()">이전</button>
                            <button type="button" class="btn-medium btn-green" onclick="goNext()">다음</button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <!-- //content -->
    </form>
    <script th:inline="javascript">

        var insertUrl = "/front/dsgnPrgrm/insertPrgrmEvlForm.do";
        var updateUrl = "/front/dsgnPrgrm/updatePrgrmEvlForm.do";
        var nextUrl = "/front/dsgnPrgrm/ldrQlfcForm.html";    //지도자및 자격 배치
        var prevUrl = "/front/dsgnPrgrm/prgrmDstnctnForm.html";    //우수성
        var reUrl = "/front/dsgnPrgrm/prgrmEvlForm.html";    //프로그램 평가

        function validate(){

            $("#evlForm").validate({
                ignore: [],
                rules: {
                    evlPrps              : { maxlength:50 }
                  , bfrLdrEvlArtcl       : { maxlength:50 }
                  , bfrLdrEvlTl          : { maxlength:50 }
                  , aftrLdrEvlArtcl      : { maxlength:50 }
                  , aftrLdrEvlTl         : { maxlength:50 }
                  , bfrPrtpntEvlArtcl    : { maxlength:50 }
                  , bfrPrtpntEvlTl       : { maxlength:50 }
                  , aftrPrtpntEvlArtcl   : { maxlength:50 }
                  , aftrPrtpntEvlTl      : { maxlength:50 }
                  , bfrGdrEvlArtcl       : { maxlength:50 }
                  , bfrGdrEvlTl          : { maxlength:50 }
                  , aftrGdrEvlArtcl      : { maxlength:50 }
                  , aftrGdrEvlTl         : { maxlength:50 }
                  , etcCn                : { maxlength:50 }
                 },
                 messages: {
                     evlPrps              : { maxlength:"평가 목적 은 100자를 넘을 수 없습니다."}
                   , bfrLdrEvlArtcl       : { maxlength:"사전 지도자 평가 항목은 50자를 넘을 수 없습니다." }
                   , bfrLdrEvlTl          : { maxlength:"사전 지도자 평가 도구는 50자를 넘을 수 없습니다." }
                   , aftrLdrEvlArtcl      : { maxlength:"사후 지도자 평가 항목은 50자를 넘을 수 없습니다." }
                   , aftrLdrEvlTl         : { maxlength:"사후 지도자 평가 도구는 50자를 넘을 수 없습니다." }
                   , bfrPrtpntEvlArtcl    : { maxlength:"사전 참여자 평가 항목은 50자를 넘을 수 없습니다." }
                   , bfrPrtpntEvlTl       : { maxlength:"사전 참여자 평가 도구는 50자를 넘을 수 없습니다." }
                   , aftrPrtpntEvlArtcl   : { maxlength:"사후 참여자 평가 항목은 50자를 넘을 수 없습니다." }
                   , aftrPrtpntEvlTl      : { maxlength:"사후 참여자 평가 도구는 50자를 넘을 수 없습니다." }
                   , bfrGdrEvlArtcl       : { maxlength:"사전 인솔자 평가 항목은 50자를 넘을 수 없습니다." }
                   , bfrGdrEvlTl          : { maxlength:"사전 인솔자 평가 도구는 50자를 넘을 수 없습니다." }
                   , aftrGdrEvlArtcl      : { maxlength:"사후 인솔자 평가 항목은 50자를 넘을 수 없습니다." }
                   , aftrGdrEvlTl         : { maxlength:"사후 인솔자 평가 도구는 50자를 넘을 수 없습니다." }
                   , etcCn                : { maxlength:"기타내용은 50자를 넘을 수 없습니다."              }
                 }
            });
        }


        function goPrev(){
            document.evlForm.action = prevUrl;
            $("#evlForm").submit();
        }

        function goNext(){

        	doSave("next");
        }

        function doSave(call){

        	var url= ($("#evlid").val() == null || $("#evlid").val() == "" || $("#evlid").val() == 0) ? insertUrl : updateUrl;

        	if($("#evlForm").valid() == false) return;

        	if(call != "next") {
                if(!confirm("저장하시겠습니까?")) return;
            }

            var data =  $("#evlForm").serialize() ;

            $.ajax({
                url : insertUrl,
                type: 'POST',
                cache : false,
                dataType: 'json',
                data : data,
                success : function (data) {
                    if(data.result=="success"){
                    	if(call == "next") {

                            document.evlForm.action = nextUrl;
                            $("#evlForm").submit();
                        }else{
                            alert(data.msg);
                            document.evlForm.action = reUrl;
                        }
                        $("#evlForm").submit();
                    }else{
                        alert(data.msg);
                    }
                },
                error : function (error){
                }
            });

        }

        $(function() {

            $("textArea").keyup(function (e) {
                var inTxt = $(this).val();
                if($("#"+this.id).next().prop("class")=="desc ar size"){
                    $("#"+this.id).next().children().prop("innerHTML",inTxt.length);
                }
            });
            $("textArea").trigger("keyup");
        });

        </script>
</div>

</body>
</html>