<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
    xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
    layout:decorator="layout/front/subLayout" >
<body>
	<div layout:fragment="content">
		<!-- content -->
		<form id="searchForm" class="search-filter">
            <input type="hidden" id="pageNumber" name="pageNumber" value="1">
            <input type="hidden" id="rowPerPage" name="rowPerPage" value="10">
            <input type="hidden" id="orderDirection" name="orderDirection" value="desc">
            <input type="hidden" id="orderField" name="orderField" value="REG_DT">

            <div class="form-input-wrap">
                <div class="form-row">
                    <div class="form-header"><strong class="label">프로그램명</strong></div>
                    <div class="form-body">
                        <input type="search" title="프로그램명" placeholder="프로그램명을 입력해 주세요." name="searchPrgrmNm" id="searchPrgrmNm" onkeydown="if(event.keyCode == 13){dsgnSttus.search(); return false;};">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-header"><strong class="label">운영기관명</strong></div>
                    <div class="form-body">
                        <input type="search" title="운영기관명" placeholder="운영기관명을 입력해 주세요." name="searchInstNm" id="searchInstNm" onkeydown="if(event.keyCode == 13){dsgnSttus.search(); return false;};">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-header"><strong class="label">지역</strong></div>
                    <div class="form-body">
                        <select id="searchRgnCd" name="searchRgnCd" title="지역">
                            <option value="">- 전체 -</option>
                            <th:block th:each="code : ${sidoList}">
                                <option th:value="${code.CTPRVN_CD}">[[${code.CTPRVN_NM}]]</option>
                            </th:block>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-header"><strong class="label">교육주제</strong></div>
                    <div class="form-body">
                        <div class="form-input">
                            <select name="searchManinEduSbjctCd" id="searchEduSbjctCd_1" title="교육주제" onchange="setSearchSelectBox.setNextDepth(155,this.value,'searchEduSbjctCd_2')">
                                <option value="">- 전체 -</option>
                            </select>
                            <select name="searchMdleEduSbjctCd" id="searchEduSbjctCd_2" title="교육주제 상세" style="flex:auto">
                                <option value="">- 전체 -</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-header"><strong class="label">교육대상</strong></div>
                    <div class="form-body">
                        <select id="searchEduTarget" name="searchEduTarget" title="교육대상">
                            <option value="">- 전체 -</option>
                            <option value="INFNT">유아</option>
                            <option value="SCHBOY">초등</option>
                            <option value="MSKLSD">중등</option>
                            <option value="HGSCHST">고등</option>
                            <option value="ADULT">성인</option>
                            <option value="WHOL_AGE">전연령</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-header"><strong class="label">참가비</strong></div>
                    <div class="form-body">
                        <div class="form-check-list">
                            <label class="inp"><input type="radio" name="searchEtrfee" id="searchEtrfee1" value="" checked><b>전체</b></label>
                            <label class="inp"><input type="radio" name="searchEtrfee" id="searchEtrfee2" value="free" ><b>무료</b></label>
                            <label class="inp"><input type="radio" name="searchEtrfee" id="searchEtrfee3" value="pchrg" ><b>유료</b></label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="search-filter-submit">
                <button type="button" class="btn-medium btn-gray btn-before-refresh" onclick="dsgnSttus.searchInit()">초기화</button>
                <button type="button" class="btn-medium btn-green btn-before-search" onclick="dsgnSttus.search()">검색</button>
            </div>
        </form>

        <div class="tab-content">
            <div class="table-caption flex-nowrap">
                <div class="left" id="listCount">
                    <p>총 <b>0</b> 건</p>
                </div>
                <div class="right">
                    <div class="sort-tab">
                        <ul class="tab-list">
                            <li class="active"><button data-controls="tab-album1" id="album-tab1"><span class="icon icon-sort-album"></span>앨범형</button></li>
                            <li><button data-controls="tab-list1" id="list-tab1"><span class="icon icon-sort-list"></span>목록형</button></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div id="tab-album1" class="tabpanel" >
                <h3 class="blind">앨범형</h3>
                <div class="card-section" id="card-table">
                    <ul class="n3" id="cardList-area">
                    </ul>
                </div>

                <div id="pagination1" aria-label="pagination"></div>
            </div>
            <div id="tab-list1" class="tabpanel" >
                <h3 class="blind">목록형</h3>
                <div class="pc-only">
                    <div class="table-col table-layout-auto">
                        <table>
                            <caption>우수 환경교육 프로그램 지정현황 - 번호, 운영기관, 프로그램, 지역, 교육주제, 교육대상, 참가비(1인)</caption>
                            <colgroup>
                                <col style="width:5%;">
                                <col style="width:10%;">
                                <col>
                                <col style="width:10%;">
                                <col style="width:30%;">
                                <col style="width:10%;">
                                <col style="width:10%;">
                            </colgroup>
                            <thead>
                                <tr>
                                    <th scope="col">번호</th>
                                    <th scope="col">운영기관</th>
                                    <th scope="col">프로그램</th>
                                    <th scope="col">지역</th>
                                    <th scope="col">교육주제</th>
                                    <th scope="col">교육대상</th>
                                    <th scope="col">참가비(1인)</th>
                                </tr>
                            </thead>
                            <tbody id="list-area"></tbody>
                        </table>
                    </div>
                </div>

                <div class="mo-only">
                    <div class="table-list">
                        <ul id="list-mobile-area"></ul>
                    </div>
                </div>

                <div id="pagination2" aria-label="pagination">
                </div>
            </div>
        </div>
		<!-- //content -->

		<script th:inline="javascript">

        var getCodeListUrl = "/mng/customAttr/grpCodeList.do"

        var setSearchSelectBox = {
            fn_getNextDepthList : function(grpcd , upprcd, targetId, selected){
                $.ajax({
                    url : getCodeListUrl,
                    type: 'GET',
                    cache : false,
                    dataType: 'json',
                    async: false,
                    data: {
                          grpcd  : grpcd
                        , upprcd : upprcd
                    },
                    success: function (response) {
                        let data = escapeData(response);
                        setSearchSelectBox.writeHtml(grpcd,targetId,data, selected);
                    },
                    error : function (error){
                    }

                });
            },

            writeHtml : function(grpcd,targetId,list,selected){
                var cntArr = targetId.split("_");
                var nextCnt = Number(cntArr[1])+1;
                var nextTarget = cntArr[0]+"_"+nextCnt;

                var html ="<select title='하위 교육 주제' id='"+targetId+"' onchange=setSearchSelectBox.setNextDepth('"+grpcd+"',this.value,'"+nextTarget+"')>";
                    html +="    <option value=''>- 전체 -</option>";

                for(var i=0 ; i < list.length;i++){
                    if(list[i].cd==selected){
                        html +="    <option value="+list[i].cd+" selected>"+ list[i].cdNm+ "</option>";
                    }else{
                        html +="    <option value="+list[i].cd+">"+ list[i].cdNm+ "</option>";
                    }
                }

                if(list.length == 0 && jQuery("#"+nextTarget)[0] != undefined){
                    setSearchSelectBox.writeHtml(grpcd,nextTarget,list,selected);
                }
                html +="    </select>";

                $("#"+targetId).html(html);
            },

            setNextDepth : function(grpcd , upprcd , targetId, selected){
                setSearchSelectBox.fn_getNextDepthList(grpcd , upprcd , targetId, selected);
            }
        }

        setSearchSelectBox.fn_getNextDepthList(155 , 0, 'searchEduSbjctCd_1');

         var dsgnSttus = {
 	        	listUrl: '/front/dsgnPrgrm/selectDsgnSttusList.do',
	            detailUrl : '/front/dsgnPrgrm/dsgnSttusDetailForm.html',

	            init(rowPerPage) {

	            	this.onLoadData();

	            	if(rowPerPage != null) {
		            	$("#rowPerPage").val(parseInt(rowPerPage));
		                $('#pageNumber').val('1');
	                }
	                //this.selectList();
	            },

	            onLoadData: function() {
                    if(displayWorkProgress(true)) {
                        if(document.URL.indexOf('#') > -1) {// 검색유지

                            var historyData = document.URL.substring(document.URL.indexOf("#") + 1).split("&");

                            $("#pageNumber").val(historyData[0].split("=")[1]);
                            $("#searchPrgrmNm"      ).val(decodeURI(historyData[1]?.split("=")[1]??''));
                            $("#searchInstNm"       ).val(decodeURI(historyData[2]?.split("=")[1]??''));
                            $("#searchRgnCd"        ).val(decodeURI(historyData[3]?.split("=")[1]??''));
                            $("#searchEduSbjctCd_1" ).val(decodeURI(historyData[4]?.split("=")[1]??''));
                            $("#searchEduSbjctCd_2" ).val(decodeURI(historyData[5]?.split("=")[1]??''));
                            $("#searchEduTarget"    ).val(decodeURI(historyData[6]?.split("=")[1]??''));
                            $("#searchEtrfee1"      ).val(decodeURI(historyData[7]?.split("=")[1]??''));
                        }
                        dsgnSttus.search();
                    }
                },

	            setPage() {
	            	var hashUrl = "";
                    if(document.URL.indexOf("#") > -1) {
                        var url = document.URL.substring(0, document.URL.indexOf("#"));
                        hashUrl = url + "#pageNumber="    + $("#pageNumber").val();
                        hashUrl += "&searchPrgrmNm="      + encodeURI($("#searchPrgrmNm").val());
                        hashUrl += "&searchInstNm="       + encodeURI($("#searchInstNm").val());
                        hashUrl += "&searchRgnCd="        + encodeURI($("#searchRgnCd").val());
                        hashUrl += "&searchEduSbjctCd_1=" + encodeURI($("#searchEduSbjctCd_1").val());
                        hashUrl += "&searchEduSbjctCd_2=" + encodeURI($("#searchEduSbjctCd_2").val());
                        hashUrl += "&searchEduTarget="    + encodeURI($("#searchEduTarget").val());
                        hashUrl += "&searchEtrfee1="      + encodeURI($("[id^=searchEtrfee] :checked").val());

                    } else {
                        hashUrl = document.URL + "#pageNumber=" + $("#pageNumber").val();
                        hashUrl += "&searchPrgrmNm="      + encodeURI($("#searchPrgrmNm").val());
                        hashUrl += "&searchInstNm="       + encodeURI($("#searchInstNm").val());
                        hashUrl += "&searchRgnCd="        + encodeURI($("#searchRgnCd").val());
                        hashUrl += "&searchEduSbjctCd_1=" + encodeURI($("#searchEduSbjctCd_1").val());
                        hashUrl += "&searchEduSbjctCd_2=" + encodeURI($("#searchEduSbjctCd_2").val());
                        hashUrl += "&searchEduTarget="    + encodeURI($("#searchEduTarget").val());
                        hashUrl += "&searchEtrfee1="      + encodeURI($("[id^=searchEtrfee] :checked").val());
                    }

                    location.replace(hashUrl);
	            },

	            moveToDetail(id) {

	            	if($("#pageNumber").val() != 1 || $("#searchJntpurchsNm").val() || $("#searchSttsCd").val()) {
                        this.setPage();
                    }

	                location.href = dsgnSttus.detailUrl+ "?prgrmid="+id;
	            },

	            search() {
	                $('#pageNumber').val('1');
	                this.selectList();
	            },

	            searchInit() {
	            	sessionStorage.clear();

	    			$("#searchPrgrmNm").val('');
	    			$("#searchInstNm").val('');
	    			$("#searchRgnCd").val('');
	    			$("#searchEduSbjctCd_1").val('');
	    			$("#searchEduSbjctCd_2").val('');
	    			$("#searchEduTarget").val('');
	    			$("#searchEtrfee").val('');
	    			$("#searchEtrfee1").prop("checked",true);

	            },

	            selectList() {
	            	if (displayWorkProgress(true)) {
	                	let formData = $('#searchForm').serializeArray();

	                    $.ajax({
	                    	url: dsgnSttus.listUrl,
	                        cache: false,
	                        dataType: 'json',
	                        data: formData,
	                        type: 'GET',
	                        success: function (result) {


	                        	$('#card-table').removeClass();
                                $('#card-table').addClass('card-section');
debugger;
                                $("#pagination1").html(result.pagination);
                                $("#pagination2").html(result.pagination);

                                let data = escapeData(result);
	                        	dsgnSttus.makeListHtml(data);

                                closeWorkProgress();
	                        }
	                    });
	            	}
	            },

                makeListHtml(data) {
                    var cardListHtml = "";
                    var listHtml = "";
                    var mobileHtml = "";
                    var color ="green";

                    if (data.list == null || data.list.length <= 0) {

                    	listCount.innerHTML = `<p>총 <b>${data.list.length}</b> 건</p>`;

                    	listHtml += `
                        <tr>
                            <td className="nodata" colSpan="7">
                                <p><span className="icon icon-notice bg-black9"></span>등록된 프로그램이 없습니다</p>
                            </td>
                        </tr>`;

                        mobileHtml += `
                            <li class="block">
                                <div class="nodata">
                                    <p><span class="icon icon-notice bg-black9"></span>등록된 프로그램이 없습니다.</p>
                                </div>
                            </li>
                        `;

                        $('#card-table').removeClass();
                        $('#card-table').addClass('nodata');
                        cardListHtml += `
                            <p><span class="icon icon-notice bg-black9"></span>등록된 프로그램이 없습니다.</p>
                        `;
                    } else {

                        listCount.innerHTML = `<p>총 <b>${data.list.length}</b> 건</p>`;

                        data.list.forEach(function(item, idx) {

                        	var rowNumber     = item?.rowNumber    ?? '';
                            var instNm        = item?.instNm       ?? '';
                            var prgrmid       = item?.prgrmid      ?? '';
                            var prgrmNm       = item?.prgrmNm      ?? '';
                            var ctprvnNm      = item?.ctprvnNm     ?? '';
                            var eduSbjctNmLst = item?.eduSbjctNmLst?? '';
                            var eduTarget     = item?.eduTarget    ?? '';
                            var etrfeeStr     = item?.etrfeeStr    ?? '';
                            var cdNm          = item?.cdNm         ?? '';

                        	mobileHtml += `
                        		<li class="block">
                            	   <div class="tbody">
                                        <dl>
                                            <div class="list">
                                                <dt>번호</dt>
                                                <dd>${rowNumber}</dd>
                                            </div>
                                            <div class="list">
                                                <dt>운영기관</dt>
                                                <dd>${instNm}</dd>
                                            </div>
                                            <div class="list">
                                                <dt>프로그램</dt>
                                                <dd><a href="javascript:dsgnSttus.moveToDetail(${prgrmid})" class="link ellipsis">${prgrmNm}</a></dd>
                                            </div>
                                            <div class="list">
                                                <dt>지역</dt>
                                                <dd>${ctprvnNm}</dd>
                                            </div>
                                            <div class="list">
                                                <dt>교육주제</dt>
                                                <dd>${eduSbjctNmLst}</dd>
                                            </div>
                                            <div class="list">
                                                <dt>교육대상</dt>
                                                <dd>${eduTarget}</dd>
                                            </div>
                                            <div class="list">
                                                <dt>참가비(1인)</dt>
                                                <dd>${etrfeeStr}</dd>
                                            </div>
                                        </dl>
                                    </div>
                                </li>`;

                        	listHtml += `
                            <tr>
                            <td>${rowNumber}</td>
                        	<td>${instNm}</td>
                            <td class="al article"><a href="javascript:dsgnSttus.moveToDetail(${prgrmid})" class="link ellipsis">${prgrmNm}</a></td>
   							<td>${ctprvnNm}</td>
   							<td>${eduSbjctNmLst}</td>
   							<td>${eduTarget}</td>
   							<td>${etrfeeStr}</td>
   							<tr>
   							`;

                            var ctprvnTag = "";
                            switch(ctprvnNm) {
                                case "서울특별시":
                                    ctprvnTag = '<div class="tag tag-green">' + ctprvnNm + '</div>';
                                break;

                                case "부산광역시":
                                case "대구광역시":
                                case "울산광역시":
                                case "경상북도":
                                case "경상남도":
                                    ctprvnTag = '<div class="tag tag-olive">' + ctprvnNm + '</div>';
                                break;

                                case "인천광역시":
                                case "경기도":
                                    ctprvnTag = '<div class="tag tag-blue">' + ctprvnNm + '</div>';
                                break;

                                case "광주광역시":
                                case "전라북도":
                                case "전라남도":
                                    ctprvnTag = '<div class="tag tag-red">' + ctprvnNm + '</div>';
                                break;

                                case "세종특별자치시":
                                case "대전광역시":
                                case "충청북도":
                                case "충청남도":
                                    ctprvnTag = '<div class="tag tag-purple">' + ctprvnNm + '</div>';
                                break;

                                case "강원도":
                                case "제주특별자치도":
                                    ctprvnTag = '<div class="tag tag-brown">' + ctprvnNm + '</div>';
                                break;
                            }

                            var etrfeeTag = "";
                            if(etrfeeStr == '무료') {
                                etrfeeTag = `${etrfeeStr}</span>`;
                            }else {
                                etrfeeTag = `${etrfeeStr}</span>원`;
                            }

                            // 교육대상
                            var eduTargetStr = eduTarget;
                            var eduTarget = [];
                            var eduTargetTag = "";

                            if(eduTargetStr != null && eduTargetStr != ""){
                                eduTarget = eduTargetStr.split(",");
                            }

                            eduTarget.forEach(function(index) {
                                eduTargetTag += `<div>${index}</div>`;
                            });

                            // 교육주제
                            // 생활환경, 자연환경, 지구환경, 환경문화
                            var livingEnv = "";
                            var naturalEnv = "";
                            var globalEnv = "";
                            var cultureEnv = "";
                            var other =  "";

                            var eduSbjctStr = eduSbjctNmLst;
                            var eduSbjct = [];
                            var eduSbjctTag = "";

                            if(eduSbjctStr != null && eduSbjctStr != ""){
                                eduSbjct = eduSbjctStr.split(",");
                            }

                            eduSbjct.forEach(function(index) {
                                switch(index) {
                                case "소음" :
                                case "폐기물 및 자원순환" :
                                case "환경보건" :
                                    livingEnv += ', ' + index;
                                break;

                                case "물" :
                                case "토양" :
                                case "생태계" :
                                    naturalEnv += ', ' + index;
                                break;

                                case "기후변화 및 탄소중립" :
                                case "대기" :
                                case "에너지" :
                                    globalEnv += ', ' + index;
                                break;

                                case "지속가능발전" :
                                case "생명윤리" :
                                    cultureEnv += ', ' + index;
                                break;

                                case "기타" :
                                    other += ', ' + index;
                                break;
                                }
                            });

                            if(livingEnv != ""){
                                eduSbjctTag += `<li><button type="button" title="툴팁" disabled='disabled'>#생활환경</button><div>${livingEnv.slice(2)}</div></li>`
                            }
                            if(naturalEnv != ""){
                                eduSbjctTag += `<li><button type="button" title="툴팁" disabled='disabled'>#자연환경</button><div>${naturalEnv.slice(2)}</div></li>`
                            }
                            if(globalEnv != ""){
                                eduSbjctTag += `<li><button type="button" title="툴팁" disabled='disabled'>#지구환경</button><div>${globalEnv.slice(2)}</div></li>`
                            }
                            if(cultureEnv != ""){
                                eduSbjctTag += `<li><button type="button" title="툴팁" disabled='disabled'>#환경문화</button><div>${cultureEnv.slice(2)}</div></li>`
                            }
                            if(other != ""){
                                eduSbjctTag += `<li><button type="button" title="툴팁" disabled='disabled'>#기타</button><div>${other.slice(2)}</div></li>`
                            }

   	 						cardListHtml +=`
   	 						<li>
   	                            <div class="thumb">
   	                                <img src="/downloadFileByFileid.do?fileid=${item.fileid}&file_idntfc_key=${item.fileIdntfcKey}" alt="" onerror="this.src='/images/front/bg/bg-noimage.png'; this.style.objectFit='none';">
                                    ${ctprvnTag}
   	                                <dl class="target">
                                        <dt class="blind">대상</dt>
                                        <dd>${eduTargetTag}</dd>
   	                                </dl>
   	                            </div>
   	                            <div class="cont">
   	                                <div class="part ellipsis">${instNm}</div>
   	                                <a href="javascript:dsgnSttus.moveToDetail(${prgrmid})" class="title ellipsis" data-ellipsis="2">${prgrmNm}</a>
       	                            <ul class="hash">
       	                                ${eduSbjctTag == '' ? `<li style='visibility:hidden'>#<div></div></li>`: eduSbjctTag}

                                    </ul>
   	                                <div class="d-flex a-center j-between description">
   	                             <div class="fs-14 fc-black6">운영형태 : ${cdNm}</div>
                                 <div class="fs-16 fc-black3">참가비 <span class="fw-500">${etrfeeTag}</div>
   	                                </div>
   	                            </div>
   	                        </li>
  	    					`;
                        });
                    }

                    $('#cardList-area').html(cardListHtml);
                    $('#list-area').html(listHtml);
                    $('#list-mobile-area').html(mobileHtml);

                    $("#totalCount").html(data.totalCount);
                }
	        };

            $(function () {
            	dsgnSttus.init();
            })

            function goPage(page) {
				$("#pageNumber").val(page);

				dsgnSttus.selectList();
			}
		</script>
	</div>

</body>
</html>