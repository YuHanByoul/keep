<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security" 
    xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout" 
    layout:decorator="layout/front/subLayout" >
<body>
	<div layout:fragment="content">
		<!-- content -->
		<th:block th:if="${not #lists.isEmpty(banner)}">
			<div class="sub-banner-swiper">
				<div class="swiper ">
					<div class="swiper-wrapper">		
						<th:block th:each="item : ${banner}">
							<div class="swiper-slide">
								<a th:href="${item.url}">
									<div class="thumb" style="height:260px;"><img th:src="@{/downloadFileByFileid.do?fileid=}+${item.bannerFileid}+@{&file_idntfc_key=}+${item.fileIdntfcKey}" alt=""></div>
								</a>
							</div>
						</th:block>
					</div>
					<button type="button" class="swiper-button-next"></button>
					<button type="button" class="swiper-button-prev"></button>
					<div class="swiper-control">
						<div class="swiper-pagination"></div>
						<button type="button" class="swiper-button-play" title="자동재생 시작"></button>
						<button type="button" class="swiper-button-stop" title="자동재생 멈춤"></button>
					</div>
				</div>
			</div>
		</th:block>

		<div class="tab-content tab-sub dropDown">
			<button type="button" class="tab-mobile-trigger trigger" aria-haspopup="listbox" aria-expanded="true">탄소중립 환경교육</button>
			<ul class="tab-list target" role="tablist">
				<li class="tab active">
					<button aria-controls="tab-subpanel01" id="tab-sub01" role="tab">탄소중립 환경교육</button>
				</li>
				<li class="tab">
					<button aria-controls="tab-subpanel02" id="tab-sub02" role="tab">탄소중립 환경교육 프로그램</button>
				</li>
			</ul>
			<div id="tab-subpanel01" class="tabpanel" role="tabpanel" aria-labelledby="tab-sub01">

				<form class="search-filter" id="enveduSearchForm" name="enveduSearchForm">
					<div class="form-input mo-flex-wrap">
						<strong class="label">지난호 보기</strong>
						<div class="form-input">
							<select title="지난호 보기 년 선택" name="enveduSearchYr" id="enveduSearchYr">
								<option value="">- 전체 -</option>
								<th:block th:each="item : ${enveduYr}">
									<option th:value="${item.yr}"><th:block th:text="${item.yr}"></th:block>년</option>
								</th:block>
							</select>
							<select title="지난호 보기 월 선택" name="enveduSearchMm" id="enveduSearchMm">
								<option value="">- 전체 -</option>
								<th:block th:each="item : ${enveduMm}">
									<option th:value="${item.qu}"><th:block th:text="${item.qu}"></th:block>분기</option>
								</th:block>
							</select>
						</div>
						<div class="search-filter-submit">
							<button type="button" class="btn-medium btn-green btn-before-search" onclick="envedu.search()">검색</button>
							<button type="button" class="btn-medium btn-gray btn-before-refresh" onclick="envedu.searchInit()">초기화</button>
						</div>
					</div>
					<input type="hidden" id="compareQuarter" name="compareQuarter">
					<input type="hidden" id="compareYear" name="compareYear">
					<input type="hidden" id="beforeQuarter" name="beforeQuarter">
					<input type="hidden" id="nextQuarter" name="nextQuarter">
				</form>

				<div class="table-caption">
					<div class="left">
						<h3 class="sub-title" id="enveduNowDate"></h3>
					</div>
				</div>

				<div class="card-section" id="envedu-card-list">
					<ul class="n4" id="envedu-list-area">
					</ul>
				</div>

				<div class="btn-wrap">
					<div class="center">
						<button type="button" class="btn-medium btn-gray btn-before-prev" onclick="beforeList()">이전호</button>
						<button type="button" class="btn-medium btn-blue btn-after-next" onclick="nextList()">다음호</button>
					</div>
				</div>


			</div>
			<div id="tab-subpanel02" class="tabpanel" role="tabpanel" aria-labelledby="tab-sub02">
				
				<form class="search-filter" id="prgrmgdSearchForm" name="prgrmgdSearchForm">
					<div class="form-input mo-flex-wrap">
						<strong class="label">지난호 보기</strong>
						<div class="form-input">
							<select title="지난호 보기 년 선택" name="prgrmgdSearchYr" id="prgrmgdSearchYr">
								<option value="">- 전체 -</option>
								<th:block th:each="item : ${prgrmgdYr}">
									<option th:value="${item.yr}"><th:block th:text="${item.yr}"></th:block>년</option>
								</th:block>
							</select>
							<select title="지난호 보기 월 선택" name="prgrmgdSearchMm" id="prgrmgdSearchMm">
								<option value="">- 전체 -</option>
								<th:block th:each="item : ${prgrmgdMm}">
									<th:block th:if="${item.qu} != '특별호'">
										<option th:value="${item.qu}"><th:block th:text="${item.qu}"></th:block>분기</option>
									</th:block>
									<th:block th:unless="${item.qu} != '특별호'">
										<option th:value="${item.qu}"><th:block th:text="${item.qu}"></th:block></option>
									</th:block>									
								</th:block>		
							</select>
						</div>
						<div class="search-filter-submit">
							<button type="button" class="btn-medium btn-green btn-before-search" onclick="prgrmgd.search()">검색</button>
							<button type="button" class="btn-medium btn-gray btn-before-refresh" onclick="prgrmgd.searchInit()">초기화</button>
						</div>
					</div>
					<input type="hidden" id="prgrmgd-compareQuarter" name="compareQuarter">
					<input type="hidden" id="prgrmgd-compareYear" name="compareYear">
					<input type="hidden" id="prgrmgd-beforeQuarter" name="beforeQuarter">
					<input type="hidden" id="prgrmgd-nextQuarter" name="nextQuarter">
				</form>

				<div class="table-caption">
					<div class="left">
						<h3 class="sub-title" id="prgrmgdNowDate">탄소중립 환경교육 프로그램</h3>
					</div>
				</div>

				<div class="card-section" id="prgrmgd-card-list">
					<ul class="n3" id="prgrmgd-list-area">
					</ul>
				</div>

				<div class="btn-wrap">
					<div class="center">
						<button type="button" class="btn-medium btn-gray btn-before-prev" onclick="beforeList()">이전호</button>
						<button type="button" class="btn-medium btn-blue btn-after-next" onclick="nextList()">다음호</button>
					</div>
				</div>

			</div>
		</div>
		<!-- //content -->
		
		<script th:inline="javascript">
		var envedu = {
			listUrl: '/front/wbzn/carbon/selectEnveduList.do',
			detailUrl : '/front/wbzn/carbon/enveduDetailForm.html',
			
			init(rowPerPage) {
				if(rowPerPage != null) {
					$("#rowPerPage").val(parseInt(rowPerPage));
					$('#pageNumber').val('1');
				}
				this.selectEnveduList();
			},
			
			moveToDetail() {
				if (this.userid == null) {
					alert('로그인 후 이용하실 수 있습니다.');
					return;
				}
				location.href = '/front/wbzn/carbon/enveduDetailForm.html';
			},
			
			search() {
				if($("#enveduSearchYr").val() == "" && $("#enveduSearchMm").val() != "") {
					alert("년도를 선택해 주십시오.");
					return false;
				}
				
				$('#pageNumber').val('1');
				
				if($("#enveduSearchYr").val() != "" && $("#enveduSearchMm").val() != "") {
					transformMonth("search");
					$("#compareQuarter").val($("#enveduSearchMm").val());
					$("#compareYear").val($("#enveduSearchYr").val());				
				}
				
				if(quarter != "") {
					$("#enveduNowDate").text(quarter+"분기 환경교육");	
				}else {
					$("#enveduNowDate").text("환경교육");
				}
				
				this.selectEnveduList();
				prgrmgd.init();
			},
			
			searchInit() {
				$("#enveduSearchYr").val('');
				$("#enveduSearchMm").val('');
				
				month = now.getMonth() + 1;
				quarter = null;
				
				transformMonth();
				$("#beforeQuarter").val("");
				$("#nextQuarter").val("");
				$("#compareQuarter").val("");
				$("#compareYear").val("");
				
				if(quarter != "") {
					$("#enveduNowDate").text(quarter+"분기 환경교육");	
				}else {
					$("#enveduNowDate").text("환경교육");
				}
				
				this.selectEnveduList();
				prgrmgd.init();
			},
			
			selectEnveduList() {
				if (displayWorkProgress(true)) {
					let formData = $('#enveduSearchForm').serializeArray();
					
					$.ajax({
						url: envedu.listUrl,
						cache: false,
						dataType: 'json',
						data: formData,
						type: 'GET',
						success: function (result) {
							if(result.list.length != 0){
								$('#envedu-card-list').removeClass();
								$('#envedu-card-list').addClass('card-section');
							}
							
							var data = escapeData(result);
							envedu.makeListHtml(data);
							closeWorkProgress();
						}
					});
				}
			},
			
			moveToDetail(enveduid) {
				var f = document.forms.searchForm ;
				f.enveduid.value=enveduid;
				f.action = this.detailUrl;
				f.submit();
			},

			makeListHtml(data) {
				var enveduListHtml = "";
				if (data.list == null || data.list.length <= 0) {
					$('#compareDate').val(year+"-"+month+"-"+date)
					
					$('#envedu-card-list').removeClass();
					$('#envedu-card-list').addClass('nodata');
					
					enveduListHtml += `
					<p><span class="icon icon-notice bg-black9"></span>등록된 환경교육이 없습니다.</p>
					`;
				} else {
					data.list.forEach(function(item) {
						var enveduSe = item.enveduSeCdNm;
						console.log(enveduSe)
						var enveduSeTag = "";
						
						switch(enveduSe) {
							case "탄소중립 교육자료" :
								enveduSeTag = `<div class="tag tag-red">${item.enveduSeCdNm}</div>`;
							break;
							
							case "탄소중립 영상자료" :
								enveduSeTag = `<div class="tag tag-violet">${item.enveduSeCdNm}</div>`;
							break;

							case "환경교육 용어사전" :
								enveduSeTag = `<div class="tag tag-gray">${item.enveduSeCdNm}</div>`;
							break;

							case "유아 탄소중립" :
								enveduSeTag = `<div class="tag tag-green">${item.enveduSeCdNm}</div>`;
							break;

							case "초·중등 탄소중립" :
								enveduSeTag = `<div class="tag tag-purple">${item.enveduSeCdNm}</div>`;
							break;

							case "일반 탄소중립" :
								enveduSeTag = `<div class="tag tag-blue">${item.enveduSeCdNm}</div>`;
							break;

							case "교원 탄소중립":
								enveduSeTag = `<div class="tag tag-brawn">${item.enveduSeCdNm}</div>`;
							break;

							case "탄소중립 환경뉴스":
								enveduSeTag = `<div class="tag tag-olive">${item.enveduSeCdNm}</div>`;
							break;
							
							case "탄소중립 환경교육":
								enveduSeTag = `<div class="tag tag-dblue">${item.enveduSeCdNm}</div>`;
							break;
                        }
						
						enveduListHtml += `
						<li>
							<div class="thumb">
								<img src="/downloadFileByFileid.do?fileid=${item.thmbnFileid}&file_idntfc_key=${item.fileIdntfcKey}" alt="">
								${enveduSeTag}
							</div>
							<div class="cont mt0">
								<a href="/front/wbzn/now/enveduDetailForm.html?enveduid=${item.enveduid}" class="title ellipsis" data-ellipsis="2">${item.ttl}</a>
							</div>
						</li>
						`;
					});
				}
				$('#envedu-list-area').html(enveduListHtml);
			}
		};
        	
		var prgrmgd = {
			listUrl: '/front/wbzn/carbon/selectPrgrmgdList.do',
			detailUrl : '/front/wbzn/carbon/prgrmgdDetailForm.html',
			
			init(rowPerPage) {
				if(rowPerPage != null) {
					$("#rowPerPage").val(parseInt(rowPerPage));
					$('#pageNumber').val('1');
				}
				this.selectPrgrmgdList();
			},
			
			moveToDetail() {
				if (this.userid == null) {
					alert('로그인 후 이용하실 수 있습니다.');
					return;
				}
				location.href = '/front/wbzn/carbon/prgrmgdDetailForm.html';
			},
			
			search() {
				if($("#prgrmgdSearchYr").val() == "" && $("#prgrmgdSearchMm").val() != "") {
					alert("년도를 선택해 주십시오.");
					return false;
				}
				
				$('#pageNumber').val('1');
				
				if($("#prgrmgdSearchYr").val() != "" && $("#prgrmgdSearchMm").val() != "") {
					transformMonth("search");
					$("#prgrmgd-compareQuarter").val($("#prgrmgdSearchMm").val());
					$("#prgrmgd-compareYear").val($("#prgrmgdSearchYr").val());
				}
				
				if(quarter != "") {
					if(quarter != "특별호") {
						$("#prgrmgdNowDate").text(quarter+"분기 탄소중립 환경교육 프로그램");						
					}else {
						$("#prgrmgdNowDate").text(quarter+" 탄소중립 환경교육 프로그램");
					}
				}else {
					$("#prgrmgdNowDate").text("탄소중립 환경교육 프로그램");
				}
				
				this.selectPrgrmgdList();
				envedu.init();
			},
			
			searchInit() {
				$("#prgrmgdSearchYr").val('');
				$("#prgrmgdSearchMm").val('');
				
				month = now.getMonth() + 1;
				quarter = null;
				
				transformMonth();
				$("#prgrmgd-beforeQuarter").val("");
				$("#prgrmgd-nextQuarter").val("");
				$("#prgrmgd-compareQuarter").val("");
				$("#prgrmgd-compareYear").val("");
				if(quarter != "") {
					$("#prgrmgdNowDate").text(quarter+"분기 탄소중립 환경교육 프로그램");
				}else {
					$("#prgrmgdNowDate").text("탄소중립 환경교육 프로그램");
				}
				
				this.selectPrgrmgdList();
				envedu.searchInit();
			},
			
			selectPrgrmgdList() {
				if (displayWorkProgress(true)) {
					let formData = $('#prgrmgdSearchForm').serializeArray();
					
					$.ajax({
						url: prgrmgd.listUrl,
						cache: false,
						dataType: 'json',
						data: formData,
						type: 'GET',
						success: function (data) {
							if(data.list.length != 0){
								$('#prgrmgd-card-list').removeClass();
								$('#prgrmgd-card-list').addClass('card-section');
							}
							prgrmgd.makeListHtml(data);
							closeWorkProgress();
						}
					});
				}
			},
			
			moveToDetail(prgrmgdid) {
				var f = document.forms.searchForm ;
				f.prgrmgdid.value=prgrmgdid;
				f.action = this.detailUrl;
				f.submit();
			},
			
			makeListHtml(data) {
				var prgrmgdListHtml = "";
				if (data.list == null || data.list.length <= 0) {
					$('#compareDate').val(year+"-"+month+"-"+date)
					
					$('#prgrmgd-card-list').removeClass();
					$('#prgrmgd-card-list').addClass('nodata');
					
					prgrmgdListHtml += `
						<p><span class="icon icon-notice bg-black9"></span>등록된 탄소중립 환경교육 프로그램이 없습니다.</p>
					`;
				} else {
					data.list.forEach(function(item) {
						var rgnCdNm = item.rgnCdNm;
						var rgnCdTag = "";
						
						switch(rgnCdNm) {
                            case "서울":
                            	rgnCdTag = `<span class="tag tag-green">${rgnCdNm}</span>`;
                            break;
                            
                            case "경기/인천":
                            	rgnCdTag = `<span class="tag tag-blue">${rgnCdNm}</span>`;
                            break;       
                                   
                            case "강원/제주":       
                            	rgnCdTag = `<span class="tag tag-brown">${rgnCdNm}</span>`;
                            break;
                                   
                            case "호남권":       
                            	rgnCdTag = `<span class="tag tag-red">${rgnCdNm}</span>`;
                            break;
                                   
                            case "충청권":       
                            	rgnCdTag = `<span class="tag tag-purple">${rgnCdNm}</span>`;
                            break;
                                  
                            case "영남권":       
                            	rgnCdTag = `<span class="tag tag-olive">${rgnCdNm}</span>`;
                            break;
	                    }
						
						prgrmgdListHtml += `
						<li>
							<div class="thumb">
								<img src="/downloadFileByFileid.do?fileid=${item.thmbnFileid}&file_idntfc_key=${item.fileIdntfcKey}" alt="">
								${rgnCdTag}
							</div>
							<div class="cont mt0">
								<a href="/front/wbzn/carbon/prgrmgdDetailForm.html?prgrmid=${item.prgrmid}" class="title ellipsis" data-ellipsis="2">${item.ttl}</a>
								<ul class="df">
									<li class="d-flex">
										<span class="tit">진행일정 : </span>
										<span class="dc">${item.schdl}</span>
									</li>
								</ul>
								<div class="fs-14 fc-black6">${item.cnSumry}</div>

							</div>
						</li>
						`;
						
					});
				}
				$('#prgrmgd-list-area').html(prgrmgdListHtml);
			}
		};
		
		var now = new Date();
		var year = now.getFullYear();
		var month = now.getMonth() + 1;
		var date = now.getDate();
		var quarter = null;
		
		function transformMonth(type) {
			if(type == "before"){
				if (month <= 1) {
				  year--;
				  month = 12;
				}else{
					month -= 3;
				}
				
				if(month == 1 || month == 2 || month == 3) {
					quarter = 1
				}else if(month == 4 || month == 5 || month == 6) {
					quarter = 2
				}else if(month == 7 || month == 8 || month == 9) {
					quarter = 3;
				}else {
					quarter = 4;
				}
				
				return quarter;
			}else if(type == "next"){
				console.log(month)
				if(month >= 12){
					year++;
					month = 1;
				}
				
				if(month == 1 || month == 2 || month == 3) {
					quarter = 1;
				}else if(month == 4 || month == 5 || month == 6) {
					quarter = 2;
				}else if(month == 7 || month == 8 || month == 9) {
					quarter = 3;
				}else {
					quarter = 4;
				}
				
				return quarter;
			}else if(type == "search"){
				if($("#enveduSearchYr").val() != '' || $("#enveduSearchMm").val() != ''){
					year = $("#enveduSearchYr").val();
					quarter = $("#enveduSearchMm").val();
				}else if($("#prgrmgdSearchYr").val() != '' || $("#prgrmgdSearchMm").val() != ''){
					year = $("#prgrmgdSearchYr").val();
					quarter = $("#prgrmgdSearchMm").val();
				}
			}else{
				console.log(month)
				if(month == 1 || month == 2 || month == 3) {
					quarter = 1;
				}else if(month == 4 || month == 5 || month == 6) {
					quarter = 2;
				}else if(month == 7 || month == 8 || month == 9) {
					quarter = 3;
				}else {
					quarter = 4;
				}
				
				return quarter;
			}
		}
		
		function beforeList() {
			$("#enveduSearchYr").val('');
			$("#enveduSearchMm").val('');
			$("#prgrmgdSearchYr").val('');
			$("#prgrmgdSearchMm").val('');
			$("#beforeQuarter").val("before");
			$("#nextQuarter").val("");
			$("#prgrmgd-beforeQuarter").val("before");
			$("#prgrmgd-nextQuarter").val("");
			
			transformMonth("before");
			$("#enveduNowDate").text(quarter+"분기 환경교육");
			$("#prgrmgdNowDate").text(quarter+"분기 탄소중립 환경교육 프로그램");
			
			$("#compareQuarter").val(quarter);
			$("#compareYear").val(year);
			$("#prgrmgd-compareQuarter").val(quarter);
			$("#prgrmgd-compareYear").val(year);
			
			envedu.selectEnveduList();
			prgrmgd.selectPrgrmgdList();
		}
		
		function nextList() {
			$("#enveduSearchYr").val('');
			$("#enveduSearchMm").val('');
			$("#prgrmgdSearchYr").val('');
			$("#prgrmgdSearchMm").val('');			
			$("#beforeQuarter").val("");
			$("#nextQuarter").val("next");
			$("#prgrmgd-beforeQuarter").val("");
			$("#prgrmgd-nextQuarter").val("next");
			
			month += 3;
			transformMonth("next");
			$("#enveduNowDate").text(quarter+"분기 환경교육");
			$("#prgrmgdNowDate").text(quarter+"분기 탄소중립 환경교육 프로그램");
			
			$("#compareQuarter").val(quarter);
			$("#compareYear").val(year);
			$("#prgrmgd-compareQuarter").val(quarter);
			$("#prgrmgd-compareYear").val(year);
			
			envedu.selectEnveduList();
			prgrmgd.selectPrgrmgdList();
		}

		$(function () {
			$("#enveduNowDate").text(transformMonth()+"분기 환경교육")
			$("#prgrmgdNowDate").text(transformMonth()+"분기 탄소중립 환경교육 프로그램")
			envedu.init();
			prgrmgd.init();
		})
		
		//footer banner
			var subBannerSwiper = new Swiper(".sub-banner-swiper .swiper", {
				slidesPerView : 1,
				spaceBetween: 24,
				navigation: {
					nextEl: ".sub-banner-swiper .swiper-button-next",
					prevEl: ".sub-banner-swiper .swiper-button-prev",
				},
				pagination: {
					el: ".sub-banner-swiper .swiper-pagination",
				},
				a11y: {
					prevSlideMessage: '이전 슬라이드',
					nextSlideMessage: '다음 슬라이드',
				},
				autoplay : {
					delay : 3000,
					disableOnInteraction : false
				},
				loop : true
			});
			$('.sub-banner-swiper .swiper').find('.swiper-button-play').bind({
				'click':function(e){
					subBannerSwiper.autoplay.start();
					$(this).hide();
					$(this).parent().find('.swiper-button-stop').show().focus();
				}
			});
			$('.sub-banner-swiper .swiper').find('.swiper-button-stop').bind({
				'click':function(e){
					subBannerSwiper.autoplay.stop();
					$(this).hide();
					$(this).parent().find('.swiper-button-play').show().focus();
				}
			});
		</script>
	</div>

</body>
</html>