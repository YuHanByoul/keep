<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
	layout:decorator="layout/front/intro/detailLayout">
<body>
	<div layout:fragment="content">

		<form id="bbsForm" th:action="@{/}" method="POST" class="form-inline" onsubmit="return false;">

			<article class="notice-wrap">
				<h3 class="title">
					<th:block th:text="${bbsInfo.nm}">
				</h3>

				<div class="search-board">
				
				   <th:block  th:if ="${bbsInfo.cl_use_yn == 'Y'}">
					<fieldset>
						<legend>
							<span>검색</span>
						</legend>
						<div class="search-board-in">
							<select title="구분" class="select-search" id="bbs_clid" name="bbs_clid">
								<option value="">분류선택</option>
								
								<th:block th:each="item : ${clList}">
								    <option th:value="${item.bbs_clid}"><th:block th:text="${item.cl_nm}"/></option>
								</th:block>
							</select> 
						</div>
					</fieldset>
				   </th:block>
					
					<div style="height:10px;">
					</div>
					
					<fieldset>
						<legend>
							<span>검색</span>
						</legend>
						<div class="search-board-in">
							<select title="구분" class="select-search" id="searchType"
								name="searchType">
								<option value="">전체선택</option>
								<option value="TITLE">제목</option>
								<option value="CNTNTS">내용</option>
							</select> 
							<input type="search" id="searchKeyword" name="searchKeyword" title="검색어" class="input-search">
							<button type="button" class="btn-search"onclick="searchPstList()">검색</button>
						</div>
					</fieldset>
				</div>

             
				<div class="board-wrap" >
					<div class="board-top">
						<span class="count">전체 : <span id="pstTotalCount"></span> <!-- <em><th:block th:text="${totalCount}"></th:block></em> -->
							<!--                                     ( &nbsp;<th:block th:text="${pageNumber}"></th:block>/<th:block th:text="${totalPage}"></th:block> ) -->
						</span>

						<div class="util">
							<button type="button" class="btn-reset">
								<span class="ir">초기화</span>
							</button>

							<button type="button" class="btn-list">
								<span class="ir">목록설정</span>
							</button>
						</div>
					</div>

					<table class="board-list">
						<caption>
							<span>공지사항 목록</span>
						</caption>
						<colgroup>
							<col width="5%">
                            <th:block  th:if ="${bbsInfo.cl_use_yn == 'Y'}">
 							<col width="15%">
							</th:block>
							<col width="50%">
							<col width="10%">
							<col width="10%">
							<col width="15%">
						</colgroup>
						<thead>
						    <tr>
						      <th scope="col">No.</th>
                              <th:block  th:if ="${bbsInfo.cl_use_yn == 'Y'}">
						      <th scope="col">분류</th>
						      </th:block>
						      <th scope="col">제목</th>
						      <th scope="col">작성자</th>
						      <th scope="col">조회수</th>
						      <th scope="col">등록일</th>
						    </tr>
						</thead>

						<tbody id="list_area">
						</tbody>
					</table>
					
				</div>
				
 				 <div class="notice-button">
				    <a href="notice_write.html" class="btn-medium btn-color1">글쓰기</a>
                 </div>
			</article>
			
			    <!-- paging -->
			    <div class="notice-button">&nbsp;</div>
			    <!-- paging -->
			    <div class="paging"></div>
			    
				<input type="hidden" id="pageNumber" name="pageNumber" value="1">
				<input type="hidden" id="ORDER_DIRECTION" name="ORDER_DIRECTION" value="DESC"> 
				<input type="hidden" id="orderField" name="orderField" value="order_num ASC, hot_order_num desc, ord_reg_dt desc, ord_updt_dt ">
			    <input type="hidden" id="pstid" name="pstid" value="0">
		</form>
		
		<script th:inline="javascript">
		    var BbsVo = /*[[${BbsVo}]]*/null;
		    var bbsInfo = /*[[${bbsInfo}]]*/null;
			var selectPstListUrl = "/front/bbs/"+bbsInfo.bbsid+"/selectPstList.do"
			var goReadUrl = "/front/bbs/"+bbsInfo.bbsid+"/view.html"
			var goWriteUrl = "/front/bbs/"+bbsInfo.bbsid+"/write.html"
			
			$(document).ready(function() {
				
				if(BbsVo!=null && BbsVo.pageNumber != 0 ){
					$("#pageNumber").val(BbsVo.pageNumber);
					$("#searchType").val(BbsVo.searchType);
					$("#searchKeyword").val(BbsVo.searchKeyword);
					$("#bbs_clid").val(BbsVo.bbs_clid);
				}
				
				selectPstList();
			})
			
			function selectPstList() {

				if (displayWorkProgress()){
					$.ajax({
						url : selectPstListUrl,
						cache : false,
						dataType : 'json',
						data : $("#bbsForm").serialize(),
						type : 'POST',
						success : function(data) {
							$("#list_area").html(fn_makeListHtml(data.list));
							$(".paging").html(data.pagination);
							$("#pstTotalCount").html(data.totalCount);
							closeWorkProgress();
						}
					});
				}
			}
			
			function fn_makeListHtml(list) {
				var html = "";
				if (list == null || list.length <= 0) {
					html += '<tr><td colspan="5"> 데이터가 없습니다.</td></tr>'
				} else {

					list.forEach(function(item) {

				    	html += '<tr>'
				    	html += '<td>' + item.rowNumber + '</td>'
				    	
				    	if (bbsInfo.cl_use_yn == 'Y') {
				 	   		html += '<td>' + item.cl_nm + '</td>'
				    	}
				    	
				    	html += '<td class="align-lft">'
				    	html += '    <a href="javascript:void(0);" onclick="goDetail('+ item.pstid + ')">'
				    	
				    	if (item.fxd_ntc_yn == 'Y') {
				    		html += '<span style="color:#045FB4;">[공지] </span> '
				    	}
				    	if (item.hot_yn == 'Y') {
				    		html += '<span style="color:#DF3A01;">[HOT] </span> '
				    	}
				    	if (item.new_yn == 'Y') {
				    		html += '<span style="color:#00FF00;">[NEW] </span> '
				    	}
				    	
				    	html += item.title
				    	html += '</a></td>'
				    	html += '<td>' + item.nm + '</td>'
				    	html += '<td>' + item.hits + '</td>'
				    	html += '<td>' + item.reg_dt + '</td>'
				    })
			}

				return html;
			}

			function searchPstList() {
				var searchType = $("#searchType").val()
				var searchKeyword = $("#searchKeyword").val()

				if (searchType != null && searchType != "") {
					if (searchKeyword == null || searchKeyword == "") {
						alert("검색어를 입력해주십시오");
						return;
					}
				} else {
					if (searchKeyword != null && searchKeyword != "") {
						alert("검색조건을 입력해주십시오");
						return;
					}
				}
				$("#pageNumber").val(1);
				selectPstList();
			}
			
			//공통 Pagination 사용시 function name 일괄 적용 할것
			function goPage(page) {
				$("#pageNumber").val(page);
				selectPstList();
			}
			
			function goWriteForm(){
				var f = document.bbsForm ;
				f.action = goWriteUrl;
				f.submit();
			}
			
			function goDetail(pstid){
				var f = document.forms.bbsForm ;
				f.pstid.value=pstid;
				f.action = goReadUrl;
				f.submit();
			}
		</script>
	</div>

</body>
</html>