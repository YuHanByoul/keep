<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="layout/front/subLayout">
<body>
<div layout:fragment="content">

    <form id="bbsForm" th:action="@{/}" method="GET" class="search-filter" onsubmit="return false;">
        <div class="form-input mo-flex-wrap">
            <strong class="label">검색어</strong>
            <div class="form-input">
                <select title="검색어" id="searchType" name="searchType">
                    <option value="">- 전체 -</option>
                    <option value="title">제목</option>
                    <option value="cntnts">내용</option>
                </select>
                <input type="search" title="검색어" placeholder="검색어를 입력해 주세요." id="searchKeyword" name="searchKeyword">
            </div>
            <div class="search-filter-submit">
                <button type="submit" class="btn-medium btn-green btn-before-search">검색</button>
            </div>
        </div>
        <input type="hidden" id="pageNumber" name="pageNumber" value="1"/>
        <input type="hidden" id="rowPerPage" name="rowPerPage" value="10"/>
        <input type="hidden" id="pstid" name="pstid" value="0"/>
        <input type="hidden" id="orderField" name="orderField" value="FIXORDER ASC,GRP DESC,ORD"/>
    </form>

    <div class="table-caption flex-nowrap">
        <div class="left">
            <p>총 <b id="total-count">0</b> 건</p>
        </div>
        <div class="right">
            <select title="글 보기 개수" id="selectRowPerPage" name="selectRowPerPage" onchange="onChangePageSize($(this).val(), selectPstList)">
                <option value="10">10개씩 보기</option>
                <option value="50">50개씩 보기</option>
                <option value="100">100개씩 보기</option>
            </select>
        </div>
    </div>

    <div class="pc-only">
        <div class="table-col table-layout-auto table-col-mo">
            <table>
                <caption>[[${bbsInfo.nm}]] - 번호, 제목, 첨부파일, 등록일, 조회수</caption>
                <colgroup>
                    <col>
                    <col style="width:50%;">
                    <col>
                    <col>
                    <col>
                </colgroup>
                <thead>
                <tr>
                    <th scope="col">번호</th>
                    <th scope="col">제목</th>
                    <th scope="col">첨부파일</th>
                    <th scope="col">등록일</th>
                    <th scope="col">조회수</th>
                </tr>
                </thead>
                <tbody id="pcListArea">
                </tbody>
            </table>
        </div>
    </div>

    <div class="mo-only">
        <div class="table-list">
            <ul id="moListArea">
            </ul>
        </div>
    </div>


    <div class="pagination" aria-label="pagination" id="pagination">
    </div>

    <script th:inline="javascript">
        var BbsVo = /*[[${BbsVo}]]*/null;
        var bbsInfo = /*[[${bbsInfo}]]*/null;
        var selectPstListUrl = "/front/bbs/" + bbsInfo.bbsid + "/selectPstList.do"
        var goReadUrl = "/front/bbs/" + bbsInfo.bbsid + "/view.html"
        var goWriteUrl = "/front/bbs/" + bbsInfo.bbsid + "/write.html"

        $(document).ready(function () {
            if (BbsVo != null && BbsVo.pageNumber != 0) {
                $("#pageNumber").val(BbsVo.pageNumber);
                $("#searchType").val(BbsVo.searchType);
                $("#searchKeyword").val(BbsVo.searchKeyword);
                $("#bbsClid").val(BbsVo.bbsClid);
                $('#rowPerPage').val(BbsVo.rowPerPage);
                $('#selectRowPerPage').val(BbsVo.rowPerPage);
            }

            selectPstList();

        }).on('submit', '#bbsForm', function(e) {
            e.preventDefault();

            var searchType = $("#searchType").val()
            var searchKeyword = $("#searchKeyword").val()

            if (searchType != '' && searchKeyword == '') {
                alert('검색어를 입력해 주십시오.');
                return;
            }

            $('#pageNumber').val(1);
            selectPstList();
        });

        function selectPstList() {

            if (displayWorkProgress(true)) {
                $.ajax({
                    url: selectPstListUrl,
                    cache: false,
                    dataType: 'json',
                    data: $("#bbsForm").serialize(),
                    type: 'GET',
                    success: function (response) {
                        let data = escapeData(response.list);

                        $("#pcListArea").html(fn_makeListHtmlForPc(data));
                        $("#moListArea").html(fn_makeListHtmlForMo(data));
                        $("#pagination").html(response.pagination);
                        $("#total-count").html(response.totalCount);
                        closeWorkProgress();
                    }
                });
            }
        }

        function fn_makeListHtmlForPc(list) {
            var html = "";
            if (list == null || list.length <= 0) {
                html += `
                        <tr>
                            <td class="nodata" colspan="5">
                                <p><span class="icon icon-notice bg-black9"></span>등록된 게시글이 없습니다.</p>
                            </td>
                        </tr>`;
            } else {
                list.forEach(function (item) {
                    html += `
                            <tr>
                                <td>
                                    ${bbsInfo.fxdNtcUseYn == 'Y' && item.fxdNtcYn == 'Y' ?
                        `<div class="icon icon-speaker-large bg-sred" title="중요 공지"></div>` : item.rowNumber}
                                </td>
                                <td class="al article"><a href="#" class="link ellipsis ${bbsInfo.newUseYn == 'Y' && item.newYn == 'Y' ? 'new' : ''}" title="새 글" onclick="goDetail(${item.pstid})">${item.title}</a></td>
                                <td>${item.filegrpid != 0 && item.fileCount > 0 ? '<i class="icon icon-attachment bg-blue" title="첨부파일"></i>' : ''}</td>
                                <td>${item.regDt}</td>
                                <td>${item.hits}</td>
                            </tr>`;
                })
            }
            return html;
        }

        function fn_makeListHtmlForMo(list) {
            var html = "";
            if (list == null || list.length <= 0) {
                html += `<li class="block">
                            <div class="nodata">
                                <p><span class="icon icon-notice bg-black9"></span>등록된 게시글이 없습니다.</p>
                            </div>
                        </li>`;
            } else {
                list.forEach(function (item) {
                    html += `
                        <li class="block">
                            <div class="tbody">
                                <dl>
                                    <div class="list">
                                        <dt>번호</dt>
                                        <dd>
                                              ${bbsInfo.fxdNtcUseYn == 'Y' && item.fxdNtcYn == 'Y' ? `<div class="icon icon-speaker-large bg-sred" title="중요 공지"></div>` : item.rowNumber}
                                        </dd>
                                    </div>
                                    <div class="list">
                                        <dt>제목</dt>
                                        <dd><a class="link ellipsis ${bbsInfo.newUseYn == 'Y' && item.newYn == 'Y' ? 'new' : ''}" title="새 글" onclick="goDetail(${item.pstid})">${item.title}</a></dd>
                                    </div>
                                    <div class="list">
                                        <dt>첨부파일</dt>
                                        <dd>${item.filegrpid != 0 && item.fileCount > 0 ? '<i class="icon icon-attachment bg-blue" title="첨부파일"></i>' : ''}</dd>
                                    </div>
                                    <div class="list">
                                        <dt>등록일</dt>
                                        <dd>${item.regDt}</dd>
                                    </div>
                                    <div class="list">
                                        <dt>조회수</dt>
                                        <dd>${item.hits}</dd>
                                    </div>
                                </dl>
                            </div>
                        </li>`;
                });
            }
            return html;
        }

        //공통 Pagination 사용시 function name 일괄 적용 할것
        function goPage(page) {
            $("#pageNumber").val(page);
            selectPstList();
        }

        function goWriteForm() {
            var f = document.forms.bbsForm;
            f.action = goWriteUrl;
            f.submit();
        }

        function goDetail(pstid) {
            var f = document.forms.bbsForm;
            f.pstid.value = pstid;
            f.action = goReadUrl;
            f.submit();
        }

    </script>
</div>

</body>
</html>