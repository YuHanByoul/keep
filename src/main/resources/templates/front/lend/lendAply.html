<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security" 
    xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout" 
    layout:decorator="layout/front/subLayout" >
<body>
    <script type="text/javascript" src="../files/assets/pages/accordion/accordion.js"></script>
    <div layout:fragment="content">
    <form id="lednAplyForm" >
	    <div class="table-caption">
	        <div class="left">
	            <h3 class="sub-title">대여정보</h3>
	        </div>
	    </div>
        <div class="table-row">
              <table>
                  <caption>대여정보 - 꾸러미명, 꾸러미유형, 교육주제, 교육대상, 모둠구성, 교육유형, 대여기간, 대여수량, 대여기간, 대여수량</caption>
                  <colgroup>
                      <col style="width:140px;">
                      <col>
                      <col style="width:140px;">
                      <col>
                  </colgroup>
                  <tbody>
                      <tr>
                          <th scope="row">꾸러미명</th>
                          <td>[[${lednInfo.packageNm}]]</td>
                          <th scope="row">꾸러미유형</th>
                          <td>[[${lednInfo.typeCdNm}]]</td>
                      </tr>
                      <tr>
                          <th scope="row">교육주제</th>
                          <td>[[${lednInfo.eduSbjctCdNm}]]</td>
                          <th scope="row">교육대상</th>
                          <td>[[${lednInfo.eduTrgtCdNm}]]</td>
                      </tr>
                      <tr>
                          <th scope="row">모둠구성</th>
                          <td>[[${lednInfo.teamCmpstnCdNm}]]</td>
                          <th scope="row">교육유형</th>
                          <td>[[${lednInfo.eduTypeCdNm}]]</td>
                      </tr>
                      <tr>
                          <th scope="row">대여기간</th>
                          <td>
                             <th:block th:each="item:${rndInfo}">[[${item.ordr}]]차 : [[${item.bgngDe}]] ~ [[${item.endDe}]]</th:block>
                          </td>
                          <th scope="row">대여수량</th>
                          <td>
                             <th:block th:each="item:${rndInfo}">[[${paramVo.qnty}]] 개</th:block>
                          </td>
                      </tr>
                      
                  </tbody>
              </table>
          </div>

          <div class="table-caption">
              <div class="left">
                  <h3 class="sub-title">신청정보</h3>
              </div>
              <div class="right">
                  <p class="desc"><span class="ast">*</span>표시는 필수 입력 정보입니다.</p>
              </div>
          </div>

          <div class="table-row table-row-mo">
              <table>
                  <caption>신청정보 - 신청기관, 기관유형, 예상 교육횟수, 예상 교육인원, 단체명, 신청지역</caption>
                  <colgroup>
                      <col style="width:140px;">
                      <col>
                      <col style="width:140px;">
                      <col>
                  </colgroup>
                  <tbody>
                      <tr>
                          <th scope="row">신청기관</th>
                          <td>[[${instInfo.INST_NM}]]</td>
                          <th scope="row">기관유형</th>
                          <td>[[${instInfo.INST_TYPE_CD_NM}]]</td>
                      </tr>
                      <tr>
                          <th scope="row">예상 교육횟수<i class="ast" title="필수입력">*</i></th>
                          <td>
                              <div class="form-input">
                                  <div class="bul">총</div>
                                  <input type="number" title="예상 교육횟수" id="eduCnt" name="eduCnt" min='0'>
                                  <div class="bul">회</div>
                              </div>
                              <p class="feedback "></p>
                          </td>
                          <th scope="row">예상 교육인원 <i class="ast" title="필수입력">*</i></th>
                          <td>
                              <div class="form-input">
                                  <div class="bul">총</div>
                                  <input type="number" title="예상 교육인원" id="eduNope" name="eduNope" min='0'>
                                  <div class="bul">명</div>
                              </div>
                              <p class="feedback "></p>
                          </td>
                      </tr>
                      <tr>
                          <th scope="row">단체명<i class="ast" title="필수입력">*</i></th>
                          <td><input type="text" title="단체명" id="grpNm" name="grpNm"><div class="col"><p class="feedback "></p></div></td>
                          <p class="feedback "></p>
                          <th scope="row">신청지역</th>
                          <td>[[${instInfo.CTPRVN_NM}]]</td>
                      </tr>
                  </tbody>
              </table>
          </div>
          
          
         <div class="table-caption">
             <div class="left">
                 <h3 class="sub-title">배송지 정보 확인</h3>
             </div>
             <div class="right">
                 <p class="desc"><span class="ast">*</span>표시는 필수 입력 정보입니다.</p>
             </div>
         </div>

         <div class="table-row table-row-mo">
             <table>
                 <caption>배송지 정보 확인 - 이름, 휴대전화, 이메일, 주소, 상세주소</caption>
                 <colgroup>
                     <col style="width:140px;">
                     <col>
                 </colgroup>
                 <tbody>
                     <tr>
                         <th scope="row">이름<i class="ast" title="필수입력">*</i></th>
                         <td>
                             <div class="form-input">
                                 <input type="text" title="이름" placeholder="이름 입력" data-width="304" id="recptr" name="recptr">
                             </div>
                             <p class="feedback "></p>
                         </td>
                     </tr>
                     <tr>
                         <th scope="row">휴대전화<i class="ast" title="필수입력">*</i></th>
                         <td>
                             <div class="form-input">
                                 <input type="number" title="휴대전화" placeholder="휴대전화번호 입력" data-width="304" th:value="${instInfo.TELNO}" id="recptrTelno" name="recptrTelno" >
                             </div>
                             <p class="feedback "></p>
                         </td>
                     </tr>
                     <tr>
                         <th scope="row">이메일<i class="ast" title="필수입력">*</i></th>
                         <td>
                             <div class="row row-auto flex-wrap">
                                 <div class="col">
                                     <div class="form-input">
                                         <input type="text" title="이메일 아이디" placeholder="이메일 아이디 입력" data-width="160" id="emailLocal" name="emailLocal"> 
                                         <div class="bul">@</div>
                                         <input type="text" title="이메일 도메인" placeholder="이메일 도메인 입력" data-width="160" id="emailDomain" name="emailDomain">
                                         <select id="emailDomainList" title="이메일 도메인 목록" data-width="150" >
			                                <option value="">직접입력</option>
			                                <option value="chol.com">chol.com</option>
			                                <option value="dreamwiz.com">dreamwiz.com</option>
			                                <option value="empal.com">empal.com</option>
			                                <option value="empas.com">empas.com</option>
			                                <option value="freechal.com">freechal.com</option>
			                                <option value="gmail.com">gmail.com</option>
			                                <option value="hanafos.com">hanafos.com</option>
			                                <option value="hanmail.net">hanmail.net</option>
			                                <option value="hanmir.com">hanmir.com</option>
			                                <option value="hitel.net">hitel.net</option>
			                                <option value="hotmail.com">hotmail.com</option>
			                                <option value="korea.com">korea.com</option>
			                                <option value="lycos.co.kr">lycos.co.kr</option>
			                                <option value="megapass.net">megapass.net</option>
			                                <option value="nate.com">nate.com</option>
			                                <option value="naver.com">naver.com</option>
			                                <option value="paran.com">paran.com</option>
			                                <option value="sayclub.net">sayclub.net</option>
			                                <option value="shinbiro.com">shinbiro.com</option>
			                                <option value="yahoo.co.kr">yahoo.co.kr</option>
			                            </select>
                                     </div>
                                 </div>
                                 <p class="feedback"></p>
                             </div>
                         </td>
                     </tr>
                     <tr>
                         <th scope="row">주소<i class="ast" title="필수입력">*</i></th>
                         <td>
                             <div class="form-input">
                                 <input type="text" title="우편번호" data-width="100" th:value="${instInfo.ZIP}" id="dlvyZip" name="dlvyZip"  readonly>
                                 <input type="text" title="주소" data-width="400" th:value="${instInfo.ADDR}" id="dlvyAddr" name="dlvyAddr" readonly>
                                 <button type="button" class="btn-medium btn-gray" onclick="daumPostCode()">수정</button>
                             </div>
                         </td>
                     </tr>
                     <tr>
                         <th scope="row">상세주소<i class="ast" title="필수입력">*</i></th>
                         <td>
                             <div class="row row-auto flex-wrap">
                                 <div class="col">
                                     <div class="form-input">
                                         <input type="text" title="상세주소" id="dlvyAddrDtl" name="dlvyAddrDtl" placeholder="상세주소를 입력해주세요." data-width="585" th:value="${instInfo.ADDR_DTL}">
                                     </div>
                                 </div>
                                 <p class="feedback "></p>
                             </div>
                         </td>
                     </tr>
                 </tbody>
             </table>
         </div>
         <div class="btn-wrap">
             <div class="center">
                 <th:block sec:authorize-url="/front/lend/insertLendAply.do">
                 <button type="button" class="btn-medium btn-green" onclick="save()">대여신청</button>
                 </th:block>
             </div>
         </div>
         <input type="hidden" id='rcritid'  name="rcritid"  th:value="${paramVo.rcritid}"/>
         <input type="hidden" id='qnty'     name="qnty"     th:value="${paramVo.qnty}"/>
         <input type="hidden" id='rndid'    name="rndid"    th:value="${paramVo.rndid}"/>
         <input type="hidden" id='requesrQnty'     name="requesrQnty"     th:value="${paramVo.qnty}"/>
         <input type="hidden" id='requesrRndid'    name="requesrRndid"    th:value="${paramVo.rndid}"/>
         <input type="hidden" id='telno'    name="telno"    th:value="${instInfo.MOBLPHON}"/>
         <input type="hidden" id='instNm'   name="instNm"   th:value="${instInfo.INST_NM}"/>
         <input type="hidden" id='aplcntNm' name="aplcntNm" th:value="${instInfo.NM}"/>
         <input type="hidden" id='eml'      name="eml"      th:value="${instInfo.EML}"/>
         <input type="hidden" id='instid'   name="instid"   th:value="${instInfo.INSTID}"/>
         <input type="hidden" id='ctprvnCd' name="ctprvnCd" th:value="${instInfo.CTPRVN_CD}" />
         <input type="hidden" id='packageid'name="packageid"th:value="${lednInfo.packageid}"/>
         <input type="hidden" id='sttsCd'   name="sttsCd"   value="231101"/>
         <input type="hidden" id='recptrEml'name="recptrEml"/>
         
    </form>
    
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script th:inline="javascript">
       /*<![CDATA[*/ 
       var instInfo = /*[[${instInfo}]]*/null; 
       var rndInfo = /*[[${rndInfo}]]*/null; 
       /*]]>*/
       
       $(function(){
           init();
       })
       
       function init(){
    	   if(instInfo.EML != null && instInfo.EML != ""){
    		   $("#emailLocal" ).val( instInfo.EML.split("@")[0])
    		   $("#emailDomain").val( instInfo.EML.split("@")[1])
    		   $("#emailDomainList").val( instInfo.EML.split("@")[1])
           }
       }
       
       var insertUrl = "/front/lend/insertLendAply.do";
       var successUrl = "/front/lend/lendAplyComplete.html";
       
       function  daumPostCode() {
          new daum.Postcode({
              oncomplete: function (data) {
                  let addr = '';
                  if (data.userSelectedType === 'R') {
                      addr = data.roadAddress;
                  } else {
                      addr = data.jibunAddress;
                  }
                  
                  $('#dlvyzip').val(data.zonecode);
                  $('#dlvyAddr').val(addr);
                  $('#dlvyAddrDtl').focus();
                  if(data.sigunguCode!=null){
                      $('#ctprvnCd').val((data.sigunguCode).substring(0,2));
                  }
              }
          }).open();
       }
       
       $("#emailDomainList").change(function(){
    	   $('#emailDomain').val($(this).val());
       })
       
       var validation =  $('#lednAplyForm').validate({
                    rules: {
                    	eduCnt      : {required: true, number: true ,maxlength: 10},
                    	eduNope     : {required: true, number: true,maxlength: 10},
                    	grpNm       : {required: true, maxlength: 100},
                    	recptr      : {required: true, maxlength: 100},
                    	recptrTelno : {required: true, number: true,maxlength: 20},
                    	emailLocal  : {required: true, maxlength: 100, isBlank: true},
                    	emailDomain : {required: true, maxlength: 100, isBlank: true, emailDomain: true},
                        dlvyAddr    : {required: true, maxlength: 200},
                        dlvyAddrDtl : {required: true, maxlength: 400},
                    },
                    messages: {
                        eduCnt      : {required: "교육횟수를 입력해주십시오", number: "숫자만 입력 가능합니다." ,maxlength:"10자를 넘을 수 없습니다."},
                        eduNope     : {required: "교육인원을 입력해주십시오", number: "숫자만 입력 가능합니다." ,maxlength:"10자를 넘을 수 없습니다."},
                        grpNm       : {required: "단체명을 입력해주십시오", maxlength: "100 자를 넘을수 없습니다."},
                        recptr      : {required: "이름을 입력해주십시오", maxlength: "100 자를 넘을수 없습니다."},
                        recptrTelno : {required: "전화번호를 입력해 주십시오.", number: "숫자만 입력 가능합니다.",maxlength:"20 자리를 넘을 수 없습니다." },
                        emailLocal  : {required: "이메일 아이디를 입력해 주십시오.", maxlength: "이메일 아이디는 100자를 넘을 수 없습니다.", isBlank: "이메일에 공백이 있습니다."},
                        emailDomain : {required: "이메일 도메인을 입력해 주십시오.", maxlength: "이메일 도메인은 100자를 넘을 수 없습니다.", isBlank: "이메일에 공백이 있습니다.", emailDomain: "이메일 형식이 올바르지 않습니다."},
                        dlvyAddr    : {required: "주소를 입력해 주십시오.", maxlength: "주소는 200자를 넘을 수 없습니다."},
                        dlvyAddrDtl : {required: "상세주소를 입력해 주십시오.", maxlength: "상세주소는 400자를 넘을 수 없습니다."},
                    }
        });
       
       function save(){
           
           if (!$('#lednAplyForm').valid()) return;
           
           if (!confirm("신청 하시겠습니까?")) return;
           
           $('#recptrEml').val($('#emailLocal').val() + "@" + $('#emailDomain').val());
           var param = $('#lednAplyForm').serializeArray();
           
           if (displayWorkProgress(true)) {
               $.ajax({
                   method: 'post',
                   cache: false,
                   url: insertUrl,
                   data: param,
                   dataType: 'json',
                   success: function (response) {
                       if (response.result == "success") {
                           location.href = successUrl;
                       } else {
                           alert(response.msg);
                       }
                       closeWorkProgress();
                   }
               })
           }
       }
       
    </script>
   </div>
</body>
</html>