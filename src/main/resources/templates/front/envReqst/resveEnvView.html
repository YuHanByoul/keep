<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="layout/front/subLayout">
<div layout:fragment="content">
    <link rel="stylesheet" href="/css/front/flatpickr.min.css">
    <script src="/js/front/flatpickr.js"></script>
    <script src="/js/front/flatpickr-locale-ko.js"></script>

    <div class="product-wrap sub-banner-swiper">
        <div class="thumb-swiper">
            <div class="swiper gallery-thumb">
                <div class="swiper-wrapper">
                    <div class="swiper-slide">
                        <div class="thumb"><img src="https://dummyimage.com/398x223/ffffff/000000.png" /></div>
                    </div>
                    <div class="swiper-slide">
                        <div class="thumb"><img src="https://dummyimage.com/398x223/ffffff/000000.png" /></div>
                    </div>
                    <div class="swiper-slide">
                        <div class="thumb"><img src="https://dummyimage.com/398x223/ffffff/000000.png" /></div>
                    </div>
                    <div class="swiper-slide">
                        <div class="thumb"><img src="https://dummyimage.com/398x223/ffffff/000000.png" /></div>
                    </div>
                    <div class="swiper-slide">
                        <div class="thumb"><img src="https://dummyimage.com/398x223/ffffff/000000.png" /></div>
                    </div>
                    <div class="swiper-slide">
                        <div class="thumb"><img src="https://dummyimage.com/398x223/ffffff/000000.png" /></div>
                    </div>
                    <div class="swiper-slide">
                        <div class="thumb"><img src="https://dummyimage.com/398x223/ffffff/000000.png" /></div>
                    </div>
                    <div class="swiper-slide">
                        <div class="thumb"><img src="https://dummyimage.com/398x223/ffffff/000000.png" /></div>
                    </div>
                    <div class="swiper-slide">
                        <div class="thumb"><img src="https://dummyimage.com/398x223/ffffff/000000.png" /></div>
                    </div>
                    <div class="swiper-slide">
                        <div class="thumb"><img src="https://dummyimage.com/398x223/ffffff/000000.png" /></div>
                    </div>
                </div>
                <button type="button" class="swiper-button-next"></button>
                <button type="button" class="swiper-button-prev"></button>
            </div>
            <div thumbsSlider="" class="swiper gallery-list">
                <div class="swiper-wrapper">
                    <div class="swiper-slide">
                        <div class="thumb"><img src="https://dummyimage.com/398x223/ffffff/000000.png" /></div>
                    </div>
                    <div class="swiper-slide">
                        <div class="thumb"><img src="https://dummyimage.com/398x223/ffffff/000000.png" /></div>
                    </div>
                    <div class="swiper-slide">
                        <div class="thumb"><img src="https://dummyimage.com/398x223/ffffff/000000.png" /></div>
                    </div>
                    <div class="swiper-slide">
                        <div class="thumb"><img src="https://dummyimage.com/398x223/ffffff/000000.png" /></div>
                    </div>
                    <div class="swiper-slide">
                        <div class="thumb"><img src="https://dummyimage.com/398x223/ffffff/000000.png" /></div>
                    </div>
                    <div class="swiper-slide">
                        <div class="thumb"><img src="https://dummyimage.com/398x223/ffffff/000000.png" /></div>
                    </div>
                    <div class="swiper-slide">
                        <div class="thumb"><img src="https://dummyimage.com/398x223/ffffff/000000.png" /></div>
                    </div>
                    <div class="swiper-slide">
                        <div class="thumb"><img src="https://dummyimage.com/398x223/ffffff/000000.png" /></div>
                    </div>
                    <div class="swiper-slide">
                        <div class="thumb"><img src="https://dummyimage.com/398x223/ffffff/000000.png" /></div>
                    </div>
                    <div class="swiper-slide">
                        <div class="thumb"><img src="https://dummyimage.com/398x223/ffffff/000000.png" /></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="product-section">
            <div class="title">
                <h3 th:text ="'['+${envReqst.instNm}+']'+${envReqst.fcltNm}"></h3>
                <p th:text ="${envReqst.addr}+' '+${envReqst.addrDtl}"></p>
            </div>
            <div class="btn-wrap">
                <div class="left">
                    <th:block th:if = "${gdncFileMap} != null ">
                        <span th:each="item:${gdncFileMap}" class ='label label-inverse ' th:id="'gdncFile_'+${item.fileid}">
                            <th:block th:text="${item.orginlFileNm}"></th:block>
                            &nbsp;&nbsp;
                            <a  class = 'text-white' href = "javascript:void(0)"
                                th:name="${item.fileid}" th:attr="data-idntfc-key=${item.fileIdntfcKey}">X</a>
                        </span>
                    </th:block>
                    <a href="#" class="btn-medium btn-outline-black btn-before-download">안내자료 다운로드</a>
                </div>
            </div>
            <div class="detail">
                <dl>
                    <div class="list">
                        <dt><p><span class="ast">*</span>이용공간</p></dt>
                        <dd>
                            <div class="form-input">
                                <select title="이용공간" onchange="selectSpce(this);">
                                    <option value="">---선택---</option>
                                    <option th:each="item : ${spceList}" th:value="${item.spceid}" th:text="${item.spceNm}+', 최대'+${item.maxNope}+'명, '+${item.size}+'평형'"
                                    ></option>
                                </select>
                            </div>
                        </dd>
                    </div>
                </dl>

                <dl>
                    <div class="list">
                        <dt><p><span class="ast">*</span>이용날짜</p></dt>
                        <dd>
                            <div class="form-input">
                                <input type="date" datepicker="true">
                            </div>
                        </dd>
                    </div>
                </dl>
                <dl id="timeTable" style="display:none;">
                    <div class="list">
                        <dt><p><span class="ast">*</span>이용시간</p></dt>
                        <dd>
                            <div class="form-check-list flex-column" id="timeList">
                                <label class="inp j-start">
                                    <input type="checkbox">
                                    <b class="d-flex j-between normal-wrap" style="flex:1 1 100%;">
                                        <span class="al pr5">09:00 ~ 18:00</span>
                                        <span class="ar pl5">50,000원</span>
                                    </b>
                                </label>
                                <label class="inp j-start">
                                    <input type="checkbox">
                                    <b class="d-flex j-between normal-wrap" style="flex:1 1 100%;">
                                        <span class="al pr5">09:00 ~ 12:00</span>
                                        <span class="ar pl5">25,000원</span>
                                    </b>
                                </label>
                                <label class="inp j-start">
                                    <input type="checkbox">
                                    <b class="d-flex j-between normal-wrap" style="flex:1 1 100%;">
                                        <span class="al pr5">13:00 ~ 18:00</span>
                                        <span class="ar pl5">25,000원</span>
                                    </b>
                                </label>
                                <label class="inp j-start">
                                    <input type="checkbox">
                                    <b class="d-flex j-between normal-wrap" style="flex:1 1 100%;">
                                        <span class="al pr5">19:00 ~ 21:00</span>
                                        <span class="ar pl5">25,000원</span>
                                    </b>
                                </label>
                            </div>
                        </dd>
                    </div>
                </dl>
                <dl>
                    <div class="list">
                        <dt><p><span class="ast">*</span>이용인원</p><p class="fs-14 fc-black6"><span class="ast">*</span>최대 <span id="maxNope">0</span>인</p></dt>
                        <dd>
                            <div class="form-input d-flex mo-flex-wrap al a-center j-between pt0 pb0">
                                <div class="form-input" style="flex:1;max-width:calc(100% / 3 - 10px)">
                                    <div class="bul fs-14">성인</div>
                                    <div class="form-input form-input-number">
                                        <input type="number" id="nopeAdult" min="0" max="15" title="성인" class="ac pl0 pr0">
                                        <div class="btn-number"><button type="button" class="num-up" title="숫자 증가"></button><button type="button" class="num-down" title="숫자 감소"></button></div>
                                    </div>
                                </div>
                                <div class="form-input" style="flex:1;max-width:calc(100% / 3 - 10px)">
                                    <div class="bul fs-14">아동</div>
                                    <div class="form-input form-input-number">
                                        <input type="number" id="nopeChil" min="0" max="15" title="아동" class="ac pl0 pr0">
                                        <div class="btn-number"><button type="button" class="num-up" title="숫자 증가"></button><button type="button" class="num-down" title="숫자 감소"></button></div>
                                    </div>
                                </div>
                                <div class="form-input" style="flex:1;max-width:calc(100% / 3 - 10px)">
                                    <div class="bul fs-14">유아</div>
                                    <div class="form-input form-input-number">
                                        <input type="number" id="nopeInfnt" min="0" max="15" title="유아" class="ac pl0 pr0">
                                        <div class="btn-number"><button type="button" class="num-up" title="숫자 증가"></button><button type="button" class="num-down" title="숫자 감소"></button></div>
                                    </div>
                                </div>
                            </div>
                        </dd>
                    </div>
                </dl>
                <dl>
                    <div class="list">
                        <dt><p><span class="ast">*</span>이용목적</p></dt>
                        <dd>
                            <div class="form-input">
                                <textarea title="이용목적" id="utztnPrps"></textarea>
                            </div>
                        </dd>
                    </div>
                </dl>
                <dl class="last">
                    <div class="list">
                        <dt>이용일시</dt>
                        <dd><span id="useDate">2022년 12월 23일</span><span id="useTime"></span></dd>
                    </div>
                    <div class="list">
                        <dt>금액</dt>
                        <dd><span class="fc-blue fw-700 fs-18" id="useAmt">70,000원</span></dd>
                    </div>
                </dl>
                <dl>
                    <div class="list">
                        <dt></dt>
                        <dd>
                            <button type="button" class="btn-medium btn-green" id="submitData">예약신청</button>
                        </dd>
                    </div>
                </dl>
            </div>
        </div>
    </div>

    <div class="tab-content tab-sub dropDown">
        <button type="button" class="tab-mobile-trigger trigger" aria-haspopup="listbox" aria-expanded="true">시설소개</button>
        <ul class="tab-list target" role="tablist">
            <li class="tab active"><button aria-controls="tab-subpanel01" id="tab-sub01" role="tab">시설소개</button></li>
            <li class="tab"><button aria-controls="tab-subpanel02" id="tab-sub02" role="tab">이용안내</button></li>
            <li class="tab"><button aria-controls="tab-subpanel03" id="tab-sub03" role="tab">유의사항</button></li>
        </ul>
        <div id="tab-subpanel01" class="tabpanel active" role="tabpanel" aria-labelledby="tab-sub01">

            Lorem ipsum dolor sit amet consectetur, adipisicing elit. Amet consectetur vitae deserunt recusandae voluptates, tenetur nihil eaque ullam, mollitia eius iste ipsum ratione doloribus! Eum consectetur vitae ipsam omnis ullam!


        </div>
        <div id="tab-subpanel02" class="tabpanel" role="tabpanel" aria-labelledby="tab-sub02">

            Lorem ipsum dolor sit amet consectetur adipisicing elit. Laboriosam ipsam omnis harum accusamus? Iure iusto quos error temporibus ad reprehenderit fugit minus porro facilis. Corrupti molestias natus quis libero ipsum.

        </div>
        <div id="tab-subpanel03" class="tabpanel" role="tabpanel" aria-labelledby="tab-sub03">

            Lorem ipsum dolor sit amet consectetur adipisicing elit. Laboriosam ipsam omnis harum accusamus? Iure iusto quos error temporibus ad reprehenderit fugit minus porro facilis. Corrupti molestias natus quis libero ipsum.

        </div>
    </div>

    <div class="btn-wrap">
        <div class="center">
            <button type="button" class="btn-medium btn-gray">목록</button>
        </div>
    </div>

    <form id="viewForm" method="get" onsubmit="return false;">
        <input type="hidden" id="fcltid" name="fcltid" th:value="${envReqst.fcltid}">
        <input type="hidden" id="spceid" name="spceid">
        <input type="hidden" id="rsvtdeid" name="rsvtdeid">
        <input type="hidden" id="startDate" name="startDate">
        <input type="hidden" id="endDate" name="endDate">
        <input type="hidden" name="nopeAdult" value="0">
        <input type="hidden" name="nopeChil" value="0">
        <input type="hidden" name="nopeInfnt" value="0">
        <input type="hidden" id="utztnSeCd" name="utztnSeCd">
        <input type="hidden" name="utztnPrps">
    </form>

    <script th:inline="javascript">

        // 공간리스트
        var spceList = /*[[${spceList}]]*/null;
        // 선택한 날짜 seq 리스트
        var selectedRsvtdeidList = [];
        // 최대정원
        var maxNope;
        // 선택한 인원 수
        var userCnt;
        // 이용금액
        var selectedAmt;
        // 대여인지, 숙박인지 구분값(대여 : 1, 숙박 : 0)
        var utztnSeCd = 0;

        function date2str(x, y) {
            var z = {
                m: x.getMonth() + 1,
                d: x.getDate(),
                H: x.getHours(),
                M: x.getMinutes(),
                S: x.getSeconds()
            };

            y = y.replace(/(m+|d+|H+|M+|S+)/g, function(v) {
                return ((v.length > 1 ? "0" : "") + z[v.slice(-1)]).slice(-2)
            });

            return y.replace(/(y+)/g, function(v) {
                return x.getFullYear().toString().slice(-v.length)
            });
        }

        function parseDate(strDate) {
            var _strDate = strDate;
            var _dateObj = new Date(_strDate);
            if (_dateObj.toString() == 'Invalid Date') {
                _strDate = _strDate.split('.').join('-');
                _dateObj = new Date(_strDate);
            }
            if (_dateObj.toString() == 'Invalid Date') {
                var _parts = _strDate.split(' ');

                var _dateParts = _parts[0];
                _dateObj = new Date(_dateParts);

                if (_parts.length > 1) {
                    var _timeParts = _parts[1].split(':');
                    _dateObj.setHours(_timeParts[0]);
                    _dateObj.setMinutes(_timeParts[1]);
                    if (_timeParts.length > 2) {
                        _dateObj.setSeconds(_timeParts[2]);
                    }
                }
            }

            return _dateObj;
        }

        var today = date2str(parseDate(new Date()), 'yyyy-mm-dd');
        var newToday = new Date(today);

        var envReqstView = {
            fcltid: /*[[${envReqst.fcltid}]]*/null,
            updateFormUrl: '/front/envReqst/envReqstForm.html',
            updateUrl: '/front/envReqst/updateEnvReqst.html',
            listUrl: '/front/envReqst/envReqstList.html',
            deleteUrl: '/front/envReqst/deleteHelpdesk.do',
            cancelUrl: '/front/envReqst/cancelHelpdesk.do',

            update(mode) {
                if (mode == 'cancel') {
                    if (!confirm('접수를 취소 하시겠습니까?')) return;
                    this.ajaxForSttsUpdate(this.cancelUrl);
                } else if (mode == 'delete') {
                    if (!confirm('등록하신 게시글을 삭제 하시겠습니까?')) return;
                    this.ajaxForSttsUpdate(this.deleteUrl);
                }
            },

            ajaxForSttsUpdate(url) {
                if (displayWorkProgress(true)) {
                    $.ajax({
                        method: 'post',
                        url: url,
                        dataType: 'json',
                        data: {fcltid: envReqstView.fcltid},
                        success: function (response) {
                            closeWorkProgress();
                            alert(response.msg);
                            if (response.success)
                                envReqstView.submit(envReqstView.listUrl);
                        }
                    })
                }
            },
            moveToList() {
                this.submit(this.listUrl);
            },

            moveToUpdateForm() {
                this.submit(this.updateFormUrl);
            },

            moveToUpdate() {
                this.submit(this.updateUrl);
            },

            submit(url) {
                let f = document.forms.viewForm;
                f.action = url;
                f.submit();
            }
        };

        var swiper = new Swiper(".gallery-list", {
            loop: false,
            spaceBetween: 0,
            slidesPerView: 5,
            freeMode: true,
            watchSlidesProgress: true,
        });
        var swiper2 = new Swiper(".gallery-thumb", {
            loop: false,
            spaceBetween: 10,
            thumbs: {
                swiper: swiper,
            },
            navigation: {
                nextEl: ".swiper-button-next",
                prevEl: ".swiper-button-prev",
            },
            a11y: {
                prevSlideMessage: '이전 슬라이드',
                nextSlideMessage: '다음 슬라이드',
            },
        });


        const dates01 = {
            '2023-02-09': '0',
            '2023-02-21': '0',
            '2023-02-22': '0',
            '2023-02-23': '0',
            '2023-02-24': '0',
            '2023-02-25': '1',
        }

        const classDict01 = {
            '0' : ['dot-green','모집중'],
            '1' : ['dot-gray','모집전'],
        };

        const classDict02 = {
            '0' : ['dot-blue','숙박가능'],
            '1' : ['dot-red','대여가능'],
        };
        const list01 = `<ul><li class="dot-green">모집중</li><li class="dot-gray">모집전</li><li class="dot-white">마감</li></ul>`;
        const list02 = `<ul><li class="dot-white">예약불가</li><li class="dot-blue">숙박가능</li><li class="dot-red">대여가능</li><ul>`;

        // Better always use a two digit format in your dates obj
        function get2DigitFmt(val) {
            return ('0' + val).slice(-2);
        }

        function selectSpce(el){
            var selectedVal = $(el).val();
            $('#spceid').val(selectedVal);
            makeCalendarEvent(null, selectedVal);
            for( var i=0; i<spceList.length; i++ ){
                if( spceList[i].spceid == selectedVal ){
                    // 선택한 이용공간의 정보
                    maxNope = spceList[i].maxNope;
                    resetData();
                    $('#maxNope').text(maxNope);
                }
            }
        }

        function resetData(){
            userCnt = 0;
            selectedAmt = 0;
            $('.form-input-number input[type="number"]').val(0);
            $('#timeTable').hide();
            $('#utztnPrps').val('');
            $('#useTime').empty();
            $('#useDate').empty();
        }

        function checkData(){
            let spceid = $('#spceid').val();
            let startDate = $('#startDate').val();
            let endDate = $('#endDate').val();
            let time = null;
            let nopeCnt = userCnt;
            let utztnPrps = $('#utztnPrps').val();
            let utztnSeCd = $('#utztnSeCd').val();

            if( spceid == '' ){
                alert('이용공간을 선택해 주세요.');
                return false;
            }

            if( startDate == '' || endDate == '' ){
                alert('이용날짜를 선택해 주세요.');
                return false;
            }

            if( utztnSeCd == 1 && time == '' ){
                alert('이용시간을 선택해 주세요.');
                return false;
            }

            if( nopeCnt == 0 ){
                alert('이용인원수를 입력해 주세요.');
                return false;
            }

            if( utztnPrps == '' ){
                alert('이용목적을 입력해 주세요.');
                return false;
            }

            return true;
        }

        function makeCalendarEvent(gotoYYYYMM, spceid){

            var date = new Date();
            y = date.getFullYear();
            m = date.getMonth();
            var firstDay = new Date(y, m, 1);
            var lastDay = new Date(y, m + 1, 0);

            var firstDay_string = date2str(parseDate(firstDay), 'yyyy-mm-dd');

            var lastDayOfMonth = "";

            if(gotoYYYYMM != null && gotoYYYYMM != '' && gotoYYYYMM != 'undefined'){
                lastDayOfMonth = date2str(parseDate(lastDay), 'yyyy-mm-dd');
            }else{
                lastDayOfMonth = date2str(parseDate(lastDay), 'yyyy-mm-dd');
            }

            var params = {
                spceid  : spceid
                ,bgngDt : firstDay_string
                ,endDt  : lastDayOfMonth
            }

            if(displayWorkProgress()){
                $.ajax({
                    url : "/mng/spce/selectSpceRsvtdeList.do",
                    type: 'POST',
                    cache : false,
                    dataType: 'json',
                    data : params,
                    success : function (data){

                        let list = data.rsvtdelist;

                        console.log(data.rsvtdelist);

                        let enableDates = [
                        ];

                        let disableDates = [
                        ];

                        let dates02 = {};

                        if(list.length > 0){

                            var schdul_events = { events: []};

                            list.forEach(function(item){

                                // let title  = "";
                                let background_color  = "";
                                let de = item.de;
                                // let amt = (item.amt=='0')? "무료":addComma3(item.amt)+'원';

                                if(item.utztnSeCd == '169102'){//대여
                                    // title  +=  item.strtTm +' ~ '+ item.endTm+' | '+amt
                                    dates02[de] = '1';
                                    enableDates.push(de);
                                }else{//숙박
                                    // title  +=  '숙박 | '+amt
                                    dates02[de] = '0';
                                    enableDates.push(de);
                                }

                                // let elementColor = '#0ac282';
                                // let backgroundColor = '#effcee !important';

                                //현재일자보다 이전 (운영종료)
                                if( newToday > new Date(de)){
                                    // disableDates.push(de);
                                    //운영 중지 상태
                                }else if(item.rsvtPsbltyYn == 'N'){
                                    // disableDates.push(de);
                                }else{
                                    // $("#rsvt_stts"+de).val("R");
                                }
                            })

                            let datepicker = flatpickr("[datepicker=true]",{
                                mode: "range",
                                dateFormat: "Y-m-d",
                                // disable: disableDates,
                                enable: enableDates,
                                minDate: "today",
                                locale: "ko",
                                position: "bottom center",
                                onDayCreate: function(dObj, dStr, fp, dayElem) {
                                    var date = dayElem.dateObj,
                                        // Note the + 1 in the month.
                                        key = date.getFullYear() + '-' + get2DigitFmt(date.getMonth() + 1) + '-' + get2DigitFmt(date.getDate()),
                                        value = classDict02[dates02[key]];
                                    if (value) {
                                        dayElem.className += ' ' + value[0];
                                        dayElem.title = value[1]
                                    }
                                },
                                onReady : function () {
                                    const datepickerWrap = this.calendarContainer;
                                    const datepickerList = document.createElement('div')
                                    datepickerList.classList.add('datepicker-list')
                                    datepickerWrap.appendChild(datepickerList)
                                    datepickerList.insertAdjacentHTML('beforeend', list02);
                                },
                                onChange : function(selectedDates, dateStr, instance){
                                    selectedRsvtdeidList = [];
                                    for( var d=0; d<Object.keys(dates02).length; d++ ){
                                        if( dates02[dateStr] == 1 ){
                                            // 대여
                                            var str = '';
                                            utztnSeCd = 1;
                                            $('#timeList').empty();
                                            for( var t=0; t<data.rsvtdelist.length; t++ ){
                                                let innerData = data.rsvtdelist[t];
                                                let target1 = new Date(innerData.de);
                                                let target2 = new Date(dateStr);
                                                if( target1.getFullYear() === target2.getFullYear() &&
                                                    target1.getMonth() === target2.getMonth() &&
                                                    target1.getDate()=== target2.getDate() ){
                                                    selectedRsvtdeidList.push({rsvtdeid : innerData.rsvtdeid});
                                                    $('#rsvtdeid').val(JSON.stringify(selectedRsvtdeidList));
                                                    let amt = (innerData.amt=='0')? "무료":addComma3(innerData.amt)+'원';
                                                    str = '<label class="inp j-start">\n' +
                            '                                    <input type="checkbox" id="rsvtdeTime'+innerData.rsvtdeid+'" name="rsvtdeTime" data-amt="'+innerData.amt+'" value="'+innerData.rsvtdeid+'">\n' +
                            '                                    <b class="d-flex j-between normal-wrap" style="flex:1 1 100%;">\n' +
                            '                                        <span class="al pr5 timeStr">'+innerData.strtTm +' ~ '+ innerData.endTm+'</span>\n' +
                            '                                        <span class="ar pl5">'+amt+'</span>\n' +
                            '                                    </b>\n' +
                            '                                </label>';
                                                    $('#timeList').append(str);
                                                }
                                            }
                                            $('#timeTable').show();
                                            $('#startDate').val(dateStr);
                                            $('#endDate').val(dateStr);
                                            $('#useDate').text(date2str(parseDate(dateStr), 'yyyy년 mm월 dd일'));
                                            break;
                                        }else{
                                            utztnSeCd = 0;
                                            $('#timeTable').hide();
                                        }
                                    }
                                    if( selectedDates.length > 1 ) {
                                        let selectedDatesList = [];
                                        let target1 = new Date(selectedDates[0]);
                                        let target2 = new Date(selectedDates[1]);
                                        $('#startDate').val(date2str(parseDate(selectedDates[0]), 'yyyy-mm-dd'));
                                        $('#endDate').val(date2str(parseDate(selectedDates[1]), 'yyyy-mm-dd'));
                                        if( !( target1.getFullYear() === target2.getFullYear() &&
                                            target1.getMonth() === target2.getMonth() &&
                                            target1.getDate()=== target2.getDate() ) ){
                                            let dateList = getDatesStartToLast(date2str(parseDate(selectedDates[0]), 'yyyy-mm-dd'), date2str(parseDate(selectedDates[1]), 'yyyy-mm-dd'));
                                            for( var s=0; s<selectedDates.length; s++ ){
                                                selectedDatesList.push(date2str(parseDate(selectedDates[s]), 'yyyy년 mm월 dd일'));
                                            }
                                            for( var da=0; da<dateList.length; da++ ){
                                                for( da2=0; da2<data.rsvtdelist.length; da2++ ){
                                                    let innerData = data.rsvtdelist[da2];
                                                    let daTarget1 = new Date(dateList[da]);
                                                    let daTarget2 = new Date(innerData.de);
                                                    if( daTarget1.getFullYear() === daTarget2.getFullYear() &&
                                                        daTarget1.getMonth() === daTarget2.getMonth() &&
                                                        daTarget1.getDate()=== daTarget2.getDate() ){
                                                        selectedRsvtdeidList.push({rsvtdeid : innerData.rsvtdeid});
                                                        selectedAmt += innerData.amt;
                                                    }
                                                }
                                            }

                                            $('#useDate').text(selectedDatesList.join(' ~ '));
                                            $('#useAmt').text(addComma3(selectedAmt)+'원');
                                            $('#amt').val(selectedAmt);
                                            $('#rsvtdeid').val(JSON.stringify(selectedRsvtdeidList));
                                        };
                                    }
                                }
                            });


                        }

                        closeWorkProgress();
                    }
                });
            }
        }

        function getDatesStartToLast(startDate, lastDate) {
            var regex = RegExp(/^\d{4}-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/);
            if(!(regex.test(startDate) && regex.test(lastDate))) return "Not Date Format";
            var result = [];
            var curDate = new Date(startDate);
            while(curDate <= new Date(lastDate)) {
                result.push(curDate.toISOString().split("T")[0]);
                curDate.setDate(curDate.getDate() + 1);
            }
            return result;
        }

        $(document).on('change', 'input[name="rsvtdeTime"]' , function () {
            if( $(this).prop('checked') ){
                // 이용시간 선택 시
                selectedAmt += parseInt($(this).attr('data-amt'));
                $('#useTime').text($($($(this).siblings('b')).find('.timeStr')).text());
            }else{
                selectedAmt -= parseInt($(this).attr('data-amt'));
                $('#useTime').text('');
            }
            $('#useAmt').text(addComma3(selectedAmt)+'원');
            $('#amt').val(selectedAmt);
        });

        $(document).on('click', '#submitData', function(){
            if( checkData() ){
                $('input[name="utztnPrps"]').val($('#utztnPrps').val());
                envReqstView.moveToUpdate()
            }
        })

        $(function(){
            $(document).off('keyup', '.form-input-number input[type="number"]');
            $(document).off('click', '.form-input-number button');

            $(document).on('keyup', '.form-input-number input[type="number"]' , function () {
                const numInput = $(this);
                const valueMin = parseInt(numInput[0].min);
                const valueMax = parseInt(numInput[0].max);
                if (numInput.val() > valueMax) {
                    numInput.val(valueMax)
                }
                if (numInput.val() < valueMin) {
                    numInput.val(valueMin)
                }

                let tempCnt = 0;
                $('.form-input-number input[type="number"]').each(function(){
                    tempCnt += parseInt(this.value);
                })
                let inputId = $(this).attr('id');

                if( tempCnt > maxNope ){
                    alert('최대 '+maxNope+'명 까지만 신청 가능합니다.');
                    $('input[name='+inputId+']').val(0);
                    numInput.val(0);
                }else{
                    userCnt = tempCnt;
                    $('input[name='+inputId+']').val(this.value);
                }
            });

            $(document).on('click', '.form-input-number button' , function () {
                const par = $(this).closest('.form-input-number');
                const numInput = par.find('input[type="number"]');
                const valueMin = parseInt(numInput[0].min);
                const valueMax = parseInt(numInput[0].max);

                //value up
                if ($(this).hasClass('num-up')) {
                    userCnt++;
                    if (numInput.val() === '') {
                        numInput.val(0)
                    }
                    if (valueMax > numInput.val() || numInput[0].max === '') {
                        if( userCnt > maxNope ){
                            userCnt--;
                            if( userCnt == maxNope ){
                                alert('최대 '+maxNope+'명 까지만 신청 가능합니다.');
                                numInput.val(parseInt(numInput.val()));
                            }
                        }else{
                            numInput[0].value++;
                        }
                    }
                }

                //value down
                if ($(this).hasClass('num-down')) {
                    if (numInput.val() === '') {
                        numInput.val(0)
                    }
                    if (numInput.val() > valueMin || numInput[0].min === '') {
                        numInput[0].value--;
                        userCnt--;
                    }
                }

                let inputId = $(numInput).attr('id');
                $('input[name='+inputId+']').val(numInput.val());

            });
        })
    </script>
</div>