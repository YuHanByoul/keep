<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security" 
    xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout" 
    layout:decorator="layout/front/popupLayout"
>
    <body>
        <div layout:fragment="content" class="layer-popup layer-window-alert layer-alert active">
            <div class="layer-wrap" style="max-width:none!important;max-height:none!important;">
                <div class="layer-header">
                    <strong class="tit">로그인</strong>
                </div>
                <div class="layer-content">
                    <div class="member-login noborder">
                    <form id="logOutRequest">
                        <input type="hidden" th:name="${T(kr.go.onepass.client.handler.saml.OnepassRequestHandler).LOGOUT_INPUT_NAME}" th:value="${T(kr.go.onepass.client.handler.saml.OnepassRequestHandler).logout(#request)}" />
                        <input type="hidden" name="pageType" th:value="${T(kr.go.onepass.client.handler.saml.OnepassRequestHandler).pageType(#request)}" />
                    </form>
                    <form name="request" id="request" th:action="${T(kr.go.onepass.client.handler.saml.OnepassRequestHandler).LOGIN_DEST}" method="post">
                        <input type="hidden" name="returnUrl" value="">
                        <input type="hidden" th:name="${T(kr.go.onepass.client.handler.saml.OnepassRequestHandler).LOGIN_INPUT_NAME}" th:value="${T(kr.go.onepass.client.handler.saml.OnepassRequestHandler).login()}" />
                        <dl class="mb0">
                            <dt class="mb5">디지털 원패스</dt>
                            <dd>
                                <strong>디지털원패스 아이디를 입력해 주십시오.</strong>
                                <input type="email" title="디지털원패스 아이디" placeholder="디지털원패스 아이디" id="user_id" name="user_id" onkeydown="if(event.keyCode == 13){onClickSubmit(); return false;};">
                                <label class="inp"><input type="checkbox" name="ridSave" id="ridSave" value="Y"><b>아이디 저장</b></label>
                                <p class="invalid-feedback"></p>
                            </dd>
                        </dl>
                        <div class="btn-inner">
                            <a href="javascript:onClickSubmit();" class="btn-large btn-dblue btn-fingerprint">디지털원패스로 로그인</a>
                            <ul class="link-list">
                                <li><a href="https://www.onepass.go.kr/membership/find/id" target="_blank">아이디 찾기</a></li>
                                <li><a href="https://www.onepass.go.kr/regist/agree" target="_blank">디지털원패스 회원가입</a></li>
                            </ul>
                        </div>
                    </form>
                    </div>
                </div>
            </div>
            
<script th:inline="javascript">

    jQuery(document).ready(function(){      
        var f = document.request;
        
        if(jQuery.cookie != null)
        {           
            if(jQuery.cookie('ruserid') && jQuery.cookie('ruserid') != 'undefined' && jQuery.cookie('ruserid') != 'null'){
                f.user_id.value =jQuery.cookie('ruserid');
                f.ridSave.checked = true;
            }
        }
        
        if(f.user_id.value == ""){
            jQuery("#user_id").focus();
        }
        
        jQuery.ajax({
            url : /*[[${T(kr.go.onepass.client.handler.saml.OnepassRequestHandler).logoutDest(#request)}]]*/"",
            type : "POST",
            data: $('#logOutRequest').serialize(),
            withCredentials: true,
            success : function(res) {
                console.log(res + " 로그아웃 성공");
            },
            error : function() {
                console.log("로그아웃 실패");
            }
        });
    });
    
    function onClickSubmit() {    
        var f = document.request;
        
        var user_id = f.user_id.value;
        if ( user_id == null || user_id == "" ) {
            $("#onepassInvalidFeedback").text("아이디를 입력해주세요.");
            f.user_id.focus();
            return;
        }

        if(f.ridSave.checked){
            jQuery.cookie('ruserid', f.user_id.value, {expires:30});
        }else{
            jQuery.removeCookie('ruserid');
        }
        f.returnUrl.value = location.pathname;
        f.submit();
    }
</script>
        </div>
    </body>
</html>