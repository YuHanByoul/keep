<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security" 
    xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout" 
    layout:decorator="layout/front/join/detailLayout" 
>
    <body>
        <div layout:fragment="content">
        <form id="joinForm"  onsubmit="return false">
                <ol class="join-step">
                    <li>STEP 01 <strong>약관동의</strong></li>
                    <li class="is-active"><h3 class="title-step">STEP 02 <strong>상세정보 입력</strong></h3></li>
                    <li>STEP 03 <strong>가입완료</strong></li>
                </ol>

                <h4 class="join-title">정보를 입력해 주세요.</h4>
                <p class="join-dsc">회원님이 입력하신 정보는 면밀히 보호되며 자세한 내용은 개인정보취급방침을 확인하여 주시기 바랍니다.</p>

                <div class="join-box">
                    <h5 class="title">회원정보</h5>

                    <div class="join-info-required">
                        <em class="ico-required">*</em> 필수 입력 항목
                    </div>

                    <div class="join-info-input">
                            <fieldset>
                                <legend><span>회원정보 입력</span></legend>
                                <div class="board-wrap">
                                    <table class="board-input">
                                        <caption><span>회원정보 상세 입력</span></caption>
                                        <colgroup>
                                            <col style="width: 199px">
                                            <col>
                                        </colgroup>
                                        <tr>
                                            <th scope="row">
                                                <label for="id-id"><em class="ico-required">*</em> 아이디</label>
                                            </th>
                                            <td>
                                                <div class="form-group">
                                                    <input type="text" id="acnt" name="acnt" class="input-text" style="width: 30%;">
                                                    <button type="button" class="btn-medium btn-color3" onclick="fn_checkDupleID()" >중복확인</button>
                                                    <span class="form-msg acnt_err"></span>

                                                    <!-- validation msg-->
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th scope="row">
                                                <label for="id-name"><em class="ico-required">*</em> 이름</label>
                                            </th>
                                            <td>
                                                <input type="text" id="nm" name="nm" class="input-text" style="width: 30%;">
                                                <span class="form-msg"></span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th scope="row">
                                                <label for="id-school"><em class="ico-required">*</em> 학교명</label>
                                            </th>
                                            <td>
                                                <div class="form-group">
                                                    <input type="text" id="schl_nm" name="schl_nm"class="input-text" style="width: 30%;" readonly>
                                                    <button type="button" class="btn-medium btn-color3" onclick="fn_searchSchool()" >학교검색</button>
                                                    <span class="form-msg"></span>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th scope="row">
                                                <label for="id-edu"><em class="ico-required">*</em> 담당 과목</label>
                                            </th>
                                            <td>
                                                <div class="form-group">
                                                    <input type="text" id="chrg_crs_nm" name="chrg_crs_nm" class="input-text" style="width: 30%;">
                                                    <span kattr:select_code="chrg_crs_cd" grpCd="103" firstOptTxt="선택" addClass="form-select" onchange="fn_chooseSchool"></span>
                                                    <span class="form-msg"></span>
                                                </div>
                                            </td>
                                        </tr>
                                        
                                        <tr>
                                            <th scope="row">
                                                <label for=""><em class="ico-required">*</em> 담임 여부</label>
                                            </th>
                                            <td>
                                                <div class="form-group">
                                                    <span class="form-checkbox">
                                                        <input type="radio" id="id-checkbox01" name="cls_tchr_yn" class="form-checkbox-input" value="Y" checked>
                                                        <label for="id-checkbox01" class="form-checkbox-label">담임</label>
                                                    </span>
    
                                                    <span class="form-checkbox">
                                                        <input type="radio" id="id-checkbox02" name="cls_tchr_yn" class="form-checkbox-input" value="N" >
                                                        <label for="id-checkbox02" class="form-checkbox-label">비담임</label>
                                                    </span>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th scope="row">
                                                <label for="id-pw"><em class="ico-required">*</em> 비밀번호</label>
                                            </th>
                                            <td>
                                                <input type="password" id="pswd" name="pswd" class="input-text" style="width: 30%;" autocomplete="off">

                                                <!-- validation msg-->
                                                <span class="form-msg"></span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th scope="row">
                                                <label for="id-pw2"><em class="ico-required">*</em> 비밀번호 확인</label>
                                            </th>
                                            <td>
                                                <input type="password" id="pswd_chk" name="pswd_chk" class="input-text" style="width: 30%;" autocomplete="off">

                                                <!-- validation msg-->
                                                <span class="form-msg pswd_chk"></span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th scope="row">
                                                <label for="id-email"><em class="ico-required">*</em> E-mail</label>
                                            </th>
                                            <td>
                                                <div class="form-group">
                                                    <input type="text" id="email1" name="email1" class="input-text" style="width: 21%;">
                                                    <span class="at">@</span>
                                                    <!-- 직접입력시 -->
                                                    <input type="text" id="email2" name="email2" title="입력" class="input-text" style="width: 30%;">
                                                    <!-- // 직접입력시 -->
                                                    <select title="선택" class="form-select" id="email_domain" name="email_domain"  onchange="fn_changeEmailDomain()">
                                                        <option value="">직접입력</option>
                                                        <option value="naver.com">naver.com</option>
												        <option value="gmail.com">gmail.com</option>
												        <option value="daum.net">daum.net</option>
												        <option value="nate.com">nate.com</option>
												        <option value="hanmail.net">hanmail.net</option>
												        <option value="hotmail.com">hotmail.com</option>
												        <option value="yahoo.com">yahoo.com</option>
												        <option value="empas.com">empas.com</option>
												        <option value="korea.com">korea.com</option>
												        <option value="dreamwiz.com">dreamwiz.com</option>
                                                    </select>

                                                    <!-- validation msg-->
                                                    <span class="form-msg"></span>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th scope="row">
                                                <label for="id-phone"><em class="ico-required">*</em> 휴대전화</label>
                                            </th>
                                            <td>
                                                <div class="form-group">
                                                    <select  class="form-select" id="mob_no1" name="mob_no1">
                                                        <option>선택</option>
                                                        <option value="010">010</option>
                                                        <option value="011">011</option>
                                                        <option value="016">016</option>
                                                        <option value="017">017</option>
                                                    </select>
                                                    <span class="dash">-</span>
                                                    <input type="tel" title="휴대전화 중간자리" id="mob_no2" name="mob_no2" class="input-text" style="width: 100px;">
                                                    <span class="dash">-</span>
                                                    <input type="tel" title="휴대전화 끝자리" id="mob_no3" name="mob_no3" class="input-text" style="width: 100px;">
                                                    <span class="form-msg"></span>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>

                                <div class="join-board-button">
                                    <button type="button" class="btn-large btn-color1" onclick="fn_joinMemeber()">가입신청</button>
                                </div>
                            </fieldset>
                    </div>
                </div>
                
             <!--**********HIDDEN PARAMETER**********************  -->
                <input type="hidden" id="schl_cd" name="schl_cd">
                <input type="hidden" id="checked_acnt" name="checked_acnt">
                <input type="hidden" id="mob_no" name="mob_no">
                <input type="hidden" id="email" name="email">
                <input type="hidden" id="user_se_cd" name="user_se_cd" value="T">
                <input type="hidden" id="tos_agre_yn" name="tos_agre_yn" >
             <!--***********************************************  -->
      </form>
         
    <script th:inline="javascript">
      
      var member_register_url      = "/front/member/insertMember.do";
      var id_duplication_chekc_url = "/front/member/chekcDuplicationUser.do";
      var search_school_popup        = "/front/member/searchSchoolPop.html";
      
        $(document).ready(function(){
            var prev_agre_yn = /*[[${agreYn}]]*/null;
            if(prev_agre_yn != "Y"){
            	alert("약관동의 후 회원가입 진행이 가능합니다.");
            	location.href="/front/member/provision.html";
            }else{
            	$("#tos_agre_yn").val("Y");
            }
        })
        
        function fn_chooseSchool(){
        	var chrg_crs_cd = $("#chrg_crs_cd").val();
        	var chrg_crs_nm = $("#chrg_crs_cd option:checked").text();
        	
        	if( chrg_crs_cd == null || chrg_crs_cd =="" ){
        		$("#chrg_crs_nm").val(null);
        	}else{
        	    $("#chrg_crs_nm").val(chrg_crs_nm)
        	}
        }
        
        function fn_changeEmailDomain(){
        	var domain_val = $("#email_domain").val();
        	var domain_text = $("#email_domain option:checked").text();
        	
        	if( domain_val == null || domain_val =="" ){
        		$("#email2").val(null);
        	}else{
        	    $("#email2").val(domain_text)
        	}
        }
        
        function fn_checkDupleID(){
        	
            var acnt = $("#acnt").val();
            
            if(acnt == null || acnt == ""){
            	$(".acnt_err").text("아이디를 입력해주십시오")
            	return;
            }
        	
        	if(displayWorkProgress()){	
	        	$.ajax({
					url : id_duplication_chekc_url,
		            cache : false,
		            dataType: 'json',
					data : {acnt: acnt},
					type : 'POST',
					success : function(data) {
						if(data.result){
							$(".acnt_err").text("사용가능한 아이디입니다.")
							$("#checked_acnt").val(acnt);
						}else{
							$(".acnt_err").text("이미 사용중인 아이디입니다. ")
							$("#checked_acnt").val(null);
						}
						closeWorkProgress();
					}
			   });
		   }
        }
        
        function fn_searchSchool(){
        	var pop_option ="left=800,top=500,width=500,height=670,toolbar=no,location=no"
        	window.open(search_school_popup,"school_pop",pop_option);
        }
        
        function fn_joinMemeber(){
        	
        	var cmntValidator= $("#joinForm").validate({
        		   rules   : {
        			   acnt        : { required: true, minlength:5,maxlength:20},
        			   nm          : { required: true},
        			   pswd         : { required: true, passwordPolicy2:true ,minlength:8 ,maxlength:20},
        			   pswd_chk     : { required: true, passwordPolicy2:true ,minlength:8 ,maxlength:20},
        			   schl_nm     : { required: true},
        			   schl_cd     : { required: true},
        			   chrg_crs_nm : { required: true},
        			   chrg_crs_cd : { required: true},
        			   email1      : { required: true ,maxlength:100 ,alphanumeric:true},
        			   email2      : { required: true ,maxlength:100 },
        			   cls_tchr_yn : { required: true},
        			   mob_no1     : { required: true},
        			   mob_no2     : { required: true},
        			   mob_no3     : { required: true}
        	       },
        	       messages: {
        			   acnt        : { required: "아이디를 입력해주십시오" , minlength:"5자리 이상 입력해주십시오"},
        			   nm          : { required: "이름을 입력해주십시오" },
        			   pswd         : { required: "비밀번호을 입력해주십시오"   ,passwordPolicy2:"영문,숫자,특수기호 조합 8자리 이상 입력해주십시오",minlength:"영문,숫자,특수기호 조합 8자리 이상 입력해주십시오" },
        			   pswd_chk        : { required: "비밀번호확인을 입력해주십시오",passwordPolicy2:"영문,숫자,특수기호 조합 8자리 이상 입력해주십시오",minlength:"영문,숫자,특수기호 조합 8자리 이상 입력해주십시오" },
        			   schl_nm     : { required: "학교 검색후 선택해주십시오" },
        			   schl_cd     : { required: "학교 검색후 선택해주십시오" },
        			   chrg_crs_nm : { required: "담당과목을 선택해주십시오" },
        			   chrg_crs_cd : { required: "담당과목을 선택해주십시오" },
        			   email1      : { required: "이메일을 입력해주십시오" ,alphanumeric:"알파벳과 숫자만 입력 가능합니다."},
        			   email2      : { required: "이메일을 입력해주십시오" },
        			   cls_tchr_yn : { required: "담입여부을 체크해주십시오" },
        			   mob_no1     : { required: "휴대전화번호를 입력해주십시오"},
        			   mob_no2     : { required: "휴대전화번호를 입력해주십시오"},
        			   mob_no3     : { required: "휴대전화번호를 입력해주십시오"}
        	       }
        		 })
        		 
        		 
        	if($("#joinForm").valid() == false) return;
        	
        	if($("#checked_acnt").val() != $("#acnt").val()){
        		$(".acnt_err").text("아이디 중복확인을 해주십시오");
        		return;
        	}	 
        		 
            if($("#pswd").val() != $("#pswd_chk").val()){
            	$(".pswd_chk").text("비밀번호와 일치 하지 않습니다. 다시한번 확해주십시오")
            	return;
            }
        	
        	var email1 = $("#email1").val();
        	var email2 = $("#email2").val();
        	$("#email").val(email1+"@"+email2);
        	
        	var mob_no1 = $("#mob_no1").val();
        	var mob_no2 = $("#mob_no2").val();
        	var mob_no3 = $("#mob_no3").val();
        	$("#mob_no").val(mob_no1+"-"+mob_no2+"-"+mob_no3);
        	
        	var param_data = $("#joinForm").serialize();
        	if(displayWorkProgress()){
		 		$.ajax({
					url : member_register_url,
		            cache : false,
		            dataType: 'json',
					data : param_data,
					type : 'POST',
					success : function(data) {
						console.log(data)
						if(data.result){
							location.href= "/front/member/joinComplete.html";
						}else{
							alert("회원가입이 정상적으로 되지 않았습니다. 확인 해주십시오.")
						}
						closeWorkProgress();
					}
			   });
			}
        }
        
      </script>
      </div>
    </body>
</html>