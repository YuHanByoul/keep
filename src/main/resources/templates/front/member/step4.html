<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security" 
    xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout" 
    layout:decorator="layout/front/membershipLayout"
>
    <body>
        <th:block layout:fragment="content">
            <form name="memberInfoForm" id="memberInfoForm">
            <input type="hidden" name="type" id="type" th:value="${data.type}" />
            <input type="hidden" name="tosAgreYn" id="tosAgreYn" th:value="${data.tosAgreYn}" />
            <input type="hidden" name="privcyAgreYn" id="privcyAgreYn" th:value="${data.privcyAgreYn}" />
            <input type="hidden" name="prvcThptyPvsnAgreYn" id="prvcThptyPvsnAgreYn" th:value="${data.prvcThptyPvsnAgreYn}" />
            <input type="hidden" name="childJoinAgreYn" th:if="${data.type == 'C'}" id="childJoinAgreYn" th:value="${param.childJoinAgreYn}" />
            <input type="hidden" name="wbznAplyAgreYn" id="wbznAplyAgreYn" th:value="${data.wbznAplyAgreYn}" />
            <input type="hidden" name="wbznAp" id="wbznAplyAgreYn" th:value="${data.wbznAplyAgreYn}" />
            <input type="hidden" name="pencodeData" id="pencodeData" th:value="${data.pencodeData}" />
            <input type="hidden" name="encodeData" id="encodeData" th:value="${data.encodeData}" />
            <input type="hidden" name="onepassEncodeData" id="onepassEncodeData" th:value="${data.onepassEncodeData}" />
            <input type="hidden" name="returnUrl" id="returnUrl" th:value="${data.returnUrl}" />
            <input type="hidden" name="signguCd" id="signguCd" />
            <input type="hidden" name="zip" id="zip" />
            <input type="hidden" name="artclid" id="artclid" />
            <input type="hidden" name="instSignguCd" id="instSignguCd" />
            <input type="hidden" name="instZip" id="instZip" />
            <input type="hidden" name="directYn" id="directYn" />
            <input type="hidden" name="userid" id="userid" th:value="${memberInfo.userid}" />
            
            <section>
                <div class="underline-title">
                    <h2 th:if="${#strings.isEmpty(data.onepassEncodeData)}">회원가입</h2>
                    <h2 th:unless="${#strings.isEmpty(data.onepassEncodeData)}">회원연동</h2>
                </div>
        
                <div class="steps">
                    <ol>
                        <li>
                            <div class="steps-inner">
                                <span>01</span>
                                <strong th:if="${#strings.isEmpty(data.onepassEncodeData)}">회원가입 유형</strong>
                                <strong th:unless="${#strings.isEmpty(data.onepassEncodeData)}">회원연동 유형</strong>
                            </div>
                        </li>
                        <li>
                            <div class="steps-inner">
                                <span>02</span>
                                <strong>약관동의</strong>
                            </div>
                        </li>
                        <li th:if="${#strings.isEmpty(data.onepassEncodeData) or data.type == 'C'}">
                            <div class="steps-inner">
                                <span>03</span>
                                <strong>본인인증</strong>
                            </div>
                        </li>
                        <li class="active" title="현재 단계" aria-current="step">
                            <div class="steps-inner">
                                <span th:if="${#strings.isEmpty(data.onepassEncodeData) or data.type == 'C'}">04</span>
                                <span th:unless="${#strings.isEmpty(data.onepassEncodeData) or data.type == 'C'}">03</span>
                                <strong>회원정보입력</strong>
                            </div>
                        </li>
                        <li>
                            <div class="steps-inner" th:if="${#strings.isEmpty(data.onepassEncodeData) or data.type == 'C'}">
                                <span>05</span>
                                <strong th:if="${#strings.isEmpty(data.onepassEncodeData)}">가입완료</strong>
                                <strong th:unless="${#strings.isEmpty(data.onepassEncodeData)}">연동완료</strong>
                            </div>
                            <div class="steps-inner" th:unless="${#strings.isEmpty(data.onepassEncodeData) or data.type == 'C'}">
                                <span>04</span>
                                <strong>연동완료</strong>
                            </div>
                        </li>
                    </ol>
                </div>
    
                <div class="table-caption">
                    <div class="left">
                        <h3 class="sub-title">회원정보<th:block th:if="${memberInfo.userid == null}"> 입력</th:block></h3>
                    </div>
                    <div class="right">
                        <p class="desc"><th:block th:if="${memberInfo.userid == null}"><span class="ast">*</span>표시는 필수 입력 정보입니다.</th:block></p>
                    </div>
                </div>
    
                <div class="table-row table-row-mo">
                    <table>
                        <caption>회원가입  - 이름, 아이디, 비밀번호, 비밀번호 확인, 휴대전화, 이메일, 주소, 상세주소, 관심분야, 맞춤 환경정보</caption>
                        <colgroup>
                            <col style="width:140px;">
                            <col>
                        </colgroup>
                        <tbody>
                            <tr th:if="${data.type == 'C'}">
                                <th scope="row">보호자 성명</th>
                                <td>
                                    <div class="form-input">
                                        <input type="text" title="보호자 성명" placeholder="보호자 성명 입력" data-width="304" th:value="${pauthData.sName}" readonly="" style="width: 304px; flex: 0 1 304px;">
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">이름<th:block th:if="${memberInfo.userid == null}"><i class="ast" title="필수입력">*</i></th:block></th>
                                <td>
                                    <div class="row row-auto flex-wrap">
                                        <div class="col">
                                            <div class="form-input">
                                                <input type="text" name="nm" id="nm" maxlength="20" title="이름" placeholder="이름 입력" data-width="304" th:value="${authData.sName != null ? authData.sName : memberInfo.nm}" th:readonly="${authData.sName != null or  memberInfo.nm != null}">
                                            </div>
                                        </div>
                                        <div class="col">
                                            <p class="feedback"></p>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr th:if="${#strings.isEmpty(data.onepassEncodeData)}">
                                <th scope="row">아이디<th:block th:if="${memberInfo.userid == null}"><i class="ast" title="필수입력">*</i></th:block></th>
                                <td>
                                    <div class="row row-auto flex-wrap">
                                        <div class="col">
                                            <div class="form-input">
                                                <input type="text" name="acnt" id="acnt" maxlength="50" title="아이디" placeholder="아이디 입력" data-width="304" th:value="${memberInfo.acnt}" th:readonly="${memberInfo.userid}">
                                                <button type="button" class="btn-medium btn-gray" onclick="checkIdYn()" th:if="${memberInfo.userid == null}">중복확인</button>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <p class="feedback" id="checkIdMsg"></p>
                                        </div>
                                    </div>
                                    <p class="desc"><th:block th:if="${memberInfo.userid == null}">* 아이디는 영문소문자와 숫자, '_'특수문자만을 사용할 수 있습니다.</th:block></p>
                                </td>
                            </tr>
                            <tr th:if="${memberInfo.userid == null and #strings.isEmpty(data.onepassEncodeData)}">
                                <th scope="row">비밀번호<i class="ast" title="필수입력">*</i></th>
                                <td>
                                    <div class="row row-auto flex-wrap">
                                        <div class="col">
                                            <div class="form-input"><input type="password" name="pswd" id="pswd" maxlength="12" onkeyup="changePswd()" title="비밀번호" placeholder="비밀번호 입력" data-width="414"></div>
                                        </div>
                                        <div class="col">
                                            <p class="feedback" id="checkPswdMsg"></p>
                                        </div>
                                    </div>
                                    <p class="desc">* 비밀번호 영문+숫자+특수문자(!@#$) 각 1자 이상 포함아여 9~12자 이내</p>
                                </td>
                            </tr>
                            <tr th:if="${memberInfo.userid == null and #strings.isEmpty(data.onepassEncodeData)}">
                                <th scope="row">비밀번호 확인<i class="ast" title="필수입력">*</i></th>
                                <td>
                                    <div class="row row-auto flex-wrap">
                                        <div class="col">
                                            <div class="form-input"><input type="password" name="pswdConfirm" id="pswdConfirm" maxlength="12" onkeyup="changePswdConfirm()" title="비밀번호 확인" placeholder="비밀번호 확인 입력" data-width="414"></div>
                                        </div>
                                        <div class="col">
                                            <p class="feedback" id="checkPswdConfirmMsg"></p>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">휴대전화<th:block th:if="${memberInfo.userid == null}"><i class="ast" title="필수입력" th:if="${data.type != 'C'}">*</i></th:block></th>
                                <td>
                                    <div class="row row-auto flex-wrap">
                                        <div class="col">
                                            <div class="form-input">
                                                <input type="number" name="moblphon" id="moblphon" maxlength="12" title="휴대전화" placeholder="숫자만 입력" data-width="304" th:value="${authData.sMobileNo}" th:readonly="${data.encodeData != '' and authData.sName != null}">
                                                <button type="button" class="btn-medium btn-gray" th:if="${#strings.isEmpty(data.encodeData)}" onclick="fnAuthPopup()">본인인증</button>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <p class="feedback" id="checkMoblphonMsg"></p>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">이메일<th:block th:if="${memberInfo.userid == null}"><i class="ast" title="필수입력">*</i></th:block></th>
                                <td>
                                    <div class="row row-auto flex-wrap">
                                        <div class="col">
                                            <div class="form-input">
                                                <input type="text" name="eml1" id="eml1" maxlength="50" title="이메일 아이디" placeholder="이메일 아이디 입력" data-width="160" th:value="${memberInfo.eml1}" th:readonly="${memberInfo.userid}">
                                                <div class="bul">@</div>
                                                <input type="text" name="eml2" id="eml2" maxlength="50" title="이메일 도메인" placeholder="이메일 도메인 입력" data-width="160" th:value="${memberInfo.eml2}" th:readonly="${memberInfo.userid}">
                                                <select id="emailList" title="이메일 도메인" data-width="150" th:readonly="${memberInfo.userid}">
                                                    <option value="">직접입력</option>
                                                    <option value="chol.com">chol.com</option>
                                                    <option value="dreamwiz.com">dreamwiz.com</option>
                                                    <option value="empal.com">empal.com</option>
                                                    <option value="empas.com">empas.com</option>
                                                    <option value="freechal.com">freechal.com</option>
                                                    <option value="gmail.com">gmail.com</option>
                                                    <option value="hanafos.com">hanafos.com</option>
                                                    <option value="hanmail.net">hanmail.net</option>
                                                    <option value="hanmir.com">hanmir.com</option>
                                                    <option value="hitel.net">hitel.net</option>
                                                    <option value="hotmail.com">hotmail.com</option>
                                                    <option value="korea.com">korea.com</option>
                                                    <option value="lycos.co.kr">lycos.co.kr</option>
                                                    <option value="megapass.net">megapass.net</option>
                                                    <option value="nate.com">nate.com</option>
                                                    <option value="naver.com">naver.com</option>
                                                    <option value="paran.com">paran.com</option>
                                                    <option value="sayclub.net">sayclub.net</option>
                                                    <option value="shinbiro.com">shinbiro.com</option>
                                                    <option value="yahoo.co.kr">yahoo.co.kr</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <p class="feedback"></p>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">주소<th:block th:if="${memberInfo.userid == null}"><i class="ast" title="필수입력">*</i></th:block></th>
                                <td>
                                    <div class="row row-auto flex-wrap">
                                        <div class="col">
                                            <div class="form-input">
                                                <input type="text" name="addr" id="addr" title="지번/도로명" placeholder="지번/도로명을 입력해주세요." data-width="500" readonly th:value="${memberInfo.addr}">
                                                <button type="button" class="btn-medium btn-gray" onclick="daumPostcode1()" th:if="${memberInfo.userid == null}">검색</button>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <p class="feedback" id="checkAddrMsg1"></p>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">상세주소<th:block th:if="${memberInfo.userid == null}"><i class="ast" title="필수입력">*</i></th:block></th>
                                <td>
                                    <div class="row row-auto flex-wrap">
                                        <div class="col">
                                            <div class="form-input">
                                                <input type="text" name="addrDtl" id="addrDtl" maxlength="400" title="상세주소" placeholder="상세주소를 입력해주세요." data-width="585" th:value="${memberInfo.addrDtl}" th:readonly="${memberInfo.userid}">
                                            </div>
                                        </div>
                                        <div class="col">
                                            <p class="feedback"></p>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr th:if="${memberInfo.userid == null}">
                                <th scope="row" rowspan="4">관심분야 <br class="pc-only"><small class="vt">(최대 3개 선택)</small></th>
                                <td>
                                    <div class="form-input mo-flex-wrap">
                                        <strong class="label" data-width="90px">교육 프로그램</strong>
                                        <span kattr:check_code="itrstfldCds1" grpCd="105" upprCd="105101" addClass="itrstfldCds" />
                                    </div>
                                </td>
                            </tr>
                            <tr th:if="${memberInfo.userid == null}">
                                <td>
                                    <div class="form-input mo-flex-wrap">
                                        <strong class="label" data-width="90px">지원사업</strong>
                                        <span kattr:check_code="itrstfldCds2" grpCd="105" upprCd="105102" addClass="itrstfldCds" />
                                    </div>
                                </td>
                            </tr>
                            <tr th:if="${memberInfo.userid == null}">
                                
                                <td>
                                    <div class="form-input mo-flex-wrap">
                                        <strong class="label" data-width="90px">제도지원</strong>
                                        <span kattr:check_code="itrstfldCds3" grpCd="105" upprCd="105103" addClass="itrstfldCds" />
                                    </div>
                                </td>
                            </tr>
                            <tr th:if="${memberInfo.userid == null}">
                                <td>
                                    <div class="form-input mo-flex-wrap">
                                        <strong class="label" data-width="90px">기타</strong>
                                        <span kattr:check_code="itrstfldCds4" grpCd="105" upprCd="105104" addClass="itrstfldCds" />
                                    </div>
                                </td>
                            </tr>
                            <tr th:if="${memberInfo.userid == null}">
                                <th scope="row">맞춤 환경정보 <br class="pc-only"><small class="vt">(최대 3개 선택)</small></th>
                                <td>
                                    <span kattr:check_code="envfldCds1" grpCd="104" addClass="envfldCds" selectedCd="104101,104105,104106" />
                                    <p class="desc-info mt15">선택하신 정보는 로그인 시, 메인 화면에서 위젯 형태로 확인할 수 있습니다.</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
    
                <div class="table-caption" th:if="${data.type == 'I'}">
                    <div class="left">
                        <h3 class="sub-title">기관정보 입력</h3>
                    </div>
                    <div class="right">
                        <p class="desc"><span class="ast">*</span>표시는 필수 입력 정보입니다.</p>
                    </div>
                </div>
    
                <div class="table-row table-row-mo" th:if="${data.type == 'I'}">
                    <table>
                        <caption>기관 회원가입  - 기관명, 기관유형, 사업자등록번호, 사업자등록증, 대표자 이름, 대표 전화번호, 대표 팩스번호, 홈페이지 주소, 기관 로고, 주소, 상세주소</caption>
                        <colgroup>
                            <col style="width:140px;">
                            <col>
                        </colgroup>
                        <tbody>
                            <tr>
                                <th scope="row">기관명<i class="ast" title="필수입력">*</i></th>
                                <td>
                                    <div class="row row-auto flex-wrap">
                                        <div class="col">
                                            <div class="form-input">
                                                <input type="text" name="instNm" id="instNm" maxlength="100" title="기관명" placeholder="기관명 입력" data-width="304" readonly>
                                                <button type="button" class="btn-medium btn-gray" id="instSearchBtn">기관 검색</button>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <p class="feedback"></p>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">기관유형<i class="ast" title="필수입력">*</i></th>
                                <td>
                                    <div class="row row-auto flex-wrap">
                                        <div class="col">
                                            <div class="form-input">
                                                <select id="instTypeCd" name="instTypeCd" title="기관유형" dataWidth="304" readonly>
                                                   <option value="">선택하세요</option>
                                                   <option th:each="item : ${instTypeCdList}" th:value="${item.CD}"><th:block th:text="${item.CD_NM}" /></option>
                                               </select>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <p class="feedback"></p>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">사업자등록번호<i class="ast" title="필수입력">*</i></th>
                                <td>
                                    <div class="row row-auto flex-wrap">
                                        <div class="col">
                                            <div class="form-input">
                                                <input type="number" name="brno" id="brno" maxlength="10" title="사업자등록번호" placeholder="사업자등록번호 입력" data-width="304" readonly>
                                                <button type="button" class="btn-medium btn-gray" onclick="checkBizIdYn()">중복확인</button>
                                            </div>
                                            <p class="desc">* 하이픈 &lsquo;-&rsquo; 없이 숫자만 입력해주세요.</p>
                                        </div>
                                        <div class="col">
                                            <p class="feedback" id="checkBizIdMsg"></p>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr id="bizFileTr" style="display:none">
                                <th scope="row">사업자등록증<i class="ast" title="필수입력">*</i></th>
                                <td>
                                    <div class="row row-auto flex-wrap flex-column">
                                        <div class="col">
                                            <div class="form-input form-input-file">
                                                <label>
                                                    <input type="file" id="bizFile" name="bizFile" class="blind" th:attr="accept=${acceptUploadBizFileExt}" title="파일첨부">
                                                    <span class="btn-medium btn-gray">파일선택</span>
                                                </label>
                                                <ul id="bizFileUploadSuccess"></ul>
                                                <input type="hidden" name="bizfileFilegrpid" id="bizfileFilegrpid" value="0">
                                            </div>
                                        </div>
                                        <div class="col">
                                            <p class="feedback" id="checkBizFileMsg"></p>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">대표자 이름<i class="ast" title="필수입력">*</i></th>
                                <td>
                                    <div class="row row-auto flex-wrap">
                                        <div class="col">
                                            <div class="form-input">
                                                <input type="text" name="rprsvNm" id="rprsvNm" maxlength="20" title="대표자 이름" placeholder="대표자 이름 입력" data-width="414" readonly>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <p class="feedback"></p>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">대표전화번호<i class="ast" title="필수입력">*</i></th>
                                <td>
                                    <div class="row row-auto flex-wrap">
                                        <div class="col">
                                            <div class="form-input">
                                                <input type="number" name="telno" id="telno" maxlength="12" title="대표전화번호" placeholder="대표전화번호 입력" data-width="414" readonly>
                                            </div>
                                            <p class="desc">* 하이픈 &lsquo;-&rsquo; 없이 숫자만 입력해주세요.</p>
                                        </div>
                                        <div class="col">
                                            <p class="feedback"></p>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">대표팩스번호</th>
                                <td>
                                    <div class="row row-auto flex-wrap">
                                        <div class="col">
                                            <div class="form-input">
                                                <input type="number" name="fxno" id="fxno" maxlength="12" title="대표팩스번호" placeholder="대표팩스번호 입력" data-width="414">
                                            </div>
                                            <p class="desc">* 하이픈 &lsquo;-&rsquo; 없이 숫자만 입력해주세요.</p>
                                        </div>
                                        <div class="col">
                                            <p class="feedback"></p>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">홈페이지 주소</th>
                                <td>
                                    <div class="row row-auto flex-wrap">
                                        <div class="col">
                                            <div class="form-input">
                                                <input type="url" name="hmpg" id="hmpg" maxlength="100" title="홈페이지 주소" placeholder="홈페이지 주소 입력" data-width="414">
                                            </div>
                                            <p class="desc">* 예) https://keep.go.kr</p>
                                        </div>
                                        <div class="col">
                                            <p class="feedback"></p>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">기관 로고</th>
                                <td>
                                    <div class="form-input-file form-input-thumb">
                                        <div class="form-input">
                                            <div class="logo-image">
                                                <img src="" alt="" id="bizLogoImage">
                                                <span class="logo-text">LOGO IMAGE</span>
                                                <input type="hidden" name="bizlogoFileid" id="bizlogoFileid" value="0">
                                            </div>
                                            <label>
                                                <input type="file" id="bizLogo" class="blind" accept=".jpeg,.jpg,.png" title="파일첨부">
                                                <span class="btn-medium btn-gray">파일선택</span>
                                            </label>
                                        </div>
                                    </div>
                                    <p class="desc">* 로고사진 파일은 10MB 미만의 JPG, PNG, GIF파일만 업로드 가능</p>
                                    <p class="desc">* 권장사이즈 : 가로 170px, 세로 40px</p>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">주소<i class="ast" title="필수입력">*</i></th>
                                <td>
                                    <div class="row row-auto flex-wrap">
                                        <div class="col">
                                            <div class="form-input">
                                                <input type="text" name="instAddr" id="instAddr" maxlength="200" title="지번/도로명" placeholder="지번/도로명을 입력해주세요." data-width="500" readonly>
                                                <button type="button" class="btn-medium btn-gray" onclick="daumPostcode2()">검색</button>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <p class="feedback" id="checkAddrMsg2"></p>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">상세주소<i class="ast" title="필수입력">*</i></th>
                                <td>
                                    <div class="row row-auto flex-wrap">
                                        <div class="col">
                                            <div class="form-input">
                                                <input type="text" name="instAddrDtl" id="instAddrDtl" maxlength="400" title="상세주소" placeholder="상세주소를 입력해주세요." data-width="585" readonly>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <p class="feedback"></p>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                            
                <div class="box-df-list mt20">
                    <dl>
                        <dt>개인정보 유효기간</dt>
                        <dd>선택된 유효기간 동안 국가환경교육 통합플랫폼 이용 내역이 없어도 개인정보 분리보관 및 휴면회원으로 전환되지 않습니다.</dd>
                    </dl>
                    <div class="form-check-list mt10">
                        <label class="inp"><input type="radio" name="prvcVldty" value="1" checked><b>1년</b></label>
                        <label class="inp"><input type="radio" name="prvcVldty" value="2"><b>2년</b></label>
                        <label class="inp"><input type="radio" name="prvcVldty" value="5"><b>5년</b></label>
                        <label class="inp"><input type="radio" name="prvcVldty" value="0"><b>회원탈퇴 시</b></label>
                    </div>
                </div>
                
                <div class="btn-wrap">
                    <div class="center">
                        <button type="button" class="btn-medium btn-green" onclick="join()"><th:block th:text="${#strings.isEmpty(data.onepassEncodeData)} ? '가입' : '연동'"></th:block>하기</button>
                    </div>
                </div>
            </section>
            </form>
            <form name="form_chk" th:action="@{/CheckPlusSafeModel/checkplus.html}" method="post">
                <input type="hidden" name="type" th:value="${data.type}" />
                <input type="hidden" name="kind" value="info" />
            </form>
            <form id="typeForm" th:action="@{/front/membership/step5.html}" method="post">
                <input type="hidden" name="type" id="type" th:value="${data.type}" />
                <input type="hidden" name="onepassEncodeData" id="onepassEncodeData" th:value="${data.onepassEncodeData}" />
                <input type="hidden" name="returnUrl" id="returnUrl" th:value="${data.returnUrl}" />
            </form>
            <!-- layerpopup -->
            <div id="layer-popup05">
            </div>
            <!-- //layerpopup -->
    
            <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
            <script th:inline="javascript">
                var validator= $("#memberInfoForm").validate({
                        onsubmit: false,
                        rules: {
                            /*[# th:if="${memberInfo.userid == null}"]*/
                             nm         :   { required: true, isBlank: true, maxlength: 20 }
                            ,acnt       :   { required: true, isBlank: true, minlength: 5, maxlength: 50, idPolicy1: true }
                            ,pswd       :   { required: true, isBlank: true, passwordPolicy2: true, minlength: 9, maxlength: 12 ,isHangulOff: true }
                            ,pswdConfirm:   { required: true, isBlank: true, passwordPolicy2: true, isHangulOff: true }
                            ,moblphon   :   { 
                            /*[# th:if="${data.type != 'C'}"]*/
                                                required: true,
                            /*[/]*/
                                                number : true, 
                                                maxlength: 12
                                            }
                            ,eml1       :   { required: true, isBlank: true, maxlength: 50 }
                            ,eml2       :   { required: true, isBlank: true, maxlength: 50, emailDomain: true }
                            ,addr       :   { required: true, maxlength: 200 }
                            ,addrDtl    :   { required: true, maxlength: 400 },
                            /*[/]*/
                            /*[# th:if="${data.type == 'I'}"]*/
                             instNm     :   { required: true, isBlank: true, maxlength: 100 }
                            ,instTypeCd :   { required: true }
                            ,brno       :   { required: true, isRightBizNo: true}
                            ,rprsvNm    :   { required: true, isBlank: true, maxlength: 20 }
                            ,telno      :   { required: true, number: true, maxlength: 12}
                            ,fxno       :   { number: true, maxlength: 12}
                            ,hmpg       :   { url: true, maxlength: 100 }
                            ,instAddr   :   { required: true, maxlength: 200 }
                            ,instAddrDtl:   { required: true, maxlength: 400 }
                            /*[/]*/
                        },
                        messages: {
                             nm         :   { required: "이름을 입력 해주십시오.", isBlank: "이름에 공백이 있습니다.", maxlength: "이름은 20자를 초과할 수 없습니다." }
                            ,acnt       :   { required: "아이디를 입력 해주십시오.", isBlank: "아이디에 공백이 있습니다.", minlength:"아이디는 5자리 이상이어야 합니다.", maxlength: "아이디는 50자를 초과할 수 없습니다.", idPolicy1: "아이디 형식이 올바르지 않습니다." }  
                            ,pswd       :   { required: "비밀번호를 입력 해주십시오.", isBlank: "비밀번호 조건이 일치하지 않습니다.", passwordPolicy2: "비밀번호 조건이 일치하지 않습니다.", minlength:"비밀번호 조건이 일치하지 않습니다.", maxlength: "비밀번호 조건이 일치하지 않습니다.", isHangulOff: "비밀번호 조건이 일치하지 않습니다." }
                            ,pswdConfirm:   { required: "비밀번호 확인을 입력 해주십시오.", isBlank: "비밀번호 조건이 일치하지 않습니다.", passwordPolicy2: "비밀번호 조건이 일치하지 않습니다.", isHangulOff: "비밀번호 조건이 일치하지 않습니다." }
                            ,moblphon   :   { 
                            /*[# th:if="${data.type != 'C'}"]*/
                                                required: "휴대전화를 입력 해주십시오.",
                            /*[/]*/ 
                                                number : "숫자만 입력 가능합니다.", 
                                                maxlength:"휴대전화는 12자를 초과할 수 없습니다." }  
                            ,eml1       :   { required: "이메일을 입력 해주십시오.", isBlank: "이메일에 공백이 있습니다.", maxlength: "이메일 아이디는 50자를 초과할 수 없습니다." }
                            ,eml2       :   { required: "이메일을 입력 해주십시오.", isBlank: "이메일에 공백이 있습니다.", maxlength: "이메일 도메인은 50자를 초과할 수 없습니다.", emailDomain: "이메일 형식이 올바르지 않습니다." }
                            ,addr       :   { required: "주소를 입력 해주십시오.", maxlength: "주소는 200자를 초과할 수 없습니다." }
                            ,addrDtl    :   { required: "상세주소를 입력 해주십시오.", maxlength: "상세주소는 400자를 초과할 수 없습니다." }
                            /*[# th:if="${data.type == 'I'}"]*/
                            ,instNm     :   { required: "기관명을 입력 해주십시오.", isBlank: "기관명에 공백이 있습니다.", maxlength: "기관명은 100자를 초과할 수 없습니다." }
                            ,instTypeCd :   { required: "기관유형을 선택 해주십시오." }
                            ,brno       :   { required: "사업자등록번호를 입력 해주십시오." ,isRightBizNo:"유효하지않은 사업자등록번호 입니다." }
                            ,rprsvNm    :   { required: "대표자 이름을 입력 해주십시오.", isBlank: "대표자 이름에 공백이 있습니다.", maxlength: "대표자 이름은 20자를 초과할 수 없습니다." }
                            ,telno      :   { required: "대표전화번호를 입력 해주십시오." ,number: "숫자만 입력가능합니다.", maxlength:"대표전화번호는 12자를 초과할 수 없습니다." }
                            ,fxno       :   { number: "숫자만 입력가능합니다.", maxlength:"대표팩스번호는 12자를 초과할 수 없습니다." }
                            ,hmpg       :   { url: "홈페이지 주소의 형식이 올바르지 않습니다.", maxlength: "홈페이지 주소는 100자를 초과할 수 없습니다." }
                            ,instAddr   :   { required: "주소를 입력 해주십시오.", maxlength: "주소는 200자를 초과할 수 없습니다." }
                            ,instAddrDtl:   { required: "상세주소를 입력 해주십시오.", maxlength: "상세주소는 400자를 초과할 수 없습니다." }
                            /*[/]*/
                        }
                    });
                    
                function join(){
                    if(!($("#memberInfoForm").valid())){
                        /*[# th:if="${memberInfo.userid == null}"]*/
                          /*[# th:if="${#strings.isEmpty(data.onepassEncodeData)}"]*/
                        if($("#checkIdMsg").text() == "") checkIdDup();
                        if($("#checkPswdMsg").text() == "") changePswd();
                        if($("#checkPswdConfirmMsg").text() == "") $("#pswdConfirm").focus();
                          /*[/]*/
                        if($("#checkMoblphonMsg").text() == "") checkMoblphon();
                        /*[/]*/
                        /*[# th:if="${data.type == 'I'}"]*/
                        if($("#checkBizIdMsg").text() == "") checkBizIdDup();
                        /*[/]*/
                        // readonly라 별도 처리
                        /*if(!checkAddr1()) {
                          if($(".feedback.invalid", "#memberInfoForm").length == 1) {
                              $("#addr").focus();
                              //window.scrollTo({top: document.getElementById("addr").getBoundingClientRect().top-128 + window.pageYOffset});
                          }  
                        }
                        if(!checkAddr2()) {
                          if($(".feedback.invalid", "#memberInfoForm").length == 1) {
                              $("#instAddr").focus();
                              //window.scrollTo({top: document.getElementById("instAddr").getBoundingClientRect().top-128 + window.pageYOffset});
                          }  
                        }*/ 
                        return;
                    }

                    var checkIdDupResult = true;                    
                    var checkPswdConfirmResult = true;
                    var checkMoblphoneResult = true;
                    var checkBizIdDupResult = true;
                    var checkBizFileResult = true;
                    /*[# th:if="${memberInfo.userid == null}"]*/
                      /*[# th:if="${#strings.isEmpty(data.onepassEncodeData)}"]*/
                    changePswd();
                    checkIdDupResult = checkIdDup();                    
                    checkPswdConfirmResult = changePswdConfirm();
                      /*[/]*/
                    checkMoblphoneResult = checkMoblphon();
                    /*[/]*/
                    /*[# th:if="${data.type == 'I'}"]*/
                    checkBizIdDupResult = checkBizIdDup();
                    if($("#directYn").val() == 'Y') {
                        checkBizFileResult = checkBizFile();
                    }
                    /*[/]*/
                    
                    if(!checkIdDupResult) {
                        $("#acnt").focus();
                    }else if(!checkPswdConfirmResult) {
                        $("#pswdConfirm", "#memberInfoForm").focus();
                    }else if(!checkMoblphoneResult) {
                        $("#moblphon").focus();
                    }else if(!checkBizIdDupResult) {
                        $("#brno", "#memberInfoForm").focus();
                    }else if(!checkBizFileResult) {
                        $("#bizFile").focus();
                    }
                    
                    if(checkIdDupResult && checkPswdConfirmResult && checkMoblphoneResult && checkBizIdDupResult && checkBizFileResult){
                        if($("input[name=envfldCds1]:checked").length > 3) {
                            alert("맞춤 환경정보는 최대 3개 까지만 선택가능합니다.");
                            return;
                        }
                        
                        if(($("input[name=itrstfldCds1]:checked").length + $("input[name=itrstfldCds2]:checked").length + $("input[name=itrstfldCds3]:checked").length + $("input[name=itrstfldCds4]:checked").length) > 3) {
                            alert("관심분야는 최대 3개 까지만 선택가능합니다.");
                            return;
                        }
                        
                        var confirmMsg = "회원연동을 완료하시겠습니까?";
                        /*[# th:if="${#strings.isEmpty(data.onepassEncodeData)}"]*/
                            confirmMsg = "회원가입을 완료하시겠습니까?";                                            
                        /*[/]*/
                        if(!confirm(confirmMsg)) return;
                        
                        var itrstfldCds = $('.itrstfldCds:checked').map(function(){ return $(this).val();}).get().join(",");
                        var envfldCds   = $('.envfldCds:checked').map(function(){ return $(this).val();}).get().join(",");
                        
                        var data =  $("#memberInfoForm").serialize();
                        data = data+"&itrstfldCds="+itrstfldCds+"&envfldCds="+envfldCds

                        if(displayWorkProgress(true)){
                            $.ajax({
                                url : "/front/member/insertMember.do",
                                type: 'POST',
                                cache : false,
                                dataType: 'json',
                                data : data,
                                success : function (data){
                                    if(data.result=="success"){
                                        if(data.msg != undefined) {
                                            const paramAlertMsg = $("<input type='hidden' name='alertMsg' value='" + data.msg + "'>");
                                            $("#typeForm").append(paramAlertMsg);
                                        }
                                        $("#typeForm").submit();
                                    }else{
                                        alert(data.msg);
                                    }
                                    closeWorkProgress();
                                }
                            });
                        }
                    }
                }
            </script>
            <script type="text/javascript">
                var checkId = "";
                var checkBizId = "";
                var isDuplicatedId = false;
                var isDuplicatedBizId = false;

                //아이디 중복 체크 
                function checkIdYn(){
                    
                    if(!$('#acnt').valid()) return;
                    
                    if(displayWorkProgress(true)){
                        $.ajax({
                            url : "/front/member/checkDuplicationUser.do",
                            type: 'POST',
                            cache : false,
                            dataType: 'json',
                            data : { acnt: $("#acnt").val() },
                            success : function (data){
                                if(!data.result){
                                    $("#checkIdMsg").text("이미 사용중인 아이디입니다.").removeClass("valid").addClass("invalid");
                                    checkId = "";
                                    isDuplicatedId = true;
                                }else{
                                    $("#checkIdMsg").text("사용가능한 아이디입니다.").removeClass("invalid").addClass("valid");
                                    checkId = $("#acnt").val();
                                    isDuplicatedId = false;
                                }
                                closeWorkProgress();
                            }
                        });
                    }
                }
                
                //사업자등록번호 중복 체크 
                function checkBizIdYn(){
                    
                    if(!$('#brno', "#memberInfoForm").valid()) return;
                    
                    if(displayWorkProgress(true)){
                        $.ajax({
                            url : "/front/member/checkDuplicationBrno.do",
                            type: 'POST',
                            cache : false,
                            dataType: 'json',
                            data : { brno: $("#brno", "#memberInfoForm").val(), directYn: $("#directYn").val() },
                            success : function (data){
                                if(!data.result){
                                    alert(data.msg);
                                    //$("#checkBizIdMsg").text(data.msg).removeClass("valid").addClass("invalid");
                                    checkBizId = "";
                                    isDuplicatedBizId = true;
                                }else{
                                    
                                    checkBizId = $("#brno", "#memberInfoForm").val();
                                    isDuplicatedBizId = false;
                                    if(data.dataLoad) {
                                        alert(data.msg);
                                        searchInput(data);
                                        $("#checkBizIdMsg").text("사용가능한 사업자등록번호입니다.").removeClass("invalid").addClass("valid");
                                    }else{
                                        $("#checkBizIdMsg").text(data.msg).removeClass("invalid").addClass("valid");
                                    }
                                }
                                closeWorkProgress();
                            }
                        });
                    }
                }
                
                function changePswd(){
                    if($('#pswd').valid()) {
                        $("#checkPswdMsg").text("사용 가능한 비밀번호입니다.").removeClass("invalid").addClass("valid");
                    }
                    
                    if($("#pswdConfirm").val().length > 0) {
                        changePswdConfirm();
                    }
                }
                
                function changePswdConfirm() {
                    if($("#pswd").val()!=$("#pswdConfirm").val()) {
                        $("#checkPswdConfirmMsg").text("비밀번호가 일치하지 않습니다.").removeClass("valid").addClass("invalid");
                        return false;
                    }else{
                        
                        $("#checkPswdConfirmMsg").text("비밀번호가 일치합니다.").removeClass("invalid").addClass("valid");
                        return true;
                    }
                }   
                
                function checkIdDup() {
                    if(checkId == "" || checkId !=  $("#acnt").val()){
                        $("#checkIdMsg").text("아이디 중복확인을 해주시기 바랍니다.").removeClass("valid").addClass("invalid");
                        return false;
                    }else{
                        return true;
                    }   
                }
                
                function checkBizIdDup() {
                    if(checkBizId == "" || checkBizId !=  $("#brno", "#memberInfoForm").val()){
                        $("#checkBizIdMsg").text("사업자등록번호 중복확인을 해주시기 바랍니다.").removeClass("valid").addClass("invalid");
                        return false;
                    }else{
                        return true;
                    }   
                }
                
                function checkMoblphon() {
                    if($("#moblphon").val() != '' && $("#encodeData").val() == '') {
                        $("#checkMoblphonMsg").text("휴대전화 본인인증을 해주시기 바랍니다.").removeClass("valid").addClass("invalid");
                        return false;
                    }else{
                        return true;
                    }
                }
                
                function checkBizFile() {
                    if($("#bizfileFilegrpid").val() == 0) {
                        $("#checkBizFileMsg").text("사업자등록증 파일을 첨부 해주십시오.").removeClass("valid").addClass("invalid");
                        return false;
                    }else{
                        return true;
                    }
                }
                    
                /*
                function checkAddr1() {
                    if($("#addr").val() == "") {
                        $("#checkAddrMsg1").text("주소를 입력 해주십시오.").removeClass("valid").addClass("invalid");
                        return false;
                    }else if($("#addr").val().length > 200){
                        $("#checkAddrMsg1").text("주소는 200자를 초과할 수 없습니다.").removeClass("valid").addClass("invalid");
                        return false;
                    }
                    return true;
                }
                
                function checkAddr2() {
                    if($("#instAddr").val() == "") {
                        $("#checkAddrMsg2").text("주소를 입력 해주십시오.").removeClass("valid").addClass("invalid");
                        return false;
                    }else if($("#instAddr").val().length > 200){
                        $("#checkAddrMsg2").text("주소는 200자를 초과할 수 없습니다.").removeClass("valid").addClass("invalid");
                        return false;
                    }
                    return true;
                }*/

                function fnAuthPopup(){
                    window.open('', 'popupChk', 'width=500, height=550, top=100, left=100, fullscreen=no, menubar=no, status=no, toolbar=no, titlebar=yes, location=no, scrollbar=no');
                    document.form_chk.target = "popupChk";
                    document.form_chk.submit();
                }
                
                function setEncodeData(encodeData) {
                    document.memberInfoForm.encodeData.value = encodeData;
                    $("#checkMoblphonMsg").text("휴대전화 본인인증이 완료되었습니다.").removeClass("invalid").addClass("valid");
                }
                
                function setInstArtclid(artclid) {
                    // 기관풀정보 조회
                    if (displayWorkProgress(true)){
                        $.ajax({
                            url : "/front/membership/selectInstPoolInfo.do",
                            cache : false,
                            dataType : 'json',
                            data : { artclid : artclid },
                            type : 'POST',
                            success : function(data) {
                                searchInput(data);
                            }
                        });
                    }
                }
                
                function setReadonlyInstForm() {
                    $("#instNm", "#memberInfoForm").attr("readonly", true);
                    $("#instTypeCd").attr("readonly", true);
                    $("#brno", "#memberInfoForm").attr("readonly", true);
                    $("#rprsvNm").attr("readonly", true);
                    $("#telno").attr("readonly", true);
                    $("#instAddrDtl").attr("readonly", true);
                }
                
                // 불러온 기관정보 셋팅시
                function searchInput(data) {
                    $("#checkBizIdMsg").text('').removeClass("valid").removeClass("invalid");
                    setReadonlyInstForm();
                    $("#directYn").val('N');
                    $("#bizfileFilegrpid").val(0);
                    $("#bizFileUploadSuccess").html('');
                    $("#bizFileTr").hide();
                    $("#artclid").val('');
                    $("#artclid").val(data.artclid);
                    $("#instNm", "#memberInfoForm").val(data.instNm);
                    $("#instTypeCd").val(data.instTypeCd);
                    $("#brno", "#memberInfoForm").val(data.brno);
                    $("#rprsvNm").val(data.rprsvNm);
                    $("#telno").val(data.telno);
                    
                    if(data.signguCd != '') { // 없는경우 빈값으로 넘어옴
                        $("#instAddr").val(data.addr);
                        $("#instAddrDtl").val(data.addrDtl);
                        $("#instZip").val(data.zip);
                        $("#instSignguCd").val(data.signguCd);
                    }else{
                        $("#instAddr").val('');
                        $("#instAddrDtl").val('');
                        $("#instZip").val('');
                        $("#instSignguCd").val('');
                        $("#instAddrDtl").removeAttr("readonly");
                    }
                }
                
                // 기관정보 직접입력시 초기화
                function directInput() {
                    $("#checkBizIdMsg").text('').removeClass("valid").removeClass("invalid");
                    $("#directYn").val('Y');
                    $("#artclid").val('');
                    $("#instNm", "#memberInfoForm").val('');
                    $("#instTypeCd").val('');
                    $("#brno"," #memberInfoForm").val('');
                    $("#rprsvNm").val('');
                    $("#telno").val('');
                    $("#fxno").val('');
                    $("#hmpg").val('');
                    $("#instAddr").val('');
                    $("#instAddrDtl").val('');
                    $("#instZip").val('');
                    $("#instSignguCd").val('');
                    $("#instNm", "#memberInfoForm").removeAttr("readonly");
                    $("#instTypeCd").removeAttr("readonly");
                    $("#brno", "#memberInfoForm").removeAttr("readonly");
                    $("#rprsvNm").removeAttr("readonly");
                    $("#telno").removeAttr("readonly");
                    $("#instAddrDtl").removeAttr("readonly");
                    $("#bizfileFilegrpid").val(0);
                    $("#bizFileUploadSuccess").html('');
                    $("#bizlogoFileid").val(0);
                    $("#bizLogoImage").attr("src",'')
                    $("#bizFileTr").show();
                }
        
                function daumPostcode1(){
                    new daum.Postcode({
                        oncomplete: function(data) {
                            let addr = '';
                            if (data.userSelectedType === 'R') {
                                addr = data.roadAddress;
                            } else {
                                addr = data.jibunAddress;
                            }
                            $('#signguCd').val(data.sigunguCode);
                            $('#zip').val(data.zonecode);
                            $('#addr').val(addr);
                            $('#addrDtl').focus();
                        }
                    }).open();
                }
                
                function daumPostcode2(){
                    new daum.Postcode({
                        oncomplete: function(data) {
                            let addr = '';
                            if (data.userSelectedType === 'R') {
                                addr = data.roadAddress;
                            } else {
                                addr = data.jibunAddress;
                            }
                            $('#instSignguCd').val(data.sigunguCode);
                            $('#instZip').val(data.zonecode);
                            $('#instAddr').val(addr);
                            $('#instAddrDtl').focus();
                        }
                    }).open();
                }
                
                $('#bizFile').on("change", function (event) {
                    var objFile = event.target;
                    var formData = new FormData();
        
                    formData.append("file", objFile.files[0]);
                    formData.append("filegrpNm", "biz_file");
        
                    if (displayWorkProgress(true)) {
                        $.ajax({
                            url: '/registFile.do',
                            processData: false,
                            contentType: false,
                            data: formData,
                            type: 'POST',
                            success: function (response) {
                                if (response.result == 'fail') {
                                    alert(response.msg);
                                }else if(response.filegrpid != undefined && response.filegrpid != ''){
                                    $("#bizfileFilegrpid").val(response.filegrpid);
                                    var result = `
                                            <li id="${response.fileid}" class='file-block' data_ext='${response.fileExtsn.substr(1)}'>
                                                <span class="name">
                                                    <a href="javascript:void(0)" data-fileid="${response.fileid}" data-file-idntfc-key="${response.fileIdntfcKey}"
                                                     onclick="javascript:downloadFileByFileid(this.dataset.fileid, this.dataset.fileIdntfcKey)"> ${response.orginlFileNm}
                                                    </a>
                                                </span>
                                                <button type="button" class="file-delete" title="삭제" data-fileid="${response.fileid}" onclick="deleteBizFile(this.dataset.fileid)">
                                                    <span class="icon icon-circle-close"></span>
                                                </button>
                                            </li>
                                        `; 
                                    $('#bizFileUploadSuccess').html(result);
                                }
                                closeWorkProgress();
                            }
                        });
                        $("#bizFile").val("");
                    }
                });
                
                function deleteBizFile(fileid) {
                    $("#"+fileid).remove();
                    $("#bizfileFilegrpid").val(0);
                }
                
                $('#bizLogo').on("change", function (event) {
                    var objFile = event.target;
                    var formData = new FormData();
        
                    formData.append("file", objFile.files[0]);
                    formData.append("filegrpNm", "biz_logo");
        
                    if (displayWorkProgress(true)) {
                        $.ajax({
                            url: '/registFile.do',
                            processData: false,
                            contentType: false,
                            data: formData,
                            type: 'POST',
                            success: function (response) {
                                if (response.result == 'fail') {
                                    alert(response.msg);
                                }else if(response.filegrpid != undefined && response.filegrpid != ''){
                                    $("#bizlogoFileid").val(response.fileid);
                                    $("#bizLogoImage").attr("src",`/downloadLogo.do?fileid=${response.fileid}&file_idntfc_key=${response.fileIdntfcKey}`);
                                }
                                closeWorkProgress();
                            }
                        });
                        $("#bizLogo").val("");
                    }
                });
                
                $(function(){
                    $('#emailList').change(function(e){
                        var self = $(this);
                        var val = self.val();
                        $('input#eml2').val(val);
                        if(val == '') {
                            $('input#eml2').attr('readonly', false);
                        }else{
                            $('input#eml2').attr('readonly', true);
                        }
                    });
                    
                    jQuery("#instSearchBtn").bind("click",function(){     
                        $("#layer-popup05").load("/front/membership/instSearchPopup.html", function(response, status, xhr) {
                            if (status == "success") {
                                layerPopup.open({target:'layer-popup05', h: "640px", callback: function(){ initInstSearchPopup(); }});
                            }
                        });
                    });
                });
            </script>
        </th:block>
    </body>
</html>