<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security" 
    xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout" 
    layout:decorator="layout/front/membershipLayout"
>
    <body>
        <th:block layout:fragment="content">
            <form name="memberInfoForm" id="memberInfoForm">
            <input type="hidden" name="type" id="type" th:value="${data.type}" />
            <input type="hidden" name="tosAgreYn" id="tosAgreYn" th:value="${data.tosAgreYn}" />
            <input type="hidden" name="privcyAgreYn" id="privcyAgreYn" th:value="${data.privcyAgreYn}" />
            <input type="hidden" name="prvcThptyPvsnAgreYn" id="prvcThptyPvsnAgreYn" th:value="${data.prvcThptyPvsnAgreYn}" />
            <input type="hidden" name="childJoinAgreYn" th:if="${data.type == 'C'}" id="childJoinAgreYn" th:value="${param.childJoinAgreYn}" />
            <input type="hidden" name="wbznAplyAgreYn" id="wbznAplyAgreYn" th:value="${data.wbznAplyAgreYn}" />
            <input type="hidden" name="wbznAp" id="wbznAplyAgreYn" th:value="${data.wbznAplyAgreYn}" />
            <input type="hidden" name="pencodeData" id="pencodeData" th:value="${data.pencodeData}" />
            <input type="hidden" name="encodeData" id="encodeData" th:value="${data.encodeData}" />
            <input type="hidden" name="onepassEncodeData" id="onepassEncodeData" th:value="${data.onepassEncodeData}" />
            <input type="hidden" name="returnUrl" id="returnUrl" th:value="${data.returnUrl}" />
            <input type="hidden" name="signguCd" id="signguCd" />
            <input type="hidden" name="zip" id="zip" />
            
            <div class="steps">
                <ol>
                    <li>
                        <div class="steps-inner">
                            <span>01</span>
                            <strong>약관동의</strong>
                        </div>
                    </li>
                    <li>
                        <div class="steps-inner">
                            <span>02</span>
                            <strong>본인인증</strong>
                        </div>
                    </li>
                    <li class="active" title="현재 단계">
                        <div class="steps-inner">
                            <span>03</span>
                            <strong>회원정보입력</strong>
                        </div>
                    </li>
                    <li>
                        <div class="steps-inner">
                            <span>04</span>
                            <strong>가입완료</strong>
                        </div>
                    </li>
                </ol>
            </div>

            <div class="table-caption">
                <div class="left">
                    <h3 class="sub-title">회원정보 입력</h3>
                </div>
                <div class="right">
                    <p class="desc"><span class="ast">*</span>표시는 필수 입력 정보입니다.</p>
                </div>
            </div>

            <div class="table-row table-row-mo">
                <table>
                    <caption>회원가입  - 이름, 아이디, 비밀번호, 비밀번호 확인, 휴대전화, 이메일, 주소, 상세주소, 관심분야, 맞춤 환경정보</caption>
                    <colgroup>
                        <col style="width:140px;">
                        <col>
                    </colgroup>
                    <tbody>
                        <tr th:if="${data.type == 'C'}">
                            <th scope="row">보호자 성명</th>
                            <td>
                                <div class="form-input">
                                    <input type="text" title="보호자 성명" placeholder="보호자 성명 입력" data-width="304" th:value="${pauthData.sName}" readonly="" style="width: 304px; flex: 0 1 304px;">
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">이름<i class="ast" title="필수입력">*</i></th>
                            <td>
                                <div class="row row-auto flex-wrap">
                                    <div class="col">
                                        <div class="form-input">
                                            <input type="text" name="nm" id="nm" maxlength="20" title="이름" placeholder="이름 입력" data-width="304" th:value="${authData.sName}" th:readonly="${authData.sName}">
                                        </div>
                                    </div>
                                    <div class="col">
                                        <p class="feedback"></p>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">아이디<i class="ast" title="필수입력">*</i></th>
                            <td>
                                <div class="row row-auto flex-wrap">
                                    <div class="col">
                                        <div class="form-input">
                                            <input type="text" name="acnt" id="acnt" maxlength="10" title="아이디" placeholder="아이디 입력" data-width="304">
                                            <button type="button" class="btn-medium btn-gray" onclick="checkIdYn()">중복확인</button>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <p class="feedback" id="checkIdMsg"></p>
                                    </div>
                                </div>
                                <p class="desc">* 아이디 영문소문자+숫자 6~10자 이내</p>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">비밀번호<i class="ast" title="필수입력">*</i></th>
                            <td>
                                <div class="row row-auto flex-wrap">
                                    <div class="col">
                                        <div class="form-input"><input type="password" name="pswd" id="pswd" maxlength="12" onkeyup="changePswd()" title="비밀번호" placeholder="비밀번호 입력" data-width="414"></div>
                                    </div>
                                    <div class="col">
                                        <p class="feedback" id="checkPswdMsg"></p>
                                    </div>
                                </div>
                                <p class="desc">* 비밀번호 영문+숫자+특수문자(!@#$) 각 1자 이상 포함아여 9~12자 이내</p>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">비밀번호 확인<i class="ast" title="필수입력">*</i></th>
                            <td>
                                <div class="row row-auto flex-wrap">
                                    <div class="col">
                                        <div class="form-input"><input type="password" name="pswdConfirm" id="pswdConfirm" maxlength="12" onkeyup="changePswdConfirm()" title="비밀번호 확인" placeholder="비밀번호 확인 입력" data-width="414"></div>
                                    </div>
                                    <div class="col">
                                        <p class="feedback" id="checkPswdConfirmMsg"></p>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">휴대전화<i class="ast" title="필수입력" th:if="${data.type != 'C'}">*</i></th>
                            <td>
                                <div class="row row-auto flex-wrap">
                                    <div class="col">
                                        <div class="form-input">
                                            <input type="number" name="moblphon" id="moblphon" maxlength="12" title="휴대전화" placeholder="숫자만 입력" data-width="304" th:value="${authData.sMobileNo}" th:readonly="${data.encodeData != '' and authData.sName != null}">
                                            <button type="button" class="btn-medium btn-gray" th:if="${data.encodeData == ''}" onclick="fnAuthPopup()">본인인증</button>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <p class="feedback" id="checkMoblphonMsg"></p>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">이메일<i class="ast" title="필수입력">*</i></th>
                            <td>
                                <div class="row row-auto flex-wrap">
                                    <div class="col">
                                        <div class="form-input">
                                            <input type="text" name="eml1" id="eml1" maxlength="50" title="이메일 아이디" placeholder="이메일 아이디 입력" data-width="160">
                                            <div class="bul">@</div>
                                            <input type="text" name="eml2" id="eml2" maxlength="50" title="이메일 도메인" placeholder="이메일 도메인 입력" data-width="160">
                                            <select id="emailList" title="이메일 도메인" data-width="150">
                                                <option value="">직접입력</option>
                                                <option value="chol.com">chol.com</option>
                                                <option value="dreamwiz.com">dreamwiz.com</option>
                                                <option value="empal.com">empal.com</option>
                                                <option value="empas.com">empas.com</option>
                                                <option value="freechal.com">freechal.com</option>
                                                <option value="gmail.com">gmail.com</option>
                                                <option value="hanafos.com">hanafos.com</option>
                                                <option value="hanmail.net">hanmail.net</option>
                                                <option value="hanmir.com">hanmir.com</option>
                                                <option value="hitel.net">hitel.net</option>
                                                <option value="hotmail.com">hotmail.com</option>
                                                <option value="korea.com">korea.com</option>
                                                <option value="lycos.co.kr">lycos.co.kr</option>
                                                <option value="megapass.net">megapass.net</option>
                                                <option value="nate.com">nate.com</option>
                                                <option value="naver.com">naver.com</option>
                                                <option value="paran.com">paran.com</option>
                                                <option value="sayclub.net">sayclub.net</option>
                                                <option value="shinbiro.com">shinbiro.com</option>
                                                <option value="yahoo.co.kr">yahoo.co.kr</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <p class="feedback"></p>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">주소<i class="ast" title="필수입력">*</i></th>
                            <td>
                                <div class="row row-auto flex-wrap">
                                    <div class="col">
                                        <div class="form-input">
                                            <input type="text" name="addr" id="addr" title="지번/도로명" placeholder="지번/도로명을 입력해주세요." data-width="500" readonly>
                                            <button type="button" class="btn-medium btn-gray" onclick="daumPostcode1()">검색</button>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <p class="feedback" id="checkAddrMsg"></p>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">상세주소<i class="ast" title="필수입력">*</i></th>
                            <td>
                                <div class="row row-auto flex-wrap">
                                    <div class="col">
                                        <div class="form-input">
                                            <input type="text" name="addrDtl" id="addrDtl" maxlength="400" title="상세주소" placeholder="상세주소를 입력해주세요." data-width="585">
                                        </div>
                                    </div>
                                    <div class="col">
                                        <p class="feedback"></p>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row" rowspan="4">관심분야 <br class="pc-only"><small class="vt">(최대 3개 선택)</small></th>
                            <td>
                                <div class="form-input mo-flex-wrap">
                                    <strong class="label">교육 프로그램</strong>
                                    <span kattr:check_code="itrstfldCds1" grpCd="105" upprCd="105101" addClass="itrstfldCds" />
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="form-input mo-flex-wrap">
                                    <strong class="label">지원사업</strong>
                                    <span kattr:check_code="itrstfldCds2" grpCd="105" upprCd="105102" addClass="itrstfldCds" />
                                </div>
                            </td>
                        </tr>
                        <tr>
                            
                            <td>
                                <div class="form-input mo-flex-wrap">
                                    <strong class="label">제도지원</strong>
                                    <span kattr:check_code="itrstfldCds3" grpCd="105" upprCd="105103" addClass="itrstfldCds" />
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="form-input mo-flex-wrap">
                                    <strong class="label">기타</strong>
                                    <span kattr:check_code="itrstfldCds4" grpCd="105" upprCd="105104" addClass="itrstfldCds" />
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">맞춤 환경정보 <br class="pc-only"><small class="vt">(최대 3개 선택)</small></th>
                            <td>
                                <span kattr:check_code="envfldCds1" grpCd="104" addClass="envfldCds" selectedCd="104101,104105,104106" />
                                <p class="desc-info mt15">선택하신 정보는 로그인 시, 메인 화면에서 위젯 형태로 확인할 수 있습니다.</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="table-caption" th:if="${data.type = 'I'}">
                <div class="left">
                    <h3 class="sub-title">기관정보 입력</h3>
                </div>
                <div class="right">
                    <p class="desc"><span class="ast">*</span>표시는 필수 입력 정보입니다.</p>
                </div>
            </div>

            <div class="table-row table-row-mo" th:if="${data.type = 'I'}">
                <table>
                    <caption>기관 회원가입  - 기관명, 기관유형, 사업자등록번호, 사업자등록증, 대표자 이름, 대표 전화번호, 대표 팩스번호, 홈페이지 주소, 기관 로고, 주소, 상세주소</caption>
                    <colgroup>
                        <col style="width:140px;">
                        <col>
                    </colgroup>
                    <tbody>
                        <tr>
                            <th scope="row">기관명<i class="ast" title="필수입력">*</i></th>
                            <td>
                                <div class="row row-auto flex-wrap">
                                    <div class="col">
                                        <div class="form-input">
                                            <input type="text" title="기관명" placeholder="기관명 입력" data-width="304">
                                            <button type="button" class="btn-medium btn-gray" id="instSearchBtn">기관 검색</button>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <p class="feedback"></p>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">기관유형<i class="ast" title="필수입력">*</i></th>
                            <td>
                                <div class="row row-auto flex-wrap">
                                    <div class="col">
                                        <div class="form-input">
                                            <span kattr:select_code="acnt_lock_cd" grpCd="108" title="기관유형" dataWidth="304" firstOptTxt="선택하세요"></span>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <p class="feedback"></p>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">사업자등록번호<i class="ast" title="필수입력">*</i></th>
                            <td>
                                <div class="form-input">
                                    <input type="text" title="사업자등록번호" placeholder="사업자등록번호 입력" data-width="304">
                                    <button type="button" class="btn-medium btn-gray">중복확인</button>
                                </div>
                                <p class="desc">* 하이픈 &lsquo;-&rsquo; 없이 숫자만 입력해주세요.</p>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">사업자등록증<i class="ast" title="필수입력">*</i></th>
                            <td>
                                <div class="form-input form-input-file">
                                    <label>
                                        <input type="file" id="bizFile" name="bizFile" class="blind" th:attr="accept=${acceptUploadBizFileExt}" title="파일첨부">
                                        <span class="btn-medium btn-gray">파일선택</span>
                                    </label>
                                    <ul id="bizFileUploadSuccess"></ul>
                                    <input type="hidden" name="bizfileFilegrpid" id="bizfileFilegrpid" value="0">
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">대표자 이름<i class="ast" title="필수입력">*</i></th>
                            <td>
                                <div class="row row-auto flex-wrap">
                                    <div class="col">
                                        <div class="form-input">
                                            <input type="text" title="대표자 이름" placeholder="대표자 이름 입력" data-width="414">
                                        </div>
                                    </div>
                                    <div class="col">
                                        <p class="feedback"></p>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">대표전화번호<i class="ast" title="필수입력">*</i></th>
                            <td>
                                <div class="row row-auto flex-wrap">
                                    <div class="col">
                                        <div class="form-input">
                                            <input type="number" title="대표전화번호" placeholder="대표전화번호 입력" data-width="414">
                                        </div>
                                        <p class="desc">* 하이픈 &lsquo;-&rsquo; 없이 숫자만 입력해주세요.</p>
                                    </div>
                                    <div class="col">
                                        <p class="feedback"></p>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">대표팩스번호</th>
                            <td>
                                <div class="form-input">
                                    <input type="number" title="대표팩스번호" placeholder="대표팩스번호 입력" data-width="414">
                                </div>
                                <p class="desc">* 하이픈 &lsquo;-&rsquo; 없이 숫자만 입력해주세요.</p>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">홈페이지 주소</th>
                            <td>
                                <div class="form-input">
                                    <input type="text" title="홈페이지 주소" placeholder="홈페이지 주소 입력" data-width="414">
                                </div>
                                <p class="desc">* 예) https://keep.go.kr</p>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">기관 로고</th>
                            <td>
                                <div class="form-input-file form-input-thumb">
                                    <div class="form-input">
                                        <div class="logo-image">
                                            <img src="" alt="" id="bizLogoImage">
                                            <span class="logo-text">LOGO IMAGE</span>
                                            <input type="hidden" name="bizlogoFileid" id="bizlogoFileid" value="0">
                                        </div>
                                        <label>
                                            <input type="file" id="bizLogo" class="blind" accept=".jpeg,.jpg,.png" title="파일첨부">
                                            <span class="btn-medium btn-gray">파일선택</span>
                                        </label>
                                    </div>
                                </div>
                                <p class="desc">* 로고사진 파일은 10MB 미만의 JPG, PNG파일만 업로드 가능</p>
                                <p class="desc">* 로고사진 크기는 240*120px이 권장사이즈입니다.</p>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">주소<i class="ast" title="필수입력">*</i></th>
                            <td>
                                <div class="row row-auto flex-wrap">
                                    <div class="col">
                                        <div class="form-input">
                                            <input type="text" title="지번/도로명" placeholder="지번/도로명을 입력해주세요." data-width="500" readonly>
                                            <button type="button" class="btn-medium btn-gray" onclick="daumPostcode2()">검색</button>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <p class="feedback"></p>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">상세주소<i class="ast" title="필수입력">*</i></th>
                            <td>
                                <div class="row row-auto flex-wrap">
                                    <div class="col">
                                        <div class="form-input">
                                            <input type="text" title="상세주소" placeholder="상세주소를 입력해주세요." data-width="585">
                                        </div>
                                    </div>
                                    <div class="col">
                                        <p class="feedback"></p>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
                        
            <div class="box-df-list mt10">
                <dl>
                    <dt>개인정보 유효기간</dt>
                    <dd>선택된 유효기간 동안 국가환경교육 통합플랫폼 이용 내역이 없어도 개인정보 분리보관 및 휴면회원으로 전환되지 않습니다.</dd>
                </dl>
                <div class="form-check-list mt10">
                    <label class="inp"><input type="radio" name="prvcVldty" value="1" checked><b>1년</b></label>
                    <label class="inp"><input type="radio" name="prvcVldty" value="2"><b>2년</b></label>
                    <label class="inp"><input type="radio" name="prvcVldty" value="5"><b>5년</b></label>
                    <label class="inp"><input type="radio" name="prvcVldty" value="0"><b>회원탈퇴 시</b></label>
                </div>
            </div>
            
            <div class="btn-wrap">
                <div class="center">
                    <button type="button" class="btn-medium btn-green" onclick="join()">가입하기</button>
                </div>
            </div>
            </form>
            <form name="form_chk" th:action="@{/CheckPlusSafeModel/checkplus.html}" method="post">
                <input type="hidden" name="type" th:value="${data.type}" />
                <input type="hidden" name="kind" value="info" />
            </form>
            
            <!-- layerpopup -->
            <div id="layer-popup05">
            </div>
            <!-- //layerpopup -->
    
            <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
            <script th:inline="javascript">
                var validator= $("#memberInfoForm").validate({
                        onsubmit: false,
                        rules: {
                             nm         :   { required: true, isBlank : true, maxlength: 20 }
                            ,acnt       :   { required: true, isBlank : true, minlength: 6, maxlength: 10, idPolicy1: true }
                            ,pswd       :   { required: true, isBlank : true, passwordPolicy2: true, minlength: 9, maxlength: 12 ,isHangulOff: true }
                            ,pswdConfirm:   { required: true, isBlank : true, passwordPolicy2: true, isHangulOff: true }
                            ,moblphon   :   { 
                            /*[# th:if="${data.type != 'C'}"]*/
                                                required: true,
                            /*[/]*/
                                                number : true, 
                                                maxlength: 12
                                            }
                            ,eml1       :   { required: true, isBlank : true, maxlength: 50 }
                            ,eml2       :   { required: true, isBlank : true, maxlength: 50, emailDomain: true }
                            ,addr       :   { required: true, maxlength: 200 }
                            ,addrDtl    :   { required: true, maxlength: 400 }
                        },
                        messages: {
                             nm         :   { required: "이름을 입력 해주십시오.", isBlank : "이름에 공백이 있습니다.", maxlength: "이름은 20자를 초과할 수 없습니다." }
                            ,acnt       :   { required: "아이디를 입력 해주십시오.", isBlank : "아이디에 공백이 있습니다.", minlength:"아이디 형식이 올바르지 않습니다.", maxlength: "아이디 형식이 올바르지 않습니다.", idPolicy1: "아이디 형식이 올바르지 않습니다." }  
                            ,pswd       :   { required: "비밀번호를 입력 해주십시오.", isBlank : "비밀번호 조건이 일치하지 않습니다.", passwordPolicy2 : "비밀번호 조건이 일치하지 않습니다.", minlength:"비밀번호 조건이 일치하지 않습니다.", maxlength: "비밀번호 조건이 일치하지 않습니다.", isHangulOff: "비밀번호 조건이 일치하지 않습니다." }
                            ,pswdConfirm:   { required: "비밀번호 확인을 입력 해주십시오.", isBlank : "비밀번호 조건이 일치하지 않습니다.", passwordPolicy2 : "비밀번호 조건이 일치하지 않습니다.", isHangulOff: "비밀번호 조건이 일치하지 않습니다." }
                            ,moblphon   :   { 
                            /*[# th:if="${data.type != 'C'}"]*/
                                                required: "휴대전화를 입력 해주십시오.",
                            /*[/]*/ 
                                                number : "숫자만 입력 가능합니다.", 
                                                maxlength:"휴대전화는 12자를 초과할 수 없습니다." }  
                            ,eml1       :   { required: "이메일을 입력 해주십시오.", isBlank : "이메일에 공백이 있습니다.", maxlength: "이메일 아이디는 50자를 초과할 수 없습니다." }
                            ,eml2       :   { required: "이메일을 입력 해주십시오.", isBlank : "이메일에 공백이 있습니다.", maxlength: "이메일 도메인은 50자를 초과할 수 없습니다.", emailDomain: "이메일 형식이 올바르지 않습니다." }
                            ,addr       :   { required: "주소를 입력 해주십시오.", maxlength: "주소는 200자를 초과할 수 없습니다." }
                            ,addrDtl    :   { required: "상세주소를 입력 해주십시오.", maxlength: "상세주소는 400자를 초과할 수 없습니다." }
                        }
                    })
            </script>
            <script type="text/javascript">
                var checkId = "";
                var isDuplicatedId = false;

                //아이디 중복 체크 
                function checkIdYn(){
                    
                    if(!$('#acnt').valid()) return;
                    
                    if(displayWorkProgress(true)){
                        $.ajax({
                            url : "/front/member/checkDuplicationUser.do",
                            type: 'POST',
                            cache : false,
                            dataType: 'json',
                            data : { acnt: $("#acnt").val() },
                            success : function (data){
                                if(!data.result){
                                    $("#checkIdMsg").text("이미 사용중인 아이디입니다.").removeClass("valid").addClass("invalid");
                                    checkId = "";
                                    isDuplicatedId = true;
                                }else{
                                    $("#checkIdMsg").text("사용가능한 아이디입니다.").removeClass("invalid").addClass("valid");
                                    checkId = $("#acnt").val();
                                    isDuplicatedId = false;
                                }
                                closeWorkProgress();
                            }
                        });
                    }
                }
                
                function changePswd(){
                    if($('#pswd').valid()) {
                        $("#checkPswdMsg").text("사용 가능한 비밀번호입니다.").removeClass("invalid").addClass("valid");
                    }
                    
                    if($("#pswdConfirm").val().length > 0) {
                        changePswdConfirm();
                    }
                }
                
                function changePswdConfirm() {
                    if($("#pswd").val()!=$("#pswdConfirm").val()) {
                        $("#checkPswdConfirmMsg").text("비밀번호가 일치하지 않습니다.").removeClass("valid").addClass("invalid");
                        return false;
                    }else{
                        
                        $("#checkPswdConfirmMsg").text("비밀번호가 일치합니다.").removeClass("invalid").addClass("valid");
                        return true;
                    }
                }   
                
                function checkIdDup() {
                    if(checkId !=  $("#acnt").val()){
                        $("#checkIdMsg").text("아이디 중복확인을 해주시기 바랍니다.").removeClass("valid").addClass("invalid");
                        return false;
                    }else{
                        return true;
                    }   
                }
                
                function checkAddr() {
                    if($("#addr").val() == "") {
                        $("#checkAddrMsg").text("주소를 입력 해주십시오.").removeClass("valid").addClass("invalid");
                        return false;
                    }else if($("#addr").val().length > 200){
                        $("#checkAddrMsg").text("주소는 200자를 초과할 수 없습니다.").removeClass("valid").addClass("invalid");
                        return false;
                    }
                    return truel;
                }
                
                function join(){
                    if(!($("#memberInfoForm").valid())){
                        if($("#checkIdMsg").text() == "" || checkId !=  $("#acnt").val()) $("#acnt").focus();
                        if($("#checkPswdMsg").text() == "") changePswd();
                        if($("#checkPswdConfirmMsg").text() == "") $("#pswdConfirm").focus();   
                        // readonly라 별도 처리
                        if(!checkAddr()) {
                          if($(".feedback.invalid", "#memberInfoForm").length == 1) {
                              window.scrollTo({top: document.getElementById("addr").getBoundingClientRect().top-128 + window.pageYOffset});
                          }  
                        } 
                        return;
                    }

                    changePswd();
                    
                    var checkIdDupResult = checkIdDup();
                    var checkPswdConfirmResult = changePswdConfirm();
                    
                    if($("#moblphon").val() != '' && $("#encodeData").val() == '') {
                        $("#moblphon").focus();
                        $("#checkMoblphonMsg").text("휴대전화 본인인증을 해주시기 바랍니다.").removeClass("valid").addClass("invalid");
                        return;
                    }
                    
                    if(checkIdDupResult && checkPswdConfirmResult){
                        if($("input[name=envfldCds1]:checked").length > 3) {
                            alert("맞춤 환경정보는 최대 3개 까지만 선택가능합니다.");
                            return;
                        }
                        
                        if(($("input[name=itrstfldCds1]:checked").length + $("input[name=itrstfldCds2]:checked").length + $("input[name=itrstfldCds3]:checked").length + $("input[name=itrstfldCds4]:checked").length) > 3) {
                            alert("관심분야는 최대 3개 까지만 선택가능합니다.");
                            return;
                        }
                        
                        if(!confirm("회원가입을 완료하시겠습니까?")) return;
                
                        var itrstfldCds = $('.itrstfldCds:checked').map(function(){ return $(this).val();}).get().join(",");
                        var envfldCds   = $('.envfldCds:checked').map(function(){ return $(this).val();}).get().join(",");
                        
                        var data =  $("#memberInfoForm").serialize();
                        data = data+"&itrstfldCds="+itrstfldCds+"&envfldCds="+envfldCds

                        if(displayWorkProgress(true)){
                            $.ajax({
                                url : "/front/member/insertMember.do",
                                type: 'POST',
                                cache : false,
                                dataType: 'json',
                                data : data,
                                success : function (data){
                                    if(data.result=="success"){
                                        if($("#returnUrl").val() != ''){
                                            location.href="/front/membership/step5.html?type=" + $("#type").val() + "&returnUrl=" + $("#returnUrl").val();
                                        }else{
                                            location.href="/front/membership/step5.html?type=" + $("#type").val();
                                        }
                                    }else{
                                        alert(data.msg);
                                    }
                                    closeWorkProgress();
                                }
                            });
                        }
                    }else{
                        if(!checkPswdConfirmResult) $("#pswdConfirm").focus();
                        if(!checkIdDupResult) $("#acnt").focus();
                    }
                }
                
                function fnAuthPopup(){
                    window.open('', 'popupChk', 'width=500, height=550, top=100, left=100, fullscreen=no, menubar=no, status=no, toolbar=no, titlebar=yes, location=no, scrollbar=no');
                    document.form_chk.target = "popupChk";
                    document.form_chk.submit();
                }
                
                function setEncodeData(encodeData) {
                    document.memberInfoForm.encodeData.value = encodeData;
                    $("#checkMoblphonMsg").text("휴대전화 본인인증이 완료되었습니다.").removeClass("invalid").addClass("valid");
                }
                
                function setInstArtclid(artclid) {
                    alert('부모창에서 받음' + artclid);
                }
        
                function daumPostcode1(){
                    new daum.Postcode({
                        oncomplete: function(data) {
                            let addr = '';
                            if (data.userSelectedType === 'R') {
                                addr = data.roadAddress;
                            } else {
                                addr = data.jibunAddress;
                            }
                            $('#signguCd').val(data.sigunguCode);
                            $('#zip').val(data.zonecode);
                            $('#addr').val(addr);
                            $('#addrDtl').focus();
                        }
                    }).open();
                }
                
                function daumPostcode2(){
                    new daum.Postcode({
                        oncomplete: function(data) {
                            let addr = '';
                            if (data.userSelectedType === 'R') {
                                addr = data.roadAddress;
                            } else {
                                addr = data.jibunAddress;
                            }
                            $('#instSignguCd').val(data.sigunguCode);
                            $('#instZip').val(data.zonecode);
                            $('#instAddr').val(addr);
                            $('#instAddrDtl').focus();
                        }
                    }).open();
                }
                
                $('#bizFile').on("change", function (event) {
                    var objFile = event.target;
                    var formData = new FormData();
        
                    formData.append("file", objFile.files[0]);
                    formData.append("filegrpNm", "biz_file");
        
                    if (displayWorkProgress(true)) {
                        $.ajax({
                            url: '/registFile.do',
                            processData: false,
                            contentType: false,
                            data: formData,
                            type: 'POST',
                            success: function (response) {
                                if (response.result == 'fail') {
                                    alert(response.msg);
                                }else if(response.filegrpid != undefined && response.filegrpid != ''){
                                    $("#bizfileFilegrpid").val(response.filegrpid);
                                    var result = `
                                            <li id="${response.fileid}" class='file-block' data_ext='${response.fileExtsn.substr(1)}'>
                                                <span class="name">
                                                    <a href="javascript:void(0)" data-fileid="${response.fileid}" data-file-idntfc-key="${response.fileIdntfcKey}"
                                                     onclick="javascript:downloadFileByFileid(this.dataset.fileid, this.dataset.fileIdntfcKey)"> ${response.orginlFileNm}
                                                    </a>
                                                </span>
                                                <button type="button" class="file-delete" title="삭제" data-fileid="${response.fileid}" onclick="deleteBizFile(this.dataset.fileid)">
                                                    <span class="icon icon-circle-close"></span>
                                                </button>
                                            </li>
                                        `; 
                                    $('#bizFileUploadSuccess').html(result);
                                }
                                closeWorkProgress();
                            }
                        });
                        $("#bizFile").val("");
                    }
                });
                
                function deleteBizFile(fileid) {
                    $("#"+fileid).remove();
                    $("#bizfileFilegrpid").val(0);
                }
                
                $('#bizLogo').on("change", function (event) {
                    var objFile = event.target;
                    var formData = new FormData();
        
                    formData.append("file", objFile.files[0]);
                    formData.append("filegrpNm", "biz_logo");
        
                    if (displayWorkProgress(true)) {
                        $.ajax({
                            url: '/registFile.do',
                            processData: false,
                            contentType: false,
                            data: formData,
                            type: 'POST',
                            success: function (response) {
                                if (response.result == 'fail') {
                                    alert(response.msg);
                                }else if(response.filegrpid != undefined && response.filegrpid != ''){
                                    $("#bizlogoFileid").val(response.fileid);
                                    //response.fileIdntfcKey
                                    $("#bizLogoImage").attr("src",`/downloadLogo.do?fileid=${response.fileid}&file_idntfc_key=${response.fileIdntfcKey}`);
                                }
                                closeWorkProgress();
                            }
                        });
                        $("#bizLogo").val("");
                    }
                });
                
                $(function(){
                    $('#emailList').change(function(e){
                        var self = $(this);
                        var val = self.val();
                        $('input#eml2').val(val);
                    });
                    
                    jQuery("#instSearchBtn").bind("click",function(){     
                        $("#layer-popup05").load("/front/membership/instSearchPopup.html", function(response, status, xhr) {
                            if (status == "success") {
                                layerPopup.open({target:'layer-popup05', h: "640px", callback: function(){ initInstSearchPopup(); }});
                            }
                        });
                    });
                });
            </script>
        </th:block>
    </body>
</html>