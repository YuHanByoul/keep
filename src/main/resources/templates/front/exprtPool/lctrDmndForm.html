<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="layout/front/subLayout">

<div layout:fragment="content">
    <form name="lctrDmndForm" id="lctrDmndForm">
        <div class="table-caption">
            <div class="left">
                <h3 class="sub-title">강의요청서 작성</h3>
            </div>
            <div class="right">
                <p class="desc"><span class="ast">*</span>표시는 필수 입력 정보입니다.</p>
            </div>
        </div>

        <div class="table-row table-row-mo">
            <table>
                <caption>강의요청서 작성 - 제목, 강의 시작일시, 강의종료일시, 강의장소(지역),상세주소, 신청자 휴대전화, 신청자 이메일, 요청내용, 첨부파일</caption>
                <colgroup>
                    <col style="width:140px;">
                    <col>
                    <col style="width:140px;">
                    <col>
                </colgroup>
                <tbody>
                <tr>
                    <th scope="row">제목<i class="ast" title="필수입력">*</i></th>
                    <td colspan="3">
                        <div class="form-input">
                            <input type="text" title="제목" placeholder="제목을 입력해주세요." id="ttl" name="ttl">
                        </div>
                        <p class="feedback"></p>
                    </td>
                </tr>
                <tr>
                    <th scope="row">강의 시작 일시<i class="ast" title="필수입력">*</i></th>
                    <td>
                        <div class="form-input">
                            <input type="datetime-local" title="시작일" id="lctrBgngDt" name="lctrBgngDt">
                        </div>
                        <p class="feedback"></p>
                    </td>
                    <th scope="row">강의 종료 일시<i class="ast" title="필수입력">*</i></th>
                    <td>
                        <div class="form-input">
                            <input type="datetime-local" title="종료일" id="lctrEndDt" name="lctrEndDt">
                        </div>
                        <p class="feedback"></p>
                    </td>
                </tr>
                <tr>
                    <th scope="row">강의 장소(지역)<i class="ast" title="필수입력">*</i></th>
                    <td colspan="3">
                        <div class="form-input mo-flex-wrap">
                            <div class="form-input">
                                <div class="bul">지번/도로명</div>
                            </div>
                            <div class="form-input">
                                <input type="text" title="지번/도로명" placeholder="지번/도로명을 입력해주세요." data-width="500" readonly id="addr" name="addr">
                                <button type="button" class="btn-medium btn-gray" onclick="frontLctrDmndForm.daumPostCode()" title="새창열림">검색</button>
                            </div>
                        </div>
                        <p class="feedback"></p>
                        <p class="desc">지번주소 : 동/읍/면/리 이름을 입력하세요. 예) 역삼동, 화도읍, 둔내면 <br> 도로명주소(새주소) : 도로명을 입력하세요. 예) 중앙로, 불정로432번길</p>

                    </td>
                </tr>
                <tr>
                    <th scope="row">상세주소<i class="ast" title="필수입력">*</i></th>
                    <td colspan="3">
                        <div class="form-input">
                            <input type="text" title="상세주소" placeholder="상세주소를 입력해주세요." id="addrDtl" name="addrDtl">
                        </div>
                        <p class="feedback"></p>
                    </td>
                </tr>
                <tr>
                    <th scope="row">신청자 휴대전화<i class="ast" title="필수입력">*</i></th>
                    <td colspan="3">
                        <div class="form-input">
                            <input type="number" title="신청자 휴대전화" placeholder="하이픈 &lsquo;-&rsquo; 없이 숫자만 입력해주세요" data-width="300" id="moblphon" name="moblphon">
                        </div>
                        <p class="feedback"></p>
                    </td>
                </tr>
                <tr>
                    <th scope="row">신청자 이메일<i class="ast" title="필수입력">*</i></th>
                    <td colspan="3">
                        <div class="form-input">
                            <input type="text" title="이메일 아이디" placeholder="이메일 아이디 입력" data-width="160" id="emailLocal" name="emailLocal">
                            <div class="bul">@</div>
                            <input type="text" title="이메일 도메인" placeholder="이메일 도메인 입력" data-width="160" id="emailDomain" name="emailDomain">
                            <select id="emailDomainList" title="이메일 도메인 목록" data-width="120">
                                <option value="">직접입력</option>
                                <option value="chol.com">chol.com</option>
                                <option value="dreamwiz.com">dreamwiz.com</option>
                                <option value="empal.com">empal.com</option>
                                <option value="empas.com">empas.com</option>
                                <option value="freechal.com">freechal.com</option>
                                <option value="gmail.com">gmail.com</option>
                                <option value="hanafos.com">hanafos.com</option>
                                <option value="hanmail.net">hanmail.net</option>
                                <option value="hanmir.com">hanmir.com</option>
                                <option value="hitel.net">hitel.net</option>
                                <option value="hotmail.com">hotmail.com</option>
                                <option value="korea.com">korea.com</option>
                                <option value="lycos.co.kr">lycos.co.kr</option>
                                <option value="megapass.net">megapass.net</option>
                                <option value="nate.com">nate.com</option>
                                <option value="naver.com">naver.com</option>
                                <option value="paran.com">paran.com</option>
                                <option value="sayclub.net">sayclub.net</option>
                                <option value="shinbiro.com">shinbiro.com</option>
                                <option value="yahoo.co.kr">yahoo.co.kr</option>
                            </select>
                        </div>
                        <p class="feedback"></p>
                    </td>
                </tr>
                <tr>
                    <th scope="row">요청 내용<i class="ast" title="필수입력">*</i></th>
                    <td colspan="3">
                        <div class="form-input">
                            <textarea title="요청 내용" placeholder="강의 요청 내용을 입력해주세요." id="dmndCn" name="dmndCn"></textarea>
                        </div>
                        <p class="feedback"></p>
                    </td>
                </tr>
                <tr>
                    <th scope="row">첨부파일</th>
                    <td colspan="3">
                        <div class="form-input-file">
                            <span class="form-input">
                                <input id="multiFileInput" name="files" type="file" multiple class="blind" title="파일첨부" maxcount="5" 
                                       th:attr="accept=${acceptUploadFileExt}">
                            </span>
                            <button class="btn-medium btn-gray" type="button" title="파일선택" onclick="javascript:$('#multiFileInput').click()">파일선택</button>
                            <ul id="multipleFileUploadSuccess">
                            </ul>
                            <input type="hidden" id="filegrpid" name="filegrpid" value="0"/>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="box-desc-list bg7 mt10">
            <ul>
                <li>첨부 가능 확장자 :
                    <th:block>
                        <th:block th:each="item, itemStat : ${fileConfiguration.uploadFileExtsn}">
                            [[${item.value}]]
                            <th:block th:if="${!itemStat.last}">,&nbsp;</th:block>
                        </th:block>
                    </th:block>
                </li>
                <li>첨부 가능 총 용량 : [[${fileConfiguration.uploadFileTotalSize}]]Mbyte</li>
                <li>첨부 가능 개별 용량 : [[${fileConfiguration.uploadFileSize}]]Mbyte</li>
            </ul>
        </div>

        <div class="btn-wrap">
            <div class="center">
                <button type="button" class="btn-medium btn-gray" onclick="frontLctrDmndForm.previous()">이전</button>
                <button type="button" class="btn-medium btn-green" onclick="frontLctrDmndForm.save()">요청</button>
            </div>
        </div>

        <input type="hidden" name="exprtid" id="exprtid" th:value="${searchVo.userid}">
        <input type="hidden" name="signguCd" id="signguCd"/>
        <input type="hidden" name="zip" id="zip"/>
        <input type="hidden" name="eml" id="eml"/>
    </form>

    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script th:inline="javascript">
        let frontLctrDmndForm = {
            successUrl: '/front/exprtPool/lctrDmndSuccess.html',
            insertUrl: '/front/exprtPool/insertLctrDmnd.do',

            init() {
                this.validateForm();
            },

            validateForm() {
                $('#lctrDmndForm').validate({
                    rules: {
                        ttl: {required: true, maxlength: 100},
                        lctrBgngDt: {required: true},
                        lctrEndDt: {required: true},
                        zip: {required: true, maxlength: 10},
                        addr: {required: true, maxlength: 200},
                        addrDtl: {required: true, maxlength: 400},
                        moblphon: {required: true, maxlength: 11, number: true},
                        emailLocal: {required: true, maxlength: 100, isBlank: true},
                        emailDomain: {required: true, maxlength: 100, isBlank: true, emailDomain: true},
                        dmndCn: {required: true, maxlength: 1000},
                    },
                    messages: {
                        ttl: {required: "제목을 입력해 주십시오.", maxlength: "제목은 100자를 넘을 수 없습니다."},
                        lctrBgngDt: {required: "강의 시작 일시를 입력해 주십시오."},
                        lctrEndDt: {required: "강의 종료 일시를 입력해 주십시오."},
                        zip: {required: '우편번호를 입력해 주십시오.', maxlegnth: '우편번호는 10자를 초과할 수 없습니다.'},
                        addr: {required: "주소를 입력해 주십시오.", maxlength: "주소는 200자를 넘을 수 없습니다."},
                        addrDtl: {required: "상세주소를 입력해 주십시오.", maxlength: "상세주소는 400자를 넘을 수 없습니다."},
                        moblphon: {required: "휴대전화를 입력해 주십시오.", maxlength: "휴대전화는 11자를 넘을 수 없습니다.", number: "숫자만 입력 가능합니다."},
                        emailLocal: {required: "이메일 아이디를 입력해 주십시오.", maxlength: "이메일 아이디는 100자를 넘을 수 없습니다.", isBlank: "이메일에 공백이 있습니다."},
                        emailDomain: {required: "이메일 도메인을 입력해 주십시오.", maxlength: "이메일 도메인은 100자를 넘을 수 없습니다.", isBlank: "이메일에 공백이 있습니다.", emailDomain: "이메일 형식이 올바르지 않습니다."},
                        dmndCn: {required: "내용을 입력해 주십시오.", maxlength: "내용은 1000자를 넘을 수 없습니다."},
                    }
                });
            },

            previous() {
                history.back();
            },

            save() {
                if (!$('#lctrDmndForm').valid()) return;

                if(confirm('섭외요청을 완료하시겠습니까?')) {
                    $('#eml').val($('#emailLocal').val() + "@" + $('#emailDomain').val());
                    if (displayWorkProgress(true)) {
                        $.ajax({
                            method: 'post',
                            cache: false,
                            url: frontLctrDmndForm.insertUrl,
                            data: $('#lctrDmndForm').serializeArray(),
                            dataType: 'json',
                            success: function (response) {
                                if (response.result == "success") {
                                    location.href = frontLctrDmndForm.successUrl;
                                } else {
                                    alert(response.msg);
                                }
                                closeWorkProgress();
                            }
                        })
                    }
                }
            },

            daumPostCode() {
                new daum.Postcode({
                    oncomplete: function (data) {
                        let addr = '';
                        if (data.userSelectedType === 'R') {
                            addr = data.roadAddress;
                        } else {
                            addr = data.jibunAddress;
                        }
                        $('#signguCd').val(data.sigunguCode);
                        $('#zip').val(data.zonecode);
                        $('#addr').val(addr);
                        $('#addrDtl').focus();
                    }
                }).open();
            }
        }

        $(function () {
            frontLctrDmndForm.init();
            addFileUploadEvent('multiFileInput', 'lctrDmnd_file', 'multipleFileUploadSuccess');

            $('#emailDomainList').change(function () {
                $val = $(this).val();
                $('#emailDomain').val($val);
                if ($val == '') $("#emailDomain").focus();
            })
        })
    </script>
</div>
