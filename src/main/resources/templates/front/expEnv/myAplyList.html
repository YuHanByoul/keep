<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
    xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
    layout:decorator="layout/front/subLayout" >
<body>
    <div layout:fragment="content">
        <!-- content -->
        <div id="content" class="content">

            <form class="search-filter" id="searchForm" name="searchForm">
                <input type="hidden" id="pageNumber" name="pageNumber" th:value="${reqMngVo.pageNumber == null ? 1 : reqMngVo.pageNumber}">
                <input type="hidden" id="rowPerPage" name="rowPerPage" th:value="${reqMngVo.rowPerPage == null ? 10 : reqMngVo.rowPerPage}">
                <input type="hidden" id="ORDER_DIRECTION" name="orderDirection" value="desc">
                <input type="hidden" id="orderField" name="orderField" value="REG_DT">
                <input type="hidden" id="pcntstid" name="pcntstid" />
                <input type="hidden" id="aplyid" name="aplyid" />
                <input type="hidden" id="fldCd" name="fldCd" />
                <input type="hidden" id="mode" name="mode" />
                <div class="form-input-wrap">
                    <div class="form-row">
                        <div class="form-header"><strong class="label">사업분야</strong></div>
                        <div class="form-body">
                            <span kattr:select_code="searchFldCd" th:attr="selectedCd=${reqMngVo.searchFldCd}" grpCd="173" firstOptTxt="- 전체 -" addClass="input-sm" title="사업분야">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-header"><strong class="label">공모명</strong></div>
                        <div class="form-body">
                            <input type="search" title="공모명" placeholder="공모명을 입력해주세요." name="searchPcntstNm" id="searchPcntstNm" th:value="${reqMngVo.searchPcntstNm}">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-header"><strong class="label">프로그램명</strong></div>
                        <div class="form-body">
                            <input type="search" title="프로그램명" placeholder="프로그램명을 입력해주세요." name="searchPrgrmNm" id="searchPrgrmNm" th:value="${reqMngVo.searchPrgrmNm}">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-header"><strong class="label">진행상태</strong></div>
                        <div class="form-body">
                            <select title="상태" id="status" name="status">
                                <option value="">- 전체 -</option>
                                <option value="192101" th:selected="${reqMngVo.status == '192101'}">신청중</option>
                                <option value="192102" th:selected="${reqMngVo.status == '192102'}">신청완료</option>
                                <option value="201101" th:selected="${reqMngVo.status == '201101'}">보완요청</option>
                                <option value="201102" th:selected="${reqMngVo.status == '201102'}">보완완료</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="search-filter-submit">
                    <button type="button" class="btn-medium btn-gray btn-before-refresh" onclick="listPage.searchInit();">초기화</button>
                    <button type="submit" class="btn-medium btn-green btn-before-search" onclick="listPage.search(); return false;">검색</button>
                </div>
            </form>

            <div class="table-caption flex-nowrap">
                <div class="left">
                    <p>총 <b id="totalCount">0</b> 건</p>
                </div>
                <div class="right d-flex">
                    <select title="글 보기 개수" class="sort-filter" id="rowPerPageChangeSelect">
                        <option value="10">10개</option>
                        <option value="50">50개</option>
                        <option value="100">100개</option>
                    </select>
                    <div><button type="button" id="rowPerPageChange" class="btn-medium btn-outline-black">보기</button></div>
                </div>
            </div>

            <div class="pc-only">
                <div class="table-col table-layout-auto table-col-mo">
                    <table>
                        <caption>공모신청 - 번호, 진행상태, 사업분야, 공모명, 신청기간, 사업기간, 등록일,</caption>
                        <colgroup>
                            <col style="width:6%;">
                            <col>
                            <col>
                            <col style="width:11%;">
                            <col style="width:15%;">
                            <col style="width:12%;">
                            <col style="width:10%;">
                            <col style="width:9%;">
                        </colgroup>
                        <thead>
                            <tr>
                                <th scope="col">번호</th>
                                <th scope="col">사업분야</th>
                                <th scope="col">공모명</th>
                                <th scope="col">접수번호</th>
                                <th scope="col">프로그램명</th>
                                <th scope="col">신청상태</th>
                                <th scope="col">접수일</th>
                                <th scope="col">선정결과</th>
                            </tr>
                        </thead>
                        <tbody id="list-area">
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="mo-only">
                <div class="table-list">
                    <ul id="list-mobile-area">
                    </ul>
                </div>
            </div>

            <div id="pagination" aria-label="pagination"></div>
        </div>
        <!-- //content -->

        <!-- layerpopup -->
        <div class="layer-popup layer-large" data-layer-id="suppModalPopup">
            <div class="layer-dimmed" title="레이어팝업 닫기"></div>
            <div class="layer-wrap" id="suppModalPopup">
            </div>
        </div>

        <script th:inline="javascript">
        /*<![CDATA[*/
        var requestURI = /*[[${#httpServletRequest.requestURI}]]*/null;
        /*]]>*/
        var listPage = {
            listUrl: '/front/expEnv/selectMyAplyList.do',
            detailUrl : '/front/expEnv/baseInfoForm.html',

            init(rowPerPage) {
                if(rowPerPage != null) {
                    $("#rowPerPage").val(parseInt(rowPerPage));
                    $('#pageNumber').val('1');
                }
                this.selectList();
            },
            search() {
                $('#pageNumber').val('1');
                this.selectList();
            },
            searchInit() {
                $("#searchPcntstNm").val('');
                $("#searchPrgrmNm").val('');
                $("#searchFldCd").val('');
                $("#status").val('');
//              this.selectList();
            },
            selectList() {
                if (displayWorkProgress(true)) {
                    let formData = $('#searchForm').serializeArray();

                    $.ajax({
                        url: listPage.listUrl,
                        cache: false,
                        dataType: 'json',
                        data: formData,
                        type: 'GET',
                        success: function (data) {
                            listPage.makeListHtml(data);
                            closeWorkProgress();
                        }
                    });
                }
            },
            moveToDetail(pcntstid, aplyid, fldCd) {
                var f = document.forms.searchForm ;
                f.pcntstid.value = pcntstid;
                f.aplyid.value = aplyid;
                f.fldCd.value = fldCd;
                f.mode.value = 'U';
                f.action = this.detailUrl;
                f.submit();
            },
            suppPopup: function(splmntid) {
                $("#suppModalPopup").load("/front/expEnv/detailSplmntForm.html?splmntid=" + splmntid, function(response, status, xhr) {
                    if (status == "success") {
                        layerPopup.open({target:'suppModalPopup'});
                    }
                });
            },
            makeListHtml(data) {
                var listHtml = "";
                var mobileHtml = "";
                if (data.list == null || data.list.length <= 0) {
                    listHtml += `
                    <tr>
                        <td class="nodata" colspan="8">
                            <p><span class="icon icon-notice bg-black9"></span>등록된 공모신청이 없습니다.</p>
                        </td>
                    </tr>
                    `;
                    mobileHtml += `
                    <div class="nodata">
                        <p><span class="icon icon-notice bg-black9"></span>등록된 공모신청이 없습니다.</p>
                    </div>
                    `;
                } else {
                    data.list.forEach(function(item) {
                        listHtml += `
                        <tr>
                            <td>${item.rowNumber}</td>
                            <td>${item.fldNm}</td>
                            <td>${item.pcntstNm}</td>
                            <td>${item.aplyno}</td>
                            <td><a href="javascript:listPage.moveToDetail(${item.pcntstid},${item.aplyid},${item.fldCd})" class="link ellipsis">${item.prgrmNm}</a></td>`;
                            if(`${item.splmntid}` == 'null'){
                                listHtml += `<td>${item.aplySttsNm}</td>`;
                            } else {
                                listHtml += `<td><button type="button" class="link" onclick="listPage.suppPopup(${item.splmntid})">${item.aplySttsNm}</button></td>`;
                            }
                            listHtml += `
                            <td>${item.regDe}</td>
                            <td>${item.slctnSttsNm}</td>
                        </tr>
                        `;
                        mobileHtml += `
                        <li class="block">
                            <div class="tbody">
                                <dl>
                                    <div class="list">
                                        <dt>번호</dt>
                                        <dd>${item.rowNumber}</dd>
                                    </div>
                                    <div class="list">
                                        <dt>사업분야</dt>
                                        <dd>${item.fldNm}</dd>
                                    </div>
                                    <div class="list">
                                        <dt>공모명</dt>
                                        <dd>${item.pcntstNm}</dd>
                                    </div>
                                    <div class="list">
                                        <dt>접수번호</dt>
                                        <dd>${item.aplyno}</dd>
                                    </div>
                                    <div class="list">
                                        <dt>프로그램명</dt>
                                        <dd><a href="javascript:listPage.moveToDetail(${item.pcntstid},${item.aplyid},${item.fldCd})" class="link ellipsis">${item.prgrmNm}</a></dd>
                                    </div>`;
                            if(`${item.splmntid}` == 'null'){
                                mobileHtml += `
                                    <div class="list">
                                        <dt>신청상태</dt>
                                        <dd>${item.aplySttsNm}</dd>
                                    </div>`;
                            } else {
                                mobileHtml += `
                                    <div class="list">
                                        <dt>신청상태</dt>
                                        <dd><button type="button" class="link" onclick="listPage.suppPopup(${item.splmntid})">${item.aplySttsNm}</button></dd>
                                    </div>`;
                            }
                            mobileHtml += `
                                    <div class="list">
                                        <dt>접수일</dt>
                                        <dd>${item.regDe}</dd>
                                    </div>
                                    <div class="list">
                                        <dt>선정상태</dt>
                                        <dd>${item.slctnSttsNm}</dd>
                                    </div>
                                </dl>
                            </div>
                        </li>
                        `;
                    });
                }
                $('#list-area').html(listHtml);
                $('#list-mobile-area').html(mobileHtml);
                $("#pagination").html(data.pagination);
                $("#totalCount").html(data.totalCount);
            }
        };

        $(function () {
            listPage.init();
            $("#rowPerPageChange").click(function(){
                $("#rowPerPage").val($("#rowPerPageChangeSelect").val());
                listPage.init($("#rowPerPageChangeSelect").val());
            });
        });

        function goPage(page) {
            $("#pageNumber").val(page);

            listPage.selectList();
        }

        </script>
    </div>
</body>
</html>