`
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="layout/front/nolnbSubLayout">
<div layout:fragment="content">
    <div class="steps">
        <ol>
            <li>
                <div class="steps-inner">
                    <span>01</span>
                    <strong>약관동의</strong>
                </div>
            </li>
            <li class="active" title="현재 단계" aria-current="step">
                <div class="steps-inner">
                    <span>02</span>
                    <strong>신청정보입력</strong>
                </div>
            </li>
            <li>
                <div class="steps-inner">
                    <span>03</span>
                    <strong>가입완료</strong>
                </div>
            </li>
        </ol>
    </div>
    <form id="registForm" name="registForm" th:action="@{/front/infntAply/infntAplyRegStep3.html}" method="post">
    <input type="hidden" id="prgrmid" name="prgrmid" th:value="${infntAplyParamVo.prgrmid}" />
    <input type="hidden" id="tmeSchdlid" name="tmeSchdlid" th:value="${infntAplyParamVo.tmeSchdlid}" />
    <input type="hidden" id="instid" name="instid" th:value="${infntAplyRegVo.instid}" />
    <input type="hidden" id="aplyUserid" name="aplyUserid" th:value="${infntAplyRegVo.aplyUserid}" />
    <input type="hidden" id="addr" name="addr" th:value="${infntAplyRegVo.addr}" />
    <input type="hidden" id="addrDtl" name="addrDtl" th:value="${infntAplyRegVo.addrDtl}" />
    <input type="hidden" id="telno" name="telno" th:value="${infntAplyRegVo.telno}" />
    <input type="hidden" id="eml" name="eml" th:value="${infntAplyRegVo.eml}" />
    
	    <div class="table-caption">
	        <h3 class="sub-title">프로그램 정보</h3>
	    </div>
	
	    <div class="table-row">
	        <table>
	            <caption>프로그램 정보 - 프로그램, 교육관, 교육정원, 교육시간, 교육대상, 교육회차</caption>
	            <colgroup>
	                <col style="width:140px;">
	                <col>
	                <col style="width:140px;">
	                <col>
	            </colgroup>
	            <tbody>
	                <tr>
	                    <th scope="row">프로그램</th>
	                    <td><th:block th:text="${infntAplyRegVo.prgrmNm}"></th:block></td>
	                    <th scope="row">교육관</th>
	                    <td><th:block th:text="${infntAplyRegVo.clssrmNm}"></th:block></td>
	                </tr>
	                <tr>
	                    <th scope="row">교육정원</th>
	                    <td><th:block th:text="|${infntAplyRegVo.eduNope}명|"></th:block></td>
	                    <th scope="row">교육시간</th>
	                    <td><th:block th:text="|${infntAplyRegVo.eduHrMnt}분|"></th:block></td>
	                </tr>
	                <tr>
	                    <th scope="row">교육대상</th>
	                    <td><th:block th:text="${infntAplyRegVo.trgtNm}"></th:block></td>
	                    <th scope="row">교육회차</th>
	                    <td><th:block th:text="|${infntAplyRegVo.de}, ${infntAplyRegVo.tmeNm}|"></th:block></td>
	                </tr>
	            </tbody>
	        </table>
	    </div>
	
	
	    <div class="table-caption">
	        <h3 class="sub-title">신청 정보</h3>
	    </div>
	
	    <div class="table-row table-row-mo">
	        <table>
	            <caption>신청 정보 - 신청기관, 전화번호, 신청자명, 휴대전화, 기관주소, 상세주소, 이메일, 교육대상, 총 교육인원, 인솔교사인원, 신청인 지역, 기타사항</caption>
	            <colgroup>
	                <col style="width:140px;">
	                <col>
	                <col style="width:140px;">
	                <col>
	            </colgroup>
	            <tbody>
	                <tr>
	                    <th scope="row">신청기관</th>
	                    <td><th:block th:text="${infntAplyRegVo.instNm}"></th:block></td>
	                    <th scope="row">전화번호</th>
	                    <td><th:block th:text="${infntAplyRegVo.telno}"></th:block></td>
	                </tr>
	                <tr>
	                    <th scope="row">신청자명</th>
	                    <td><th:block th:text="${infntAplyRegVo.aplyUserNm}"></th:block></td>
	                    <th scope="row">신청자 이메일</th>
	                    <td><th:block th:text="${infntAplyRegVo.eml}"></th:block></td>
	                </tr>
	                <tr>
	                    <th scope="row">기관주소</th>
	                    <td><th:block th:text="${infntAplyRegVo.addr}"></th:block></td>
	                    <th scope="row">상세주소</th>
	                    <td><th:block th:text="${infntAplyRegVo.addrDtl}"></th:block></td>
	                </tr>
	                <tr>
	                    <th scope="row">방문교사 휴대전화<i class="ast" title="필수입력">*</i></th>
	                    <td>
	                        <div class="form-input">
	                            <input type="text" id="moblphon" name="moblphon" title="방문교사 휴대전화" placeholder="교육일에 방문하는 교사 휴대폰 번호" />
	                        </div>
	                        <p class="desc fc-red">※ '-' 를 제외하고 입력해주세요.</p>
	                        <p class="feedback"></p>
	                    </td>
	                    <th scope="row">교육대상<i class="ast" title="필수입력">*</i></th>
	                    <td>
	                        <div class="form-input">
	                            <div class="form-check-list">
	                                <th:block th:each="item, stat : ${trgtList}">
	                                   <label class="inp"><input type="checkbox" class="trgtCds" th:id="|trgtCd${stat.count}|" name="trgtCd" th:value="${item.TRGTCD}"><b><th:block th:text="${item.TRGTNM}"></th:block></b></label>
<!-- 	                                <span kattr:check_code="trgtCd" th:attr="grpCd=162,selectedCd=${infntAplyRegVo.trgtCd}" addClass="trgtCds" /> -->
	                                </th:block>
	                            </div>
	                        </div>
	                    </td>
	                </tr>
	                <tr>
	                    <th scope="row">총 교육인원<i class="ast" title="필수입력">*</i></th>
	                    <td>
	                        <div class="form-input mo-flex-wrap">
	                            <div class="bul">총</div>
	                            <input type="number" class="ar" id="eduNope" name="eduNope" title="총 교육인원" style="flex:0 0 50px;width:50px;" min="1">
	                            <div class="bul">명</div>
	                        </div>
	                        <p class="feedback"></p>
	                    </td>
	                    <th scope="row">인솔교사인원<i class="ast" title="필수입력">*</i></th>
	                    <td>
	                        <div class="form-input mo-flex-wrap">
	                            <div class="bul">총</div>
	                            <input type="number" class="ar" id="tcherNope" name="tcherNope" title="인솔 교육인원" style="flex:0 0 50px;width:50px;" min="1">
	                            <div class="bul">명</div>
	                        </div>
	                        <p class="desc fc-red">※ 유아 10명당 인솔교사 1명 필수 참석</p>
	                        <p class="feedback"></p>
	                    </td>
	                </tr>
	                <tr>
	                    <th scope="row">신청인 지역<i class="ast" title="필수입력">*</i></th>
	                    <td colspan="3">
	                        <div class="form-input">
	                            <th:block kattr:select_code="ctprvnCd" grpCd="143" firstOptTxt="- 선택 -"></th:block>
	                        </div>
	                        <p class="feedback"></p>
	                    </td>
	                </tr>
	                <tr>
	                    <th scope="row">기타사항</th>
	                    <td colspan="3">
	                        <textarea name="etc" id="etc" title="기타사항" placeholder="요청사항 또는 특이사항이 있으시면, 여기에 남겨주세요." maxlength="300"></textarea>
	                        <div class="desc ar size"><span id="etcTextSize">0</span> / 200자</div>
	                    </td>
	                </tr>
	            </tbody>
	        </table>
	    </div>
	    <div class="form-check-all">
	        <label class="inp"><input id="towwayOnlnEduAgreYn" name="towwayOnlnEduAgreYn" type="checkbox"><b class="normal-wrap">쌍방향 온라인 시범교육 신청 동의(비동의 시 교육 선정 및 진행 불가)<i class="ast" title="필수입력">*</i></b></label>
	    </div>
	    <div class="btn-wrap">
	        <div class="center">
	            <button type="button" class="btn-medium btn-green" onclick="infntAplyRegStep2.insertApply();">교육신청</button>
	        </div>
	    </div>
    </form>

    <script th:inline="javascript">
    $(function () {
        infntAplyRegStep2.validateForm();
        
        $('#etc').keyup(function (e) {
            let content = $(this).val();
            if (content == '' || content.length == 0) {
                $('#etcTextSize').text('0');
            } else {
                $('#etcTextSize').text(content.length);
            }
            // 기타사항 text size 제한
            if (content.length > 200) {
                $(this).val($(this).val().substring(0, 200));
            };
        });        
    })    
    var infntAplyRegStep2 = {    
   		insertApply() {
            if(!isMobilePhone($("#moblphon").val())) {
                alert("방문교사 휴대전화를 확인해주세요.");
                $("#moblphon").focus();
                return false;
            }   
               
            if ($("input[name=trgtCd]:checked").length == 0) {
                alert('교육대상을 선택해주십시오.')
                $('#trgtCd1').focus();
                return;
            }
            
            if (!$('#registForm').valid()) return;
            
            if(!confirm("교육신청을 하시겠습니까?")) return;
            
            var trgtCds = $('.trgtCds:checked').map(function(){ return $(this).val();}).get().join(",");
            
            $('#towwayOnlnEduAgreYn').prop("checked") ? $('#towwayOnlnEduAgreYn').val("Y") : $('#towwayOnlnEduAgreYn').val("N");
            
            var data =  $("#registForm").serialize();
            data = data+"&trgtCds="+trgtCds;
            if(displayWorkProgress(true)){
                $.ajax({
                    url : "/front/infntAply/insertInfntAply.do",
                    type: 'POST',
                    cache : false,
                    dataType: 'json',
                    data : data,
                    success : function (data){
                    	var data = escapeData(data);
                        if(data.result=="success"){
                            $("#registForm").submit();
                        }else{
                            alert(data.msg);
                        }
                        closeWorkProgress();
                    }
                });
            }            

        },
        validateForm() {
            $('#registForm').validate({
                rules: {
                	moblphon: {required: true}
                    , eduNope: {required: true}
                    , tcherNope: {required: true}
                    , ctprvnCd: {required: true}
                },
                messages: {
                	moblphon: {required: '방문교사 휴대전화를 입력해주십시오.'}
                    , eduNope: {requried: '교육인원을 입력해주십시오.'}
                    , tcherNope: {required: "인솔교사인원을 입력해주십시오."}
                    , ctprvnCd: {required: "신청인 지역을 선택해주십시오."}
                }
            });
        },
    }
    </script>
</div>
`