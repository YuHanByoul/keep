<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security" 
    xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout" 
    layout:decorator="layout/front/simpleLayout" >
<body>
	<div layout:fragment="content">
		<form name="pswdUpdateForm" id="pswdUpdateForm">
		<input type="hidden" name="returnUrl" id="returnUrl" th:value="${returnUrl}" />
			<section>
				<div class="underline-title">
					<h2>내 정보</h2>
				</div>
				
				<h3 class="blind">탭 제목</h3>
				
				<div class="tab-content tab-sub dropDown">
					<button type="button" class="tab-mobile-trigger trigger" aria-haspopup="listbox" aria-expanded="true">내 정보 수정</button>
					<ul class="tab-list tab-list-pc target" role="tablist">
						<li class="tab"><a href="javascript:goUpdateMyInfo();" role="tab">내 정보 수정</a></li>
						<li class="tab active"><a role="tab" >비밀번호 변경</a></li>
					</ul>
				</div>
		
				<div class="section-title">
					<h3>비밀번호 변경</h3>
				</div>
		
				<div class="table-caption">
					<div class="right">
						<p class="desc"><span class="ast">*</span>표시는 필수 입력 정보입니다.</p>
					</div>
				</div>
		
				<div class="table-row table-row-mo">
					<table>
						<caption>비밀번호 찾기 - 회원 아이디, 변경 비밀번호, 변경 비밀번호 확인</caption>
						<colgroup>
							<col style="width:140px;">
							<col>
						</colgroup>
						<tbody>
							<tr>
								<th scope="row">현재 비밀번호<i class="ast" title="필수입력">*</i></th>
								<td>
									<div class="row row-auto flex-wrap">
										<div class="col">
											<div class="form-input"><input type="password" id="pswd" name="pswd" title="현재 비밀번호" placeholder="현재 비밀번호를 입력해주세요." data-width="414" autocomplete="off"></div>
										</div>
										<div class="col">
											<p class="feedback" id="pswdMsg"></p>
										</div>
									</div>
								</td>
							</tr>
							<tr>
								<th scope="row">변경 비밀번호<i class="ast" title="필수입력">*</i></th>
								<td>
									<div class="row row-auto flex-wrap">
										<div class="col">
											<div class="form-input"><input type="password" id="chgPswd" name="chgPswd" maxlength="12" onkeyup="changePswd()" title="비밀번호" placeholder="변경 비밀번호를 입력해주세요." data-width="414" autocomplete="off"></div>
										</div>
										<div class="col">
											<p class="feedback" id="checkChgPswdMsg"></p>
										</div>
									</div>
									<p class="desc">* 비밀번호 영문+숫자+특수문자(!@#$) 각 1자 이상 포함하여 9~12자 이내</p>
								</td>
							</tr>
							<tr>
								<th scope="row">변경 비밀번호 <br> 확인<i class="ast" title="필수입력">*</i></th>
								<td>
									<div class="row row-auto flex-wrap">
										<div class="col">
											<div class="form-input"><input type="password" id="chgPswdIdnty" name="chgPswdIdnty" maxlength="12" onkeyup="changePswdConfirm()" title="비밀번호 확인" placeholder="비밀번호를 다시 한 번 입력해주세요." data-width="414" autocomplete="off"></div>
										</div>
										<div class="col">
											<p class="feedback" id="checkChgPswdIdntyMsg"></p>
										</div>
									</div>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
		
				
				<!-- 디지털원패스 -->
				<th:block th:if="${userVo.acnt} == null">
					<th:block th:if="${userVo.onepassLinkYn} == 'Y'">
						<div class="box-step-end">
							<div class="thumb"><span class="icon icon-info-pop-warning" title=""></span></div>
							<dl>
								<dt>디지털원패스로 신규 연동한 회원입니다.</dt>
								<dd>디지털원패스로 신규 연동한 회원은 비밀번호가 존재하지 않습니다.</dd>
							</dl>
						</div>
					</th:block>
				</th:block>
				<!-- //디지털원패스 -->
				
				<div class="btn-wrap">
					<div class="center">
						<button type="button" class="btn-medium btn-gray" onclick="cancel();">취소</button>
						<button type="button" class="btn-medium btn-green" onclick="updatePswd();">변경하기</button>
					</div>
				</div>
		
			</section>
		</form>
		<script th:inline="javascript">
			function goUpdateMyInfo() {
	            var portalUrl = /*[[${T(com.kbrainc.plum.rte.util.CommonUtil).portalUrl}]]*/ "";
	            /*[# th:if="${returnUrl != null and returnUrl != ''}"]*/
	                location.href = portalUrl + "front/myInfo/myInfoUpdate.html?returnUrl=" + /*[[${returnUrl}]]*/'';   
	            /*[/]*/
	            /*[# th:unless="${returnUrl != null and returnUrl != ''}"]*/
	                location.href = portalUrl + "front/myInfo/myInfoUpdate.html";
	            /*[/]*/
			}
			
			function cancel() {
				if(!confirm("이전 페이지로 이동 하시겠습니까?")) return;
				
	            var portalUrl = /*[[${T(com.kbrainc.plum.rte.util.CommonUtil).portalUrl}]]*/ "";
	            /*[# th:if="${returnUrl != null and returnUrl != ''}"]*/
	                location.href = /*[[${returnUrl}]]*/'';
	            /*[/]*/
	            /*[# th:unless="${returnUrl != null and returnUrl != ''}"]*/
	                location.href = portalUrl;
	            /*[/]*/
			}
			
            var validator= $("#pswdUpdateForm").validate({
                rules: {
                	 pswd			:   { required: true }
                	,chgPswd		:   { required: true, isBlank: true, passwordPolicy2: true, minlength: 9, maxlength: 12 ,isHangulOff: true }
                    ,chgPswdIdnty	:   { required: true, isBlank: true, passwordPolicy2: true, isHangulOff: true }
                },
                messages: {
                	 pswd			:   { required: "현재 비밀번호를 입력 해주십시오."}
                	,chgPswd		:   { required: "변경 비밀번호를 입력 해주십시오.", isBlank: "비밀번호 조건이 일치하지 않습니다.", passwordPolicy2: "비밀번호 조건이 일치하지 않습니다.", minlength:"비밀번호 조건이 일치하지 않습니다.", maxlength: "비밀번호 조건이 일치하지 않습니다.", isHangulOff: "비밀번호 조건이 일치하지 않습니다." }
                    ,chgPswdIdnty	:   { required: "변경 비밀번호 확인을 입력 해주십시오.", isBlank: "비밀번호 조건이 일치하지 않습니다.", passwordPolicy2: "비밀번호 조건이 일치하지 않습니다.", isHangulOff: "비밀번호 조건이 일치하지 않습니다." }
                }
            });
			
            function changePswd(){
                if($('#chgPswd').valid()) {
                    $("#checkChgPswdMsg").text("사용 가능한 비밀번호입니다.").removeClass("invalid").addClass("valid");
                }
                
                if($("#chgPswdIdnty").val().length > 0) {
                    changePswdConfirm();
                }
            }
            
            function changePswdConfirm() {
                if($("#chgPswd").val()!=$("#chgPswdIdnty").val()) {
                    $("#checkChgPswdIdntyMsg").text("비밀번호가 일치하지 않습니다.").removeClass("valid").addClass("invalid");
                    return false;
                }else{
                    $("#checkChgPswdIdntyMsg").text("비밀번호가 일치합니다.").removeClass("invalid").addClass("valid");
                    return true;
                }
            }
			
			function updatePswd() {
				var pswd = $("#pswd").val();
				var chgPswd = $("#chgPswd").val();
				var chgPswdIdnty = $("#chgPswdIdnty").val();
				
	            if(!($("#pswdUpdateForm").valid())) return;
	            
	            if(!confirm("변경하시겠습니까?")) return;
	            
	            var data =  $("#pswdUpdateForm").serialize();
 				if(displayWorkProgress(true)){
	                $.ajax({
	                    url : "/front/myInfo/updatePswd.do",
	                    type: 'POST',
	                    cache : false,
	                    dataType: 'json',
	                    data : data,
	                    success : function (data){
	                        if(data.result=="success"){
	                        	alert(data.msg);
	            				$("#pswd").val("");
	            				$("#chgPswd").val("");
	            				$("#chgPswdIdnty").val("");
	            				$("#checkChgPswdMsg").text("").removeClass("valid");
	            				$("#checkChgPswdIdntyMsg").text("").removeClass("valid");
	                        }else{
	                            alert(data.msg);
	                        }
	                        closeWorkProgress();
	                    }
	                });
	            }
			}
		</script>
	</div>

</body>
</html>