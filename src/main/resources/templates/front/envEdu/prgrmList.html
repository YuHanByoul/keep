<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security" 
    xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout" 
    layout:decorator="layout/front/subLayout" >
<body>
	<div layout:fragment="content">
		<!-- content -->
		<form class="search-filter" id="searchForm" name="searchForm">
			<div class="form-input-wrap">
				<div class="form-row">
					<div class="form-header"><strong class="label">프로그램명</strong></div>
					<div class="form-body">
						<input type="text" id="searchPrgrmNm" name="searchPrgrmNm" title="프로그램명" placeholder="프로그램명을 입력해 주세요.">
					</div>
				</div>
				<div class="form-row">
					<div class="form-header"><strong class="label">기관명</strong></div>
					<div class="form-body">
						<input type="text" id="searchInstNm" name="searchInstNm" title="기관명" placeholder="기관명을 입력해 주세요.">
					</div>
				</div>
				<div class="form-row">
					<div class="form-header"><strong class="label">지역</strong></div>
					<div class="form-body">
                        <select id="searchRgnCd" name="searchRgnCd" title="지역">
                            <option value="">- 전체 -</option>
                            <th:block th:each="code : ${sidoList}">
                                <option th:value="${code.CTPRVN_CD}">[[${code.CTPRVN_NM}]]</option>
                            </th:block>
                        </select>
					</div>
				</div>
				<div class="form-row">
					<div class="form-header"><strong class="label">교육대상</strong></div>
					<div class="form-body">
						<select id="searchEduTarget" name="searchEduTarget" title="교육대상">
							<option value="">- 전체 -</option>
							<option value="infnt">유아</option>
							<option value="schboy">초등</option>
							<option value="msklsd">중등</option>
							<option value="hgschst">고등</option>
							<option value="adult">성인</option>
							<option value="all">전연령</option>
						</select>
					</div>
				</div>
				<div class="form-row">
					<div class="form-header"><strong class="label">교육주제</strong></div>
					<div class="form-body">
						<div class="form-input">
	                        <select name="searchManinEduSbjctCd" id="searchEduSbjctCd_1" title="교육주제" onchange="setSearchSelectBox.setNextDepth(155,this.value,'searchEduSbjctCd_2')">
	                            <option value="">- 전체 -</option>
	                        </select>
							<select name="searchMdleEduSbjctCd" id="searchEduSbjctCd_2" title="교육주제 상세" style="flex:auto">
			                	<option value="">- 전체 -</option>
			                </select>
						</div>
					</div>
				</div>
				
		        <input type="hidden" id="pageNumber" name="pageNumber" value="1">
		        <input type="hidden" id="rowPerPage" name="rowPerPage" value="12">
		        <input type="hidden" id="ORDER_DIRECTION" name="orderDirection" value="desc">
		        <input type="hidden" id="orderField" name="orderField" value="REG_DT">
		        <input type="hidden" id="prgrmid" name="prgrmid" >				
			</div>
			<div class="search-filter-submit">
				<button type="button" class="btn-medium btn-gray btn-before-refresh" onclick="prgrm.searchInit()">초기화</button>
				<button type="button" class="btn-medium btn-green btn-before-search" onclick="prgrm.search()">검색</button>
			</div>
		</form>

		<div class="tab-content">
			<div class="table-caption flex-nowrap">
				<div class="left">
					<p>총 <b id="totalCount">0</b> 건</p>
				</div>
				<div class="right">
					<div class="sort-tab">
						<ul class="tab-list" role="tablist">
							<li class="active"><button role="tab" aria-controls="tab-album1" id="album-tab1"><span class="icon icon-sort-album"></span>앨범형</button></li>
							<li><button role="tab" aria-controls="tab-list1" id="list-tab1"><span class="icon icon-sort-list"></span>목록형</button></li>
						</ul>
					</div>
				</div>
			</div>
			<div id="tab-album1" class="tabpanel" role="tabpanel" aria-labelledby="album-tab1">
				<div class="card-section" id="card-table"> 
					<ul class="n3" id="cardList-area">
					</ul>
				</div>
				<div id="pagination1" aria-label="pagination">
				</div>
			</div>
			<div id="tab-list1" class="tabpanel" role="tabpanel" aria-labelledby="list-tab1">

				<div class="pc-only">
					<div class="table-col table-layout-auto">
						<table>
							<caption>프로그램 - 번호, 지정번호, 프로그램명, 기관명, 지역, 교육대상, 참가비(1인), 지정일</caption>
							<colgroup>
								<col style="width:6%;">
								<col style="width:11%;">
								<col>
								<col style="width:12%;">
								<col style="width:9%;">
								<col style="width:12%;">
								<col style="width:10%;">
								<col style="width:10%;">
							</colgroup>
							<thead>
								<tr>
									<th scope="col">번호</th>
									<th scope="col">지정번호</th>
									<th scope="col">프로그램명</th>
									<th scope="col">기관명</th>
									<th scope="col">지역</th>
									<th scope="col">교육대상</th>
									<th scope="col">참가비(1인)</th>
									<th scope="col">지정일</th>
								</tr>
							</thead>
							<tbody id="pc-list-area">
							</tbody>
						</table>
					</div>
				</div>

				<div class="mo-only">
					<div class="table-list">
						<ul id="mo-list-area">
						</ul>
					</div>
				</div>

				<div id="pagination2" aria-label="pagination">
				</div>
			</div>
		</div>
		<!-- //content -->
				
		<script th:inline="javascript">
		var mainEduSbjctCd = /*[[${mainEduSbjctCd}]]*/ null;
		var eduSbjctCd = /*[[${eduSbjctCd}]]*/ null;
		var getCodeListUrl = "/mng/customAttr/grpCodeList.do"
		
	    $("input").on("keyup",function(key){
	        if(key.keyCode==13) {
	        	prgrm.search();
	        }
	    });
		
		var setSearchSelectBox = {
		 	fn_getNextDepthList : function(grpcd , upprcd, targetId, selected, sessionId){
				$.ajax({
					url : getCodeListUrl,
					type: 'GET',
					cache : false,
					dataType: 'json',
					async: false,
					data: {
						  grpcd  : grpcd
						, upprcd : upprcd
					}, 
					success : function (data){
						setSearchSelectBox.writeHtml(grpcd,targetId,data, selected, sessionId);
					},
				 	error : function (error){
					} 
					
				});
			},

		 	writeHtml : function(grpcd, targetId, list, selected, sessionId){
			 	var cntArr = targetId.split("_");
			   	var nextCnt = Number(cntArr[1])+1;
			   	var nextTarget = cntArr[0]+"_"+nextCnt;
			   	
			    var html ="<select id='"+targetId+"' onchange=setSearchSelectBox.setNextDepth('"+grpcd+"',this.value,'"+nextTarget+"')>";
			        html +="    <option value=''>- 전체 -</option>";
		    	   
		  		for(var i=0 ; i < list.length;i++){
		  			if(list[i].cd==selected){
		   				html +="    <option value="+list[i].cd+" selected>"+ list[i].cdNm+ "</option>";
		  			}else{
		  				html +="    <option value="+list[i].cd+">"+ list[i].cdNm+ "</option>";
		  			}
		  		}
		  		
				if(list.length == 0 && jQuery("#"+nextTarget)[0] != undefined){
					setSearchSelectBox.writeHtml(grpcd,nextTarget,list,selected);
				}
				html +="    </select>";
				
				$("#"+targetId).html(html);
				
				if(sessionId == "searchEduSbjctCd_2"){
					sessionStorage.removeItem("searchEduSbjctCd_1");
					sessionStorage.removeItem("searchEduSbjctCd_2");
				}
		 	},
		 	
		    setNextDepth : function(grpcd , upprcd , targetId, selected){
				setSearchSelectBox.fn_getNextDepthList(grpcd , upprcd , targetId, selected);
			}
		}
		
    	if(sessionStorage.getItem("searchEduSbjctCd_2") != null){
        	setSearchSelectBox.fn_getNextDepthList(155 , 0, 'searchEduSbjctCd_1', sessionStorage.getItem("searchEduSbjctCd_1"));
    		setSearchSelectBox.fn_getNextDepthList(155, sessionStorage.getItem("searchEduSbjctCd_1"), "searchEduSbjctCd_2", sessionStorage.getItem("searchEduSbjctCd_2"), "searchEduSbjctCd_2");            		
    	}else{
    		setSearchSelectBox.fn_getNextDepthList(155 , 0, 'searchEduSbjctCd_1', mainEduSbjctCd == null ? sessionStorage.getItem("searchEduSbjctCd_1") : mainEduSbjctCd);
    		setSearchSelectBox.fn_getNextDepthList(155, mainEduSbjctCd == null ? sessionStorage.getItem("searchEduSbjctCd_1") : mainEduSbjctCd,'searchEduSbjctCd_2', eduSbjctCd == null ? sessionStorage.getItem("searchEduSbjctCd_2") : eduSbjctCd, "searchEduSbjctCd_2");	
    	}
		
        var prgrm = {
	        	listUrl: '/front/envEdu/selectPrgrmList.do',
	            detailUrl : '/front/envEdu/prgrmDetailForm.html',

	            init(rowPerPage) {
	            	if(rowPerPage != null) {
		            	$("#rowPerPage").val(parseInt(rowPerPage));
		                $('#pageNumber').val('1');
	                }
	                this.selectPrgrmList();
	            },

	            moveToDetail(prgrmid, eduSbjctCd) {
                	if(eduSbjctCd == null && $("#searchEduSbjctCd_2").val() != "") {
                		sessionStorage.setItem("searchEduSbjctCd_1", $("#searchEduSbjctCd_1").val());
                		sessionStorage.setItem("searchEduSbjctCd_2", $("#searchEduSbjctCd_2").val());
                	}
                	
	            	if(eduSbjctCd == null) {
		                location.href = '/front/envEdu/prgrmDetailForm.html?prgrmid='+prgrmid;	            		
	            	}else{
	            		location.href = '/front/envEdu/prgrmDetailForm.html?prgrmid='+prgrmid+'&eduSbjctCd='+eduSbjctCd;
	            	}
	            },

	            search() {
               		sessionStorage.setItem("searchEduSbjctCd_1", $("#searchEduSbjctCd_1").val());
               		sessionStorage.setItem("searchEduSbjctCd_2", $("#searchEduSbjctCd_2").val());
	            	
	                $('#pageNumber').val('1');
	                this.selectPrgrmList();
	            },

	            searchInit() {
	            	sessionStorage.clear();
	    			$("#searchPrgrmNm").val('');
	    			$("#searchInstNm").val('');
	    			$("#searchRgnCd").val('');
	    			$("#searchEduTarget").val('');
	    			$("#searchEduSbjctCd_1").val('');
	    			$("#searchEduSbjctCd_2").val('');
	            },

	            selectPrgrmList() {
	            	if (displayWorkProgress(true)) {	            		
	                	let formData = $('#searchForm').serializeArray();

	                    $.ajax({
	                    	url: prgrm.listUrl,
	                        cache: false,
	                        dataType: 'json',
	                        data: formData,
	                        type: 'GET',
	                        success: function (result) {
	                        	if(mainEduSbjctCd == ""){
		                			$("#searchEduSbjctCd_1").val('');
		                			$("#searchEduSbjctCd_2").val('');	                        		
	                        	}
	                        	
	                        	$('#card-table').removeClass();
	                            $('#card-table').addClass('card-section');
	                        	
	                            $("#pagination1").html(result.pagination);
	                            $("#pagination2").html(result.pagination);
	                            $("#totalCount").html(result.totalCount);
	                        	 var data = escapeData(result);
	                        	prgrm.makeListHtml(data);
	                        	closeWorkProgress();
	                        }
	                    });
	            	}
	            },

                makeListHtml(data) {
                    var cardListHtml = "";
                    var pc_listHtml = "";
                    var mo_listHtml = "";
                    
                    if (data.list == null || data.list.length <= 0) {
                    	 pc_listHtml += `
                            <tr>
                                <td class="nodata" colSpan="8">
                                    <p><span class="icon icon-notice bg-black9"></span>등록된 프로그램이 없습니다.</p>
                                </td>
                            </tr>
                         `;
                         
                    	 mo_listHtml += `
 							<li class="block">
								<div class="nodata">
									<p><span class="icon icon-notice bg-black9"></span>등록된 프로그램이 없습니다.</p>
								</div>
							</li>
                         `; 
                            
                         $('#card-table').removeClass();
                         $('#card-table').addClass('nodata');
                         cardListHtml += `
               				<p><span class="icon icon-notice bg-black9"></span>등록된 프로그램이 없습니다.</p>
                         `;
                    } else {
                        data.list.forEach(function(item) {
                            var dsgnNo = !item.dsgnNo ? "-" : item.dsgnNo; 
                            var dsgnDe = !item.dsgnDe ? "-" : item.dsgnDe;
                             
                        	pc_listHtml += `
                            <tr>
                            <td>${item.rowNumber}</td>
                            <td>${dsgnNo}</td>
                            <td class="al article"><a class="link ellipsis" href="javascript:prgrm.moveToDetail(${item.prgrmid}, ${eduSbjctCd})">${item.prgrmNm}</a></td>
   							<td>${item.instNm}</td>
   							<td>${item.ctprvnNm}</td>
   							<td>${item.eduTarget}</td>
   							<td>${item.etrfee}</td>
   							<td>${dsgnDe}</td>
   							</tr>
   							`;
   							
                        	mo_listHtml += `
   							<li class="block">
								<div class="tbody">
									<dl>
										<div class="list">
											<dt>번호</dt>
											<dd>${item.rowNumber}</dd>
										</div>
										<div class="list">
											<dt>지정번호</dt>
											<dd>${dsgnNo}</dd>
										</div>
										<div class="list">
											<dt>프로그램명</dt>
											<dd><a href="javascript:prgrm.moveToDetail(${item.prgrmid}, ${eduSbjctCd})" class="link ellipsis">${item.prgrmNm}</a></dd>
										</div>
										<div class="list">
											<dt>기관명</dt>
											<dd>${item.instNm}</dd>
										</div>
										<div class="list">
											<dt>지역</dt>
											<dd>${item.ctprvnNm}</dd>
										</div>
										<div class="list">
											<dt>교육대상</dt>
											<dd>${item.eduTarget}</dd>
										</div>
										<div class="list">
											<dt>참가비(1인)</dt>
											<dd>${item.etrfee}</dd>
										</div>
										<div class="list">
											<dt>지정일</dt>
											<dd>${dsgnDe}</dd>
										</div>
									</dl>
								</div>
							</li>
   							`;
   							
   							var ctprvnNm = item.ctprvnNm;
   							var ctprvnTag = "";   							
   							switch(ctprvnNm) {
                                case "서울특별시":
                                    ctprvnTag = '<div class="tag tag-green">' + ctprvnNm + '</div>';
                                break;
                                       
                                case "부산광역시":       
                                case "대구광역시":       
                                case "울산광역시":       
                                case "경상북도":       
                                case "경상남도":
                                    ctprvnTag = '<div class="tag tag-olive">' + ctprvnNm + '</div>';
                                break;       
                                
                                case "인천광역시":       
                                case "경기도":       
                                    ctprvnTag = '<div class="tag tag-blue">' + ctprvnNm + '</div>';
                                break;
                                
                                case "광주광역시":       
                                case "전라북도":       
                                case "전라남도":       
                                    ctprvnTag = '<div class="tag tag-red">' + ctprvnNm + '</div>';
                                break;
                                
                                case "세종특별자치시":
                                case "대전광역시":       
                                case "충청북도":       
                                case "충청남도":       
                                    ctprvnTag = '<div class="tag tag-purple">' + ctprvnNm + '</div>';
                                break;
                                
                                case "강원도":       
                                case "제주특별자치도":       
                                    ctprvnTag = '<div class="tag tag-brown">' + ctprvnNm + '</div>';
                                break;
                            }
   							
   							var etrfeeTag = "";
   							if(item.etrfee == '무료') {
   								etrfeeTag = `${item.etrfee}</span>`;
   							}else {
   								etrfeeTag = `${item.etrfee}</span>원`;
   							}
   	  	    				
   	  	    				// 교육대상
   	  	    				var eduTargetStr = item.eduTarget;
   	  	    				var eduTarget = [];
   	  	    				var eduTargetTag = "";
   	  	    				
   	  	    				if(eduTargetStr != null && eduTargetStr != ""){
   	  	    					eduTarget = eduTargetStr.split(",");   	  	    					
	  	    				}
   	  	    				
   	  	    				eduTarget.forEach(function(index) {
   	  	    					eduTargetTag += `<div>${index}</div>`;
   	  	    				});
   	  	    				
   	  	    				// 교육주제
   	  	    				// 생활환경, 자연환경, 지구환경, 환경문화
   	  	    				var livingEnv = "";   	  	    				
   	  	    				var naturalEnv = "";   	  	    				
   	  	    				var globalEnv = "";   	  	    				
   	  	    				var cultureEnv = "";
   	  	    				var other =  "";
   	  	    				
   	  	    				var eduSbjctStr = item.eduSbjctCdNm;
   	  	    				var eduSbjct = [];
   	  	    				var eduSbjctTag = "";
   	  	    			
   	  	    				if(eduSbjctStr != null && eduSbjctStr != ""){
	   	  	    				eduSbjct = eduSbjctStr.split(",");   	  	    					
   	  	    				}
   	  	    				
   	  	    				eduSbjct.forEach(function(index) {
   	  	    					switch(index) {
   	  	    					case "소음" :
   	  	    					case "폐기물 및 자원순환" :
   	  	    					case "환경보건" :
   	  	    						livingEnv += ', ' + index;
   	  	    					break;
   	  	    					
   	  	    					case "물" :
   	  	    					case "토양" :
   	  	    					case "생태계" :
   	  	    						naturalEnv += ', ' + index;
   	  	    					break;
   	  	    					
   	  	    					case "기후변화 및 탄소중립" :
   	  	    					case "대기" :
   	  	    					case "에너지" :
   	  	    						globalEnv += ', ' + index;
   	  	    					break;
   	  	    					
   	  	    					case "지속가능발전" :
   	  	    					case "생명윤리" :
   	  	    						cultureEnv += ', ' + index;
   	  	    					break;
   	  	    					
   	  	    					case "기타" :
   	  	    						other += ', ' + index;
   	  	    					break;	
	  	    					}
   	  	    				});
   	  	    				
   	  	    				if(livingEnv != ""){
   	  	    					eduSbjctTag += `<li><button type="button" title="툴팁">#생활환경</button><div>${livingEnv.slice(2)}</div></li>`
   	  	    				}
   	  	    				if(naturalEnv != ""){
   	  	    					eduSbjctTag += `<li><button type="button" title="툴팁">#자연환경</button><div>${naturalEnv.slice(2)}</div></li>`
   	  	    				}
   	  	    				if(globalEnv != ""){
   	  	    					eduSbjctTag += `<li><button type="button" title="툴팁">#지구환경</button><div>${globalEnv.slice(2)}</div></li>`
   	  	    				}
   	  	    				if(cultureEnv != ""){
   	  	    					eduSbjctTag += `<li><button type="button" title="툴팁">#환경문화</button><div>${cultureEnv.slice(2)}</div></li>`
   	  	    				}
   	  	    				if(other != ""){
   	  	    					eduSbjctTag += `<li><button type="button" title="툴팁">#기타</button><div>${other.slice(2)}</div></li>`
   	  	    				}
   	  	    				
  	    					cardListHtml += `
							<li>
								<div class="thumb">
									<img src="/downloadFileByFileid.do?fileid=${item.fileid}&file_idntfc_key=${item.fileIdntfcKey}" alt="" onerror="this.src='/images/front/bg/bg-noimage.png'">
									${ctprvnTag}
									<dl class="target">
										<dt class="blind">대상</dt>
										<dd>
											${eduTargetTag}
										</dd>
									</dl>
								</div>
								<div class="cont">
									<div class="part ellipsis">${item.instNm}</div>
									<a href="javascript:prgrm.moveToDetail(${item.prgrmid}, ${eduSbjctCd})" class="title ellipsis" data-ellipsis="2">${item.prgrmNm}</a>
									<ul class="hash">
										${eduSbjctTag}
									</ul>
									<div class="d-flex a-center j-between description">
										<div class="fs-14 fc-black6">운영형태 : ${item.cdNm}</div>
										<div class="fs-16 fc-black3">참가비 <span class="fw-500">${etrfeeTag}</div>
									</div>
								</div>
							</li>  	    					
  	    					`;
                        });
                    }
                    $('#cardList-area').html(cardListHtml);	
                    $('#pc-list-area').html(pc_listHtml);
                    $('#mo-list-area').html(mo_listHtml);
                }
	        };

            $(function () {
            	prgrm.init();
            })
			
			function goPage(page) {
				$("#pageNumber").val(page);
				
				prgrm.selectPrgrmList();
			}            
		</script>
	</div>

</body>
</html>